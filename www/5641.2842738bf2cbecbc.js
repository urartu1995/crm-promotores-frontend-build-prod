"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5641,3666,1285],{3274:(H,w,l)=>{l.d(w,{K:()=>x});var o=l(177),t=l(3953);let x=(()=>{var T;class h{}return(T=h).\u0275fac=function(v){return new(v||T)},T.\u0275mod=t.$C({type:T}),T.\u0275inj=t.G2t({imports:[o.MD]}),h})()},7380:(H,w,l)=>{l.d(w,{$:()=>e});var o=l(467),t=l(3953),x=l(2081),T=l(8397),h=l(1213),y=l(3955),v=l(9417);const b=V=>({item:V}),f=V=>({field:V});function E(V,c){if(1&V){const U=t.RV6();t.j41(0,"div",1)(1,"div",4)(2,"textarea",5),t.nI1(3,"translate"),t.nI1(4,"translate"),t.mxI("ngModelChange",function(I){t.eBV(U);const j=t.XpG();return t.DH7(j.textNote,I)||(j.textNote=I),t.Njj(I)}),t.k0s()()()}if(2&V){const U=t.XpG();t.R7$(2),t.FS9("placeholder",t.i5U(4,4,"text.input_placeholder_fem",t.eq3(7,f,t.bMT(3,2,"text."+U.options.type)))),t.R50("ngModel",U.textNote)}}let e=(()=>{var V;class c{constructor(u,I,j,G){this.api=u,this.toast=I,this.byvaroState=j,this.translate=G,this.onNoteCreated=new t.bkB,this.textNote=""}ngOnInit(){this.getUserInfo()}getUserInfo(){this.byvaroState.getState().subscribe(u=>{this.currentUser=u.user,this.currentUserAgency=u.agency,this.currentUserPromoter=u.promoter})}onCreateNote(){var u=this;return(0,o.A)(function*(){var I,j,G;if(!u.textNote)return void u.toast.showToast({text:u.translate.instant("activity_creation_block.error_empty_note"),theme:"red",time:3e3});const z={id:void 0,createdAt:void 0,updatedAt:void 0,text:u.textNote,createdById:null===(I=u.currentUser)||void 0===I?void 0:I.id,contactId:u.options.contactId,promoterId:null===(j=u.currentUserPromoter)||void 0===j?void 0:j.id,agencyId:null===(G=u.currentUserAgency)||void 0===G?void 0:G.id,operationId:u.options.operationId},D=yield u.api.createNote(z);D.success?(u.toast.showToast({text:u.translate.instant("activity_creation_block.success_note_created"),theme:"success",time:2e3}),u.textNote="",u.onNoteCreated.emit(D.success.data)):u.toast.showToast({text:u.translate.instant("activity_creation_block.error_note_creation")+D.error.errorMessage,theme:"red",time:3e3})})()}}return(V=c).\u0275fac=function(u){return new(u||V)(t.rXU(x.i),t.rXU(T.f),t.rXU(h.c),t.rXU(y.c$))},V.\u0275cmp=t.VBU({type:V,selectors:[["app-activity-creation-block"]],inputs:{options:"options"},outputs:{onNoteCreated:"onNoteCreated"},decls:7,vars:9,consts:[[1,"crm-activity-content"],[1,"crm-input"],[1,"crm-section-buttons-right"],[1,"crm-button",3,"click"],[1,"crm-input-input","crm-input-input-textarea"],[3,"ngModelChange","ngModel","placeholder"]],template:function(u,I){1&u&&(t.j41(0,"div",0),t.DNE(1,E,5,9,"div",1),t.j41(2,"div",2)(3,"button",3),t.bIt("click",function(){return I.onCreateNote()}),t.EFF(4),t.nI1(5,"translate"),t.nI1(6,"translate"),t.k0s()()()),2&u&&(t.R7$(),t.vxM("note"===(null==I.options?null:I.options.type)?1:-1),t.R7$(3),t.SpI(" ",t.i5U(6,4,"text.add_item",t.eq3(7,b,t.bMT(5,2,"text."+(null==I.options?null:I.options.type))))," "))},dependencies:[v.me,v.BC,v.vS,y.D9]}),c})()},179:(H,w,l)=>{l.d(w,{Y:()=>y});var o=l(177),t=l(9417),x=l(9465),T=l(3955),h=l(3953);let y=(()=>{var v;class b{}return(v=b).\u0275fac=function(E){return new(E||v)},v.\u0275mod=h.$C({type:v}),v.\u0275inj=h.G2t({imports:[o.MD,t.YN,x.bv,T.h]}),b})()},6580:(H,w,l)=>{l.d(w,{k:()=>T});var o=l(3953);function t(h,y){if(1&h&&(o.j41(0,"div",15),o.EFF(1),o.k0s()),2&h){const v=o.XpG(2);o.R7$(),o.SpI(" ",null==v.listPaginationConfig?null:v.listPaginationConfig.checkedItems," seleccionado ")}}function x(h,y){if(1&h&&(o.j41(0,"div",14),o.DNE(1,t,2,1,"div",15),o.k0s()),2&h){const v=o.XpG();o.R7$(),o.vxM(null!=v.listPaginationConfig&&v.listPaginationConfig.checkedItems||0===(null==v.listPaginationConfig?null:v.listPaginationConfig.checkedItems)?1:-1)}}let T=(()=>{var h;class y{constructor(){this.listPaginationConfig={},this.goPreviousPage=new o.bkB,this.goNextPage=new o.bkB,this.sort=new o.bkB}ngOnInit(){}onGoPreviousPage(b){this.goPreviousPage.emit(b)}onGoNextPage(b){this.goNextPage.emit(b)}onSort(b){this.sort.emit(b)}}return(h=y).\u0275fac=function(b){return new(b||h)},h.\u0275cmp=o.VBU({type:h,selectors:[["app-list-pagination-selectors"]],inputs:{listPaginationConfig:"listPaginationConfig"},outputs:{goPreviousPage:"goPreviousPage",goNextPage:"goNextPage",sort:"sort"},decls:21,vars:6,consts:[[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"]],template:function(b,f){1&b&&(o.j41(0,"div",0)(1,"div",1)(2,"div",2),o.EFF(3),o.k0s(),o.j41(4,"div",3)(5,"button",4),o.bIt("click",function(e){return f.onGoPreviousPage(e)}),o.nrm(6,"i",5),o.k0s(),o.j41(7,"div",6),o.EFF(8),o.k0s(),o.j41(9,"button",4),o.bIt("click",function(e){return f.onGoNextPage(e)}),o.nrm(10,"i",7),o.k0s()(),o.j41(11,"div",8),o.bIt("click",function(e){return f.onSort(e)}),o.j41(12,"div",9),o.EFF(13," Ordenar por "),o.k0s(),o.j41(14,"div",10)(15,"div",11),o.EFF(16),o.k0s(),o.j41(17,"div",12),o.nrm(18,"i",13),o.k0s()()()(),o.j41(19,"div"),o.DNE(20,x,2,1,"div",14),o.k0s()()),2&b&&(o.R7$(3),o.E5c(" ",null==f.listPaginationConfig?null:f.listPaginationConfig.pageStartIndex," - ",null==f.listPaginationConfig?null:f.listPaginationConfig.pageEndIndex," de ",null==f.listPaginationConfig?null:f.listPaginationConfig.totalCount," "),o.R7$(5),o.SpI(" P\xe1g ",null==f.listPaginationConfig?null:f.listPaginationConfig.paginationPage," "),o.R7$(8),o.SpI(" ",null==f.listPaginationConfig?null:f.listPaginationConfig.sortField," "),o.R7$(4),o.vxM(null!=f.listPaginationConfig&&f.listPaginationConfig.showSelectItems?20:-1))}}),y})()},5603:(H,w,l)=>{l.d(w,{P:()=>T});var o=l(177),t=l(9417),x=l(3953);let T=(()=>{var h;class y{}return(h=y).\u0275fac=function(b){return new(b||h)},h.\u0275mod=x.$C({type:h}),h.\u0275inj=x.G2t({imports:[o.MD,t.YN]}),y})()},1852:(H,w,l)=>{l.d(w,{n:()=>V});var o=l(3953),t=l(6552),x=l(177);const T=(c,U)=>({"background-color":c,color:U});function h(c,U){}function y(c,U){if(1&c&&(o.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),o.nrm(4,"i",5),o.k0s(),o.j41(5,"div",6),o.EFF(6," Nota "),o.k0s(),o.j41(7,"div",7),o.EFF(8),o.nI1(9,"date"),o.j41(10,"span",8),o.EFF(11),o.nI1(12,"date"),o.k0s()()(),o.j41(13,"div",9)(14,"button",10),o.nrm(15,"i",11),o.k0s()()(),o.j41(16,"div",12)(17,"div",13),o.EFF(18),o.k0s()(),o.j41(19,"div",14),o.DNE(20,h,0,0),o.j41(21,"div")(22,"div",15)(23,"div",16),o.nrm(24,"img",17),o.k0s(),o.j41(25,"div",18),o.EFF(26),o.k0s()()()()()),2&c){const u=o.XpG().$implicit;o.R7$(8),o.SpI(" ",o.i5U(9,6,u.createdAt,"dd/MM/yyyy")," "),o.R7$(3),o.SpI(" ",o.i5U(12,9,u.createdAt,"HH:mm")," "),o.R7$(7),o.SpI(" ",null==u.element?null:u.element.text," "),o.R7$(2),o.vxM(null!=u.element&&u.element.operationId?20:-1),o.R7$(4),o.Y8G("src",(null==u.element?null:u.element.createdBy.photoUrl)||"assets/images/avatar.png",o.B4B),o.R7$(2),o.SpI(" ",null==u.element||null==u.element.createdBy?null:u.element.createdBy.name," ")}}function v(c,U){if(1&c&&(o.j41(0,"div",13),o.EFF(1),o.k0s()),2&c){const u=o.XpG(2).$implicit;o.R7$(),o.SpI(" ",null==u.element?null:u.element.comment," ")}}function b(c,U){if(1&c&&(o.EFF(0," Pipeline cambiada de "),o.j41(1,"b"),o.EFF(2),o.k0s(),o.EFF(3," a "),o.j41(4,"b"),o.EFF(5),o.k0s(),o.EFF(6,". Del paso "),o.j41(7,"span",20),o.EFF(8),o.k0s(),o.EFF(9," \xa0 al paso \xa0 "),o.j41(10,"span",20),o.EFF(11),o.k0s()),2&c){const u=o.XpG(2).$implicit,I=o.XpG();o.R7$(2),o.JRh(null==u.element?null:u.element.oldPipeline.title),o.R7$(3),o.JRh(null==u.element?null:u.element.newPipeline.title),o.R7$(2),o.Y8G("ngStyle",o.l_i(6,T,I.utils.hexToRgba(null==u.element?null:u.element.oldStep.color,.1),null==u.element?null:u.element.oldStep.color)),o.R7$(),o.SpI(" ",null==u.element?null:u.element.oldStep.text," "),o.R7$(2),o.Y8G("ngStyle",o.l_i(9,T,I.utils.hexToRgba(null==u.element?null:u.element.newStep.color,.1),null==u.element?null:u.element.newStep.color)),o.R7$(),o.SpI(" ",null==u.element?null:u.element.newStep.text," ")}}function f(c,U){if(1&c&&(o.EFF(0," Paso de la pipeline "),o.j41(1,"b"),o.EFF(2),o.k0s(),o.EFF(3," cambiado de "),o.j41(4,"span",20),o.EFF(5),o.k0s(),o.EFF(6," \xa0 a \xa0 "),o.j41(7,"span",20),o.EFF(8),o.k0s()),2&c){const u=o.XpG(2).$implicit,I=o.XpG();o.R7$(2),o.JRh(null==u.element?null:u.element.oldPipeline.title),o.R7$(2),o.Y8G("ngStyle",o.l_i(5,T,I.utils.hexToRgba(null==u.element?null:u.element.oldStep.color,.1),null==u.element?null:u.element.oldStep.color)),o.R7$(),o.SpI(" ",null==u.element?null:u.element.oldStep.text," "),o.R7$(2),o.Y8G("ngStyle",o.l_i(8,T,I.utils.hexToRgba(null==u.element?null:u.element.newStep.color,.1),null==u.element?null:u.element.newStep.color)),o.R7$(),o.SpI(" ",null==u.element?null:u.element.newStep.text," ")}}function E(c,U){if(1&c&&(o.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),o.nrm(4,"i",19),o.k0s(),o.j41(5,"div",6),o.EFF(6," Cambio de estado "),o.k0s(),o.j41(7,"div",7),o.EFF(8),o.nI1(9,"date"),o.j41(10,"span",8),o.EFF(11),o.nI1(12,"date"),o.k0s()()(),o.j41(13,"div",9)(14,"button",10),o.nrm(15,"i",11),o.k0s()()(),o.j41(16,"div",12),o.DNE(17,v,2,1,"div",13)(18,b,12,12)(19,f,9,11),o.k0s(),o.j41(20,"div",14)(21,"div")(22,"div",15)(23,"div",16),o.nrm(24,"img",17),o.k0s(),o.j41(25,"div",18),o.EFF(26),o.k0s()()()()()),2&c){const u=o.XpG().$implicit;o.R7$(8),o.SpI(" ",o.i5U(9,7,null==u.element?null:u.element.createdAt,"dd/MM/yyyy")," "),o.R7$(3),o.SpI(" ",o.i5U(12,10,null==u.element?null:u.element.createdAt,"HH:mm")," "),o.R7$(6),o.vxM(null!=u.element&&u.element.comment?17:-1),o.R7$(),o.vxM("changePipeline"===(null==u.element?null:u.element.type)?18:-1),o.R7$(),o.vxM("changePipelineStep"===(null==u.element?null:u.element.type)?19:-1),o.R7$(5),o.Y8G("src",(null==u.element?null:u.element.createdBy.photoUrl)||"assets/images/avatar.png",o.B4B),o.R7$(2),o.SpI(" ",null==u.element||null==u.element.createdBy?null:u.element.createdBy.name," ")}}function e(c,U){if(1&c&&o.DNE(0,y,27,12,"div",1)(1,E,27,13,"div",1),2&c){const u=U.$implicit;o.vxM("note"===(null==u?null:u.type)?0:-1),o.R7$(),o.vxM("operationHistoric"===(null==u?null:u.type)?1:-1)}}let V=(()=>{var c;class U{constructor(I){this.utils=I,this.items=[]}ngDoCheck(){const I=JSON.stringify(this.data);I!==this.previousData&&(this.previousData=I,this.items=this.transformDataToItemsAndOrderByCreatedAt(this.data))}transformDataToItemsAndOrderByCreatedAt(I){const j=[];return I.notes.forEach(G=>{j.push({type:"note",element:G,createdAt:G.createdAt,updatedAt:G.updatedAt})}),I.operationHistorics.forEach(G=>{j.push({type:"operationHistoric",element:G,createdAt:G.createdAt,updatedAt:G.updatedAt})}),j.sort((G,z)=>new Date(z.createdAt).getTime()-new Date(G.createdAt).getTime()),j}}return(c=U).\u0275fac=function(I){return new(I||c)(o.rXU(t.T))},c.\u0275cmp=o.VBU({type:c,selectors:[["app-operation-activity-block"]],inputs:{data:"data"},decls:3,vars:0,consts:[[1,"crm-section-operations"],[1,"crm-operation-activity"],[1,"crm-operation-activity-header"],[1,"crm-operation-activity-header-left"],[1,"crm-square-icon","crm-square-icon-small"],[1,"fa","fa-note-sticky"],[1,"crm-operation-activity-header-title"],[1,"crm-operation-activity-header-timestamp"],[1,"crm-operation-activity-header-timestamp-time"],[2,"display","flex","align-items","center","gap","8px"],[1,"crm-button-icon-solo"],[1,"fas","fa-ellipsis-vertical"],[1,"crm-operation-activity-content"],[1,"crm-text","small"],[1,"crm-operation-activity-footer"],[1,"crm-item-reference","small"],[1,"crm-item-reference-img"],["alt","",3,"src"],[1,"crm-item-reference-text"],[1,"fa","fa-exchange-alt"],[1,"crm-item-chip","crm-item-chip-warn",3,"ngStyle"]],template:function(I,j){1&I&&(o.j41(0,"div",0),o.Z7z(1,e,2,2,null,null,o.fX1),o.k0s()),2&I&&(o.R7$(),o.Dyx(j.items))},dependencies:[x.B3,x.vh]}),U})()},3675:(H,w,l)=>{l.d(w,{S:()=>h});var o=l(177),t=l(9465),x=l(9417),T=l(3953);let h=(()=>{var y;class v{}return(y=v).\u0275fac=function(f){return new(f||y)},y.\u0275mod=T.$C({type:y}),y.\u0275inj=T.G2t({imports:[o.MD,t.bv,x.YN]}),v})()},2606:(H,w,l)=>{l.d(w,{O:()=>h});var o=l(3953),t=l(3955);const x=["tabElement"];function T(y,v){if(1&y){const b=o.RV6();o.j41(0,"div",3,0),o.bIt("click",function(){const E=o.eBV(b).$index,e=o.XpG();return o.Njj(e.onClickTab(E))}),o.EFF(2),o.nI1(3,"translate"),o.k0s()}if(2&y){const b=v.$implicit;o.AVh("active",b.active),o.R7$(2),o.SpI(" ",o.bMT(3,3,"text."+(null==b?null:b.title))||(null==b?null:b.title)," ")}}let h=(()=>{var y;class v{constructor(){this.tabs=[{id:"1",title:"Visi\xf3n general",active:!0},{id:"2",title:"Nuestro equipo",active:!1},{id:"3",title:"Agencias",active:!1}],this.tabClicked=new o.bkB}ngOnChanges(f){if(f.activeTab&&this.activeTab&&this.tabs.length>0){const E=this.tabs.findIndex(e=>e.title===this.activeTab);-1!==E&&this.onClickTab(E)}}ngAfterViewInit(){const f=this.tabs.findIndex(E=>E.active)||0;-1!==f&&this.onClickTab(f)}onClickTab(f){console.log("HEY",f),this.tabs.forEach((E,e)=>{E.active=e===f}),this.tabClicked.emit(this.tabs[f].title),this.updateActiveTab(f)}updateActiveTab(f){setTimeout(()=>{var E;const e=null===(E=this.tabElements.get(f))||void 0===E?void 0:E.nativeElement;if(e){const c=e.offsetLeft;document.documentElement.style.setProperty("--indicator-width",e.offsetWidth-12+"px"),document.documentElement.style.setProperty("--indicator-left",`${c}px`)}},0)}}return(y=v).\u0275fac=function(f){return new(f||y)},y.\u0275cmp=o.VBU({type:y,selectors:[["app-tabs"]],viewQuery:function(f,E){if(1&f&&o.GBs(x,5),2&f){let e;o.mGM(e=o.lsd())&&(E.tabElements=e)}},inputs:{tabs:"tabs",activeTab:"activeTab"},outputs:{tabClicked:"tabClicked"},standalone:!0,features:[o.OA$,o.aNF],decls:3,vars:0,consts:[["tabElement",""],[1,"crm-tabs"],[1,"crm-tabs-tab",3,"active"],[1,"crm-tabs-tab",3,"click"]],template:function(f,E){1&f&&(o.j41(0,"div",1),o.Z7z(1,T,4,5,"div",2,o.fX1),o.k0s()),2&f&&(o.R7$(),o.Dyx(E.tabs))},dependencies:[t.h,t.D9]}),v})()},1129:(H,w,l)=>{l.d(w,{Z:()=>h});var o=l(3953),t=l(6069),x=l(1982);function T(y,v){if(1&y){const b=o.RV6();o.j41(0,"app-country-selector-popover",4),o.bIt("countrySelected",function(E){o.eBV(b);const e=o.XpG();return o.Njj(e.selectCountry(E))})("closePopover",function(){o.eBV(b);const E=o.XpG();return o.Njj(E.dropdownOpen=!1)}),o.k0s()}2&y&&o.Y8G("showCountryCode",!0)}let h=(()=>{var y;class v{constructor(){this.emitCountrySelected=new o.bkB,this.countries=t.X,this.selectedCountry=t.X[0],this.dropdownOpen=!1}ngOnChanges(){const f=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);f!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(f)}toggleDropdown(f){f.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(f){f.event.stopPropagation(),this.selectedCountry=f.country,this.emitCountrySelected.emit(f.country),this.dropdownOpen=!1}selectCountryByPhoneCode(f){const E=this.countries.find(e=>e.phoneCode===f);E&&(this.selectedCountry=E,this.emitCountrySelected.emit(E))}extractCountryPhoneCodeFromPhoneNumber(f){return null==f?void 0:f.split(" ")[0]}}return(y=v).\u0275fac=function(f){return new(f||y)},y.\u0275cmp=o.VBU({type:y,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[o.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(f,E){1&f&&(o.j41(0,"div",0),o.bIt("click",function(V){return E.toggleDropdown(V)}),o.j41(1,"div",1),o.nrm(2,"span")(3,"i",2),o.k0s(),o.DNE(4,T,1,1,"app-country-selector-popover",3),o.k0s()),2&f&&(o.R7$(2),o.HbH(null==E.selectedCountry?null:E.selectedCountry.flagClass),o.R7$(2),o.vxM(E.dropdownOpen?4:-1))},dependencies:[x.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),v})()},6812:(H,w,l)=>{l.d(w,{u:()=>h});var o=l(177),t=l(9417),x=l(7754),T=l(3953);let h=(()=>{var y;class v{}return(y=v).\u0275fac=function(f){return new(f||y)},y.\u0275mod=T.$C({type:y}),y.\u0275inj=T.G2t({imports:[o.MD,t.YN,x.X]}),v})()},9066:(H,w,l)=>{l.d(w,{K:()=>T});var o=l(177),t=l(9465),x=l(3953);let T=(()=>{var h;class y{}return(h=y).\u0275fac=function(b){return new(b||h)},h.\u0275mod=x.$C({type:h}),h.\u0275inj=x.G2t({imports:[o.MD,t.bv]}),y})()},7310:(H,w,l)=>{l.d(w,{s:()=>z});var o=l(3953),t=l(8359),x=l(467),T=l(1413),h=l(152),y=l(5558),v=l(2081);let b=(()=>{var D;class N{constructor(C){this.api=C,this.searchTermSubject=new T.B,this.ignoreIncludes=!1,this.allAgencies=[],this.searchResults$=this.searchTermSubject.pipe((0,h.B)(300),(0,y.n)(M=>this.performSearch(M)))}search(C){this.searchTermSubject.next(C)}performSearch(C){var M=this;return(0,x.A)(function*(){let K=[];if(C.includes("@")){const Y=C.split("@")[1];let se;se=["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","aol.com","msn.com","live.com","mail.com","protonmail.com","zoho.com","gmx.com","yandex.com","ymail.com","rocketmail.com","fastmail.com","tutanota.com","hushmail.com","inbox.com","me.com","mac.com","live.co.uk","hotmail.co.uk","yahoo.co.uk","hotmail.fr","yahoo.fr","hotmail.de","yahoo.de","hotmail.it","yahoo.it","hotmail.es","yahoo.es","hotmail.uz","yahoo.uz","hotmail.mn"].includes(Y)?yield M.api.getAgency({email:{equals:C}},null,{page:0,itemsPerPage:50}):yield M.api.getAgency({email:{contains:"@"+Y}},null,{page:0,itemsPerPage:50}),K=se.success.data}else M.ignoreIncludes&&(console.log("ENTRA AQUIIIII"),K=yield M.api.getAgency({name:{contains:C,mode:"insensitive"}},null,{page:0,itemsPerPage:50}).then(Y=>Y.success.data));return K})()}}return(D=N).\u0275fac=function(C){return new(C||D)(o.KVO(v.i))},D.\u0275prov=o.jDH({token:D,factory:D.\u0275fac,providedIn:"root"}),N})();var f=l(177),E=l(9417);function e(D,N){if(1&D&&o.nrm(0,"img",11),2&D){const B=o.XpG().$implicit;o.Y8G("src",B.photoUrl,o.B4B)}}function V(D,N){1&D&&o.nrm(0,"img",12)}function c(D,N){1&D&&(o.j41(0,"div",16),o.nrm(1,"img",21),o.k0s())}function U(D,N){if(1&D&&(o.j41(0,"span",17),o.EFF(1),o.k0s()),2&D){const B=o.XpG().$implicit;o.R7$(),o.E5c(" ",B.city,",",B.province," / ",B.country,"")}}function u(D,N){if(1&D){const B=o.RV6();o.j41(0,"div",8),o.bIt("click",function(M){const K=o.eBV(B).$implicit,Y=o.XpG(2);return o.Njj(Y.selectAgency(K,M))}),o.j41(1,"div",9)(2,"div",10),o.DNE(3,e,1,1,"img",11)(4,V,1,0,"img",12),o.k0s(),o.j41(5,"div",13)(6,"div",14)(7,"div",15)(8,"span"),o.EFF(9),o.k0s(),o.DNE(10,c,2,0,"div",16)(11,U,2,3,"span",17),o.k0s()(),o.j41(12,"div",18)(13,"span",19),o.EFF(14),o.k0s()()()(),o.nrm(15,"div",20),o.k0s()}if(2&D){const B=N.$implicit;o.R7$(3),o.vxM(B.photoUrl?3:4),o.R7$(6),o.JRh(null==B?null:B.name),o.R7$(),o.vxM(null!=B&&B.verified?10:-1),o.R7$(),o.vxM(B.city&&B.province&&B.country?11:-1),o.R7$(3),o.SpI(" ",null==B?null:B.email,"")}}function I(D,N){1&D&&(o.j41(0,"div",22),o.EFF(1," No hay resultados en Byvaro "),o.k0s())}function j(D,N){if(1&D){const B=o.RV6();o.j41(0,"div",8),o.bIt("click",function(M){o.eBV(B);const K=o.XpG(2);return o.Njj(K.selectAgency(null,M))}),o.j41(1,"div",9)(2,"div",10),o.nrm(3,"img",12),o.k0s(),o.j41(4,"div",13)(5,"div",14),o.EFF(6),o.k0s(),o.j41(7,"div",18),o.EFF(8," Esta agencia no est\xe1 registrada en Byvaro, haz clic para invitarla. "),o.k0s()()(),o.nrm(9,"div",20),o.k0s()}if(2&D){const B=o.XpG(2);o.R7$(6),o.SpI(" ",B.searchTerm," ")}}function G(D,N){if(1&D&&(o.j41(0,"div",5),o.Z7z(1,u,16,5,"div",6,o.fX1),o.DNE(3,I,2,0,"div",7)(4,j,10,1,"div",6),o.k0s()),2&D){const B=o.XpG();o.R7$(),o.Dyx(B.searchResults),o.R7$(2),o.Y8G("ngIf",0===B.searchResults.length&&!B.validEmail),o.R7$(),o.vxM(0===B.searchResults.length&&B.validEmail?4:-1)}}let z=(()=>{var D;class N{constructor(C,M){this.renderer=C,this.searchbarService=M,this.selectedAgency=new o.bkB,this.textUpdated=new o.bkB,this.ignoreIncludes=!1,this.searchTerm="",this.dropdownOpen=!1,this.searchResults=[],this.validEmail=!1,this.globalClickUnlistener=null,this.searchSubscription=new t.yU}ngOnInit(){this.ignoreIncludes&&(this.searchbarService.ignoreIncludes=!0),this.searchSubscription=this.searchbarService.searchResults$.subscribe(C=>{this.searchResults=C,this.searchResults.length||this.selectedAgency.emit(null)})}onInputClick(C){C.stopPropagation(),this.dropdownOpen||this.openDropdown()}onSearchTermChange(C){this.searchTerm=C,this.searchbarService.search(C),this.checkEmail(),this.textUpdated.emit(C)}checkEmail(){this.validEmail=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.searchTerm)}selectAgency(C,M){C||(C={name:this.searchTerm,email:"Esta agencia no est\xe1 registrada en Byvaro, se enviar\xe1 una invitaci\xf3n por e-mail."}),M.stopPropagation(),this.selectedAgency.emit({name:C.name,email:C.email,id:C.id,city:C.city,province:C.province,country:C.country,photoUrl:C.photoUrl}),this.closeDropdown()}openDropdown(){this.dropdownOpen=!0,this.attachDocumentClickListener()}closeDropdown(){this.dropdownOpen=!1,this.detachDocumentClickListener()}attachDocumentClickListener(){this.globalClickUnlistener=this.renderer.listen("document","click",C=>{C.target.closest(".agents-searchbar-container")||this.closeDropdown()})}detachDocumentClickListener(){this.globalClickUnlistener&&(this.globalClickUnlistener(),this.globalClickUnlistener=null)}ngOnDestroy(){this.detachDocumentClickListener(),this.searchSubscription.unsubscribe()}}return(D=N).\u0275fac=function(C){return new(C||D)(o.rXU(o.sFG),o.rXU(b))},D.\u0275cmp=o.VBU({type:D,selectors:[["app-agencies-searchbar"]],inputs:{ignoreIncludes:"ignoreIncludes"},outputs:{selectedAgency:"selectedAgency",textUpdated:"textUpdated"},decls:5,vars:2,consts:[[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar","crm-input-input-searchbar-square","agents-searchbar-container","secondary-border-1",3,"click"],[1,"fas","fa-search"],["type","text","placeholder","Email de la agencia",3,"ngModelChange","ngModel"],["class","dropdown-options",4,"ngIf"],[1,"dropdown-options"],[1,"crm-item-searchbar-agent-result"],["class","no-results",4,"ngIf"],[1,"crm-item-searchbar-agent-result",3,"click"],[1,"crm-item-searchbar-agent-result-left"],[1,"crm-item-searchbar-agent-result-left-image"],["alt","",3,"src"],["src","assets/images/building.png","alt",""],[1,"crm-item-searchbar-agent-result-left-info"],[1,"crm-item-searchbar-agent-result-left-info-name"],[1,"d-flex","align-center"],[1,"mx-10"],[1,"text-16","text-secondary"],[1,"crm-item-searchbar-agent-result-left-info-email"],[1,"text-secondary"],[1,"crm-item-searchbar-agent-result-right"],["src","assets/icon/blue-star-icon.svg","alt",""],[1,"no-results"]],template:function(C,M){1&C&&(o.j41(0,"div",0)(1,"div",1),o.bIt("click",function(Y){return M.onInputClick(Y)}),o.nrm(2,"i",2),o.j41(3,"input",3),o.mxI("ngModelChange",function(Y){return o.DH7(M.searchTerm,Y)||(M.searchTerm=Y),Y}),o.bIt("ngModelChange",function(Y){return M.onSearchTermChange(Y)}),o.k0s(),o.DNE(4,G,5,2,"div",4),o.k0s()()),2&C&&(o.R7$(3),o.R50("ngModel",M.searchTerm),o.R7$(),o.Y8G("ngIf",M.dropdownOpen))},dependencies:[f.bT,E.me,E.BC,E.vS],styles:[".agents-searchbar-container[_ngcontent-%COMP%]{position:relative;cursor:pointer}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;z-index:9999;background-color:#fff;padding:8px 0;border-radius:0 0 8px 8px;border:1px solid var(--crm-border-light-color);max-height:225px;overflow-y:auto;font-size:14px}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.no-results[_ngcontent-%COMP%]{padding:8px;color:#888}"]}),N})()},4646:(H,w,l)=>{l.d(w,{X:()=>T});var o=l(177),t=l(9417),x=l(3953);let T=(()=>{var h;class y{}return(h=y).\u0275fac=function(b){return new(b||h)},h.\u0275mod=x.$C({type:h}),h.\u0275inj=x.G2t({imports:[o.MD,t.YN]}),y})()},68:(H,w,l)=>{l.d(w,{k:()=>T});var o=l(177),t=l(9417),x=l(3953);let T=(()=>{var h;class y{}return(h=y).\u0275fac=function(b){return new(b||h)},h.\u0275mod=x.$C({type:h}),h.\u0275inj=x.G2t({imports:[o.MD,t.YN]}),y})()},2306:(H,w,l)=>{l.d(w,{T:()=>T});var o=l(177),t=l(9417),x=l(3953);let T=(()=>{var h;class y{}return(h=y).\u0275fac=function(b){return new(b||h)},h.\u0275mod=x.$C({type:h}),h.\u0275inj=x.G2t({imports:[o.MD,t.YN]}),y})()},5641:(H,w,l)=>{l.d(w,{D:()=>pt});var o=l(177),t=l(4716),x=l(9417),T=l(9465),h=l(7944),y=l(7991),v=l(4646),b=l(3955),f=l(2652),E=l(6812),e=l(3953);let V=(()=>{var r;class k{}return(r=k).\u0275fac=function(a){return new(a||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[o.MD,x.YN]}),k})();var c=l(6279);let U=(()=>{var r;class k{}return(r=k).\u0275fac=function(a){return new(a||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[o.MD,x.YN,x.X1,T.bv,b.h,E.u,V,c.F]}),k})();var u=l(2606),I=l(179),j=l(3675),G=l(2824),z=l(1968),D=l(3895),N=l(9662);let B=(()=>{var r;class k{}return(r=k).\u0275fac=function(a){return new(a||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[o.MD,x.YN,x.X1,T.bv,f.T,c.F,N.Y,b.h]}),k})();var C=l(3274),M=l(2306),K=l(68),Y=l(144),ae=l(8433),se=l(9066),de=l(7774),ee=l(467),ue=l(9420),ve=l(4760),ge=l(2081),fe=l(8397),Ce=l(6552),he=l(5970);const Te=r=>({"last-label-date":r});function Se(r,k){1&r&&e.nrm(0,"img",9),2&r&&e.Y8G("src","assets/icon/checked-dot-icon.svg",e.B4B)}function Ee(r,k){1&r&&e.nrm(0,"img",10),2&r&&e.Y8G("src","assets/icon/secondary-dot-icon.svg",e.B4B)}function Me(r,k){if(1&r&&(e.j41(0,"div",14),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&r){const d=e.XpG().$implicit;e.R7$(),e.JRh(e.i5U(2,1,d.date,"dd/MM/yyyy HH:mm"))}}function Fe(r,k){if(1&r&&(e.j41(0,"div",7)(1,"div",8),e.DNE(2,Se,1,1,"img",9)(3,Ee,1,1,"img",10),e.k0s(),e.j41(4,"div",11)(5,"div",12),e.EFF(6),e.k0s(),e.DNE(7,Me,3,4,"div",13),e.k0s()()),2&r){const d=k.$implicit,a=k.index,s=e.XpG(2);e.xc7("left",s.getLeftPosition(a,s.statusStepsArray.length-1),"%"),e.AVh("completed",d.completed),e.R7$(2),e.vxM(d.completed?2:3),e.R7$(2),e.Y8G("ngClass",e.eq3(8,Te,a===s.statusStepsArray.length-1)),e.R7$(2),e.JRh(d.label),e.R7$(),e.Y8G("ngIf",d.date)}}function Pe(r,k){if(1&r&&(e.j41(0,"div",2),e.DNE(1,Fe,8,10,"div",3),e.j41(2,"div",4),e.nrm(3,"div",5)(4,"div",6),e.k0s()()),2&r){const d=e.XpG();e.R7$(),e.Y8G("ngForOf",d.statusStepsArray),e.R7$(3),e.xc7("width",d.getCompletedCount(),"%")}}function Ie(r,k){if(1&r&&(e.j41(0,"div",2)(1,"div",15),e.EFF(2),e.nI1(3,"date"),e.nrm(4,"i",16),e.k0s()()),2&r){const d=e.XpG();e.R7$(2),e.SpI(" Firma completada en ",e.i5U(3,1,null==d.statusStepsArray[d.statusStepsArray.length-1]?null:d.statusStepsArray[d.statusStepsArray.length-1].date,"dd/MM/yyyy HH:mm")," ")}}let Oe=(()=>{var r;class k{constructor(){this.statusSteps={sent:{label:"Sent",date:"",completed:!0},delivered:{label:"Delivered",date:"",completed:!1},unopened:{label:"Unopened",date:"",completed:!1},unsigned:{label:"Unsigned",date:"",completed:!1},signed:{label:"Signed",date:"",completed:!1}},this.statusStepsArray=[this.statusSteps.sent,this.statusSteps.delivered,this.statusSteps.unopened,this.statusSteps.unsigned,this.statusSteps.signed]}ngOnChanges(a){this.updateStatusStepsArray()}ngOnInit(){console.log("DocumentStatusTrackerComponent statusSteps",this.statusSteps),this.updateStatusStepsArray()}updateStatusStepsArray(){this.statusStepsArray=[this.statusSteps.sent,this.statusSteps.delivered,this.statusSteps.unopened,this.statusSteps.unsigned,this.statusSteps.signed]}getLeftPosition(a,s){return 0===a?0:a*(100/s)}getCompletedCount(){let a=this.statusStepsArray.filter(s=>s.completed);return this.getLeftPosition(a.length-1,this.statusStepsArray.length-1)}}return(r=k).\u0275fac=function(a){return new(a||r)},r.\u0275cmp=e.VBU({type:r,selectors:[["app-document-status-tracker"]],inputs:{statusSteps:"statusSteps"},features:[e.OA$],decls:3,vars:2,consts:[[1,"status-tracker","w-full"],["class","line-container d-flex justify-between relative w-full","style","width: 100%;",4,"ngIf"],[1,"line-container","d-flex","justify-between","relative","w-full",2,"width","100%"],["class","step absolute","style","z-index:1",3,"completed","left",4,"ngFor","ngForOf"],[1,"w-full"],[1,"w-full","secondary-border-1"],[1,"primary-border-1","absolute",2,"top","0"],[1,"step","absolute",2,"z-index","1"],[1,"relative"],["alt","",1,"absolute",2,"top","-7px",3,"src"],["alt","",1,"absolute",2,"top","-3px",3,"src"],[1,"label-date",2,"margin-top","10px",3,"ngClass"],[1,"label","text-10"],["class","date  text-12 text-secondary",4,"ngIf"],[1,"date","text-12","text-secondary"],[2,"color","green"],[1,"fa-solid","fa-check"]],template:function(a,s){1&a&&(e.j41(0,"div",0),e.DNE(1,Pe,5,3,"div",1)(2,Ie,5,4,"div",1),e.k0s()),2&a&&(e.R7$(),e.Y8G("ngIf",!(null!=s.statusStepsArray[s.statusStepsArray.length-1]&&s.statusStepsArray[s.statusStepsArray.length-1].completed)),e.R7$(),e.Y8G("ngIf",null==s.statusStepsArray[s.statusStepsArray.length-1]?null:s.statusStepsArray[s.statusStepsArray.length-1].completed))},dependencies:[o.YU,o.Sq,o.bT,o.vh],styles:[".last-label-date[_ngcontent-%COMP%]{margin-left:-35px}"]}),k})();const ye=()=>[];function Be(r,k){if(1&r&&(e.j41(0,"div",19),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&r){const d=e.XpG(2);e.R7$(),e.SpI(" Added ",e.i5U(2,1,d.options.existingOperationDocument.createdAt,"dd/MM/yyyy HH:mm"),"")}}function Ae(r,k){if(1&r){const d=e.RV6();e.j41(0,"div")(1,"img",20),e.bIt("click",function(s){e.eBV(d);const S=e.XpG(2);return e.Njj(S.onItemMenuClick(s))}),e.k0s()()}2&r&&(e.R7$(),e.Y8G("src","assets/icon/more-vertical-icon.svg",e.B4B))}function Re(r,k){if(1&r){const d=e.RV6();e.j41(0,"div",21)(1,"button",22),e.bIt("click",function(){e.eBV(d);const s=e.XpG(2);return e.Njj(s.onUploadNewDocument())}),e.EFF(2,"Subir nuevo documento"),e.k0s()()}}function je(r,k){1&r&&(e.j41(0,"span",24),e.EFF(1,"Este documento ya est\xe1 firmado. Debes a\xf1adir a los firmantes para completar el registro."),e.k0s())}function we(r,k){1&r&&(e.j41(0,"span",24),e.EFF(1,"Este documento est\xe1 listo para ser enviado para firma."),e.k0s())}function Ue(r,k){if(1&r){const d=e.RV6();e.j41(0,"button",27),e.bIt("click",function(){e.eBV(d);const s=e.XpG(3);return e.Njj(s.onAddSigners())}),e.nrm(1,"img",28),e.EFF(2," A\xf1adir firmantes"),e.k0s()}}function $e(r,k){if(1&r){const d=e.RV6();e.j41(0,"button",29),e.bIt("click",function(){e.eBV(d);const s=e.XpG(3);return e.Njj(s.onSendForSignature())}),e.EFF(1,"Enviar a firmar"),e.k0s()}}function Ge(r,k){if(1&r&&(e.j41(0,"div",8)(1,"div",23),e.nrm(2,"img",10),e.DNE(3,je,2,0,"span",24)(4,we,2,0,"span",24),e.k0s(),e.DNE(5,Ue,3,0,"button",25)(6,$e,2,0,"button",26),e.k0s()),2&r){const d=e.XpG(2);e.R7$(2),e.Y8G("src","assets/icon/warning-red-icon.svg",e.B4B),e.R7$(),e.vxM("alreadySigned"===d.options.existingOperationDocument.documentFlowType?3:4),e.R7$(2),e.vxM("alreadySigned"===d.options.existingOperationDocument.documentFlowType?5:6)}}function Ne(r,k){if(1&r&&(e.j41(0,"div",38),e.EFF(1),e.k0s()),2&r){const d=e.XpG().$implicit,a=e.XpG(3);e.R7$(),e.JRh(null==a.options.existingOperationDocument?null:a.options.existingOperationDocument.contactsToSignData[d.id].relationType)}}function Xe(r,k){1&r&&(e.j41(0,"div",38),e.EFF(1,"Comprator"),e.k0s())}function m(r,k){if(1&r&&(e.j41(0,"div",41),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&r){const d=e.XpG().$implicit,a=e.XpG(3);e.R7$(),e.SpI("Firmado en ",e.i5U(2,1,null==a.options.existingOperationDocument?null:a.options.existingOperationDocument.contactsToSignData[d.id].signedDate,"dd/MM/yyyy"),"")}}function O(r,k){1&r&&e.nrm(0,"div",41)}function p(r,k){if(1&r&&(e.j41(0,"div",30)(1,"div",31)(2,"div",32),e.EFF(3),e.k0s(),e.j41(4,"div",33)(5,"div",34),e.nrm(6,"img",35),e.k0s(),e.j41(7,"div",36)(8,"div",37),e.EFF(9),e.k0s(),e.DNE(10,Ne,2,1,"div",38)(11,Xe,2,0,"div",38),e.k0s()(),e.j41(12,"div",39),e.nrm(13,"img",40),e.DNE(14,m,3,4,"div",41)(15,O,1,0,"div",41),e.k0s()()()),2&r){const d=k.$implicit,a=k.$index,s=e.XpG(3);e.R7$(3),e.SpI("",a+1,"."),e.R7$(3),e.Y8G("src",(null==d?null:d.photoUrl)||"assets/images/avatar.png",e.B4B),e.R7$(3),e.JRh(d.name),e.R7$(),e.vxM(null!=s.options&&null!=s.options.existingOperationDocument&&s.options.existingOperationDocument.contactsToSignData&&null!=s.options&&null!=s.options.existingOperationDocument&&s.options.existingOperationDocument.contactsToSignData[d.id]?10:11),e.R7$(4),e.vxM(null!=s.options&&null!=s.options.existingOperationDocument&&s.options.existingOperationDocument.contactsToSignData&&null!=s.options&&null!=s.options.existingOperationDocument&&s.options.existingOperationDocument.contactsToSignData[d.id]?14:15)}}function i(r,k){if(1&r&&e.Z7z(0,p,16,5,"div",30,e.fX1),2&r){const d=e.XpG(2);e.Dyx(null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.contactsToSign)}}function n(r,k){if(1&r&&(e.j41(0,"div",30)(1,"div",31)(2,"div",32),e.EFF(3),e.k0s(),e.j41(4,"div",33)(5,"div",34),e.nrm(6,"img",35),e.k0s(),e.j41(7,"div",36)(8,"div",37),e.EFF(9),e.k0s(),e.j41(10,"div",38),e.EFF(11),e.k0s()()(),e.j41(12,"div",39),e.nrm(13,"img",40),e.j41(14,"div",41),e.EFF(15),e.nI1(16,"date"),e.k0s()()()()),2&r){const d=e.XpG(),a=d.$implicit,s=d.$index,S=e.XpG(3);e.R7$(3),e.SpI("",s+1,"."),e.R7$(3),e.Y8G("src",(null==a?null:a.photoUrl)||"assets/images/avatar.png",e.B4B),e.R7$(3),e.JRh(a.name),e.R7$(2),e.JRh(null==S.options.existingOperationDocument?null:S.options.existingOperationDocument.contactsToSignData[a.id].relationType),e.R7$(4),e.SpI("Firmado en ",e.i5U(16,5,null==S.options.existingOperationDocument?null:S.options.existingOperationDocument.contactsToSignData[a.id].signedDate,"dd/MM/yyyy")," ")}}function _(r,k){if(1&r&&e.DNE(0,n,17,8,"div",30),2&r){const d=k.$implicit,a=e.XpG(3);e.vxM(null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData&&null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData[d.id]?0:-1)}}function g(r,k){if(1&r&&e.Z7z(0,_,1,1,null,null,e.fX1),2&r){const d=e.XpG(2);e.Dyx(null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.contactsToSign)}}function P(r,k){if(1&r){const d=e.RV6();e.j41(0,"div",50)(1,"button",51),e.bIt("click",function(){e.eBV(d);const s=e.XpG(2).$implicit,S=e.XpG(4);return e.Njj(S.onResendClick({contact:s}))}),e.nrm(2,"img",10),e.EFF(3," Resend"),e.k0s()()}2&r&&(e.R7$(2),e.Y8G("src","assets/icon/refresh-icon.svg",e.B4B))}function W(r,k){if(1&r&&(e.j41(0,"div",45)(1,"div",46),e.EFF(2),e.k0s(),e.j41(3,"div",47),e.nrm(4,"app-document-status-tracker",48),e.k0s(),e.DNE(5,P,4,1,"div",49),e.k0s()),2&r){let d;const a=e.XpG(),s=a.$implicit,S=a.$index,A=e.XpG(4);e.R7$(2),e.Lme("",S+1,". ",s.name,""),e.R7$(2),e.Y8G("statusSteps",A.getDocumentStatusStepsForAssignedSigner(s)),e.R7$(),e.Y8G("ngIf",!(null!=(d=A.getDocumentStatusStepsForAssignedSigner(s))&&null!=d.signed&&d.signed.completed))}}function L(r,k){if(1&r&&e.DNE(0,W,6,4,"div",45),2&r){const d=k.$implicit,a=e.XpG(4);e.vxM(null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData&&null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData[d.id]?-1:0)}}function ie(r,k){1&r&&(e.j41(0,"div",44),e.EFF(1,"No hay contactos asignados para firmar este documento."),e.k0s())}function te(r,k){if(1&r){const d=e.RV6();e.j41(0,"div",45)(1,"div",46),e.EFF(2),e.k0s(),e.j41(3,"div",47),e.nrm(4,"app-document-status-tracker",48),e.k0s(),e.j41(5,"div",50)(6,"button",51),e.bIt("click",function(){const s=e.eBV(d).$implicit,S=e.XpG(4);return e.Njj(S.onResendClick({user:s}))}),e.nrm(7,"img",10),e.EFF(8," Resend"),e.k0s()()()}if(2&r){const d=k.$implicit,a=k.$index,s=e.XpG(4);e.R7$(2),e.Lme("",a+1,". ",d.name,""),e.R7$(2),e.Y8G("statusSteps",s.getDocumentStatusStepsForAssignedSigner(d)),e.R7$(3),e.Y8G("src","assets/icon/refresh-icon.svg",e.B4B)}}function Z(r,k){1&r&&(e.j41(0,"div",44),e.EFF(1,"No hay usuarios asignados para firmar este documento."),e.k0s())}function F(r,k){if(1&r&&(e.j41(0,"div"),e.nrm(1,"br"),e.j41(2,"div",42),e.EFF(3),e.k0s(),e.nrm(4,"br"),e.j41(5,"div",43),e.EFF(6," Contactos firmantes: "),e.k0s(),e.Z7z(7,L,1,1,null,null,e.fX1),e.DNE(9,ie,2,0,"div",44),e.nrm(10,"br"),e.j41(11,"div",43),e.EFF(12," Usuarios firmantes: "),e.k0s(),e.Z7z(13,te,9,4,"div",45,e.fX1),e.DNE(15,Z,2,0,"div",44),e.nrm(16,"br"),e.k0s()),2&r){const d=e.XpG(3);e.R7$(3),e.SpI(" Estado firma del documento: ",d.options.existingOperationDocument.documentSignStatus," "),e.R7$(4),e.Dyx((null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.contactsToSign)||e.lJ4(3,ye)),e.R7$(2),e.vxM(0===(null==d.options.existingOperationDocument.contactsToSign?null:d.options.existingOperationDocument.contactsToSign.length)?9:-1),e.R7$(4),e.Dyx(d.options.existingOperationDocument.usersToSign||e.lJ4(4,ye)),e.R7$(2),e.vxM(0===(null==d.options.existingOperationDocument.contactsToSign?null:d.options.existingOperationDocument.contactsToSign.length)?15:-1)}}function X(r,k){if(1&r&&e.DNE(0,F,17,5,"div",15),2&r){const d=e.XpG(2);e.Y8G("ngIf",d.options.existingOperationDocument&&d.options.existingOperationDocument.documentSignStatus)}}function re(r,k){if(1&r&&(e.j41(0,"div",1)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e.EFF(5),e.k0s(),e.nrm(6,"div",5),e.k0s(),e.j41(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),e.nrm(11,"img",10),e.j41(12,"div",11)(13,"div",12),e.EFF(14),e.k0s(),e.j41(15,"div",13),e.EFF(16),e.k0s(),e.DNE(17,Be,3,4,"div",14),e.k0s()(),e.DNE(18,Ae,2,1,"div",15),e.k0s(),e.nrm(19,"div",16),e.DNE(20,Re,3,0,"div",17)(21,Ge,7,3,"div",18)(22,i,2,0)(23,g,2,0),e.k0s()()(),e.DNE(24,X,1,1,"div"),e.k0s()()),2&r){const d=e.XpG();e.R7$(5),e.JRh((null==d.options?null:d.options.visibleIndex)||1),e.R7$(6),e.Y8G("src","assets/icon/icon-1.svg",e.B4B),e.R7$(3),e.SpI("",d.options.title," "),e.R7$(2),e.JRh(d.options.subtitle||d.options.documentType),e.R7$(),e.Y8G("ngIf",d.options.existingOperationDocument),e.R7$(),e.Y8G("ngIf",d.options.existingOperationDocument),e.R7$(2),e.Y8G("ngIf",!d.options.existingOperationDocument),e.R7$(),e.Y8G("ngIf",d.options.existingOperationDocument&&"notNecessary"!==d.options.existingOperationDocument.documentFlowType&&!d.options.existingOperationDocument.documentSignStatus),e.R7$(),e.vxM("alreadySigned"===(null==d.options||null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.documentFlowType)&&d.options.existingOperationDocument&&d.options.existingOperationDocument.documentSignStatus?22:"partiallySigned"===(null==d.options||null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.documentFlowType)?23:-1),e.R7$(2),e.vxM("alreadySigned"!==(null==d.options||null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.documentFlowType)?24:-1)}}let Le=(()=>{var r;class k{constructor(a,s,S,A,R){this.modalCtrl=a,this.api=s,this.toast=S,this.utils=A,this.popoversService=R,this.triggerAfterDocumentCreation=new e.bkB}ngOnInit(){console.log("SignDocumentFlowComponent options",this.options)}onSendForSignature(a){var s=this;return(0,ee.A)(function*(){var S;const A=yield s.modalCtrl.create({component:ve.i,componentProps:{operationId:s.options.operationId,operationDocument:s.options.existingOperationDocument,operation:s.options.operation,promotion:s.options.promotion,options:{resend:(null==a?void 0:a.resend)||!1,contactsToSign:s.options.contactsToSign||[]}},cssClass:"modal-upload-document backdrop-opacity-0-52"});yield A.present();const R=yield A.onDidDismiss();if(null!=R&&null!==(S=R.data)&&void 0!==S&&S.reload){const $=yield s.api.getOperationDocumentById(s.options.existingOperationDocument.id);if(!$.success)return void s.toast.showErrorToast($.error.errorMessage);s.options.existingOperationDocument=$.success.data,s.options.existingOperationDocument.documentSignStatus="pending"}})()}onAddSigners(a){var s=this;return(0,ee.A)(function*(){var S;const A=yield s.modalCtrl.create({component:ve.i,componentProps:{operationId:s.options.operationId,operation:s.options.operation,promotion:s.options.promotion,operationDocument:s.options.existingOperationDocument,options:{resend:(null==a?void 0:a.resend)||!1,contactsToSign:s.options.contactsToSign||[]}},cssClass:"modal-upload-document backdrop-opacity-0-52"});yield A.present(),yield A.present();const R=yield A.onDidDismiss();if(null!=R&&null!==(S=R.data)&&void 0!==S&&S.reload){const $=yield s.api.getOperationDocumentById(s.options.existingOperationDocument.id);if(!$.success)return void s.toast.showErrorToast($.error.errorMessage);s.options.existingOperationDocument=$.success.data,s.options.existingOperationDocument.documentSignStatus="pending"}})()}onGoToSeeDocument(){var a;window.open(null===(a=this.options.existingOperationDocument)||void 0===a?void 0:a.url,"_blank")}getDocumentStatusStepsForAssignedSigner(a){var s,S,A;let R={sent:{label:"Sent",date:"",completed:!0},delivered:{label:"Delivered",date:"",completed:!1},unopened:{label:"Unopened",date:"",completed:!1},unsigned:{label:"Unsigned",date:"",completed:!1},signed:{label:"Signed",date:"",completed:!1}};const $=null!==(s=null===(S=this.options.existingOperationDocument)||void 0===S?void 0:S.docusignUpdates)&&void 0!==s?s:[];if(console.log("UPDATES",$),!$||0===$.length)return R;const ce=null===(A=$[$.length-1].recipients)||void 0===A||null===(A=A.signers)||void 0===A?void 0:A.find(oe=>String(oe.recipientId)===String(a.id)||String(oe.clientUserId)===String(a.id));return ce&&(console.log("SIGNER",ce),R.sent.date=ce.sentDateTime||"",R.delivered.date=ce.deliveredDateTime||"",R.delivered.date&&(R.delivered.completed=!0),R.signed.date=ce.signedDateTime||"",R.signed.date&&(R.signed.completed=!0)),R}onResendClick(a){var s=this;return(0,ee.A)(function*(){const S=a.contact,A=a.user,R=yield s.api.resendOperationDocumentSignForContact(s.options.operationId,s.options.existingOperationDocument.id,(null==S?void 0:S.id)||(null==A?void 0:A.id));R.success?s.toast.showSuccessToast("Documento reenviado correctamente"):s.toast.showErrorToast(R.error.errorMessage);const $=yield s.api.getOperationDocumentById(s.options.existingOperationDocument.id);$.success?s.options.existingOperationDocument=$.success.data:s.toast.showErrorToast($.error.errorMessage)})()}onUploadNewDocument(){var a=this;return(0,ee.A)(function*(){var s;const S=yield a.modalCtrl.create({component:ue.a,componentProps:{operationId:a.options.operationId,uploadedDocument:a.options.existingOperationDocument||null,options:{documentType:a.options.documentType,visibleStep:a.options.visibleStep||null,allowNotFirmNecessary:a.options.allowNotFirmNecessary||!1,reference:a.options.reference||null,isStandalone:a.options.isStandalone||!1}},cssClass:"modal-upload-document backdrop-opacity-0-52"});yield S.present();const A=yield S.onDidDismiss();null!=A&&null!==(s=A.data)&&void 0!==s&&s.reload&&A.data.operationDocument&&(a.options.existingOperationDocument=A.data.operationDocument,a.options.title=A.data.operationDocument.title,a.triggerAfterDocumentCreation.emit())})()}onItemMenuClick(a){var s=this;return(0,ee.A)(function*(){var S;if(a.stopPropagation(),a.preventDefault(),!s.options.existingOperationDocument)return;if(s.options.existingOperationDocument.documentSignStatus){var A;let oe;if(oe="signed"===s.options.existingOperationDocument.documentSignStatus?yield s.popoversService.onShowMenuPopover(a,"operation-document-sign-completed-actions"):yield s.popoversService.onShowMenuPopover(a,"operation-document-sign-actions"),null!==(A=oe)&&void 0!==A&&A.data){const le=oe.data;if("upload-new-document"===le&&(yield s.onUploadNewDocument()),"resend-document"===le&&(yield s.onSendForSignature({resend:!0})),"view-document"===le&&(yield s.onGoToSeeDocument()),"cancel-document"===le){if("alreadySigned"===s.options.existingOperationDocument.documentFlowType){let ne=s.options.existingOperationDocument;ne.contactsToSign=[],ne.contactsToSignData={},ne.documentSignStatus=null,yield s.api.updateOperationDocument(ne.operationId,ne.id,ne)}else yield s.api.cancelOperationDocumentSign(s.options.operationId,s.options.existingOperationDocument.id);s.toast.showSuccessToast("Firma del documento cancelada correctamente")}if("download-certificate"===le){var R,$;const ne=s.options.existingOperationDocument.docusignUpdates||[],J=ne[ne.length-1],ke=null==J||null===(R=J.envelopeDocuments)||void 0===R||null===(R=R[(null==J?void 0:J.envelopeDocuments.length)-1])||void 0===R?void 0:R.PDFBytes;if(null==J||null===($=J.envelopeDocuments)||void 0===$||($=$[0]),console.log("certificateBase64",ke),ke){const me=s.base64PdfToBlob(ke);console.log("BLOB",me);const _e=URL.createObjectURL(me);console.log("URL",_e),window.open(_e,"_blank")}}if("download-signed-document"===le){var q,Q;const ne=s.options.existingOperationDocument.docusignUpdates||[],J=ne[ne.length-1];console.log("LAST UPDATE",J),null==J||null===(q=J.envelopeDocuments)||void 0===q||(q=q[(null==J?void 0:J.envelopeDocuments.length)-1]);const De=null==J||null===(Q=J.envelopeDocuments)||void 0===Q||null===(Q=Q[0])||void 0===Q?void 0:Q.PDFBytes;if(console.log("contractSignedBase64",De),De){const me=s.base64PdfToBlob(De);console.log("BLOB",me);const _e=URL.createObjectURL(me);console.log("URL",_e),window.open(_e,"_blank")}}}}else{const oe=yield s.popoversService.onShowMenuPopover(a,"operation-document-upload-actions");if(null!=oe&&oe.data){const le=oe.data;"upload-new-document"===le&&(yield s.onUploadNewDocument()),"view-document"===le&&s.onGoToSeeDocument(),"send-to-sign"===le&&(yield s.onSendForSignature()),"delete-document"===le&&(yield s.api.deleteOperationDocument(s.options.operationId,s.options.existingOperationDocument.id)),s.triggerAfterDocumentCreation.emit()}}const ce=yield s.api.getOperationDocumentById(s.options.existingOperationDocument.id);s.options.existingOperationDocument=null===(S=ce.success)||void 0===S?void 0:S.data})()}base64PdfToBlob(a){const s=atob(a),S=new Array(s.length);for(let R=0;R<s.length;R++)S[R]=s.charCodeAt(R);const A=new Uint8Array(S);return new Blob([A],{type:"application/pdf"})}}return(r=k).\u0275fac=function(a){return new(a||r)(e.rXU(T.W3),e.rXU(ge.i),e.rXU(fe.f),e.rXU(Ce.T),e.rXU(he.m))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-sign-document-flow"]],inputs:{options:"options"},outputs:{triggerAfterDocumentCreation:"triggerAfterDocumentCreation"},decls:1,vars:1,consts:[["class","",4,"ngIf"],[1,""],[1,"d-flex"],[1,"pl-8","pr-15"],[1,"text-14","bg-white","d-flex","align-center","justify-center","border-radius-full",2,"width","30px","height","30px"],[1,"secondary-border-1","ml-15",2,"height","100%","width","1px","border-left-width","0"],[1,"w-full","bg-white","border-radius-16",2,"box-shadow","0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)"],[1,"p-24"],[1,"d-flex","justify-between","align-center"],[1,"text-14","d-flex","align-center"],["alt","",3,"src"],[1,"ml-15"],[1,"text-16","text-black"],[1,"text-14","text-secondary"],["class","text-12 text-secondary",4,"ngIf"],[4,"ngIf"],[1,"secondary-border-1","my-24","border-bottom-unset"],["class","d-flex justify-center pt-16",4,"ngIf"],["class","d-flex justify-between align-center",4,"ngIf"],[1,"text-12","text-secondary"],["alt","",2,"cursor","pointer",3,"click","src"],[1,"d-flex","justify-center","pt-16"],[1,"crm-button","crm-button-outline-primary","ml-10",3,"click"],[1,"text-error","text-14","d-flex","align-center"],[1,"pl-10"],[1,"crm-button","crm-button-secondary","text-secondary","text-[14px]"],[1,"crm-button"],[1,"crm-button","crm-button-secondary","text-secondary","text-[14px]",3,"click"],["src","assets/icon/plus-icon.svg","alt",""],[1,"crm-button",3,"click"],[1,"rounded-[16px]","mt-[10px]","p-[16px]","w-full","secondary-border-1","flex","justify-between","items-center"],[1,"flex","justify-start","w-full","items-center"],[1,"text-[14px]"],[1,"flex","items-center","w-[350px]"],[1,"w-[50px]","rounded-[100%]","ml-[15px]"],["alt","",1,"w-[38px]","h-[38px]","rounded-[100%]",3,"src"],[1,"ml-[10px]"],[1,"text-[13px]","text-black"],[1,"text-[10px]","text-secondary"],[1,"flex","text-[#00C751]","text-[12px]","w-full","items-center","ml-[20px]"],["src","assets/icon/checked-green-icon.svg","alt",""],[1,"ml-10"],[1,"crm-title","text-14","text-black","mt-24"],[1,"crm-text"],[1,"text-14","text-secondary","mt-16"],[1,"d-flex","mt-16","justify-between","pt-24","pb-16","px-16","secondary-border-1","border-radius-16"],[1,"text-14","-mt-10"],[2,"width","70%","height","40px"],[3,"statusSteps"],["class","-mt-10 ml-10",4,"ngIf"],[1,"-mt-10","ml-10"],[1,"text-14","text-secondary","bg-white","secondary-border-1","px-12","py-8","border-radius-8",3,"click"]],template:function(a,s){1&a&&e.DNE(0,re,25,10,"div",0),2&a&&e.Y8G("ngIf",s.options)},dependencies:[o.bT,Oe,o.vh]}),k})();var pe=l(1129);const Ke=["fileUploaderManagerComponent"],be=r=>({"crm-input-input-error":r}),xe=r=>({field:r}),We=r=>({item:r});function ze(r,k){1&r&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&r&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function He(r,k){1&r&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&r&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Je(r,k){1&r&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&r&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Ze(r,k){1&r&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&r&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function Qe(r,k){if(1&r){const d=e.RV6();e.j41(0,"div",15)(1,"div",27)(2,"div",28),e.nrm(3,"span"),e.k0s(),e.j41(4,"div",29),e.EFF(5),e.k0s()(),e.j41(6,"div",30),e.bIt("click",function(){const s=e.eBV(d).$implicit,S=e.XpG();return e.Njj(S.onRemoveLanguage(s))}),e.nrm(7,"i",31),e.k0s()()}if(2&r){let d,a;const s=k.$implicit,S=e.XpG();e.R7$(3),e.HbH(null==(d=S.getLanguageInfo(s))?null:d.flagClass),e.R7$(2),e.SpI(" ",null==(a=S.getLanguageInfo(s))?null:a.name," ")}}function qe(r,k){if(1&r&&(e.j41(0,"option",34),e.EFF(1),e.k0s()),2&r){const d=k.$implicit;e.Y8G("value",d.id),e.R7$(),e.JRh(d.name)}}function et(r,k){if(1&r&&(e.j41(0,"div",32)(1,"select",33),e.Z7z(2,qe,2,2,"option",34,e.fX1),e.k0s()()),2&r){const d=e.XpG();e.R7$(2),e.Dyx(d.roles)}}function tt(r,k){1&r&&(e.j41(0,"div",26),e.EFF(1),e.nI1(2,"translate"),e.k0s()),2&r&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"errors.required")," "))}function ot(r,k){if(1&r){const d=e.RV6();e.j41(0,"button",35),e.bIt("click",function(){e.eBV(d);const s=e.XpG();return e.Njj(s.changeUserInactiveState(!1))}),e.EFF(1,"Activar Usuario"),e.k0s()}}function nt(r,k){if(1&r){const d=e.RV6();e.j41(0,"button",36),e.bIt("click",function(){e.eBV(d);const s=e.XpG();return e.Njj(s.changeUserInactiveState(!0))}),e.EFF(1,"Desactivar Usuario"),e.k0s()}}let it=(()=>{var r;class k{constructor(a,s,S,A,R){this.fb=a,this.utils=s,this.popoverService=S,this.api=A,this.toast=R,this.user={},this.onChange=new e.bkB,this.userCopy=null,this.files=[],this.photoEdited=!1,this.roles=[]}ngOnInit(){var a=this;return(0,ee.A)(function*(){a.userCopy=JSON.parse(JSON.stringify(a.user)),a.initForm(),a.user?(a.populateForm(a.userCopy),a.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]},a.fileUploaderManager.createProfileFilePic(a.user)):a.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]};const s=yield a.api.getAccessRole();s.success?a.roles=s.success.data:a.toast.showErrorToast("Error al cargar los roles de acceso. "+s.error.errorMessage)})()}getLanguageInfo(a){return this.utils.getLanguageInfo(a)}onAddLanguage(a){var s=this;return(0,ee.A)(function*(){var S,A;const R={languageSelector:!0,showCountryCode:!1,selectedCodes:null===(S=s.user)||void 0===S?void 0:S.languages},$=yield s.popoverService.onShowCountrySelectorPopover(a,R);var q,Q;null!=$&&null!==(A=$.data)&&void 0!==A&&A.country&&(s.user=s.user||{},s.user.languages=(null===(q=s.user)||void 0===q?void 0:q.languages)||[],s.user.languages.push(null===(Q=$.data)||void 0===Q||null===(Q=Q.country)||void 0===Q?void 0:Q.code))})()}changeUserInactiveState(a){var s=this;return(0,ee.A)(function*(){const S=yield s.api.updateUserById(s.user.id,{...s.user,inactive:a});S.success?(s.user.inactive=a,s.toast.showSuccessToast("Estado del usuario actualizado correctamente")):s.toast.showErrorToast("Ha ocurrido un error al actualizar el estado del usuario. "+S.error.errorMessage)})()}onRemoveLanguage(a){this.user.languages=this.user.languages.filter(s=>s!==a)}initForm(){this.userForm=this.fb.group({email:["",x.k0.required],name:["",x.k0.required],jobTitle:[""],phone:["+34 "],visibleForCollaborators:[],accessRoleId:["",x.k0.required],allowSignOnBehalf:[]})}populateForm(a){var s,S,A,R,$,q,Q;this.userForm.patchValue({email:null!==(s=null==a?void 0:a.email)&&void 0!==s?s:"",name:null!==(S=null==a?void 0:a.name)&&void 0!==S?S:"",jobTitle:null!==(A=null==a?void 0:a.jobTitle)&&void 0!==A?A:"",phone:null!==(R=null==a?void 0:a.phone)&&void 0!==R?R:"",visibleForCollaborators:null!==($=null==a?void 0:a.visibleForCollaborators)&&void 0!==$&&$,accessRoleId:null!==(q=null==a?void 0:a.accessRoleId)&&void 0!==q?q:"",allowSignOnBehalf:null!==(Q=null==a?void 0:a.allowSignOnBehalf)&&void 0!==Q&&Q}),this.userForm.get("email").disable()}onSelectCountry(a){this.userForm.get("phone").setValue((null==a?void 0:a.phoneCode)+" ")}isControlInvalid(a){const s=this.userForm.get(a);return!(!s||!s.invalid||!s.dirty&&!s.touched)}}return(r=k).\u0275fac=function(a){return new(a||r)(e.rXU(x.ok),e.rXU(Ce.T),e.rXU(he.m),e.rXU(ge.i),e.rXU(fe.f))},r.\u0275cmp=e.VBU({type:r,selectors:[["app-user-form"]],viewQuery:function(a,s){if(1&a&&e.GBs(Ke,7),2&a){let S;e.mGM(S=e.lsd())&&(s.fileUploaderManager=S.first)}},inputs:{user:"user"},outputs:{onChange:"onChange"},decls:83,vars:75,consts:[["fileUploaderManagerComponent",""],[1,"crm-section",3,"formGroup"],[1,"crm-section-small-title"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","formControlName","email",3,"placeholder"],["class","crm-input-error",4,"ngIf"],["type","text","formControlName","name",3,"placeholder"],["type","text","formControlName","jobTitle",3,"placeholder"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected"],["type","text","formControlName","phone",3,"placeholder"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],[1,"crm-item-option","crm-item-option-lang","edit"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],["class","crm-input-input",4,"ngIf"],[1,"crm-input-checkboxes"],["appToggleCheckbox","",1,"crm-input-checkbox"],["formControlName","visibleForCollaborators"],[1,"crm-input-checkbox-label"],["formControlName","allowSignOnBehalf"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary","crm-button-secondary-red"],[1,"crm-input-error"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[1,"crm-input-input"],["placeholder","Seleccione","formControlName","accessRoleId"],[3,"value"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"crm-button-secondary","crm-button-secondary-red",3,"click"]],template:function(a,s){if(1&a){const S=e.RV6();e.j41(0,"form",1)(1,"div",2),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.nrm(4,"app-file-uploader-manager",null,0),e.j41(6,"div",3)(7,"div",4),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"div",5),e.nrm(11,"input",6),e.nI1(12,"translate"),e.nI1(13,"translate"),e.k0s(),e.DNE(14,ze,3,3,"div",7),e.k0s(),e.j41(15,"div",3)(16,"div",4),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"div",5),e.nrm(20,"input",8),e.nI1(21,"translate"),e.nI1(22,"translate"),e.k0s(),e.DNE(23,He,3,3,"div",7),e.k0s(),e.j41(24,"div",3)(25,"div",4),e.EFF(26),e.nI1(27,"translate"),e.k0s(),e.j41(28,"div",5),e.nrm(29,"input",9),e.nI1(30,"translate"),e.nI1(31,"translate"),e.k0s(),e.DNE(32,Je,3,3,"div",7),e.k0s(),e.j41(33,"div",3)(34,"div",4),e.EFF(35),e.nI1(36,"translate"),e.k0s(),e.j41(37,"div",10)(38,"div",5)(39,"app-flag-country-selector",11),e.bIt("emitCountrySelected",function(R){return e.eBV(S),e.Njj(s.onSelectCountry(R))}),e.k0s(),e.nrm(40,"input",12),e.nI1(41,"translate"),e.nI1(42,"translate"),e.k0s()(),e.DNE(43,Ze,3,3,"div",7),e.k0s(),e.j41(44,"div",13)(45,"div",4),e.EFF(46," Idiomas "),e.k0s(),e.j41(47,"div",14),e.Z7z(48,Qe,8,3,"div",15,e.fX1),e.j41(50,"button",16),e.bIt("click",function(R){return e.eBV(S),e.Njj(s.onAddLanguage(R))}),e.nrm(51,"i",17),e.EFF(52),e.nI1(53,"translate"),e.nI1(54,"translate"),e.k0s(),e.nrm(55,"br"),e.j41(56,"div",3)(57,"div",4),e.EFF(58,"Seleccionar Rol"),e.k0s(),e.DNE(59,et,4,0,"div",18),e.k0s(),e.DNE(60,tt,3,3,"div",7),e.nrm(61,"br"),e.j41(62,"div",3)(63,"div",4),e.EFF(64,"Mostrar usuario a colaboradores"),e.k0s(),e.j41(65,"div",19)(66,"div",20),e.nrm(67,"ion-checkbox",21),e.j41(68,"div",22),e.EFF(69,"Mostrar"),e.k0s()()()(),e.nrm(70,"br"),e.j41(71,"div",3)(72,"div",4),e.EFF(73,"Permitir que el usuario firme en nombre de la empresa"),e.k0s(),e.j41(74,"div",19)(75,"div",20),e.nrm(76,"ion-checkbox",23),e.j41(77,"div",22),e.EFF(78,"Permitir"),e.k0s()()()()(),e.nrm(79,"br")(80,"br"),e.DNE(81,ot,2,0,"button",24)(82,nt,2,0,"button",25),e.k0s()()}2&a&&(e.Y8G("formGroup",s.userForm),e.R7$(2),e.SpI(" ",e.bMT(3,22,"text.profile_pic")," "),e.R7$(6),e.SpI(" ",e.bMT(9,24,"text.email")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(57,be,s.isControlInvalid("email"))),e.R7$(),e.Y8G("placeholder",e.i5U(13,28,"text.input_placeholder",e.eq3(59,xe,e.bMT(12,26,"text.email")))),e.R7$(3),e.Y8G("ngIf",s.isControlInvalid("email")),e.R7$(3),e.SpI(" ",e.bMT(18,31,"text.name")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(61,be,s.isControlInvalid("name"))),e.R7$(),e.Y8G("placeholder",e.i5U(22,35,"text.input_placeholder",e.eq3(63,xe,e.bMT(21,33,"text.name")))),e.R7$(3),e.Y8G("ngIf",s.isControlInvalid("name")),e.R7$(3),e.SpI(" ",e.bMT(27,38,"text.job_title")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(65,be,s.isControlInvalid("jobTitle"))),e.R7$(),e.Y8G("placeholder",e.i5U(31,42,"text.input_placeholder",e.eq3(67,xe,e.bMT(30,40,"text.job_title")))),e.R7$(3),e.Y8G("ngIf",s.isControlInvalid("jobTitle")),e.R7$(3),e.SpI(" ",e.bMT(36,45,"text.phone")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(69,be,s.isControlInvalid("phone"))),e.R7$(2),e.Y8G("placeholder",e.i5U(42,49,"text.input_placeholder",e.eq3(71,xe,e.bMT(41,47,"text.phone")))),e.R7$(3),e.Y8G("ngIf",s.isControlInvalid("phone")),e.R7$(5),e.Dyx(null==s.user?null:s.user.languages),e.R7$(4),e.SpI(" ",e.i5U(54,54,"text.add_item",e.eq3(73,We,e.bMT(53,52,"text.language")))," "),e.R7$(7),e.Y8G("ngIf",s.roles),e.R7$(),e.Y8G("ngIf",s.isControlInvalid("visibleForCollaborators")),e.R7$(21),e.vxM(!0===(null==s.user?null:s.user.inactive)?81:82))},dependencies:[o.YU,o.bT,x.qT,x.xH,x.y7,x.me,x.wz,x.BC,x.cb,x.j4,x.JD,T.eY,T.hB,pe.Z,c.F,b.D9]}),k})();var lt=l(8129),Ve=l(904),st=l(7310),at=l(1852),rt=l(7380),ct=l(4954),Ye=l(4821),dt=l(4426),ut=l(4558);let pt=(()=>{var r;class k{}return(r=k).\u0275fac=function(a){return new(a||r)},r.\u0275mod=e.$C({type:r}),r.\u0275inj=e.G2t({imports:[o.MD,x.YN,x.X1,T.bv,y.S,v.X,b.h,f.T,U,u.O,j.S,I.Y,D.b,B,C.K,K.k,E.u,c.F,ae.x,se.K,de.G,N.Y,M.T]}),k})();e.wjB(t.K,[o.bT,it,lt.K],[b.D9]),e.wjB(h.v,[o.bT,Ve.X,st.s],[]),e.wjB(G.O,[o.YU,o.bT,o.B3,x.xH,x.y7,x.wz,x.BC,x.vS,T.eY,T.hB,u.O,at.n,rt.$,ct.R,Ye.e,Le],[b.D9]),e.wjB(z.r,[Ve.X,Ye.e,dt.O],[b.D9,ut.w]),e.wjB(Y.f,[ae.x],[])},8433:(H,w,l)=>{l.d(w,{x:()=>z});var o=l(467),t=l(177),x=l(9417),T=l(9465),h=l(3895),y=l(5603),v=l(3953),b=l(5970),f=l(2081),E=l(1296),e=l(4501),V=l(8397),c=l(345),U=l(9710),u=l(5188),I=l(6580),j=l(1880);const G=(D,N,B,C,M)=>({pageStartIndex:D,pageEndIndex:N,totalCount:B,paginationPage:C,sortField:M});let z=(()=>{var D;class N{constructor(C,M,K,Y,ae,se,de,ee,ue){this.popoversService=C,this.api=M,this.tableService=K,this.headerService=Y,this.toastService=ae,this.sanitizer=se,this.modalsService=de,this.router=ee,this.activatedRoute=ue,this.documents=[],this.allSystemOperationsCount=0,this.filters=null,this.sort={field:"createdAt",order:"desc"},this.pagination={page:0,itemsPerPage:50},this.agencyId=null,this.promotionId=null,this.documentsTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:"A\xf1adido en",size:"medium",type:"date"},{key:"title",label:"T\xedtulo",size:"large",type:"text"},{key:"fileName",label:"Nombre del archivo",size:"large",type:"text"},{key:"documentType",label:"Tipo de documento",size:"medium",type:"text"}],rows:[]}}ngOnInit(){this.getData()}ionViewWillEnter(){var C=this;return(0,o.A)(function*(){C.getData()})()}getData(){var C=this;return(0,o.A)(function*(){var M;let K;if(K="operation"===C.options.father?yield C.api.getOperationDocuments(C.options.operationId):yield C.api.getContactOperationDocuments({contactId:C.options.contactId}),C.documents=null===(M=K)||void 0===M||null===(M=M.success)||void 0===M?void 0:M.data,C.documents){let Y=C.tableService.convertDataToTableRows(C.documents,C.documentsTableConfig);C.documentsTableConfig.rows=Y}})()}openCreateDocumentModal(){var C=this;return(0,o.A)(function*(){yield C.modalsService.onShowCreateOperationDocumentModal(C.options.operationId),C.getData()})()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}onSort(C){}onRowClicked(C){return(0,o.A)(function*(){})()}onTableButtonClick(C){return(0,o.A)(function*(){})()}}return(D=N).\u0275fac=function(C){return new(C||D)(v.rXU(b.m),v.rXU(f.i),v.rXU(E.a),v.rXU(e.d),v.rXU(V.f),v.rXU(c.up),v.rXU(U.M),v.rXU(u.Ix),v.rXU(u.nX))},D.\u0275cmp=v.VBU({type:D,selectors:[["app-operation-documents"]],inputs:{options:"options"},standalone:!0,features:[v.aNF],decls:15,vars:8,consts:[[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar documento"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"fa","fa-plus"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[1,"crm-section"],[3,"actionButtonClick","rowClicked","table"]],template:function(C,M){1&C&&(v.j41(0,"div")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),v.nrm(6,"i",5)(7,"input",6),v.k0s()(),v.j41(8,"div",7)(9,"button",8),v.bIt("click",function(){return M.openCreateDocumentModal()}),v.nrm(10,"i",9),v.EFF(11," A\xf1adir Documento "),v.k0s()()(),v.j41(12,"app-list-pagination-selectors",10),v.bIt("goPreviousPage",function(){return M.onGoPreviousPage()})("goNextPage",function(){return M.onGoNextPage()})("sort",function(Y){return M.onSort(Y)}),v.k0s(),v.j41(13,"div",11)(14,"app-table",12),v.bIt("actionButtonClick",function(Y){return M.onTableButtonClick(Y)})("rowClicked",function(Y){return M.onRowClicked(Y)}),v.k0s()()()()()),2&C&&(v.R7$(12),v.Y8G("listPaginationConfig",v.s1E(2,G,M.updatePagination().startIndex,M.updatePagination().endIndex,M.allSystemOperationsCount,M.pagination.page+1,null!=M.sort&&M.sort.field?(null==M.sort?null:M.sort.field)+" "+(null==M.sort?null:M.sort.order):"Fecha de creaci\xf3n")),v.R7$(2),v.Y8G("table",M.documentsTableConfig))},dependencies:[t.MD,T.bv,x.YN,x.X1,y.P,I.k,h.b,j.O]}),N})()},7754:(H,w,l)=>{l.d(w,{X:()=>h});var o=l(177),t=l(9417),x=l(9465),T=l(3953);let h=(()=>{var y;class v{}return(y=v).\u0275fac=function(f){return new(f||y)},y.\u0275mod=T.$C({type:y}),y.\u0275inj=T.G2t({imports:[o.MD,t.YN,x.bv]}),v})()},7774:(H,w,l)=>{l.d(w,{G:()=>y});var o=l(177),t=l(9417),x=l(3895),T=l(9465),h=l(3953);let y=(()=>{var v;class b{}return(v=b).\u0275fac=function(E){return new(E||v)},v.\u0275mod=h.$C({type:v}),v.\u0275inj=h.G2t({imports:[o.MD,t.YN,x.b,T.bv,o.MD,t.YN]}),b})()},4426:(H,w,l)=>{l.d(w,{O:()=>Xe});var o=l(467),t=l(3953),x=l(5824),T=l(7376),h=l(9465),y=l(600),v=l(177),b=l(9417),f=l(1748),E=l(4476);function e(m,O){if(1&m&&(t.j41(0,"div",12),t.nrm(1,"app-general-toast",13),t.k0s()),2&m){const p=t.XpG();t.R7$(),t.Y8G("options",p.toastConfig)}}function V(m,O){if(1&m){const p=t.RV6();t.j41(0,"ion-checkbox",15),t.bIt("ngModelChange",function(){t.eBV(p);const n=t.XpG().$implicit,_=t.XpG();return t.Njj(_.onCheckboxChange(n))}),t.mxI("ngModelChange",function(n){t.eBV(p);const _=t.XpG().$implicit;return t.DH7(_.selected,n)||(_.selected=n),t.Njj(n)}),t.k0s(),t.j41(1,"div",16),t.EFF(2),t.k0s()}if(2&m){const p=t.XpG().$implicit,i=t.XpG();t.Y8G("id",p.label)("disabled",!p.selected&&i.selectionLimitReached),t.R50("ngModel",p.selected),t.R7$(),t.Y8G("id",p.label),t.R7$(),t.JRh(p.label)}}function c(m,O){if(1&m&&(t.j41(0,"div",14),t.DNE(1,V,3,5),t.k0s()),2&m){const p=O.$implicit;t.R7$(),t.vxM(p.hidden?-1:1)}}let U=(()=>{var m;class O{constructor(i,n){this.modalCtrl=i,this.navParams=n,this.promotion=null,this.warning=!1,this.MAX_SELECTION=50,this.allColumns=[],this.selectedKeys=[],this.toastConfig={text:"Has alcanzado el l\xedmite de columnas seleccionadas. No puedes a\xf1adir m\xe1s.\n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.localColumns=[]}ngOnInit(){this.promotion=this.navParams.get("promotion")||null,this.allColumns=this.navParams.get("columns")||[],this.selectedKeys=this.navParams.get("selectedColumnKeys")||[],this.localColumns=this.allColumns.map(i=>({key:i.key,label:i.label,hidden:i.hideSelectColumnsList,selected:this.selectedKeys.includes(i.key)})),this.checkSelectionCount()}checkSelectionCount(){const i=this.localColumns.filter(n=>n.selected).length;this.warning=i>11}onCheckboxChange(i){i.selected&&this.selectedCount>this.MAX_SELECTION&&(i.selected=!1)}get selectedCount(){return this.localColumns.filter(i=>i.selected).length}get selectionLimitReached(){return this.selectedCount>=this.MAX_SELECTION}onCancel(){this.modalCtrl.dismiss(null,"cancel")}onSave(){const i=this.localColumns.filter(n=>n.selected).map(n=>n.key);console.log(i,"updatedSelectedKeys"),this.modalCtrl.dismiss(i,"save")}}return(m=O).\u0275fac=function(i){return new(i||m)(t.rXU(h.W3),t.rXU(y.y8))},m.\u0275cmp=t.VBU({type:m,selectors:[["app-select-table-columns-modal"]],decls:15,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-times"],[1,"crm-button","crm-button-success",3,"click"],[1,"fa-solid","fa-check"],["class","crm-warning-message p-15","style","",4,"ngIf"],[1,"modal-body"],[1,"modal-body-content"],[1,"crm-section-inputs"],["class","crm-input-checkbox","appToggleCheckbox","","style","margin-bottom: 12px;",4,"ngFor","ngForOf"],[1,"crm-warning-message","p-15"],[3,"options"],["appToggleCheckbox","",1,"crm-input-checkbox",2,"margin-bottom","12px"],[3,"ngModelChange","id","disabled","ngModel"],[1,"crm-input-checkbox-label",3,"id"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," Seleccionar columnas "),t.k0s(),t.j41(3,"div",2)(4,"button",3),t.bIt("click",function(){return n.onCancel()}),t.nrm(5,"i",4),t.EFF(6," Cerrar "),t.k0s(),t.j41(7,"button",5),t.bIt("click",function(){return n.onSave()}),t.nrm(8,"i",6),t.EFF(9," Guardar "),t.k0s()()(),t.DNE(10,e,2,1,"div",7),t.j41(11,"div",8)(12,"div",9)(13,"div",10),t.DNE(14,c,2,1,"div",11),t.k0s()()()),2&i&&(t.R7$(10),t.Y8G("ngIf",n.selectionLimitReached),t.R7$(4),t.Y8G("ngForOf",n.localColumns))},dependencies:[v.Sq,v.bT,b.BC,b.vS,h.eY,h.hB,f.z,E.l],styles:[".modal-body[_ngcontent-%COMP%]{overflow-y:auto}"]}),O})();function u(m,O){if(1&m&&t.nrm(0,"img",0),2&m){const p=t.XpG();t.Y8G("src",p.icon,t.B4B)}}let I=(()=>{var m;class O{constructor(){this.className=""}ngOnInit(){}}return(m=O).\u0275fac=function(i){return new(i||m)},m.\u0275cmp=t.VBU({type:m,selectors:[["app-badge"]],inputs:{text:"text",icon:"icon",className:"className"},standalone:!0,features:[t.aNF],decls:3,vars:5,consts:[["alt","",1,"badge__icon",3,"src"]],template:function(i,n){1&i&&(t.j41(0,"div"),t.DNE(1,u,1,1,"img",0),t.EFF(2),t.k0s()),2&i&&(t.ZvI("badge ",n.className,""),t.R7$(),t.vxM(n.icon?1:-1),t.R7$(),t.SpI(" ",n.text,"\n"))}}),O})();function j(m,O){if(1&m&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&m){const p=t.XpG();t.R7$(),t.JRh(p.price)}}function G(m,O){if(1&m&&t.nrm(0,"app-badge",1),2&m){const p=t.XpG();t.Mz_("className","badge--",null==p.statusMap[p.status]?null:p.statusMap[p.status].key,""),t.FS9("text",null==p.statusMap[p.status]?null:p.statusMap[p.status].text),t.FS9("icon",null==p.statusMap[p.status]?null:p.statusMap[p.status].icon)}}function z(m,O){if(1&m&&t.EFF(0),2&m){const p=t.XpG();t.SpI(" ",p.status," ")}}let D=(()=>{var m;class O{constructor(i,n){this.price=i,this.status=n,this.statusMap={blocked:{key:"blocked",text:"Blocked",icon:"assets/icon/lock-icon.svg"},reserved:{key:"reserved",text:"Reserved",icon:"assets/icon/loading-icon-warn.svg"},sold:{key:"sold",text:"Sold",icon:""},retired:{key:"retired",text:"Retired",icon:"assets/icon/toggle-icon-left.svg"}}}ngOnInit(){}}return(m=O).\u0275fac=function(i){return new(i||m)(t.rXU("price"),t.rXU("status"))},m.\u0275cmp=t.VBU({type:m,selectors:[["app-price-status-cell"]],standalone:!0,features:[t.aNF],decls:3,vars:1,consts:[[1,"col-medium","text-left"],[3,"className","text","icon"]],template:function(i,n){1&i&&t.DNE(0,j,2,1,"div",0)(1,G,1,4,"app-badge",1)(2,z,1,1),2&i&&t.vxM("available"===n.status?0:null!=n.statusMap[n.status]&&n.statusMap[n.status].key?1:2)},dependencies:[I]}),O})(),N=(()=>{var m;class O{constructor(i){this.status=i}ngOnInit(){this.status="available"===this.status?"success":this.status}}return(m=O).\u0275fac=function(i){return new(i||m)(t.rXU("status"))},m.\u0275cmp=t.VBU({type:m,selectors:[["app-table-cell-actions"]],decls:3,vars:4,consts:[[1,"d-flex","justify-end","col-small","align-center"],[2,"padding","10px 5px"],["alt","",3,"src"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1),t.nrm(2,"img",2),t.k0s()()),2&i&&(t.R7$(),t.ZvI("table-row-background-",n.status," rowMenu-icon-wrapper"),t.R7$(),t.Y8G("src","assets/icon/more-vertical-icon.svg",t.B4B))}}),O})(),B=(()=>{var m;class O{constructor(i){this.onClick=i}ngOnInit(){}}return(m=O).\u0275fac=function(i){return new(i||m)(t.rXU("onClick"))},m.\u0275cmp=t.VBU({type:m,selectors:[["app-table-header-cell-actions"]],decls:3,vars:1,consts:[[1,"d-flex","justify-end","col-small","align-center","pr-13",3,"click"],[1,"rowMenu-icon-wrapper",2,"padding","10px 5px","background","white"],["alt","",1,"cursor-pointer",3,"src"]],template:function(i,n){1&i&&(t.j41(0,"div",0),t.bIt("click",function(){return null==n.onClick?null:n.onClick()}),t.j41(1,"div",1),t.nrm(2,"img",2),t.k0s()()),2&i&&(t.R7$(2),t.Y8G("src","assets/icon/switch-horizontal-icon.svg",t.B4B))}}),O})();var C=l(1296),M=l(2081),K=l(1213),Y=l(8397),ae=l(9710),se=l(6552),de=l(8031),ee=l(5188),ue=l(1880);const ve=["tableComponent"],ge=(m,O)=>({"border-bottom-unset":m,"border-radius-16":O});function fe(m,O){if(1&m){const p=t.RV6();t.j41(0,"div",4)(1,"app-general-toast",10),t.bIt("clickActionBtn",function(){t.eBV(p);const n=t.XpG(2);return t.Njj(n.onClickToastAction())}),t.k0s()()}if(2&m){const p=t.XpG(2);t.R7$(),t.Y8G("options",p.toastConfig)}}function Ce(m,O){if(1&m&&t.DNE(0,fe,2,1,"div",9),2&m){const p=t.XpG();t.Y8G("ngIf",!(null!=p.promotion&&p.promotion.promotionPaymentInfoIsCompleted))}}function he(m,O){if(1&m){const p=t.RV6();t.qex(0),t.j41(1,"div",16)(2,"div",17)(3,"input",18),t.mxI("ngModelChange",function(n){t.eBV(p);const _=t.XpG(2);return t.DH7(_.editedBlockName,n)||(_.editedBlockName=n),t.Njj(n)}),t.k0s()(),t.j41(4,"div",19)(5,"div",20)(6,"i",21),t.bIt("click",function(){t.eBV(p);const n=t.XpG(),_=n.$implicit,g=n.$index,P=t.XpG();return t.Njj(P.onSaveBlockTitle(_,g))}),t.k0s(),t.j41(7,"i",22),t.bIt("click",function(){t.eBV(p);const n=t.XpG(2);return t.Njj(n.onCancelBlockTitle())}),t.k0s()()()(),t.bVm()}if(2&m){const p=t.XpG(2);t.R7$(3),t.R50("ngModel",p.editedBlockName)}}function Te(m,O){if(1&m){const p=t.RV6();t.j41(0,"img",24),t.bIt("click",function(){t.eBV(p);const n=t.XpG(2),_=n.$implicit,g=n.$index,P=t.XpG();return t.Njj(P.onEditBlockTitle(_,g))}),t.k0s()}2&m&&t.Y8G("src","assets/icon/edit-icon.svg",t.B4B)}function Se(m,O){if(1&m&&(t.EFF(0),t.DNE(1,Te,1,1,"img",23)),2&m){const p=t.XpG().$implicit,i=t.XpG();t.SpI(" ",p.name||"Bloque "+p.index," "),t.R7$(),t.vxM("page"===i.context?1:-1)}}function Ee(m,O){if(1&m){const p=t.RV6();t.qex(0),t.j41(1,"button",31),t.bIt("click",function(){t.eBV(p);const n=t.XpG(4).$index,_=t.XpG();return t.Njj(_.onSaveTable(n))}),t.nrm(2,"i",32),t.EFF(3," Guardar "),t.k0s(),t.bVm()}}function Me(m,O){if(1&m){const p=t.RV6();t.j41(0,"button",31),t.bIt("click",function(){t.eBV(p);const n=t.XpG(5).$index,_=t.XpG();return t.Njj(_.onEditTable(n))}),t.nrm(1,"i",34),t.EFF(2," Edici\xf3n masiva "),t.k0s()}}function Fe(m,O){if(1&m&&t.DNE(0,Me,3,0,"button",33),2&m){const p=t.XpG(5);t.Y8G("ngIf","promoter"===(null==p.currentUser?null:p.currentUser.accountType))}}function Pe(m,O){if(1&m&&t.DNE(0,Ee,4,0,"ng-container",13)(1,Fe,1,1,"ng-template",null,1,t.C5r),2&m){const p=t.sdS(2),i=t.XpG(3).$index,n=t.XpG();t.Y8G("ngIf",n.editingTableBlockIndex===i)("ngIfElse",p)}}function Ie(m,O){if(1&m){const p=t.RV6();t.j41(0,"button",31),t.bIt("click",function(n){t.eBV(p);const _=t.XpG(4);return t.Njj(_.onDuplicateProperty(n))}),t.nrm(1,"i",35),t.EFF(2," Duplicar propiedad "),t.k0s()}}function Oe(m,O){if(1&m){const p=t.RV6();t.j41(0,"button",36),t.bIt("click",function(){t.eBV(p);const n=t.XpG(3).$implicit,_=t.XpG();return t.Njj(_.onAddProperty(n))}),t.nrm(1,"i",37),t.EFF(2," A\xf1adir propiedad "),t.k0s()}if(2&m){const p=t.XpG(4);t.Y8G("disabled",!(null!=p.promotion&&p.promotion.promotionPaymentInfoIsCompleted))}}function ye(m,O){if(1&m){const p=t.RV6();t.DNE(0,Pe,3,2)(1,Ie,3,0,"button",28)(2,Oe,3,1,"button",29),t.j41(3,"div",26)(4,"img",30),t.bIt("click",function(){t.eBV(p);const n=t.XpG(2).$implicit,_=t.XpG();return t.Njj(_.onDeleteBlock(n))}),t.k0s()()}if(2&m){const p=t.XpG(2),i=p.$implicit,n=p.$index,_=t.XpG();t.vxM(null!=i&&null!=i.tableConfig&&null!=i.tableConfig.rows&&i.tableConfig.rows.length?0:-1),t.R7$(),t.vxM(_.showDuplicateButtonBlockIndex.includes(n)&&-1===_.editingTableBlockIndex?1:-1),t.R7$(),t.vxM(_.editingTableBlockIndex!==n?2:-1),t.R7$(2),t.Y8G("src","assets/icon/trash-icon.svg",t.B4B)}}function Be(m,O){if(1&m){const p=t.RV6();t.j41(0,"img",39),t.bIt("click",function(){t.eBV(p);const n=t.XpG(3).$index,_=t.XpG();return t.Njj(_.onToggleBlock(n))}),t.k0s()}2&m&&t.Y8G("src","assets/icon/chevron-up-icon.svg",t.B4B)}function Ae(m,O){if(1&m){const p=t.RV6();t.j41(0,"img",39),t.bIt("click",function(){t.eBV(p);const n=t.XpG(3).$index,_=t.XpG();return t.Njj(_.onToggleBlock(n))}),t.k0s()}2&m&&t.Y8G("src","assets/icon/chevron-down-icon.svg",t.B4B)}function Re(m,O){if(1&m&&(t.j41(0,"div",27),t.DNE(1,Be,1,1,"img",38)(2,Ae,1,1,"img",38),t.k0s()),2&m){const p=t.XpG(2).$implicit;t.R7$(),t.vxM(p.isOpen?1:2)}}function je(m,O){if(1&m&&(t.j41(0,"div",25),t.DNE(1,ye,5,4,"div",26)(2,Re,3,1,"div",27),t.k0s()),2&m){const p=t.XpG().$implicit,i=t.XpG();t.R7$(),t.vxM("page"===i.context?1:-1),t.R7$(),t.vxM(null!=p&&null!=p.tableConfig&&null!=p.tableConfig.rows&&p.tableConfig.rows.length?2:-1)}}function we(m,O){if(1&m){const p=t.RV6();t.j41(0,"app-table",40,2),t.bIt("columnClick",function(n){t.eBV(p);const _=t.XpG().$implicit,g=t.XpG();return t.Njj(g.onColumnClicked(n,_))})("rowClicked",function(n){t.eBV(p);const _=t.XpG(2);return t.Njj(_.onRowClicked(n))})("clickGlobalCheckbox",function(n){t.eBV(p);const _=t.XpG(2);return t.Njj(_.onClickGlobalCheckbox(n))})("rowCheckboxClicked",function(n){t.eBV(p);const _=t.XpG().$index,g=t.XpG();return t.Njj(g.onRowChecked(n,_))}),t.k0s()}if(2&m){const p=t.XpG().$implicit;t.Y8G("table",null==p?null:p.tableConfig)}}function Ue(m,O){if(1&m&&(t.j41(0,"div",6)(1,"div",11)(2,"div",12),t.DNE(3,he,8,1,"ng-container",13)(4,Se,2,2,"ng-template",null,0,t.C5r),t.k0s(),t.DNE(6,je,3,2,"div",14),t.k0s(),t.DNE(7,we,2,1,"app-table",15),t.k0s()),2&m){const p=O.$implicit,i=O.$index,n=t.sdS(5),_=t.XpG();t.R7$(),t.Y8G("ngClass",t.l_i(5,ge,p.isOpen,!p.isOpen)),t.R7$(2),t.Y8G("ngIf",_.editingBlockTitleIndex===i)("ngIfElse",n),t.R7$(3),t.Y8G("ngIf","promoter"===(null==_.currentUser?null:_.currentUser.accountType)),t.R7$(),t.vxM(p.isOpen?7:-1)}}function $e(m,O){1&m&&(t.j41(0,"div",7)(1,"div",41),t.EFF(2," A\xfan no hay bloques "),t.k0s()())}function Ge(m,O){if(1&m){const p=t.RV6();t.j41(0,"button",43),t.bIt("click",function(){t.eBV(p);const n=t.XpG(2);return t.Njj(n.onAddBlock())}),t.nrm(1,"i",37),t.EFF(2," A\xf1adir bloque "),t.k0s()}}function Ne(m,O){if(1&m&&(t.j41(0,"div",8),t.DNE(1,Ge,3,0,"button",42),t.k0s()),2&m){const p=t.XpG();t.R7$(),t.Y8G("ngIf","promoter"===(null==p.currentUser?null:p.currentUser.accountType))}}let Xe=(()=>{var m;class O{constructor(i,n,_,g,P,W,L,ie,te,Z){this.modalCtrl=i,this.tableService=n,this.api=_,this.state=g,this.toastService=P,this.modalsService=W,this.utils=L,this.promotionService=ie,this.router=te,this.location=Z,this.context="page",this.reloadPromotion=new t.bkB,this.changeTab=new t.bkB,this.sortBlock=new t.bkB,this.rowCheckboxClicked=new t.bkB,this.clickGlobalCheckbox=new t.bkB,this.hashMap=[],this.loadingBlocks=!1,this.blocks=[],this.toastConfig={text:"Por favor, rellena todos los campos obligatorios de la promoci\xf3n",theme:"orange",fullWidth:!0,showCloseButton:!1,showActionButton:!0,smaller:!0},this.allColumnsKeysSelected=["externalReference","reference","promotionType","floor","bedrooms","bathrooms","totalMeasures_squareMetersBuilt","totalMeasures_squareMetersUseful","totalMeasures_squareMetersCoveredTerraces","totalMeasures_squareMetersUncoveredTerraces","f_pool_comunitaria","planos","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!0,editCellsMode:!1,columns:[{key:"reference",label:"Id",size:"small",customCssClass:"sticky-second-column bg-white",editMode:{inputType:"text"}},{key:"byvaroId",label:"Ref",size:"medium",editMode:{inputType:"text"}},{key:"promotionType",label:"Subtipo",size:"medium",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"villa",value:"Villa",selected:!1},{key:"chalet",value:"Chalet",selected:!1},{key:"country_house",value:"Finca",selected:!1},{key:"semi_detached",value:"Adosado",selected:!1},{key:"twin_house",value:"Pareado",selected:!1},{key:"bungalow",value:"Bungalow",selected:!1},{key:"flat",value:"Piso / Apartamento",selected:!1},{key:"studio",value:"Estudio",selected:!1},{key:"basement",value:"Bajo",selected:!1},{key:"loft",value:"Loft",selected:!1},{key:"mezzanine",value:"Entresuelo",selected:!1},{key:"duplex",value:"D\xfaplex",selected:!1},{key:"triplex",value:"Triplex",selected:!1},{key:"penthouse",value:"\xc1tico",selected:!1},{key:"penthouse_duplex",value:"\xc1tico d\xfaplex",selected:!1},{key:"commercial_space",value:"Local comercial",selected:!1}]}},{key:"floor",label:"Planta",size:"small",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersBuilt",label:"M2 constr.",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUseful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"m2constr",label:"M2 constr. (sin incluir terrazas)",size:"small",extraString:" m\xb2",editMode:{inputType:"number"},fn:F=>{let pe=(F.totalMeasures_squareMetersBuilt||0)-((F.totalMeasures_squareMetersCoveredTerraces||0)+(F.totalMeasures_squareMetersUncoveredTerraces||0));return pe<0&&(pe=0),pe}},{key:"totalMeasures_squareMetersTerraces",label:"M2 Terrazas",size:"small",showOnlyViewMode:!0,extraString:" m\xb2",fn:F=>F.totalMeasures_squareMetersCoveredTerraces+F.totalMeasures_squareMetersUncoveredTerraces},{key:"totalMeasures_squareMetersPatch",label:"Parcela",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersCoveredTerraces",label:"terraza cubierta",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUncoveredTerraces",label:"terraza descubierta",size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"bedrooms",label:"Dorm.",size:"small",editMode:{inputType:"number"}},{key:"bathrooms",label:"Ba\xf1os",size:"small",editMode:{inputType:"number"}},{key:"f_pool_comunitaria",label:"Piscina",size:"medium",fn:F=>F.f_pool_comunitaria?"comunitaria":F.f_pool_privada?"privada":"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"comunitaria",value:"Comunitaria",selected:!1},{key:"privada",value:"Privada",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_trastero",label:"Trastero",size:"medium",fn:F=>F.fcustom_trastero?F.fcustom_trasteroPrice?this.utils.transformThousandSeparator(F.fcustom_trasteroPrice)+" \u20ac":F.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:"S\xed",selected:!1},{key:"Incluido",value:"Incluido",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_parking",label:"Parking",size:"medium",fn:F=>{let X="";return X=F.fcustom_parking?"S\xed":"No",F.fcustom_parkingPrice&&(X=this.utils.transformThousandSeparator(F.fcustom_parkingPrice)+" \u20ac"),F.fcustom_parkingIncludedInPrice&&(X="Incluido"),null!=F&&F.fcustom_parkingComunitario&&(X+=" (Comunitario)"),X},editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:"S\xed",selected:!1},{key:"Incluido",value:"Incluido",selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"solarium",label:"Solarium",size:"small",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"yes",value:"S\xed",selected:!1},{key:"no",value:"No",selected:!1}]},fn:F=>F.fcustom_solarium?"S\xed":"No"},{key:"availabilityStatus",label:"Estado",size:"medium",translate:!0,showOnlyEditMode:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"available",value:"Disponible",selected:!1},{key:"sold",value:"Vendido",selected:!1},{key:"reserved",value:"Reservado",selected:!1},{key:"blocked",value:"Bloqueado",selected:!1},{key:"retired",value:"Retirado",selected:!1}]}},{key:"deliveryDate",label:"Fecha de Entrega",size:"medium",editMode:{inputType:"date"},fn:F=>null!=F&&F.deliveryDate?new Date(null==F?void 0:F.deliveryDate).toLocaleDateString("es-ES"):null},{key:"status",label:"Estado de obra",size:"medium",type:"text",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"proyecto-sin-licencia",value:"Proyecto sin licencia",selected:!1},{key:"proyecto-con-licencia",value:"Proyecto con licencia",selected:!1},{key:"fase-excavacion",value:"En fase de excavaci\xf3n",selected:!1},{key:"cimentacion-completada",value:"Cimentaci\xf3n completada",selected:!1},{key:"estructura-construccion",value:"Estructura en construcci\xf3n",selected:!1},{key:"cerramiento-completado",value:"Cerramiento completado",selected:!1},{key:"instalaciones-proceso",value:"Instalaciones en proceso",selected:!1},{key:"acabados-interiores",value:"Acabados interiores",selected:!1},{key:"obra-finalizada",value:"Obra finalizada",selected:!1}]}},{key:"catalog",label:"Cat\xe1logo",size:"small",showOnlyViewMode:!0,type:"file",fn:F=>{var X;return null==F||null===(X=F.propertyFiles)||void 0===X||null===(X=X.find(re=>"catalog"===re.category))||void 0===X?void 0:X.url}},{key:"planos",label:"Plano",size:"small",showOnlyViewMode:!0,type:"file",fn:F=>{var X;return null==F||null===(X=F.propertyFiles)||void 0===X||null===(X=X.find(re=>"plan"===re.category))||void 0===X?void 0:X.url}},{key:"price",label:"Precio",size:"medium",fn:F=>{let X=null==F?void 0:F.price;return X&&(X=this.utils.transformThousandSeparator(X)),X+" \u20ac"},editMode:{inputType:"number",parseAsAPrice:!0}},{key:"rowMenu",label:"rowMenu",size:"small",hideSelectColumnsList:!0,customCssClass:"sticky-last-column",type:"component"}],rows:[]},this.checkedRows=[],this.editingTableBlockIndex=-1,this.showDuplicateButtonBlockIndex=[],this.editingBlockTitleIndex=-1,this.editedBlockName=""}ngOnInit(){this.getState()}ngOnChanges(){this.getState(),this.getData()}ionViewWillEnter(){this.reloadPromotion.emit()}getState(){this.state.getState().subscribe(i=>{this.currentUser=i.user})}getData(){var i=this;return(0,o.A)(function*(){var n,_;i.showDuplicateButtonBlockIndex=[],i.checkedRows=[],i.allColumnsKeysSelected=(null===(n=i.promotion)||void 0===n?void 0:n.tableColumnsKeysSelected)||i.allColumnsKeysSelected,i.blocks=(null===(_=i.promotion)||void 0===_?void 0:_.promotionBlocks)||[];for(let g=0;g<i.blocks.length;g++)i.blocks[g].isOpen=!0,i.blocks[g].properties&&0!==i.blocks[g].properties.length&&(i.blocks[g].tableConfig=T.cloneDeep(i.tableConfig),i.allColumnsKeysSelected.includes("rowMenu")||i.allColumnsKeysSelected.push("rowMenu"),i.blocks[g].tableConfig.columns=i.blocks[g].tableConfig.columns.map(P=>(P.show=!!i.allColumnsKeysSelected.includes(P.key),P)),i.blocks[g].tableConfig.rows=i.tableService.convertDataToTableRows(T.cloneDeep(i.blocks[g].properties),T.cloneDeep(i.blocks[g].tableConfig)),"modal"===i.context&&i.blocks[g].tableConfig.rows.forEach(P=>{let W=i.promotion.propertiesTable.rows.find(L=>L.rowId===P.rowId);W&&(P.checked=W.checked)}),i.blocks[g].tableConfig.rows=i.addBackgroundColorsToTableRows(i.blocks[g].tableConfig.rows),i.blocks[g].tableConfig.rows=i.customizeRowsWithComponents(i.blocks[g].tableConfig.rows),"agency"==i.currentUser.accountType&&(i.blocks[g].tableConfig.rows=i.blocks[g].tableConfig.rows.filter(P=>"available"==P.rawObject.availabilityStatus)),"page"===i.context&&i.blocks[g].tableConfig.columns.forEach((P,W)=>{if("rowMenu"===P.key){let L={...P};L.component=B,L.componentInputs={onClick:()=>{i.onEditColumns()}},i.blocks[g].tableConfig.columns[W]=L}}));"modal"===i.context&&(i.blocks=i.blocks.filter(g=>g.properties.length))})()}customizeRowsWithComponents(i){return i.map(n=>{var _;return n.cells.rowMenu.type="component",n.cells.rowMenu.component=N,n.cells.rowMenu.componentInputs={status:n.cells.availabilityStatus.value},n.cells.price.type="component",n.cells.price.component=D,n.cells.price.componentInputs={status:n.cells.availabilityStatus.value,price:n.cells.price.value},n.cells.reference.customCssClass=`bg-${null==n||null===(_=n.style)||void 0===_?void 0:_.backgroundColor}`,"available"===n.cells.availabilityStatus.value&&(n.checkboxCssClass="border-black"),n})}addBackgroundColorsToTableRows(i){for(let n=0;n<i.length;n++)switch(i[n].rawObject.availabilityStatus){case"available":i[n].style={backgroundColor:"success"};break;case"sold":i[n].style={backgroundColor:"sold"};break;case"reserved":i[n].style={backgroundColor:"reserved"};break;case"blocked":default:i[n].style={backgroundColor:"blocked"};break;case"retired":i[n].style={backgroundColor:"retired"}}return i}onAddProperty(i){var n=this;return(0,o.A)(function*(){const _=yield n.modalCtrl.create({component:x.E,componentProps:{block:i,promotion:n.promotion},cssClass:"modal-create-property"});yield _.present();const{data:g}=yield _.onWillDismiss();g&&(n.reloadPromotion.emit(),n.toastService.showSuccessToast("Propiedad a\xf1adida correctamente"))})()}onAddBlock(){var i=this;return(0,o.A)(function*(){let n={index:i.blocks.length+1,promotionId:i.promotion.id};n=(yield i.api.addBlock(n)).success.data,i.blocks.push(n)})()}onToggleBlock(i){this.blocks[i].isOpen=!this.blocks[i].isOpen}onDeleteBlock(i){var n=this;return(0,o.A)(function*(){if(i.properties.length>0)return void n.toastService.showErrorToast("No se puede eliminar un bloque que tiene propiedades");const _=yield n.modalsService.openConfirmationModal({title:"Eliminar fase",message:"\xbfEst\xe1s seguro de que quieres eliminar esta fase?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]});"delete"===(null==_?void 0:_.data)&&(yield n.api.deleteBlock(i.id),n.blocks=n.blocks.filter(P=>P.id!==i.id))})()}onClickGlobalCheckbox(i){"modal"===this.context&&this.clickGlobalCheckbox.emit(i)}onRowClicked(i){var n=this;return(0,o.A)(function*(){const _=yield n.modalCtrl.create({component:x.E,componentProps:{property:i.rawObject,promotion:n.promotion},cssClass:"modal-create-property"});yield _.present();const{data:g}=yield _.onWillDismiss();g?(console.log("HOLA2"),n.reloadPromotion.emit()):(console.log("HOLA"),n.reloadPromotion.emit())})()}onColumnClicked(i,n){var _=this;return(0,o.A)(function*(){const g={field:"",order:i.order},P=(W,L)=>(ie,te)=>{const Z=ie[W],F=te[W];return null==Z?"asc"===L?-1:1:null==F?"asc"===L?1:-1:"string"==typeof Z&&"string"==typeof F?"asc"===L?Z.localeCompare(F):F.localeCompare(Z):"asc"===L?Z-F:F-Z};switch(i.column.key){case"reference":default:g.field="reference",n.properties.sort(P(g.field,g.order));break;case"promotionType":g.field="promotionType",n.properties.sort(P(g.field,g.order));break;case"floor":g.field="floor",n.properties.sort(P(g.field,g.order));break;case"totalMeasures_squareMetersBuilt":g.field="totalMeasures_squareMetersBuilt",n.properties.sort(P(g.field,g.order));break;case"totalMeasures_squareMetersUseful":g.field="totalMeasures_squareMetersUseful",n.properties.sort(P(g.field,g.order));break;case"totalMeasures_squareMetersPatch":g.field="totalMeasures_squareMetersPatch",n.properties.sort(P(g.field,g.order));break;case"bedrooms":g.field="bedrooms",n.properties.sort(P(g.field,g.order));break;case"bathrooms":g.field="bathrooms",n.properties.sort(P(g.field,g.order))}_.getData()})()}updateEditedRowsFromTable(i){var n=this;return(0,o.A)(function*(){const g=JSON.parse(JSON.stringify(i.table.rows)).filter(P=>P.hasBeenEdited);for(const P of g){const W=n.buildPropertyValuesToUpdate(P);null==W||delete W.catalog,null==W||delete W.planos,yield n.api.updatePropertyById(P.rawObject.id,W)}g.length>0&&(n.toastService.showSuccessToast("Propiedades actualizadas correctamente"),n.reloadPromotion.emit())})()}buildPropertyValuesToUpdate(i){const n={};return Object.entries(i.cells).forEach(([_,g])=>{var P;if(!g.hasBeenEdited)return;const W=this.tableConfig.columns.find(L=>L.key===_);"f_pool_comunitaria"===_?(console.log("f_pool_comunitaria",g.value),n.f_pool_comunitaria="comunitaria"===g.value,n.f_pool_privada="privada"===g.value,"No"===g.value&&(n.f_pool_comunitaria=!1,n.f_pool_privada=!1)):"fcustom_trastero"===_?"S\xed"===g.value?(n.fcustom_trastero=!0,n.fcustom_trasteroIncludedInPrice=!1):"Incluido"===g.value?(n.fcustom_trastero=!0,n.fcustom_trasteroIncludedInPrice=!0):(n.fcustom_trastero=!1,n.fcustom_trasteroIncludedInPrice=!1):"fcustom_parking"===_?"S\xed"===g.value?(n.fcustom_parking=!0,n.fcustom_parkingIncludedInPrice=!1,n.fcustom_parkingComunitario=!1):"Incluido"===g.value?(n.fcustom_parking=!0,n.fcustom_parkingIncludedInPrice=!0,n.fcustom_parkingComunitario=!1):(n.fcustom_parking=!1,n.fcustom_parkingIncludedInPrice=!1,n.fcustom_parkingComunitario=!1):n[_]=_.startsWith("fcustom_")?"S\xed"===g.value:"price"===_?parseFloat(g.value):g.value,"date"===(null==W||null===(P=W.editMode)||void 0===P?void 0:P.inputType)&&(n[_]=new Date(g.value).toISOString())}),n}onEditTable(i){var n=this;return(0,o.A)(function*(){const _=n.tableComponents.toArray();if(-1!==n.editingTableBlockIndex&&n.editingTableBlockIndex!==i){const P=_[n.editingTableBlockIndex];null!=P&&P.editCellsMode&&(console.log("HACE UN TOGGLE"),P.resetAndCloseTableEditCellsMode())}const g=_[i];g?(g.enableTableEditCellsMode(),n.editingTableBlockIndex=g.editCellsMode?i:-1):console.warn("Table not found for block index:",i)})()}onSaveTable(i){var n=this;return(0,o.A)(function*(){const g=n.tableComponents.toArray()[i];g?g.editCellsMode&&(yield n.updateEditedRowsFromTable(g),g.resetAndCloseTableEditCellsMode(),n.editingTableBlockIndex=-1):console.warn("Table not found for block index:",i)})()}onEditColumns(){var i=this;return(0,o.A)(function*(){const n=yield i.modalCtrl.create({component:U,componentProps:{promotion:i.promotion,columns:i.tableConfig.columns,selectedColumnKeys:i.allColumnsKeysSelected},cssClass:"modal-edit-table-columns"});yield n.present();const{data:_,role:g}=yield n.onWillDismiss();if("save"===g&&_){const P=_;i.allColumnsKeysSelected=P,i.blocks.forEach(L=>{var ie;null!=L&&null!==(ie=L.tableConfig)&&void 0!==ie&&ie.columns&&L.tableConfig.columns.forEach(te=>{te.show=P.includes(te.key)})}),yield i.api.updatePromotionById(i.promotion.id,{tableColumnsKeysSelected:i.allColumnsKeysSelected})}})()}onRowChecked(i,n){var _=this;return(0,o.A)(function*(){const g=_.blocks[n].tableConfig.rows[i],P=_.checkedRows.findIndex(L=>L.rawObject.id===g.rawObject.id);-1!==P?_.checkedRows.splice(P,1):(_.checkedRows=_.checkedRows.filter(L=>_.blocks.findIndex(te=>{var Z;return null===(Z=te.properties)||void 0===Z?void 0:Z.some(F=>F.id===L.rawObject.id)})!==n),_.checkedRows.push(g));const W=_.checkedRows.filter(L=>_.blocks.findIndex(te=>{var Z;return null===(Z=te.properties)||void 0===Z?void 0:Z.some(F=>F.id===L.rawObject.id)})===n).length;Array.isArray(_.showDuplicateButtonBlockIndex)||(_.showDuplicateButtonBlockIndex=[]),1===W?_.showDuplicateButtonBlockIndex.includes(n)||_.showDuplicateButtonBlockIndex.push(n):_.showDuplicateButtonBlockIndex=_.showDuplicateButtonBlockIndex.filter(L=>L!==n),_.rowCheckboxClicked.emit({rowIndex:i,blockIndex:n})})()}onDuplicateProperty(i){var n=this;return(0,o.A)(function*(){const g=n.checkedRows[0].rawObject;(yield n.promotionService.onDuplicateProperty(i,g))&&n.reloadPromotion.emit()})()}onEditBlockTitle(i,n){this.editingBlockTitleIndex=n,this.editedBlockName=i.name||"Bloque "+i.index}onSaveBlockTitle(i,n){var _=this;return(0,o.A)(function*(){i.name=_.editedBlockName;const g=yield _.api.editBlock(i);g&&g.success?_.toastService.showSuccessToast("Nombre del bloque actualizado correctamente"):_.toastService.showErrorToast("Error al actualizar el nombre del bloque"),_.editingBlockTitleIndex=-1})()}onCancelBlockTitle(){this.editingBlockTitleIndex=-1}onClickToastAction(){this.router.navigate([`/promotions/${this.promotion.id}/info`]),this.changeTab.emit("info")}}return(m=O).\u0275fac=function(i){return new(i||m)(t.rXU(h.W3),t.rXU(C.a),t.rXU(M.i),t.rXU(K.c),t.rXU(Y.f),t.rXU(ae.M),t.rXU(se.T),t.rXU(de.J),t.rXU(ee.Ix),t.rXU(v.aZ))},m.\u0275cmp=t.VBU({type:m,selectors:[["app-promotion-details-availability"]],viewQuery:function(i,n){if(1&i&&t.GBs(ve,5),2&i){let _;t.mGM(_=t.lsd())&&(n.tableComponents=_)}},inputs:{promotion:"promotion",context:"context"},outputs:{reloadPromotion:"reloadPromotion",changeTab:"changeTab",sortBlock:"sortBlock",rowCheckboxClicked:"rowCheckboxClicked",clickGlobalCheckbox:"clickGlobalCheckbox"},features:[t.OA$],decls:7,vars:3,consts:[["viewMode",""],["notEditingBlock",""],["tableComponent",""],[1,"crm-section"],[1,"crm-section",2,"margin-bottom","16px","width","100%"],[1,"",2,"border-radius","16px","padding","24px","background","white"],[2,"margin-bottom","40px"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"d-flex","justify-center"],["style","margin-bottom: 16px; width: 100%;","class","crm-section",4,"ngIf"],[3,"clickActionBtn","options"],[1,"crm-header-modal","crm-header-modal-empty",2,"padding","24px 16px","border","1px solid #E0E0E0","border-top-right-radius","16px","border-top-left-radius","16px",3,"ngClass"],[1,"crm-section-title"],[4,"ngIf","ngIfElse"],["class","crm-buttons-group",4,"ngIf"],[3,"table"],[1,"crm-input-input-and-icon"],[1,"crm-input-input"],["type","text","placeholder","Nombre del bloque",3,"ngModelChange","ngModel"],[1,"crm-input-input-and-icon-right"],[1,"title-edit-icons"],[1,"fa-solid","fa-check",3,"click"],[1,"fa-solid","fa-times",3,"click"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"src"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"click","src"],[1,"crm-buttons-group"],[1,"crm-trash-btn"],[1,"cursor-pointer"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button",3,"disabled"],["alt","",3,"click","src"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-save"],["class","crm-button-secondary crm-button-secondary-primary",3,"click",4,"ngIf"],[1,"fa-solid","fa-pencil"],[1,"fa-solid","fa-copy"],[1,"crm-button",3,"click","disabled"],[1,"fa-solid","fa-plus"],["alt","",1,"mb-4",3,"src"],["alt","",1,"mb-4",3,"click","src"],[3,"columnClick","rowClicked","clickGlobalCheckbox","rowCheckboxClicked","table"],[1,"crm-text"],["class","crm-button crm-button-outline-primary",3,"click",4,"ngIf"],[1,"crm-button","crm-button-outline-primary",3,"click"]],template:function(i,n){1&i&&(t.j41(0,"div",3),t.DNE(1,Ce,1,1,"div",4),t.j41(2,"div",5),t.Z7z(3,Ue,8,8,"div",6,t.fX1),t.DNE(5,$e,3,0,"div",7)(6,Ne,2,1,"div",8),t.k0s()()),2&i&&(t.R7$(),t.vxM("page"===n.context?1:-1),t.R7$(2),t.Dyx(n.blocks),t.R7$(2),t.vxM(0===n.blocks.length?5:-1),t.R7$(),t.vxM("page"===n.context?6:-1))},dependencies:[v.YU,v.bT,b.me,b.BC,b.vS,ue.O,E.l],styles:[".title-edit-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;color:var(--crm-red-color)}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:first-child{color:var(--crm-success-color)}"]}),O})()},8031:(H,w,l)=>{l.d(w,{J:()=>f});var o=l(467),t=l(7376),T=l(3953),h=l(5970),y=l(8397),v=l(2081),b=l(6552);let f=(()=>{var E;class e{constructor(c,U,u,I){this.popoversService=c,this.toastService=U,this.api=u,this.utils=I}transformPromotionFormStepOne(c){return{projectName:null==c?void 0:c.projectName,constructionType:null==c?void 0:c.constructionType,constructionSubType:null==c?void 0:c.constructionSubType,constructionStatus:null==c?void 0:c.constructionStatus,constructionYear:null==c?void 0:c.constructionYear,constructionStart:null==c?void 0:c.constructionStart,commercializationStart:null==c?void 0:c.commercializationStart,keyDeliveryDate:null==c?void 0:c.keyDeliveryDate,country:null==c?void 0:c.country,province:null==c?void 0:c.province,city:null==c?void 0:c.city,neighborhood:null==c?void 0:c.neighborhood,address:null==c?void 0:c.address,postalCode:null==c?void 0:c.postalCode,number:null==c?void 0:c.number,showAddressPublicly:null==c?void 0:c.showAddressPublicly,showGeoreferencePublicly:null==c?void 0:c.showGeoreferencePublicly,energyEfficiencyCertificate:null==c?void 0:c.energyEfficiencyCertificate,co2EmissionsCertificate:null==c?void 0:c.co2EmissionsCertificate,energyEfficiencyValue:null==c?void 0:c.energyEfficiencyValue,co2EmissionsValue:null==c?void 0:c.co2EmissionsValue}}transformPromotionFormStepThree(c){return{title_es:null==c?void 0:c.title_es,title_en:null==c?void 0:c.title_en,title_de:null==c?void 0:c.title_de,title_fr:null==c?void 0:c.title_fr,title_ru:null==c?void 0:c.title_ru,description_es:null==c?void 0:c.description_es,description_en:null==c?void 0:c.description_en,description_de:null==c?void 0:c.description_de,description_fr:null==c?void 0:c.description_fr,description_ru:null==c?void 0:c.description_ru,promotionFiles:null==c?void 0:c.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(c){const U=t.cloneDeep(c);for(const u in U)u.startsWith("f_")||u.startsWith("fcustom_")||delete U[u];return U}onDuplicateProperty(c,U){var u=this;return(0,o.A)(function*(){let I=null;const j=yield u.popoversService.onShowDuplicatePropertyPopover(c);var G,z,D,N,B;if(console.log("POPOVER RESULT",j),j&&(null!=j&&null!==(G=j.data)&&void 0!==G&&G.count&&(null==j||null===(z=j.data)||void 0===z?void 0:z.count)>0&&(null==j||null===(D=j.data)||void 0===D?void 0:D.count)<=25?I=null==j||null===(B=j.data)||void 0===B?void 0:B.count:(null==j||null===(N=j.data)||void 0===N?void 0:N.count)>25&&(yield u.toastService.showErrorToast("La cantidad de propiedades a duplicar debe ser mayor a 0 y menor o igual a 25"))),!I)return!1;for(let C=0;C<I;C++)console.log("DUPLICATING PROPERTY",C),yield u.duplicateProperty(U,C);return yield u.toastService.showSuccessToast("Propiedad duplicada exitosamente"),!0})()}duplicateProperty(c,U){var u=this;return(0,o.A)(function*(){var I,j,G,z;let D=t.cloneDeep(c);D=u.utils.parseProperties(D),D.promotionBlockId=c.promotionBlockId,D.promotionId=c.promotionId,D.reference=null!==(I=D)&&void 0!==I&&I.reference?`${null===(j=D)||void 0===j?void 0:j.reference} - Copia ${U+1}`:null,D.availabilityStatus=null;const N=t.cloneDeep((null===(G=D)||void 0===G?void 0:G.propertyFiles)||[]);delete D.id,delete D.propertyFiles,delete D.measurements_floors,delete D.byvaroId,delete D.updatedAt,delete D.createdAt;const B=yield u.api.createProperty(D);null==B||null===(z=B.success)||void 0===z||(z=z.data),console.log("LA PROPERTYYYYYYY",D),console.log("PROPERTY FILES",N)})()}}return(E=e).\u0275fac=function(c){return new(c||E)(T.KVO(h.m),T.KVO(y.f),T.KVO(v.i),T.KVO(b.T))},E.\u0275prov=T.jDH({token:E,factory:E.\u0275fac,providedIn:"root"}),e})()}}]);