"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6915],{1129:(B,k,d)=>{d.d(k,{Z:()=>I});var v=d(3953),t=d(6069),u=d(1982);function b(e,M){if(1&e){const T=v.RV6();v.j41(0,"app-country-selector-popover",4),v.bIt("countrySelected",function(P){v.eBV(T);const O=v.XpG();return v.Njj(O.selectCountry(P))})("closePopover",function(){v.eBV(T);const P=v.XpG();return v.Njj(P.dropdownOpen=!1)}),v.k0s()}2&e&&v.Y8G("showCountryCode",!0)}let I=(()=>{var e;class M{constructor(){this.emitCountrySelected=new v.bkB,this.countries=t.X,this.selectedCountry=t.X[0],this.dropdownOpen=!1}ngOnChanges(){const C=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);C!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(C)}toggleDropdown(C){C.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(C){C.event.stopPropagation(),this.selectedCountry=C.country,this.emitCountrySelected.emit(C.country),this.dropdownOpen=!1}selectCountryByPhoneCode(C){const P=this.countries.find(O=>O.phoneCode===C);P&&(this.selectedCountry=P,this.emitCountrySelected.emit(P))}extractCountryPhoneCodeFromPhoneNumber(C){return null==C?void 0:C.split(" ")[0]}}return(e=M).\u0275fac=function(C){return new(C||e)},e.\u0275cmp=v.VBU({type:e,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[v.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(C,P){1&C&&(v.j41(0,"div",0),v.bIt("click",function(V){return P.toggleDropdown(V)}),v.j41(1,"div",1),v.nrm(2,"span")(3,"i",2),v.k0s(),v.DNE(4,b,1,1,"app-country-selector-popover",3),v.k0s()),2&C&&(v.R7$(2),v.HbH(null==P.selectedCountry?null:P.selectedCountry.flagClass),v.R7$(2),v.vxM(P.dropdownOpen?4:-1))},dependencies:[u.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),M})()},6812:(B,k,d)=>{d.d(k,{u:()=>I});var v=d(177),t=d(9417),u=d(7754),b=d(3953);let I=(()=>{var e;class M{}return(e=M).\u0275fac=function(C){return new(C||e)},e.\u0275mod=b.$C({type:e}),e.\u0275inj=b.G2t({imports:[v.MD,t.YN,u.X]}),M})()},2306:(B,k,d)=>{d.d(k,{T:()=>b});var v=d(177),t=d(9417),u=d(3953);let b=(()=>{var I;class e{}return(I=e).\u0275fac=function(T){return new(T||I)},I.\u0275mod=u.$C({type:I}),I.\u0275inj=u.G2t({imports:[v.MD,t.YN]}),e})()},7754:(B,k,d)=>{d.d(k,{X:()=>e});var v=d(177),t=d(9417),u=d(9465),b=d(3955),I=d(3953);let e=(()=>{var M;class T{}return(M=T).\u0275fac=function(P){return new(P||M)},M.\u0275mod=I.$C({type:M}),M.\u0275inj=I.G2t({imports:[v.MD,t.YN,u.bv,b.h]}),T})()},7700:(B,k,d)=>{d.d(k,{K:()=>bt});var v=d(467),t=d(3953),u=d(9417),b=d(6906),I=d(2081),e=d(6552),M=d(9710),T=d(8397),C=d(3955),P=d(177),O=d(7376),V=d(9465),W=d(1129),z=d(4035);const j=s=>({"crm-input-input-error":s}),K=s=>({"text-error-important":s});function A(s,_){if(1&s&&(t.j41(0,"div",4),t.nrm(1,"input",40),t.k0s()),2&s){const p=t.XpG();t.Y8G("ngClass",t.eq3(1,j,p.isControlInvalid("email")))}}function L(s,_){if(1&s){const p=t.RV6();t.j41(0,"div",5)(1,"app-contacts-searchbar",41),t.bIt("changeInput",function(o){t.eBV(p);const a=t.XpG();return t.Njj(a.onChangeEmail(o))})("contactSelected",function(o){t.eBV(p);const a=t.XpG();return t.Njj(a.onSelectContact(o))}),t.k0s()()}if(2&s){const p=t.XpG();t.Y8G("ngClass",t.eq3(2,j,p.isControlInvalid("email"))),t.R7$(),t.Y8G("searchTerm",p.emailValue)}}function J(s,_){1&s&&(t.j41(0,"div",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"operation.form.email_error")," "))}function q(s,_){if(1&s&&(t.j41(0,"option",45),t.EFF(1),t.k0s()),2&s){const p=_.$implicit;t.FS9("value",p.key),t.R7$(),t.JRh(p.label)}}function H(s,_){if(1&s&&(t.j41(0,"div",8)(1,"div",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",15)(5,"select",43)(6,"option",44),t.EFF(7),t.nI1(8,"translate"),t.k0s(),t.Z7z(9,q,2,2,"option",45,t.fX1),t.k0s()()()),2&s){const p=t.XpG();t.R7$(2),t.SpI(" ",t.bMT(3,3,"operation.form.role")," "),t.R7$(4),t.Y8G("value",null),t.R7$(),t.JRh(t.bMT(8,5,"operation.form.select_origin")),t.R7$(2),t.Dyx(p.responsibilityOptions)}}function Z(s,_){1&s&&(t.j41(0,"div",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"operation.form.name_required")," "))}function X(s,_){1&s&&(t.j41(0,"div",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"operation.form.birthdate_required")," "))}function Q(s,_){1&s&&(t.j41(0,"div",42),t.EFF(1," Error "),t.k0s())}function tt(s,_){if(1&s&&(t.j41(0,"div",8)(1,"div",3),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div",4),t.nrm(5,"input",46),t.k0s(),t.DNE(6,Q,2,0,"div",6),t.k0s()),2&s){const p=t.XpG();t.R7$(2),t.SpI(" ",t.bMT(3,3,"operation.form.participation")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(5,j,p.isControlInvalid("participationPercentage"))),t.R7$(2),t.Y8G("ngIf",p.isControlInvalid("participationPercentage"))}}function et(s,_){1&s&&(t.j41(0,"div",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"form.address_required")," "))}function nt(s,_){1&s&&(t.j41(0,"div",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"operation.form.identity_required")," "))}function Y(s,_){1&s&&(t.j41(0,"div",42),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&s&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"operation.form.phone_required")," "))}function ot(s,_){1&s&&(t.j41(0,"div",10),t.nrm(1,"ion-radio",47),t.j41(2,"div",22),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",23),t.nrm(6,"ion-radio",48),t.j41(7,"div",22),t.EFF(8),t.nI1(9,"translate"),t.k0s()()),2&s&&(t.R7$(3),t.SpI(" ",t.bMT(4,2,"operation.form.community_property")," "),t.R7$(5),t.SpI(" ",t.bMT(9,4,"operation.form.separate_property")," "))}function rt(s,_){1&s&&(t.j41(0,"div",10),t.nrm(1,"ion-radio",49),t.j41(2,"div",22),t.EFF(3),t.nI1(4,"translate"),t.k0s()(),t.j41(5,"div",23),t.nrm(6,"ion-radio",50),t.j41(7,"div",22),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"div",23),t.nrm(11,"ion-radio",51),t.j41(12,"div",22),t.EFF(13),t.nI1(14,"translate"),t.k0s()(),t.j41(15,"div",23),t.nrm(16,"ion-radio",52),t.j41(17,"div",22),t.EFF(18),t.nI1(19,"translate"),t.k0s()(),t.j41(20,"div",23),t.nrm(21,"ion-radio",53),t.j41(22,"div",22),t.EFF(23),t.nI1(24,"translate"),t.k0s()()),2&s&&(t.R7$(3),t.SpI(" ",t.bMT(4,5,"operation.form.single")," "),t.R7$(5),t.SpI(" ",t.bMT(9,7,"operation.form.separated")," "),t.R7$(5),t.SpI(" ",t.bMT(14,9,"operation.form.divorced")," "),t.R7$(5),t.SpI(" ",t.bMT(19,11,"operation.form.widowed")," "),t.R7$(5),t.SpI(" ",t.bMT(24,13,"operation.form.civil_union")," "))}let at=(()=>{var s;class _{constructor(){this.emailValue=null,this.responsibilityOptions=b.Rl;const n=new Date,o=n.getFullYear()-18,a=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0");this.maxBirthDate=`${o}-${a}-${r}`}ngOnInit(){}ngAfterViewInit(){console.log(324324,this.form.value),setTimeout(()=>{var n;this.emailValue=null===(n=this.form.get("email"))||void 0===n?void 0:n.value},1e3)}isControlInvalid(n){const o=this.form.get(n);return!(!o||!o.invalid||!o.dirty&&!o.touched)}onSelectCountry(n){}onNextStep(){}onChangeEmail(n){this.form.patchValue({email:n})}isValidEmail(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}onSelectContact(n){n=O.cloneDeep(n),this.emailValue=n.emails[0],this.form.patchValue({email:n.emails[0]}),this.form.patchValue({name:n.name}),this.form.patchValue({gender:n.gender}),this.form.patchValue({civilStatus:n.civilStatus}),this.form.patchValue({identityNumber:n.dniPassport}),this.form.patchValue({birthDate:n.birthdate}),this.form.patchValue({identityType:n.typeOfIdentification}),this.form.patchValue({alreadySaved:!1}),this.form.patchValue(n.phones.length?{phoneNumber:n.phones[0]}:{phoneNumber:""}),this.form.patchValue({id:n.id})}onChangeMaritalType(n){var o;null===(o=this.form.get("civilType"))||void 0===o||o.setValue(n)}}return(s=_).\u0275fac=function(n){return new(n||s)},s.\u0275cmp=t.VBU({type:s,selectors:[["app-person-form"]],inputs:{form:"form",hasParentContact:"hasParentContact"},decls:117,vars:89,consts:[["addressInput",""],[3,"ngSubmit","formGroup"],[1,"crm-input",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],[1,"",3,"ngClass"],["class","crm-input-error",4,"ngIf"],[1,"crm-text","small","light","mb-15"],[1,"crm-input","mb-15"],["formControlName","gender",1,"d-flex","gap-16"],[1,"crm-input-radio"],["value","male"],[1,"crm-input-radio-label"],["value","female"],["type","text","formControlName","name",3,"placeholder"],[1,"crm-input-input"],["type","date","formControlName","birthDate"],[1,"crm-input",2,"margin-bottom","16px"],["type","text","formControlName","address",3,"placeholder"],[1,"crm-input-label",3,"ngClass"],["formControlName","identityType",1,"gap-16"],["value","dni"],[1,"crm-input-radio-label","text-secondary"],[1,"crm-input-radio","mt-10"],["value","nif"],["value","nie"],["value","passport"],["value","identityCard"],[1,"crm-input-input","mt-10",3,"ngClass"],["type","text","formControlName","identityNumber",3,"placeholder"],[1,"crm-input"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected","selectedPhoneNumber"],["type","text","formControlName","phoneNumber",3,"placeholder"],[1,"crm-text","small","light",2,"margin-bottom","8px"],["formControlName","civilType",1,"d-flex","gap-16"],[1,"crm-input-radio",3,"click"],["value","married"],["value","other"],["formControlName","civilStatus",1,"gap-16"],["type","text","placeholder","Field","formControlName","email"],[3,"changeInput","contactSelected","searchTerm"],[1,"crm-input-error"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],["type","number","formControlName","participationPercentage","placeholder","%"],["value","communityProperty"],["value","separateProperty"],["value","single"],["value","separated"],["value","divorced"],["value","widowed"],["value","civilUnion"]],template:function(n,o){if(1&n){const a=t.RV6();t.j41(0,"form",1),t.bIt("ngSubmit",function(){return t.eBV(a),t.Njj(o.onNextStep())}),t.j41(1,"div",2)(2,"div",3),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.DNE(5,A,2,3,"div",4)(6,L,2,4,"div",5)(7,J,3,3,"div",6),t.k0s(),t.j41(8,"div",7),t.EFF(9),t.nI1(10,"translate"),t.k0s(),t.DNE(11,H,11,7,"div",8),t.j41(12,"div",8)(13,"ion-radio-group",9)(14,"div",10),t.nrm(15,"ion-radio",11),t.j41(16,"div",12),t.EFF(17),t.nI1(18,"translate"),t.k0s()(),t.j41(19,"div",10),t.nrm(20,"ion-radio",13),t.j41(21,"div",12),t.EFF(22),t.nI1(23,"translate"),t.k0s()()()(),t.j41(24,"div",8)(25,"div",3),t.EFF(26),t.nI1(27,"translate"),t.k0s(),t.j41(28,"div",4),t.nrm(29,"input",14),t.nI1(30,"translate"),t.k0s(),t.DNE(31,Z,3,3,"div",6),t.k0s(),t.j41(32,"div",8)(33,"div",3),t.EFF(34),t.nI1(35,"translate"),t.k0s(),t.j41(36,"div",15),t.nrm(37,"input",16),t.k0s(),t.DNE(38,X,3,3,"div",6),t.k0s(),t.DNE(39,tt,7,7,"div",8),t.j41(40,"div",17)(41,"div",3),t.EFF(42),t.nI1(43,"translate"),t.k0s(),t.j41(44,"div",4),t.nrm(45,"input",18,0),t.nI1(47,"translate"),t.k0s(),t.DNE(48,et,3,3,"div",6),t.k0s(),t.j41(49,"div",8)(50,"div",19),t.EFF(51),t.nI1(52,"translate"),t.k0s(),t.j41(53,"ion-radio-group",20)(54,"div",10),t.nrm(55,"ion-radio",21),t.j41(56,"div",22),t.EFF(57," DNI "),t.k0s()(),t.j41(58,"div",23),t.nrm(59,"ion-radio",24),t.j41(60,"div",22),t.EFF(61," NIF "),t.k0s()(),t.j41(62,"div",23),t.nrm(63,"ion-radio",25),t.j41(64,"div",22),t.EFF(65," NIE "),t.k0s()(),t.j41(66,"div",23),t.nrm(67,"ion-radio",26),t.j41(68,"div",22),t.EFF(69),t.nI1(70,"translate"),t.k0s()(),t.j41(71,"div",23),t.nrm(72,"ion-radio",27),t.j41(73,"div",22),t.EFF(74),t.nI1(75,"translate"),t.k0s()()(),t.j41(76,"div",28),t.nrm(77,"input",29),t.nI1(78,"translate"),t.k0s(),t.DNE(79,nt,3,3,"div",6),t.k0s(),t.j41(80,"div",30)(81,"div",3),t.EFF(82),t.nI1(83,"translate"),t.k0s(),t.j41(84,"div",31)(85,"div",4)(86,"app-flag-country-selector",32),t.bIt("emitCountrySelected",function(i){return t.eBV(a),t.Njj(o.onSelectCountry(i))}),t.k0s(),t.nrm(87,"input",33),t.nI1(88,"translate"),t.k0s()(),t.DNE(89,Y,3,3,"div",6),t.j41(90,"div",34),t.EFF(91),t.nI1(92,"translate"),t.nrm(93,"br")(94,"br"),t.k0s()(),t.j41(95,"div",8)(96,"div",3),t.EFF(97),t.nI1(98,"translate"),t.k0s(),t.j41(99,"ion-radio-group",35)(100,"div",36),t.bIt("click",function(){return t.eBV(a),t.Njj(o.onChangeMaritalType("married"))}),t.nrm(101,"ion-radio",37),t.j41(102,"div",12),t.EFF(103),t.nI1(104,"translate"),t.k0s()(),t.j41(105,"div",36),t.bIt("click",function(){return t.eBV(a),t.Njj(o.onChangeMaritalType("other"))}),t.nrm(106,"ion-radio",38),t.j41(107,"div",12),t.EFF(108),t.nI1(109,"translate"),t.k0s()()()(),t.j41(110,"div",17)(111,"div",3),t.EFF(112),t.nI1(113,"translate"),t.k0s(),t.j41(114,"ion-radio-group",39),t.DNE(115,ot,10,6)(116,rt,25,15),t.k0s()()()}if(2&n){let a,r,i,l;t.Y8G("formGroup",o.form),t.R7$(3),t.Lme(" ",t.bMT(4,39,"operation.form.email")," ",null==(a=o.form.get("alreadySaved"))?null:a.value," "),t.R7$(2),t.vxM(null!=(r=o.form.get("id"))&&r.value&&null!=(r=o.form.get("alreadySaved"))&&r.value?5:6),t.R7$(2),t.Y8G("ngIf",o.isControlInvalid("email")),t.R7$(2),t.SpI(" ",t.bMT(10,41,"operation.form.email_hint")," "),t.R7$(2),t.vxM(o.hasParentContact?11:-1),t.R7$(6),t.SpI(" ",t.bMT(18,43,"operation.form.mr")," "),t.R7$(5),t.SpI(" ",t.bMT(23,45,"operation.form.mrs")," "),t.R7$(4),t.SpI(" ",t.bMT(27,47,"operation.form.name")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(79,j,o.isControlInvalid("name"))),t.R7$(),t.Y8G("placeholder",t.bMT(30,49,"operation.form.example")),t.R7$(2),t.Y8G("ngIf",o.isControlInvalid("name")),t.R7$(3),t.SpI(" ",t.bMT(35,51,"operation.form.birthdate")," "),t.R7$(3),t.BMQ("max",o.maxBirthDate),t.R7$(),t.Y8G("ngIf",o.isControlInvalid("birthDate")),t.R7$(),t.vxM(o.hasParentContact?-1:39),t.R7$(3),t.SpI(" ",t.bMT(43,53,"operation.form.address")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(81,j,o.isControlInvalid("address"))),t.R7$(),t.Y8G("placeholder",t.bMT(47,55,"operation.form.address_placeholder")),t.R7$(3),t.Y8G("ngIf",o.isControlInvalid("address")),t.R7$(2),t.Y8G("ngClass",t.eq3(83,K,o.isControlInvalid("identityType"))),t.R7$(),t.SpI(" ",t.bMT(52,57,"operation.form.identity")," "),t.R7$(18),t.SpI(" ",t.bMT(70,59,"operation.form.passport")," "),t.R7$(5),t.SpI(" ",t.bMT(75,61,"operation.form.identity_card")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(85,j,o.isControlInvalid("identityNumber"))),t.R7$(),t.Y8G("placeholder",t.bMT(78,63,"operation.form.example2")),t.R7$(2),t.Y8G("ngIf",o.isControlInvalid("identityNumber")),t.R7$(3),t.SpI(" ",t.bMT(83,65,"operation.form.phone")," "),t.R7$(3),t.Y8G("ngClass",t.eq3(87,j,o.isControlInvalid("phoneNumber"))),t.R7$(),t.Y8G("selectedPhoneNumber",null==(i=o.form.get("phoneNumber"))?null:i.value),t.R7$(),t.Y8G("placeholder",t.bMT(88,67,"operation.form.phone_placeholder")),t.R7$(2),t.Y8G("ngIf",o.isControlInvalid("phoneNumber")),t.R7$(2),t.SpI(" ",t.bMT(92,69,"operation.form.phone_hint"),""),t.R7$(6),t.SpI(" ",t.bMT(98,71,"operation.form.marital_status")," "),t.R7$(6),t.SpI(" ",t.bMT(104,73,"operation.form.married")," "),t.R7$(5),t.SpI(" ",t.bMT(109,75,"operation.form.other")," "),t.R7$(4),t.SpI(" ",t.bMT(113,77,"operation.form.select")," "),t.R7$(3),t.vxM("married"===(null==(l=o.form.get("civilType"))?null:l.value)?115:116)}},dependencies:[P.YU,P.bT,u.qT,u.xH,u.y7,u.me,u.Q0,u.wz,u.BC,u.cb,V.KO,V.f0,V.Je,u.j4,u.JD,W.Z,z.y,C.D9]}),_})();const it=["addressInput"],U=s=>({"background-color":s}),w=s=>({"crm-input-input-error":s});function D(s,_){if(1&s&&(t.j41(0,"div",15),t.EFF(1),t.k0s()),2&s){let p;const n=t.XpG(2).$implicit;t.R7$(),t.JRh(null==(p=n.get("name"))?null:p.value)}}function lt(s,_){1&s&&t.nrm(0,"img",5),2&s&&t.Y8G("src","assets/icon/chevron-down-icon.svg",t.B4B)}function st(s,_){1&s&&t.nrm(0,"img",5),2&s&&t.Y8G("src","assets/icon/chevron-up-icon.svg",t.B4B)}function ct(s,_){if(1&s){const p=t.RV6();t.j41(0,"div"),t.nrm(1,"app-person-form",18),t.j41(2,"div",19)(3,"button",20),t.bIt("click",function(){t.eBV(p);const o=t.XpG(2).index,a=t.XpG();return t.Njj(a.onSaveContact(o))}),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",21)(7,"div",22)(8,"div",23),t.bIt("click",function(){t.eBV(p);const o=t.XpG(2).index,a=t.XpG();return t.Njj(a.removePerson(o))}),t.nrm(9,"img",24),t.j41(10,"span",25),t.EFF(11),t.nI1(12,"translate"),t.k0s()()()()()()}if(2&s){const p=t.XpG(2).index,n=t.XpG();t.R7$(),t.Y8G("hasParentContact",!1)("form",n.getContactForm(p)),t.R7$(3),t.SpI(" ",t.bMT(5,5,"operation.actions.save")," "),t.R7$(5),t.Y8G("src","assets/icon/trash-icon.svg",t.B4B),t.R7$(2),t.JRh(t.bMT(12,7,"operation.actions.delete"))}}function pt(s,_){if(1&s){const p=t.RV6();t.j41(0,"div",13)(1,"div",14)(2,"div"),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.DNE(5,D,2,1,"div",15),t.k0s(),t.j41(6,"div",16),t.bIt("click",function(){t.eBV(p);const o=t.XpG().index,a=t.XpG();return t.Njj(a.togglePersonForm(o))}),t.DNE(7,lt,1,1,"img",5)(8,st,1,1,"img",5),t.k0s()(),t.DNE(9,ct,13,9,"div",17)}if(2&s){let p,n,o;const a=t.XpG(),r=a.$implicit,i=a.index;t.R7$(3),t.Lme(" ",t.bMT(4,5,"operation.buyer_form.buyer")," ",i+1,""),t.R7$(2),t.vxM(null!=(p=r.get("showForm"))&&p.value?-1:5),t.R7$(2),t.vxM(null!=(n=r.get("showForm"))&&n.value?7:8),t.R7$(2),t.Y8G("ngIf",null==(o=r.get("showForm"))?null:o.value)}}function dt(s,_){if(1&s&&(t.j41(0,"option",46),t.EFF(1),t.k0s()),2&s){const p=_.$implicit;t.FS9("value",p.key),t.R7$(),t.JRh(p.label)}}function ut(s,_){if(1&s&&(t.j41(0,"div",41)(1,"div",42)(2,"div",30),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",43)(6,"select",44)(7,"option",45),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.Z7z(10,dt,2,2,"option",46,t.fX1),t.k0s()()()()),2&s){const p=t.XpG().index,n=t.XpG(3).index,o=t.XpG();t.Y8G("formGroup",o.getCompanyPersonForm(n,p)),t.R7$(3),t.SpI(" ",t.bMT(4,4,"operation.buyer_form.role")," "),t.R7$(4),t.Y8G("value",null),t.R7$(),t.JRh(t.bMT(9,6,"operation.actions.select_origin")),t.R7$(2),t.Dyx(o.responsibilityOptions)}}function mt(s,_){if(1&s&&(t.j41(0,"div",15),t.EFF(1),t.k0s()),2&s){let p;const n=t.XpG(2).index,o=t.XpG(3).index,a=t.XpG();t.R7$(),t.JRh(null==(p=a.getCompanyPersonForm(o,n).get("name"))?null:p.value)}}function vt(s,_){if(1&s){const p=t.RV6();t.j41(0,"img",50),t.bIt("click",function(){t.eBV(p);const o=t.XpG(2).index,a=t.XpG(3).index,r=t.XpG();return t.Njj(r.toggleCompanyPersonForm(a,o))}),t.k0s()}2&s&&t.Y8G("src","assets/icon/chevron-down-icon.svg",t.B4B)}function _t(s,_){if(1&s){const p=t.RV6();t.j41(0,"img",50),t.bIt("click",function(){t.eBV(p);const o=t.XpG(2).index,a=t.XpG(3).index,r=t.XpG();return t.Njj(r.toggleCompanyPersonForm(a,o))}),t.k0s()}2&s&&t.Y8G("src","assets/icon/chevron-up-icon.svg",t.B4B)}function gt(s,_){if(1&s){const p=t.RV6();t.nrm(0,"app-person-form",18),t.j41(1,"div",19)(2,"button",51),t.bIt("click",function(){t.eBV(p);const o=t.XpG(2).index,a=t.XpG(3).index,r=t.XpG();return t.Njj(r.onSaveChildContact(a,o))}),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"div",21)(6,"div",22)(7,"div",52),t.bIt("click",function(){t.eBV(p);const o=t.XpG(2).index,a=t.XpG(3).index,r=t.XpG();return t.Njj(r.removePersonFromCompany(a,o))}),t.nrm(8,"img",53),t.j41(9,"span",25),t.EFF(10),t.nI1(11,"translate"),t.k0s()()()()()}if(2&s){const p=t.XpG(2).index,n=t.XpG(3).index,o=t.XpG();t.Y8G("hasParentContact",!0)("form",o.getCompanyPersonForm(n,p)),t.R7$(3),t.SpI(" ",t.bMT(4,5,"operation.actions.save")," "),t.R7$(5),t.Y8G("src","assets/icon/trash-icon.svg",t.B4B),t.R7$(2),t.JRh(t.bMT(11,7,"operation.actions.delete"))}}function kt(s,_){if(1&s&&(t.j41(0,"div")(1,"div",47)(2,"div")(3,"div"),t.EFF(4),t.k0s(),t.DNE(5,mt,2,1,"div",15),t.k0s(),t.j41(6,"div",48),t.DNE(7,vt,1,1,"img",49)(8,_t,1,1,"img",49),t.k0s()(),t.DNE(9,gt,12,9),t.k0s()),2&s){let p,n,o,a;const r=t.XpG(),i=r.$implicit,l=r.index,m=t.XpG(3).index,c=t.XpG();t.R7$(4),t.JRh(c.responsibilityOptionsObj[null==(p=c.getCompanyPersonForm(m,l).get("role"))?null:p.value]),t.R7$(),t.vxM(null!=(n=i.get("showForm"))&&n.value?-1:5),t.R7$(2),t.vxM(null!=(o=i.get("showForm"))&&o.value?7:8),t.R7$(2),t.vxM(null!=(a=i.get("showForm"))&&a.value?9:-1)}}function Ct(s,_){if(1&s&&(t.j41(0,"div")(1,"div",39),t.DNE(2,ut,12,8,"div",40)(3,kt,10,4,"div",17),t.k0s()()),2&s){let p,n;const o=_.index,a=t.XpG(3).index,r=t.XpG();t.R7$(2),t.Y8G("ngIf",!(null!=(p=r.getCompanyPersonForm(a,o).get("role"))&&p.value)),t.R7$(),t.Y8G("ngIf",null==(n=r.getCompanyPersonForm(a,o).get("role"))?null:n.value)}}function ft(s,_){if(1&s){const p=t.RV6();t.j41(0,"div")(1,"form",28)(2,"div",13)(3,"div",29)(4,"div",30),t.EFF(5),t.nI1(6,"translate"),t.k0s(),t.j41(7,"div",31),t.nrm(8,"input",32),t.k0s()(),t.j41(9,"div",33)(10,"div",30),t.EFF(11),t.nI1(12,"translate"),t.k0s(),t.j41(13,"div",31),t.nrm(14,"input",34),t.k0s()()(),t.j41(15,"div",13)(16,"div",29)(17,"div",30),t.EFF(18," CIF "),t.k0s(),t.j41(19,"div",31),t.nrm(20,"input",35),t.k0s()(),t.j41(21,"div",33)(22,"div",30),t.EFF(23),t.nI1(24,"translate"),t.k0s(),t.j41(25,"div",31),t.nrm(26,"input",36),t.k0s()()(),t.DNE(27,Ct,4,2,"div",37),t.j41(28,"div",38)(29,"button",4),t.bIt("click",function(){t.eBV(p);const o=t.XpG(2).index,a=t.XpG();return t.Njj(a.addPersonToCompany(o))}),t.nrm(30,"img",5),t.EFF(31),t.nI1(32,"translate"),t.k0s()()()()}if(2&s){let p;const n=t.XpG(2).index,o=t.XpG();t.R7$(),t.Y8G("formGroup",o.getContactForm(n)),t.R7$(4),t.SpI(" ",t.bMT(6,11,"operation.buyer_form.company_name")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(19,w,o.isControlInvalid(o.getContactForm(n),"name"))),t.R7$(4),t.SpI(" ",t.bMT(12,13,"operation.buyer_form.address")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(21,w,o.isControlInvalid(o.getContactForm(n),"address"))),t.R7$(6),t.Y8G("ngClass",t.eq3(23,w,o.isControlInvalid(o.getContactForm(n),"identityNumber"))),t.R7$(4),t.SpI(" ",t.bMT(24,15,"operation.buyer_form.purchase_percentage")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(25,w,o.isControlInvalid(o.getContactForm(n),"participationPercentage"))),t.R7$(2),t.Y8G("ngForOf",null==(p=o.getPersons(n))?null:p.controls),t.R7$(3),t.Y8G("src","assets/icon/plus-icon.svg",t.B4B),t.R7$(),t.SpI(" ",t.bMT(32,17,"operation.buyer_form.add_responsible")," ")}}function ht(s,_){if(1&s){const p=t.RV6();t.j41(0,"div",13)(1,"div",26),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"div")(5,"img",27),t.bIt("click",function(){t.eBV(p);const o=t.XpG().index,a=t.XpG();return t.Njj(a.removeCompany(o))}),t.k0s()()(),t.DNE(6,ft,33,27,"div",17)}if(2&s){let p;const n=t.XpG(),o=n.$implicit,a=n.index;t.R7$(2),t.Lme("",t.bMT(3,4,"operation.buyer_form.buyer")," ",a+1,""),t.R7$(3),t.Y8G("src","assets/icon/trash-icon.svg",t.B4B),t.R7$(),t.Y8G("ngIf",null==(p=o.get("showForm"))?null:p.value)}}function yt(s,_){if(1&s){const p=t.RV6();t.j41(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12),t.bIt("click",function(){const o=t.eBV(p).index,a=t.XpG();return t.Njj(a.onChangePersonType(o,"particular"))}),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"div",12),t.bIt("click",function(){const o=t.eBV(p).index,a=t.XpG();return t.Njj(a.onChangePersonType(o,"empresa"))}),t.EFF(7),t.nI1(8,"translate"),t.k0s()()(),t.DNE(9,pt,10,7)(10,ht,7,6),t.k0s()}if(2&s){let p,n,o;const a=_.$implicit;t.R7$(3),t.Y8G("ngStyle",t.eq3(9,U,"particular"===(null==(p=a.get("type"))?null:p.value)?"#ECF2FF":"")),t.R7$(),t.SpI(" ",t.bMT(5,5,"operation.buyer_form.physical_person")," "),t.R7$(2),t.Y8G("ngStyle",t.eq3(11,U,"empresa"===(null==(n=a.get("type"))?null:n.value)?"#ECF2FF":"")),t.R7$(),t.SpI(" ",t.bMT(8,7,"operation.buyer_form.legal_person")," "),t.R7$(2),t.vxM("particular"===(null==(o=a.get("type"))?null:o.value)?9:10)}}let bt=(()=>{var s;class _{constructor(n,o,a,r,i,l,m){this.fb=n,this.ngZone=o,this.api=a,this.utils=r,this.modalsService=i,this.toastService=l,this.translate=m,this.selectContactData=new t.bkB,this.screen="reserve",this.mapCenter={lat:40.416775,lng:-3.70379},this.mapZoom=6,this.markerPosition=this.mapCenter,this.mapOptions={disableDefaultUI:!1,styles:[{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]}]},this.markerOptions={draggable:!0},this.disabled=!0,this.showForms=[],this.FormGroup=u.gE,this.responsibilityOptions=b.Rl,this.responsibilityOptionsObj=b.qA;const c=this.createContactForm(!1,"particular");this.contactFormArray=this.fb.array([c])}ngOnInit(){}set contactData(n){this.contact=n,this.contact&&!this.contacts.length&&this.patchContactData(0,this.contact)}set operationData(n){this.operation=n}set reservedContacts(n){if(this.contacts=n,this.contacts.length){const o=this.extractRelatedContactIds(this.contacts);let a=0;this.contacts.forEach(r=>{o.includes(r.id)||(this.patchContactData(a,r,!1),a++)})}}extractRelatedContactIds(n){const o=[];for(const a of n.filter(r=>"empresa"===r.type))for(const r of a.contactsRelation||[])o.push(r.contactRelatedId);return o}patchContactData(n,o,a=!1){var r,i;let l=this.utils.parseBackendDateToFrontendDateInput(null==o?void 0:o.birthdate),m="";null!=o&&o.civilStatus&&(m=["communityProperty","separateProperty"].includes(o.civilStatus)?"married":"other");let c={id:o.id||null,email:(null===(r=o.emails)||void 0===r?void 0:r[0])||"",name:o.name||"",birthDate:l||"",phoneNumber:(null===(i=o.phones)||void 0===i?void 0:i[0])||"+34 ",address:o.address||"",gender:o.gender||"",type:o.type||"particular",role:"sole_administrator",identityType:o.typeOfIdentification||"",identityNumber:o.dniPassport,civilStatus:o.civilStatus,civilType:m,alreadySaved:!0,showForm:!a,formId:n},g=this.getContactForm(n);if(a){let h=this.createContactForm(a,"particular");h.patchValue(c),g.get("persons").push(h)}else{var f;null!==(f=this.operation)&&void 0!==f&&f.buyersContactsPercentages&&this.operation.buyersContactsPercentages[o.id]&&(c.participationPercentage=Number(this.operation.buyersContactsPercentages[o.id].percentage)),g?(g.patchValue(c),g.patchValue({participationPercentage:c.participationPercentage})):(g=this.createContactForm(a,c.type),g.patchValue(c))}if(this.contactFormArray.setControl(n,g),"empresa"===o.type)for(const h of o.contactsRelation||[]){const y=this.contacts.find(S=>S.id===h.contactRelatedId);y&&this.patchContactData(n,y,!0)}let F=0;this.contactFormArray.controls.forEach(h=>{var y;F+=null===(y=h.get("participationPercentage"))||void 0===y?void 0:y.value}),this.disabled=100!==F}createContactForm(n=!1,o){var a,r;const i=this.fb.group({type:[o],showForm:[!0],name:[""],email:[""],phoneNumber:["+34 "],birthDate:[""],identityNumber:[""],identityType:[""],address:[""],role:[""],id:[null],parentContact:[null],gender:[""],civilStatus:[""],civilType:[""],participationPercentage:["",[u.k0.min(1),u.k0.max(100)]],formId:[""],alreadySaved:[!1],persons:this.fb.array([])});return this.applyConditionalValidators(n,i,o),null===(a=i.get("type"))||void 0===a||a.valueChanges.subscribe(l=>{this.applyConditionalValidators(n,i,l)}),null===(r=i.get("participationPercentage"))||void 0===r||r.valueChanges.subscribe(l=>{this.onParticipationPercentageChanged(l,i)}),i}onParticipationPercentageChanged(n,o){var a;let r=null===(a=o.get("formId"))||void 0===a?void 0:a.value;const l=100-this.contactFormArray.controls.reduce((f,F)=>{var h;return F.value.formId!==r?f+parseFloat((null===(h=F.get("participationPercentage"))||void 0===h?void 0:h.value)||"0"):f},0);var c;parseFloat(n||"0")>l&&(null===(c=o.get("participationPercentage"))||void 0===c||c.setValue(l,{emitEvent:!1}));const g=this.contactFormArray.controls.reduce((f,F)=>{var h;return f+parseFloat((null===(h=F.get("participationPercentage"))||void 0===h?void 0:h.value)||"0")},0);this.disabled=100!==g}applyConditionalValidators(n=!1,o,a){var r,i,l,m,c,g,f,F,h,y,S,R,x,E,G;if(null===(r=o.get("email"))||void 0===r||r.clearValidators(),null===(i=o.get("phoneNumber"))||void 0===i||i.clearValidators(),null===(l=o.get("birthDate"))||void 0===l||l.clearValidators(),null===(m=o.get("identityNumber"))||void 0===m||m.clearValidators(),null===(c=o.get("address"))||void 0===c||c.clearValidators(),null===(g=o.get("identityType"))||void 0===g||g.clearValidators(),"particular"!==a||n){if("particular"===a&&n){var $,N,Pt,Ft,It;null===($=o.get("email"))||void 0===$||$.setValidators([u.k0.required,u.k0.email]),null===(N=o.get("phoneNumber"))||void 0===N||N.setValidators([u.k0.required]),null===(Pt=o.get("birthDate"))||void 0===Pt||Pt.setValidators([u.k0.required]),null===(Ft=o.get("identityNumber"))||void 0===Ft||Ft.setValidators([u.k0.required]),null===(It=o.get("identityType"))||void 0===It||It.setValidators([u.k0.required])}else if("empresa"===a){var Mt,Tt;null===(Mt=o.get("cif"))||void 0===Mt||Mt.setValidators([u.k0.required]),null===(Tt=o.get("participationPercentage"))||void 0===Tt||Tt.setValidators([u.k0.required,u.k0.min(1),u.k0.max(100)])}}else null===(y=o.get("email"))||void 0===y||y.setValidators([u.k0.required,u.k0.email]),null===(S=o.get("phoneNumber"))||void 0===S||S.setValidators([u.k0.required]),null===(R=o.get("birthDate"))||void 0===R||R.setValidators([u.k0.required]),null===(x=o.get("identityNumber"))||void 0===x||x.setValidators([u.k0.required]),null===(E=o.get("identityType"))||void 0===E||E.setValidators([u.k0.required]),null===(G=o.get("participationPercentage"))||void 0===G||G.setValidators([u.k0.required,u.k0.min(1),u.k0.max(100)]);null===(f=o.get("name"))||void 0===f||f.setValidators([u.k0.required]),null===(F=o.get("identityNumber"))||void 0===F||F.setValidators([u.k0.required]),null===(h=o.get("address"))||void 0===h||h.setValidators([u.k0.required])}removeCompany(n){var o=this;return(0,v.A)(function*(){let a=o.getPersons(n),r=o.getContactForm(n),i=!1;if(a.value.forEach(c=>{c.id&&(i=!0)}),r.value.id&&(i=!0),i){let c=yield o.openConfirmationModal();var l,m;if("delete"===(null==c?void 0:c.data))r.value.id&&(yield o.api.unlinkReserveContactToOperation(null===(l=o.operation)||void 0===l?void 0:l.id,r.value.id),yield o.api.unlinkBuyerContactToOperation(null===(m=o.operation)||void 0===m?void 0:m.id,r.value.id)),a.value.forEach(function(){var g=(0,v.A)(function*(f){var F,h,y;f.id&&(yield o.api.unlinkReserveContactToOperation(null===(F=o.operation)||void 0===F?void 0:F.id,f.id),yield o.api.unlinkBuyerContactToOperation(null===(h=o.operation)||void 0===h?void 0:h.id,f.id),r.value.id&&(yield o.api.removeContactRelation(f.id,null===(y=r.value)||void 0===y?void 0:y.id)))});return function(f){return g.apply(this,arguments)}}()),o.contactFormArray.removeAt(n)}else o.contactFormArray.removeAt(n)})()}getContactForm(n){return this.contactFormArray.at(n)}getPersons(n){return this.getContactForm(n).get("persons")}getCompanyPersonForm(n,o){return this.getPersons(n).at(o)}addPersonToCompany(n){this.getPersons(n).push(this.createContactForm(!0,"particular"))}removePersonFromCompany(n,o){var a=this;return(0,v.A)(function*(){let r=a.getCompanyPersonForm(n,o),i=a.getContactForm(n);if(r.value.id&&i.value.id){let g=yield a.openConfirmationModal();var l,m,c;"delete"===(null==g?void 0:g.data)&&(a.getPersons(n).removeAt(o),yield a.api.unlinkReserveContactToOperation(null===(l=a.operation)||void 0===l?void 0:l.id,r.value.id),yield a.api.unlinkBuyerContactToOperation(null===(m=a.operation)||void 0===m?void 0:m.id,r.value.id),yield a.api.removeContactRelation(r.value.id,null===(c=i.value)||void 0===c?void 0:c.id))}else a.getPersons(n).removeAt(o)})()}toggleCompanyPersonForm(n,o){var a;const r=this.getCompanyPersonForm(n,o);r.patchValue({showForm:!(null!==(a=r.get("showForm"))&&void 0!==a&&a.value)})}toggleCompanyForm(n){var o;const a=this.getContactForm(n);a.patchValue({showForm:!(null!==(o=a.get("showForm"))&&void 0!==o&&o.value)})}addNewForm(){this.contactFormArray.push(this.createContactForm(!1,"particular"))}ngAfterViewInit(){this.addressInput&&(this.autocomplete=new google.maps.places.Autocomplete(this.addressInput.nativeElement,{types:["geocode"],componentRestrictions:{country:"es"}}),this.autocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{const o=this.autocomplete.getPlace();if(!o.geometry)return;this.mapCenter={lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},this.markerPosition=this.mapCenter,this.mapZoom=17;const a=o.formatted_address||o.name||"";this.contactForm.patchValue({address:a}),this.addressInput.nativeElement.value=a})}))}isControlInvalid(n,o){const a=n.get(o);return!(!a||!a.invalid||!a.dirty&&!a.touched)}onSelectCountry(n){console.log("Selected country prefix:",n);const o=null==n?void 0:n.phoneCode,a=this.contactForm.get("phoneNumber");if(!a)return;const i=(a.value||"").split(" ");i.shift();const l=i.join(" ");a.setValue(`${o} ${l}`)}onAddressSelected(n){console.log("Address selected:",n),this.contactForm.patchValue({address:(null==n?void 0:n.formatted_address)||(null==n?void 0:n.address)||""})}getAddressFromCoordinates(n,o){(new google.maps.Geocoder).geocode({location:{lat:n,lng:o}},(r,i)=>{"OK"===i&&r&&r[0]&&this.ngZone.run(()=>{const l=r[0].formatted_address;this.contactForm.patchValue({address:l}),this.addressInput&&(this.addressInput.nativeElement.value=l),this.markerPosition={lat:n,lng:o}})})}onPrevStep(){console.log("Going to previous step...")}onNextStep(){var n=this;return(0,v.A)(function*(){n.contactFormArray.invalid?n.contactFormArray.markAllAsTouched():(n.contactFormArray.controls.forEach((o,a)=>{"particular"===o.value.type?n.onSaveContact(a,!1):"empresa"===o.value.type&&n.getPersons(a).controls.forEach((i,l)=>{n.onSaveChildContact(a,l,!1)})}),n.toastService.showToast({text:n.translate.instant("operation.contacts_deleted"),theme:"success",time:3e3}),n.selectContactData.emit())})()}onChangePersonType(n,o){const a=this.createContactForm(!1,o),r=this.contactFormArray.at(n).value;if("empresa"===o){let i=this.createContactForm(!0,"particular");i.patchValue({id:r.id||null,name:r.name||"",email:r.email||"",address:r.address||"",birthDate:r.birthDate||"",phoneNumber:r.phoneNumber||"+34 ",gender:r.gender||"male",showForm:!0,identityNumber:r.identityNumber,identityType:r.identityType,civilStatus:r.civilStatus}),a.patchValue({name:"",identityNumber:"",showForm:!0,participationPercentage:r.participationPercentage,formId:r.formId||1}),a.get("persons").push(i)}else{let i=r;Array.isArray(r.persons)&&r.persons.length>0&&(i=r.persons[0]),a.patchValue({id:i.id||null,parentContact:r||null,name:i.name||"",participationPercentage:r.participationPercentage,email:i.email||"",address:i.address||"",birthDate:i.birthDate||"",phoneNumber:i.phoneNumber||"+34 ",gender:i.gender||"male",formId:r.formId||1,identityNumber:i.identityNumber,identityType:i.identityType,civilStatus:i.civilStatus})}this.contactFormArray.setControl(n,a)}togglePersonForm(n){var o;const a=this.getContactForm(n);a.patchValue({showForm:!(null!==(o=a.get("showForm"))&&void 0!==o&&o.value)})}openConfirmationModal(){var n=this;return(0,v.A)(function*(){return yield n.modalsService.openConfirmationModal({title:n.translate.instant("operation.delete_contacts_title"),message:n.translate.instant("operation.delete_contacts_message"),icon:"fas fa-trash",iconTheme:"red",buttons:[{text:n.translate.instant("operation.action.cancel"),theme:"btn-secondary",id:"cancel"},{text:n.translate.instant("operation.action.delete"),theme:"btn-red",id:"delete"}]})})()}removePerson(n){var o=this;return(0,v.A)(function*(){const a=o.getContactForm(n);if(a.value.id){let l=yield o.openConfirmationModal();var r,i;"delete"===(null==l?void 0:l.data)&&(yield o.api.unlinkReserveContactToOperation(null===(r=o.operation)||void 0===r?void 0:r.id,a.value.id),yield o.api.unlinkBuyerContactToOperation(null===(i=o.operation)||void 0===i?void 0:i.id,a.value.id),o.contactFormArray.removeAt(n))}else o.contactFormArray.removeAt(n)})()}onSaveChildContact(n,o,a=!0){var r=this;return(0,v.A)(function*(){var i,l,m,c;const g=r.getContactForm(n),f=r.getCompanyPersonForm(n,o);if(g.invalid)return void g.markAllAsTouched();let F=r.buildContactData(g.value),h=r.buildContactData(f.value),y=yield r.saveOrUpdateContact(f.value.id,h),S=yield r.saveOrUpdateContact(g.value.id,F),R=null==S||null===(i=S.success)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.id,x=null==y||null===(l=y.success)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.id;var E,G,$,N;null!==(m=f.value)&&void 0!==m&&m.id&&null!==(c=f.value)&&void 0!==c&&c.alreadySaved||(yield r.api.addReserveContactToOperation(null===(E=r.operation)||void 0===E?void 0:E.id,x)),g.value.id||(yield r.api.addReserveContactToOperation(null===(G=r.operation)||void 0===G?void 0:G.id,R)),"buy"===r.screen&&(yield r.api.addBuyerContactToOperation(null===($=r.operation)||void 0===$?void 0:$.id,R),yield r.api.addBuyerContactToOperation(null===(N=r.operation)||void 0===N?void 0:N.id,x)),yield r.api.addContactRelation(R,x,f.value.role),yield r.updateBuyersContactsPercentages(R,g.value.participationPercentage),a&&r.toastService.showToast({text:r.translate.instant("operation.contacts_deleted"),theme:"success",time:3e3}),f.patchValue({showForm:!1})})()}onSaveContact(n,o=!0){var a=this;return(0,v.A)(function*(){const r=a.getContactForm(n);if(r.invalid)r.markAllAsTouched();else{if("particular"===r.value.type){var i,l;let S=a.buildContactData(r.value);var m,c,g,f,F;r.value.parentContact&&(yield a.api.unlinkReserveContactToOperation(null===(m=a.operation)||void 0===m?void 0:m.id,null===(c=r.value.parentContact)||void 0===c?void 0:c.id),yield a.api.unlinkBuyerContactToOperation(null===(g=a.operation)||void 0===g?void 0:g.id,null===(f=r.value.parentContact)||void 0===f?void 0:f.id),r.value.id&&(yield a.api.removeContactRelation(r.value.id,null===(F=r.value.parentContact)||void 0===F?void 0:F.id)));let R=yield a.saveOrUpdateContact(r.value.id,S),x=null==R||null===(i=R.success)||void 0===i?void 0:i.data.id;var h;yield a.api.addReserveContactToOperation(null===(l=a.operation)||void 0===l?void 0:l.id,x),"buy"===a.screen&&(yield a.api.addBuyerContactToOperation(null===(h=a.operation)||void 0===h?void 0:h.id,x)),yield a.updateBuyersContactsPercentages(x,r.value.participationPercentage),o&&a.toastService.showToast({text:a.translate.instant("operation.contacts_deleted"),theme:"success",time:3e3})}else if("empresa"===r.value.type){var y;let S={name:r.value.name,type:r.value.type,identityNumber:r.value.identityNumber,address:r.value.address},x=(yield a.saveOrUpdateContact(r.value.id,S)).success.data.id;yield a.api.addReserveContactToOperation(null===(y=a.operation)||void 0===y?void 0:y.id,x)}r.patchValue({showForm:!1})}})()}saveOrUpdateContact(n,o){var a=this;return(0,v.A)(function*(){return n?yield a.api.updateContactById(n,o):yield a.api.createContact(o)})()}updateBuyersContactsPercentages(n,o){var a=this;return(0,v.A)(function*(){var r;let i=a.operation.buyersContactsPercentages;i?i[n]={percentage:o,order:1}:i={[n]:{percentage:o,order:1}},yield a.api.updateOperationById(null===(r=a.operation)||void 0===r?void 0:r.id,{buyersContactsPercentages:i})})()}buildContactData(n){if("particular"===n.type){const o=n.phoneNumber,a=n.email,r=[];o&&!r.includes(o)&&r.unshift(o);const i=[];return a&&!i.includes(a)&&i.unshift(a),{name:n.name,birthdate:new Date(n.birthDate),phones:r,emails:i,address:n.address,gender:n.gender,typeOfIdentification:n.identityType,dniPassport:n.identityNumber,type:n.type,civilStatus:n.civilStatus}}return{name:n.name,address:n.address,dniPassport:n.identityNumber,type:n.type}}}return(s=_).\u0275fac=function(n){return new(n||s)(t.rXU(u.ok),t.rXU(t.SKi),t.rXU(I.i),t.rXU(e.T),t.rXU(M.M),t.rXU(T.f),t.rXU(C.c$))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-venta-select-contact-data"]],viewQuery:function(n,o){if(1&n&&t.GBs(it,5),2&n){let a;t.mGM(a=t.lsd())&&(o.addressInput=a.first)}},inputs:{contact:"contact",operationId:"operationId",operation:"operation",screen:"screen",contactData:"contactData",operationData:"operationData",reservedContacts:"reservedContacts"},outputs:{selectContactData:"selectContactData"},decls:15,vars:12,consts:[[1,"venta-component"],[1,"venta-component-body"],["class","content mt-15",4,"ngFor","ngForOf"],[1,"w-full"],["type","button",1,"crm-button-secondary","w-full","d-flex","justify-center","align-center",3,"click"],["alt","",1,"cursor-pointer",3,"src"],[1,"mt-10",2,"display","flex","gap","16px","justify-content","space-between"],["type","button",1,"crm-button-secondary","w-50p","d-block","text-center","border-primary",3,"click"],["type","submit",1,"crm-button","w-50p","d-block","text-center",3,"click","disabled"],[1,"content","mt-15"],[1,"",2,"border","1px solid #E0E0E0","width","100%","padding","6px","border-radius","20px","margin-bottom","16px"],[1,"d-flex","text-14"],[1,"cursor-pointer","w-50p","text-center",2,"padding","6px 10px","border-radius","20px",3,"click","ngStyle"],[1,"d-flex","justify-between"],[1,"title","mb-10"],[1,"text-14","text-secondary","font-weight-400"],[1,"cursor-pointer",3,"click"],[4,"ngIf"],[3,"hasParentContact","form"],[1,"mt-10",2,"gap","16px"],["type","submit",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"w-full","d-block","text-center","text-13","mt-15","text-secondary"],[1,"d-flex","justify-center","align-center"],[1,"d-flex","align-center","cursor-pointer",3,"click"],[2,"width","14px",3,"src"],[1,"ml-5"],[1,"title"],["alt","",1,"cursor-pointer",3,"click","src"],[3,"formGroup"],[1,"crm-input","w-50p",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","name"],[1,"crm-input","w-50p","ml-10",2,"margin-bottom","8px"],["type","text","placeholder","Field","formControlName","address"],["type","text","placeholder","Field","formControlName","identityNumber"],["type","number","placeholder","%","formControlName","participationPercentage"],[4,"ngFor","ngForOf"],[1,"w-full","mt-20"],[1,"p-16","mt-10",2,"border","1px solid #EBEBEB","border-radius","12px"],["class","w-full  ",3,"formGroup",4,"ngIf"],[1,"w-full",3,"formGroup"],[1,"crm-input"],[1,"crm-input-input"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],[1,"d-flex","justify-between","mb-10"],[1,"d-flex","align-center"],["alt","",1,"cursor-pointer","ml-10",3,"src"],["alt","",1,"cursor-pointer","ml-10",3,"click","src"],["type","button",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"cursor-pointer","d-flex","align-center",3,"click"],[1,"cursor-pointer",2,"width","14px",3,"src"]],template:function(n,o){1&n&&(t.j41(0,"div",0)(1,"div",1),t.DNE(2,yt,11,13,"div",2),t.j41(3,"div",3)(4,"button",4),t.bIt("click",function(){return o.addNewForm()}),t.nrm(5,"img",5),t.EFF(6),t.nI1(7,"translate"),t.k0s()()(),t.j41(8,"div",6)(9,"button",7),t.bIt("click",function(){return o.onPrevStep()}),t.EFF(10),t.nI1(11,"translate"),t.k0s(),t.j41(12,"button",8),t.bIt("click",function(){return o.onNextStep()}),t.EFF(13),t.nI1(14,"translate"),t.k0s()()()),2&n&&(t.R7$(2),t.Y8G("ngForOf",o.contactFormArray.controls),t.R7$(3),t.Y8G("src","assets/icon/user-plus-icon.svg",t.B4B),t.R7$(),t.SpI(" ",t.bMT(7,6,"operation.buyer_form.add_buyer")," "),t.R7$(4),t.SpI(" ",t.bMT(11,8,"operation.actions.previous")," "),t.R7$(2),t.Y8G("disabled",o.disabled),t.R7$(),t.SpI(" ",t.bMT(14,10,"operation.actions.next")," "))},dependencies:[P.YU,P.Sq,P.bT,P.B3,u.qT,u.xH,u.y7,u.me,u.Q0,u.wz,u.BC,u.cb,u.j4,u.JD,at,C.D9],styles:[".venta-component[_ngcontent-%COMP%]{max-width:500px}"]}),_})()},6915:(B,k,d)=>{d.r(k),d.d(k,{VentaOperationProcessPageModule:()=>p});var v=d(177),t=d(9417),u=d(9465),b=d(5188),I=d(467),e=d(3953),M=d(2081),T=d(8397),C=d(3955),P=d(6906);const O=n=>({count:n});function V(n,o){if(1&n){const a=e.RV6();e.j41(0,"button",19),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,l=e.XpG();return e.Njj(l.onSelectPromotion(i))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"operation.promotion.selected")," "))}function W(n,o){if(1&n){const a=e.RV6();e.j41(0,"button",20),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2).$implicit,l=e.XpG();return e.Njj(l.onSelectPromotion(i))}),e.EFF(1),e.nI1(2,"translate"),e.k0s()}2&n&&(e.R7$(),e.SpI(" ",e.bMT(2,1,"operation.promotion.select")," "))}function z(n,o){if(1&n&&(e.j41(0,"div",13)(1,"div",14),e.EFF(2),e.k0s(),e.j41(3,"div",15),e.EFF(4),e.k0s(),e.j41(5,"div",16),e.DNE(6,V,3,3,"button",17)(7,W,3,3,"button",18),e.k0s()()),2&n){const a=e.XpG().$implicit,r=e.XpG();e.R7$(2),e.SpI(" ",a.projectName," "),e.R7$(2),e.Lme(" ",a.availableProperties.length," / ",a.properties.length," "),e.R7$(2),e.vxM((null==r.selectedPromotion?null:r.selectedPromotion.id)===a.id?6:7)}}function j(n,o){1&n&&e.DNE(0,z,8,4,"div",13),2&n&&e.vxM(o.$implicit.availableProperties.length?0:-1)}let K=(()=>{var n;class o{constructor(r){this.api=r,this.selectPromotion=new e.bkB,this.promotions=[],this.selectedPromotion=null,this.searchTerm="",this.responsibilityOptions=P.Rl}ngOnInit(){this.getAllPromotions()}getAllPromotions(){var r=this;return(0,I.A)(function*(){try{const i={page:0,itemsPerPage:500},l=yield r.api.getPromotions({},null,i,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1}});null!=l&&l.success?(r.promotions=l.success.data,r.promotions.forEach(m=>{var c;m.availableProperties=null===(c=m.properties)||void 0===c?void 0:c.filter(g=>"available"===g.availabilityStatus)}),console.log("All Promotions:",r.promotions)):console.error("Error fetching promotions:",null==l?void 0:l.error)}catch(i){console.error("Error in getAllPromotions:",i)}})()}get filteredPromotions(){return this.promotions.filter(i=>{var l;return null===(l=i.projectName)||void 0===l?void 0:l.toLowerCase().includes(this.searchTerm.toLowerCase())})}onSelectPromotion(r){this.selectPromotion.emit(r),this.selectedPromotion=r}}return(n=o).\u0275fac=function(r){return new(r||n)(e.rXU(M.i))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-venta-select-promotion"]],outputs:{selectPromotion:"selectPromotion"},decls:26,vars:22,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","300px","margin-bottom","16px"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text",3,"ngModelChange","ngModel","placeholder"],[1,"promotions-table"],[1,"promotions-table-header"],[1,"promotions-table-header-title"],[1,"promotions-table-header-availability"],[1,"promotions-table-header-actions"],[1,"promotions-table-footer"],[1,"promotions-table-row"],[1,"promotions-table-row-title"],[1,"promotions-table-row-availability"],[1,"promotions-table-row-actions"],["disabled","",1,"crm-button"],[1,"crm-button"],["disabled","",1,"crm-button",3,"click"],[1,"crm-button",3,"click"]],template:function(r,i){1&r&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",2)(5,"div",3)(6,"div",4),e.nrm(7,"i",5),e.j41(8,"input",6),e.nI1(9,"translate"),e.mxI("ngModelChange",function(m){return e.DH7(i.searchTerm,m)||(i.searchTerm=m),m}),e.k0s()()(),e.j41(10,"div",7)(11,"div",8)(12,"div",9),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"div",10),e.EFF(16),e.nI1(17,"translate"),e.k0s(),e.j41(18,"div",11),e.EFF(19),e.nI1(20,"translate"),e.k0s()(),e.Z7z(21,j,1,1,null,null,e.fX1),e.k0s(),e.j41(23,"div",12),e.EFF(24),e.nI1(25,"translate"),e.k0s()()()),2&r&&(e.R7$(2),e.SpI(" ",e.bMT(3,7,"operation.promotion.step_title")," "),e.R7$(6),e.R50("ngModel",i.searchTerm),e.Y8G("placeholder",e.bMT(9,9,"operation.promotion.search_placeholder")),e.R7$(5),e.JRh(e.bMT(14,11,"operation.promotion.column_name")),e.R7$(3),e.JRh(e.bMT(17,13,"operation.promotion.column_availability")),e.R7$(3),e.JRh(e.bMT(20,15,"operation.promotion.column_actions")),e.R7$(2),e.Dyx(i.filteredPromotions),e.R7$(3),e.SpI(" ",e.i5U(25,17,"operation.promotion.total",e.eq3(20,O,i.filteredPromotions.length))," "))},dependencies:[t.me,t.BC,t.vS,C.D9]}),o})();var A=d(7376),L=d(1296),J=d(6552),q=d(1880);function H(n,o){if(1&n){const a=e.RV6();e.qex(0),e.j41(1,"div",4),e.EFF(2),e.k0s(),e.j41(3,"app-table",5),e.bIt("rowClicked",function(i){e.eBV(a);const l=e.XpG();return e.Njj(l.onRowClicked(i))}),e.k0s(),e.nrm(4,"div",6),e.bVm()}if(2&n){const a=o.$implicit,r=o.index;e.R7$(2),e.SpI(" ",a.name||"Bloque "+(a.index||r+1)," "),e.R7$(),e.Y8G("table",a.tableConfig)}}let Z=(()=>{var n;class o{constructor(r,i,l,m){this.tableService=r,this.utils=i,this.toastService=l,this.translate=m,this.selectProperty=new e.bkB,this.blocks=[],this.allColumnsKeysSelected=["externalReference","reference","m2useful","m2total","terrace","plot","bedrooms","bathrooms","pool","storage","parking","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!1,editCellsMode:!1,columns:[{key:"externalReference",label:this.translate.instant("operation.select_property.external_reference"),size:"medium",editMode:{inputType:"text"}},{key:"reference",label:this.translate.instant("operation.select_property.identifier"),size:"medium",editMode:{inputType:"text"}},{key:"m2useful",label:this.translate.instant("operation.select_property.useful_area"),size:"small",extraString:" m\xb2",fn:c=>null!=c&&c.totalMeasures_squareMetersUseful?c.totalMeasures_squareMetersUseful+" m\xb2":""},{key:"m2total",label:this.translate.instant("operation.select_property.total_area"),size:"small",extraString:" m\xb2",fn:c=>null!=c&&c.totalMeasures_squareMetersBuilt?c.totalMeasures_squareMetersBuilt+" m\xb2":""},{key:"terrace",label:this.translate.instant("operation.select_property.terrace"),size:"small",fn:c=>{const F=(c.totalMeasures_squareMetersCoveredTerraces||0)+(c.totalMeasures_squareMetersUncoveredTerraces||0);return F?F+" m\xb2":""}},{key:"plot",label:this.translate.instant("operation.select_property.plot"),size:"small",extraString:" m\xb2",fn:c=>null!=c&&c.totalMeasures_squareMetersPatch?c.totalMeasures_squareMetersPatch+" m\xb2":""},{key:"bedrooms",label:this.translate.instant("operation.select_property.bedrooms"),size:"small"},{key:"bathrooms",label:this.translate.instant("operation.select_property.bathrooms"),size:"small"},{key:"pool",label:this.translate.instant("operation.select_property.pool"),size:"small",fn:c=>c.f_pool_comunitaria?this.translate.instant("operation.select_property.pool_community"):c.f_pool_privada?this.translate.instant("operation.select_property.pool_private"):"No"},{key:"storage",label:this.translate.instant("operation.select_property.storage"),size:"small",fn:c=>c.fcustom_trastero?c.fcustom_trasteroPrice?this.utils.transformThousandSeparator(c.fcustom_trasteroPrice)+" \u20ac":this.translate.instant(c.fcustom_trasteroIncludedInPrice?"operation.select_property.included":"operation.select_property.yes"):"No"},{key:"parking",label:"Parking",size:"small",fn:c=>{let g=c.fcustom_parking?this.translate.instant("operation.select_property.yes"):"No";return c.fcustom_parkingPrice&&(g=this.utils.transformThousandSeparator(c.fcustom_parkingPrice)+" \u20ac"),c.fcustom_parkingIncludedInPrice&&(g=this.translate.instant("operation.select_property.included")),c.fcustom_parkingComunitario&&(g+=` (${this.translate.instant("operation.select_property.community")})`),g}},{key:"price",label:this.translate.instant("operation.select_property.price"),size:"small",fn:c=>null!=c&&c.price?this.utils.transformThousandSeparator(c.price)+" \u20ac":""}],rows:[]}}ngOnInit(){}set selectedPromotion(r){this.promotion=r,this.getData()}getData(){var r;if(this.promotion){this.allColumnsKeysSelected=(null===(r=this.promotion)||void 0===r?void 0:r.tableColumnsKeysSelected)||this.allColumnsKeysSelected,this.blocks=this.promotion.promotionBlocks||[];for(let i=0;i<this.blocks.length;i++){const l=this.blocks[i];!l.properties||0===l.properties.length||(l.tableConfig=A.cloneDeep(this.tableConfig),l.tableConfig.rows=this.tableService.convertDataToTableRows(A.cloneDeep(l.properties),A.cloneDeep(l.tableConfig)),l.tableConfig.rows=this.addBackgroundColorsToTableRows(l.tableConfig.rows))}}}addBackgroundColorsToTableRows(r){for(let i=0;i<r.length;i++)switch(r[i].rawObject.availabilityStatus){case"available":r[i].style={backgroundColor:"success"};break;case"sold":r[i].style={backgroundColor:"red"};break;case"reserved":r[i].style={backgroundColor:"warning"};break;default:r[i].style={backgroundColor:"blocked"}}return r}onRowClicked(r){const i=r.rawObject;console.log("Row clicked, property:",i),this.selectProperty.emit(i)}}return(n=o).\u0275fac=function(r){return new(r||n)(e.rXU(L.a),e.rXU(J.T),e.rXU(T.f),e.rXU(C.c$))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-venta-select-property"]],outputs:{selectProperty:"selectProperty"},decls:6,vars:4,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[4,"ngFor","ngForOf"],[1,"block-title"],[2,"margin-bottom","16px",3,"rowClicked","table"],[2,"margin-bottom","16px"]],template:function(r,i){1&r&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",2),e.DNE(5,H,5,2,"ng-container",3),e.k0s()()),2&r&&(e.R7$(2),e.SpI(" ",e.bMT(3,2,"operation.promotion.step_title2")," "),e.R7$(3),e.Y8G("ngForOf",i.blocks))},dependencies:[v.Sq,q.O,C.D9],styles:[".block-title[_ngcontent-%COMP%]{margin-bottom:16px;font-size:14px;font-weight:500}"]}),o})();var X=d(4558);function Q(n,o){if(1&n&&(e.j41(0,"option",21),e.EFF(1),e.k0s()),2&n){const a=o.$implicit;e.Y8G("value",a),e.R7$(),e.JRh(a)}}function tt(n,o){if(1&n){const a=e.RV6();e.j41(0,"div",22),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.editingPrice=!0)}),e.EFF(1),e.nI1(2,"thousandSeparator"),e.nrm(3,"i",23),e.k0s()}if(2&n){const a=e.XpG();e.R7$(),e.SpI(" ",e.bMT(2,1,a.priceSelected.priceWithoutIva)," \u20ac ")}}function et(n,o){if(1&n){const a=e.RV6();e.j41(0,"div",24)(1,"input",25),e.mxI("ngModelChange",function(i){e.eBV(a);const l=e.XpG();return e.DH7(l.priceSelected.priceWithoutIva,i)||(l.priceSelected.priceWithoutIva=i),e.Njj(i)}),e.k0s(),e.j41(2,"i",26),e.bIt("click",function(){e.eBV(a);const i=e.XpG();return e.Njj(i.onPriceConfirm())}),e.k0s()()}if(2&n){const a=e.XpG();e.R7$(),e.R50("ngModel",a.priceSelected.priceWithoutIva)}}let nt=(()=>{var n;class o{constructor(){this.selectPrice=new e.bkB,this.priceSelected={priceWithoutIva:0,priceWithIva:0,finalPrice:0,iva:10},this.taxRates=["0%","10%","21%"],this.selectedTaxRate="10%",this.editingPrice=!1}set selectedProperty(r){this.property=r,this.priceSelected.priceWithoutIva=(null==r?void 0:r.price)||0,this.updateCalculations()}ngOnInit(){this.updateCalculations()}onTaxRateChange(){this.updateCalculations()}onPriceConfirm(){this.updateCalculations(),this.editingPrice=!1}updateCalculations(){const r=parseFloat(this.selectedTaxRate);this.priceSelected.iva=isNaN(r)?0:r,this.priceSelected.priceWithIva=this.priceSelected.priceWithoutIva*(this.priceSelected.iva/100),this.priceSelected.finalPrice=this.priceSelected.priceWithoutIva+this.priceSelected.priceWithIva}goNextSection(){this.selectPrice.emit(this.priceSelected),console.log("Go to the next section...")}}return(n=o).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-venta-select-price"]],outputs:{selectPrice:"selectPrice"},decls:56,vars:41,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","200px","margin-bottom","24px"],[1,"crm-input-label"],[1,"crm-input-input","crm-input-input-searchbar-square"],[3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"title",2,"margin-bottom","8px"],[1,"price-table-header",2,"padding","0px 16px"],[1,"price-table-header-cell"],[1,"price-table"],[1,"price-table-row"],[1,"price-table-cell"],[1,"price-table-cell","editable-cell"],["class","editable-price-display",3,"click",4,"ngIf"],["class","editable-price-edit",4,"ngIf"],[1,"price-table-footer"],[1,"price-table-footer-cell"],[1,"crm-block-buttons-right",2,"margin-top","16px"],[1,"crm-button",3,"click"],[3,"value"],[1,"editable-price-display",3,"click"],[1,"fas","fa-pencil",2,"color","rgb(130, 130, 130)"],[1,"editable-price-edit"],["type","number",3,"ngModelChange","ngModel"],[1,"fas","fa-check",2,"color","rgb(11, 169, 11)",3,"click"]],template:function(r,i){1&r&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",2)(5,"div",3)(6,"div",4),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"div",5)(10,"select",6),e.mxI("ngModelChange",function(m){return e.DH7(i.selectedTaxRate,m)||(i.selectedTaxRate=m),m}),e.bIt("change",function(){return i.onTaxRateChange()}),e.DNE(11,Q,2,2,"option",7),e.k0s()()(),e.j41(12,"div",8),e.EFF(13),e.nI1(14,"translate"),e.k0s(),e.j41(15,"div",9)(16,"div",10),e.EFF(17),e.nI1(18,"translate"),e.k0s(),e.j41(19,"div",10),e.EFF(20),e.nI1(21,"translate"),e.k0s(),e.j41(22,"div",10),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.j41(25,"div",10),e.EFF(26),e.nI1(27,"translate"),e.k0s()(),e.j41(28,"div",11)(29,"div",12)(30,"div",13),e.EFF(31," 1A "),e.k0s(),e.j41(32,"div",14),e.DNE(33,tt,4,3,"div",15)(34,et,3,1,"div",16),e.k0s(),e.j41(35,"div",13),e.EFF(36),e.k0s(),e.j41(37,"div",13),e.EFF(38),e.nI1(39,"thousandSeparator"),e.k0s()(),e.j41(40,"div",17)(41,"div",18),e.EFF(42," Total "),e.k0s(),e.j41(43,"div",18),e.EFF(44),e.nI1(45,"thousandSeparator"),e.k0s(),e.j41(46,"div",18),e.EFF(47),e.nI1(48,"thousandSeparator"),e.k0s(),e.j41(49,"div",18),e.EFF(50),e.nI1(51,"thousandSeparator"),e.k0s()()(),e.j41(52,"div",19)(53,"button",20),e.bIt("click",function(){return i.goNextSection()}),e.EFF(54),e.nI1(55,"translate"),e.k0s()()()()),2&r&&(e.R7$(2),e.SpI(" ",e.bMT(3,17,"operation.price.step_title")," "),e.R7$(5),e.SpI(" ",e.bMT(8,19,"operation.price.tax_label")," "),e.R7$(3),e.R50("ngModel",i.selectedTaxRate),e.R7$(),e.Y8G("ngForOf",i.taxRates),e.R7$(2),e.SpI(" ",e.bMT(14,21,"operation.price.table_title")," "),e.R7$(4),e.JRh(e.bMT(18,23,"operation.price.table_headers.house")),e.R7$(3),e.JRh(e.bMT(21,25,"operation.price.table_headers.price")),e.R7$(3),e.JRh(e.bMT(24,27,"operation.price.table_headers.tax")),e.R7$(3),e.JRh(e.bMT(27,29,"operation.price.table_headers.final")),e.R7$(7),e.Y8G("ngIf",!i.editingPrice),e.R7$(),e.Y8G("ngIf",i.editingPrice),e.R7$(2),e.SpI(" ",i.selectedTaxRate," "),e.R7$(2),e.SpI(" ",e.bMT(39,31,i.priceSelected.finalPrice)," \u20ac "),e.R7$(6),e.SpI(" ",e.bMT(45,33,i.priceSelected.priceWithoutIva)," \u20ac "),e.R7$(3),e.SpI(" ",e.bMT(48,35,i.priceSelected.priceWithIva)," \u20ac "),e.R7$(3),e.SpI(" ",e.bMT(51,37,i.priceSelected.finalPrice)," \u20ac "),e.R7$(4),e.SpI(" ",e.bMT(55,39,"operation.next_section_button")," "))},dependencies:[v.Sq,v.bT,t.xH,t.y7,t.me,t.Q0,t.wz,t.BC,t.vS,X.w,C.D9],styles:[".venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .crm-input[_ngcontent-%COMP%]{margin-bottom:16px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]   .price-table-header-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]{border-radius:12px;padding:0 16px;background:#f9f9f9}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid var(--crm-border-light-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{font-weight:500;border:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-cell[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]{display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:120px;background:#fff;outline:none;border:1px solid var(--crm-border-light-color);border-radius:8px;padding:4px 8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--crm-text-color);cursor:pointer}"]}),o})();const Y=n=>({"text-error-important":n}),ot=n=>({"text-error":n}),rt=n=>({"border-error":n});let at=(()=>{var n;class o{constructor(){this.reservationAmount=0,this.selectDocumentData=new e.bkB,this.errors=[],this.formData={contractType:"",signatureType:"",reservationAmount:this.reservationAmount}}ngOnInit(){}onContinue(){this.errors=[],this.formData.reservationAmount||this.errors.push("reservationAmount"),this.formData.contractType||this.errors.push("contractType"),this.formData.signatureType||this.errors.push("signatureType"),this.errors.length||this.selectDocumentData.emit(this.formData)}ngOnChanges(r){this.formData.reservationAmount=this.reservationAmount}}return(n=o).\u0275fac=function(r){return new(r||n)},n.\u0275cmp=e.VBU({type:n,selectors:[["app-venta-select-document"]],inputs:{reservationAmount:"reservationAmount"},outputs:{selectDocumentData:"selectDocumentData"},features:[e.OA$],decls:57,vars:54,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"margin-bottom","16px"],[1,"crm-text",3,"ngClass"],[3,"ngModelChange","ngModel"],[1,"crm-input-radio"],["value","byvaro"],[1,"crm-input-radio-label"],["value","propio"],[2,"border","none","border-bottom","1px solid #e5e5e5","margin","24px 0"],["value","electronica"],["value","papel"],[1,"title","mb8"],[1,"crm-text","small","light","mb16"],[1,"crm-input",2,"margin-bottom","24px","max-width","300px"],[1,"crm-input-label",3,"ngClass"],[1,"crm-input-input",3,"ngClass"],["type","number",3,"ngModelChange","placeholder","ngModel"],[1,"crm-block-buttons-right"],[1,"crm-button",3,"click"]],template:function(r,i){1&r&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2),e.nI1(3,"translate"),e.k0s(),e.j41(4,"div",2)(5,"div",3)(6,"div",4),e.EFF(7),e.nI1(8,"translate"),e.k0s(),e.j41(9,"ion-radio-group",5),e.mxI("ngModelChange",function(m){return e.DH7(i.formData.contractType,m)||(i.formData.contractType=m),m}),e.j41(10,"div",6),e.nrm(11,"ion-radio",7),e.j41(12,"div",8),e.EFF(13),e.nI1(14,"translate"),e.k0s()(),e.j41(15,"div",6),e.nrm(16,"ion-radio",9),e.j41(17,"div",8),e.EFF(18),e.nI1(19,"translate"),e.k0s()()()(),e.nrm(20,"hr",10),e.j41(21,"div",3)(22,"div",4),e.EFF(23),e.nI1(24,"translate"),e.k0s(),e.j41(25,"ion-radio-group",5),e.mxI("ngModelChange",function(m){return e.DH7(i.formData.signatureType,m)||(i.formData.signatureType=m),m}),e.j41(26,"div",6),e.nrm(27,"ion-radio",11),e.j41(28,"div",8),e.EFF(29),e.nI1(30,"translate"),e.k0s()(),e.j41(31,"div",6),e.nrm(32,"ion-radio",12),e.j41(33,"div",8),e.EFF(34),e.nI1(35,"translate"),e.k0s()()()(),e.nrm(36,"hr",10),e.j41(37,"div",13),e.EFF(38),e.nI1(39,"translate"),e.k0s(),e.j41(40,"div",14),e.EFF(41),e.nI1(42,"translate"),e.nrm(43,"br"),e.EFF(44),e.nI1(45,"translate"),e.k0s(),e.j41(46,"div",15)(47,"div",16),e.EFF(48),e.nI1(49,"translate"),e.k0s(),e.j41(50,"div",17)(51,"input",18),e.nI1(52,"translate"),e.mxI("ngModelChange",function(m){return e.DH7(i.formData.reservationAmount,m)||(i.formData.reservationAmount=m),m}),e.k0s()()(),e.j41(53,"div",19)(54,"button",20),e.bIt("click",function(){return i.onContinue()}),e.EFF(55),e.nI1(56,"translate"),e.k0s()()()()),2&r&&(e.R7$(2),e.SpI(" ",e.bMT(3,20,"operation.reserve.step_title")," "),e.R7$(4),e.Y8G("ngClass",e.eq3(46,Y,i.errors.includes("contractType"))),e.R7$(),e.SpI(" ",e.bMT(8,22,"operation.reserve.contract_drafting")," "),e.R7$(2),e.R50("ngModel",i.formData.contractType),e.R7$(4),e.SpI(" ",e.bMT(14,24,"operation.reserve.contract_byvaro")," "),e.R7$(5),e.SpI(" ",e.bMT(19,26,"reserve.contract_custom")," "),e.R7$(4),e.Y8G("ngClass",e.eq3(48,Y,i.errors.includes("signatureType"))),e.R7$(),e.SpI(" ",e.bMT(24,28,"operation.reserve.signature_terms")," "),e.R7$(2),e.R50("ngModel",i.formData.signatureType),e.R7$(4),e.SpI(" ",e.bMT(30,30,"operation.reserve.signature_digital")," "),e.R7$(5),e.SpI(" ",e.bMT(35,32,"operation.reserve.signature_paper")," "),e.R7$(4),e.SpI(" ",e.bMT(39,34,"operation.reserve.amount_title")," "),e.R7$(3),e.SpI(" ",e.bMT(42,36,"operation.reserve.amount_hint"),""),e.R7$(3),e.SpI(" ",e.bMT(45,38,"operation.reserve.amount_hint2")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(50,ot,i.errors.includes("reservationAmount"))),e.R7$(),e.SpI(" ",e.bMT(49,40,"operation.reserve.amount_label")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(52,rt,i.errors.includes("reservationAmount"))),e.R7$(),e.Y8G("placeholder",e.bMT(52,42,"operation.amount_placeholder")),e.R50("ngModel",i.formData.reservationAmount),e.R7$(4),e.SpI(" ",e.bMT(56,44,"operation.reserve.continue_button")," "))},dependencies:[v.YU,t.me,t.Q0,t.BC,t.vS,u.KO,u.f0,u.Je,C.D9],styles:[".crm-text[_ngcontent-%COMP%]{font-style:normal;margin-bottom:8px}.crm-input-radio[_ngcontent-%COMP%]{margin-bottom:8px}ion-radio-group[_ngcontent-%COMP%]{display:flex;gap:16px}.mb8[_ngcontent-%COMP%]{margin-bottom:8px}.mb16[_ngcontent-%COMP%]{margin-bottom:16px}"]}),o})();var it=d(7700);const U=["selectPropertyComponent"],w=["selectPriceComponent"],D=n=>({"hidden-step":n}),lt=(n,o)=>({"crm-steps-container-step-current":n,"crm-steps-container-step-inactive":o});function st(n,o){1&n&&e.nrm(0,"i",24)}function ct(n,o){if(1&n&&(e.j41(0,"span"),e.EFF(1),e.k0s()),2&n){const a=e.XpG().index;e.R7$(),e.JRh(a+1)}}function pt(n,o){1&n&&e.nrm(0,"div",25)}function dt(n,o){if(1&n&&(e.j41(0,"div",18)(1,"div",19),e.DNE(2,st,1,0,"i",20)(3,ct,2,1,"span",21),e.k0s(),e.j41(4,"div",22),e.EFF(5),e.k0s(),e.DNE(6,pt,1,0,"div",23),e.k0s()),2&n){const a=o.$implicit,r=o.index,i=e.XpG();e.Y8G("ngClass",e.l_i(5,lt,r==i.activeIndex,r>i.activeIndex)),e.R7$(2),e.Y8G("ngIf",r<i.activeIndex),e.R7$(),e.Y8G("ngIf",r>=i.activeIndex),e.R7$(2),e.JRh(a),e.R7$(),e.Y8G("ngIf",r<i.steps.length-1)}}function ut(n,o){if(1&n){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",31),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.changeStep(0))}),e.nrm(6,"i",32),e.k0s()(),e.j41(7,"div",33),e.EFF(8),e.k0s()()}if(2&n){const a=e.XpG(2);e.R7$(3),e.SpI(" ",e.bMT(4,2,"operation.sale_steps.promotion")," "),e.R7$(5),e.SpI(" ",null==a.data||null==a.data.promotion?null:a.data.promotion.projectName," ")}}function mt(n,o){if(1&n){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",31),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.changeStep(1))}),e.nrm(6,"i",32),e.k0s()(),e.j41(7,"div",33),e.EFF(8),e.k0s()()}if(2&n){const a=e.XpG(2);e.R7$(3),e.SpI(" ",e.bMT(4,2,"operation.sale_steps.property")," "),e.R7$(5),e.SpI(" ",null==a.data||null==a.data.property?null:a.data.property.reference," ")}}function vt(n,o){if(1&n){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",31),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.changeStep(2))}),e.nrm(6,"i",32),e.k0s()(),e.j41(7,"div",33),e.EFF(8),e.nI1(9,"thousandSeparator"),e.k0s()()}if(2&n){const a=e.XpG(2);e.R7$(3),e.SpI(" ",e.bMT(4,2,"operation.sale_steps.price")," "),e.R7$(5),e.SpI(" ",e.bMT(9,4,null==a.data||null==a.data.priceSelected?null:a.data.priceSelected.finalPrice)," \u20ac ")}}function _t(n,o){if(1&n){const a=e.RV6();e.j41(0,"div",28)(1,"div",29)(2,"div",30),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.j41(5,"div",31),e.bIt("click",function(){e.eBV(a);const i=e.XpG(2);return e.Njj(i.changeStep(3))}),e.nrm(6,"i",32),e.k0s()(),e.j41(7,"div",33),e.EFF(8),e.k0s()()}if(2&n){const a=e.XpG(2);e.R7$(3),e.SpI(" ",e.bMT(4,2,"operation.sale_steps.reservation_doc")," "),e.R7$(5),e.SpI(" ",null==a.data||null==a.data.documentData?null:a.data.documentData.contractType," ")}}function gt(n,o){if(1&n&&(e.j41(0,"div",26),e.DNE(1,ut,9,4,"div",27)(2,mt,9,4,"div",27)(3,vt,10,6,"div",27)(4,_t,9,4,"div",27),e.k0s()),2&n){const a=e.XpG();e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.promotion),e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.property),e.R7$(),e.Y8G("ngIf",null==a.data||null==a.data.priceSelected?null:a.data.priceSelected.finalPrice),e.R7$(),e.Y8G("ngIf",null==a.data?null:a.data.documentData)}}const Ct=[{path:"",component:(()=>{var n;class o{constructor(r,i,l,m,c){this.api=r,this.route=i,this.toast=l,this.router=m,this.translate=c,this.reservationPayment=0,this.data={promotion:null,property:null,priceSelected:{priceWithoutIva:null,priceWithIva:null,finalPrice:null,iva:10},documentData:null},this.steps=[this.translate.instant("operation.sale_steps.promotionWNumber"),this.translate.instant("operation.sale_steps.propertyWNumber"),this.translate.instant("operation.sale_steps.priceWNumber"),this.translate.instant("operation.sale_steps.reservation_docWNumber"),this.translate.instant("operation.sale_steps.client_data")],this.activeIndex=0,this.reservedContacts=[]}ngOnInit(){const r=this.route.snapshot.paramMap.get("operationId");r?this.api.getOperation({id:{equals:r}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1},operationRegisters:{apply:!0,filter:null,onlyCount:!1}}).then(i=>{i.success&&i.success.data&&i.success.data.length&&(this.operation=i.success.data[0],this.api.getOperationById(r).then(l=>{l.success&&l.success.data&&l.success.data.reserveContacts.length&&(this.reservedContacts=l.success.data.reserveContacts)}))}).catch(i=>{console.error("Error retrieving operation:",i)}):console.warn("No operationId parameter found in the URL.")}onSelectPromotion(r){var i=this;return(0,I.A)(function*(){var l;i.data.promotion=r,i.activeIndex=1;const m=yield i.api.getPromotionFullDataById(i.data.promotion.id);i.data.promotion=null==m||null===(l=m.success)||void 0===l?void 0:l.data,i.selectPropertyComponent.selectedPromotion=i.data.promotion})()}onSelectProperty(r){var i=this;return(0,I.A)(function*(){i.data.property=r,i.selectPriceComponent.selectedProperty=r,i.activeIndex=2})()}onSelectPrice(r){var i;this.data.priceSelected=r,this.reservationPayment=null===(i=this.operation)||void 0===i||null===(i=i.mainProperty)||void 0===i||null===(i=i.promotion)||void 0===i?void 0:i.reservePayment,this.activeIndex=3}onSelectDocumentData(r){this.data.documentData=r,this.activeIndex=4}onSelectContactData(){console.log("Contact data selected:",this.data.documentData),this.finishFlow()}finishFlow(){var r=this;return(0,I.A)(function*(){const i={propertyId:r.data.property.id,operationId:r.operation.id,priceSelected:r.data.priceSelected,documentData:r.data.documentData};(yield r.api.reserveProperty(i)).success?(r.toast.showSuccessToast(r.translate.instant("operation.sale_steps.success")),r.router.navigate(["/contacts",r.operation.contactId,"operations",r.operation.id])):r.toast.showErrorToast(r.translate.instant("operation.sale_steps.error"))})()}changeStep(r){this.activeIndex=r,0===r&&(this.data.property=null,this.data.priceSelected=null,this.data.documentData=null,this.selectPropertyComponent.selectedPromotion=null),1===r&&(this.data.priceSelected=null,this.data.documentData=null,this.selectPriceComponent.selectedProperty=null),console.log("DATAAAA",this.data)}}return(n=o).\u0275fac=function(r){return new(r||n)(e.rXU(M.i),e.rXU(b.nX),e.rXU(T.f),e.rXU(b.Ix),e.rXU(C.c$))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-venta-operation-process"]],viewQuery:function(r,i){if(1&r&&(e.GBs(U,7),e.GBs(w,7)),2&r){let l;e.mGM(l=e.lsd())&&(i.selectPropertyComponent=l.first),e.mGM(l=e.lsd())&&(i.selectPriceComponent=l.first)}},decls:22,vars:22,consts:[["selectPropertyComponent",""],["selectPriceComponent",""],["selectClientComponent",""],[3,"fullscreen"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-blue-content"],[1,"crm-steps-container"],["class","crm-steps-container-step",3,"ngClass",4,"ngFor","ngForOf"],[1,"venta-body"],[1,"venta-body-component"],[3,"ngClass"],[3,"selectPromotion"],[3,"selectProperty"],[3,"selectPrice"],[3,"selectDocumentData","reservationAmount"],[3,"selectContactData","contactData","reservedContacts","operationData"],["class","steps-cards-body",4,"ngIf"],[1,"crm-steps-container-step",3,"ngClass"],[1,"crm-steps-container-step-circle"],["class","fa fa-check",4,"ngIf"],[4,"ngIf"],[1,"crm-steps-container-step-label"],["class","crm-steps-container-step-separator",4,"ngIf"],[1,"fa","fa-check"],[1,"crm-steps-container-step-separator"],[1,"steps-cards-body"],["class","steps-cards-body-card",4,"ngIf"],[1,"steps-cards-body-card"],[1,"steps-cards-body-card-header"],[1,"steps-cards-body-card-header-title"],[1,"steps-cards-body-card-header-icon",3,"click"],[1,"fa-solid","fa-pencil"],[1,"steps-cards-body-card-text"]],template:function(r,i){if(1&r){const l=e.RV6();e.j41(0,"ion-content",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),e.DNE(5,dt,7,8,"div",8),e.k0s(),e.j41(6,"div",9)(7,"div",10)(8,"div",11)(9,"app-venta-select-promotion",12),e.bIt("selectPromotion",function(c){return e.eBV(l),e.Njj(i.onSelectPromotion(c))}),e.k0s()(),e.j41(10,"div",11)(11,"app-venta-select-property",13,0),e.bIt("selectProperty",function(c){return e.eBV(l),e.Njj(i.onSelectProperty(c))}),e.k0s()(),e.j41(13,"div",11)(14,"app-venta-select-price",14,1),e.bIt("selectPrice",function(c){return e.eBV(l),e.Njj(i.onSelectPrice(c))}),e.k0s()(),e.j41(16,"div",11)(17,"app-venta-select-document",15,2),e.bIt("selectDocumentData",function(c){return e.eBV(l),e.Njj(i.onSelectDocumentData(c))}),e.k0s()(),e.j41(19,"div",11)(20,"app-venta-select-contact-data",16),e.bIt("selectContactData",function(){return e.eBV(l),e.Njj(i.onSelectContactData())}),e.k0s()()(),e.DNE(21,gt,5,4,"div",17),e.k0s()()()()()}2&r&&(e.Y8G("fullscreen",!0),e.R7$(5),e.Y8G("ngForOf",i.steps),e.R7$(3),e.Y8G("ngClass",e.eq3(12,D,0!==i.activeIndex)),e.R7$(2),e.Y8G("ngClass",e.eq3(14,D,1!==i.activeIndex)),e.R7$(3),e.Y8G("ngClass",e.eq3(16,D,2!==i.activeIndex)),e.R7$(3),e.Y8G("ngClass",e.eq3(18,D,3!==i.activeIndex)),e.R7$(),e.Y8G("reservationAmount",i.reservationPayment),e.R7$(2),e.Y8G("ngClass",e.eq3(20,D,4!==i.activeIndex)),e.R7$(),e.Y8G("contactData",null==i.operation?null:i.operation.contact)("reservedContacts",i.reservedContacts)("operationData",i.operation),e.R7$(),e.Y8G("ngIf",null==i.data?null:i.data.promotion))},dependencies:[v.YU,v.Sq,v.bT,u.W9,K,Z,nt,at,it.K,X.w,C.D9],styles:[".crm-steps-container[_ngcontent-%COMP%], .crm-steps-container-step[_ngcontent-%COMP%]{display:flex;align-items:center}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#3a50e4;border:1px solid #3A50E4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#3a50e4}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#a8a8a8;border:1px solid rgb(168,168,168)}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#a8a8a8}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#a8a8a8}.crm-steps-container-step-circle[_ngcontent-%COMP%]{width:21px;min-width:21px;height:21px;min-height:21px;border-radius:50%;background:#3a50e4;color:#fff;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:12px;margin-right:8px}.crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4;font-weight:500;margin-right:16px;font-size:13px}.crm-steps-container-step-separator[_ngcontent-%COMP%]{width:20px;height:1px;background:#3a50e4;margin-right:16px}.hidden-step[_ngcontent-%COMP%]{height:0;overflow:hidden;opacity:0;position:absolute;width:0;visibility:hidden}.steps-cards-body[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:16px}.steps-cards-body-card[_ngcontent-%COMP%]{border:1px solid var(--crm-border-light-color);border-radius:6px;padding:12px}.steps-cards-body-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--crm-border-light-color);padding-bottom:16px}.steps-cards-body-card-header-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--crm-text-color)}.steps-cards-body-card-header-icon[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;color:var(--crm-text-color)}.steps-cards-body-card-text[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color);padding-top:16px}.venta-body[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px}.venta-body[_ngcontent-%COMP%]   .steps-cards-body[_ngcontent-%COMP%]{min-width:300px;width:300px;flex-shrink:0}.venta-body-component[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;overflow-y:auto}"]}),o})()}];let ft=(()=>{var n;class o{}return(n=o).\u0275fac=function(r){return new(r||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[b.iI.forChild(Ct),b.iI]}),o})();var ht=d(3895),yt=d(9662),bt=d(6812),s=d(969),_=d(2306);let p=(()=>{var n;class o{}return(n=o).\u0275fac=function(r){return new(r||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[v.MD,t.YN,u.bv,t.X1,ft,ht.b,yt.Y,bt.u,s.rJ,C.h,_.T]}),o})()},9662:(B,k,d)=>{d.d(k,{Y:()=>u});var v=d(177),t=d(3953);let u=(()=>{var b;class I{}return(b=I).\u0275fac=function(M){return new(M||b)},b.\u0275mod=t.$C({type:b}),b.\u0275inj=t.G2t({imports:[v.MD]}),I})()}}]);