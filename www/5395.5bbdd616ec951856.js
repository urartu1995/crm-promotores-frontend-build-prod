"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5395,3666,1285],{3274:(R,I,i)=>{i.d(I,{K:()=>t});var n=i(177),p=i(3953);let t=(()=>{var d;class P{}return(d=P).\u0275fac=function(S){return new(S||d)},d.\u0275mod=p.$C({type:d}),d.\u0275inj=p.G2t({imports:[n.MD]}),P})()},6580:(R,I,i)=>{i.d(I,{k:()=>F});var n=i(3953),p=i(3955);const t=(r,T,g)=>({start:r,end:T,total:g}),d=r=>({page:r}),P=r=>({count:r});function v(r,T){if(1&r&&(n.j41(0,"div",15),n.EFF(1),n.nI1(2,"translate"),n.k0s()),2&r){const g=n.XpG(2);n.R7$(),n.SpI(" ",n.i5U(2,1,"text.items_selected",n.eq3(4,P,null==g.listPaginationConfig?null:g.listPaginationConfig.checkedItems))," ")}}function S(r,T){if(1&r&&(n.j41(0,"div",14),n.DNE(1,v,3,6,"div",15),n.k0s()),2&r){const g=n.XpG();n.R7$(),n.vxM(null!=g.listPaginationConfig&&g.listPaginationConfig.checkedItems||0===(null==g.listPaginationConfig?null:g.listPaginationConfig.checkedItems)?1:-1)}}let F=(()=>{var r;class T{constructor(){this.listPaginationConfig={},this.goPreviousPage=new n.bkB,this.goNextPage=new n.bkB,this.sort=new n.bkB}ngOnInit(){}onGoPreviousPage(C){this.goPreviousPage.emit(C)}onGoNextPage(C){this.goNextPage.emit(C)}onSort(C){this.sort.emit(C)}}return(r=T).\u0275fac=function(C){return new(C||r)},r.\u0275cmp=n.VBU({type:r,selectors:[["app-list-pagination-selectors"]],inputs:{listPaginationConfig:"listPaginationConfig"},outputs:{goPreviousPage:"goPreviousPage",goNextPage:"goNextPage",sort:"sort"},decls:24,vars:19,consts:[[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"]],template:function(C,m){1&C&&(n.j41(0,"div",0)(1,"div",1)(2,"div",2),n.EFF(3),n.nI1(4,"translate"),n.k0s(),n.j41(5,"div",3)(6,"button",4),n.bIt("click",function(D){return m.onGoPreviousPage(D)}),n.nrm(7,"i",5),n.k0s(),n.j41(8,"div",6),n.EFF(9),n.nI1(10,"translate"),n.k0s(),n.j41(11,"button",4),n.bIt("click",function(D){return m.onGoNextPage(D)}),n.nrm(12,"i",7),n.k0s()(),n.j41(13,"div",8),n.bIt("click",function(D){return m.onSort(D)}),n.j41(14,"div",9),n.EFF(15),n.nI1(16,"translate"),n.k0s(),n.j41(17,"div",10)(18,"div",11),n.EFF(19),n.k0s(),n.j41(20,"div",12),n.nrm(21,"i",13),n.k0s()()()(),n.j41(22,"div"),n.DNE(23,S,2,1,"div",14),n.k0s()()),2&C&&(n.R7$(3),n.SpI(" ",n.i5U(4,5,"text.pagination_range",n.sMw(13,t,null==m.listPaginationConfig?null:m.listPaginationConfig.pageStartIndex,null==m.listPaginationConfig?null:m.listPaginationConfig.pageEndIndex,null==m.listPaginationConfig?null:m.listPaginationConfig.totalCount))," "),n.R7$(6),n.SpI(" ",n.i5U(10,8,"text.page_short",n.eq3(17,d,null==m.listPaginationConfig?null:m.listPaginationConfig.paginationPage))," "),n.R7$(6),n.SpI(" ",n.bMT(16,11,"contacts.list.order_by")," "),n.R7$(4),n.SpI(" ",null==m.listPaginationConfig?null:m.listPaginationConfig.sortField," "),n.R7$(4),n.vxM(null!=m.listPaginationConfig&&m.listPaginationConfig.showSelectItems?23:-1))},dependencies:[p.D9]}),T})()},5603:(R,I,i)=>{i.d(I,{P:()=>P});var n=i(177),p=i(9417),t=i(3955),d=i(3953);let P=(()=>{var v;class S{}return(v=S).\u0275fac=function(r){return new(r||v)},v.\u0275mod=d.$C({type:v}),v.\u0275inj=d.G2t({imports:[n.MD,p.YN,t.h]}),S})()},5395:(R,I,i)=>{i.r(I),i.d(I,{DocumentsModule:()=>W});var n=i(177),p=i(467),t=i(3953),d=i(9465),P=i(2081),v=i(8397),S=i(6552);function F(a,f){if(1&a&&(t.j41(0,"ion-item"),t.EFF(1),t.k0s()),2&a){const c=f.$implicit;t.R7$(),t.SpI(" ",c.name," ")}}let r=(()=>{var a;class f{constructor(e,o,s,l){this.modalCtrl=e,this.api=o,this.toast=s,this.utils=l,this.document=null,this.promoterUsersToSign=[]}ngOnInit(){this.getUsersToSign()}getUsersToSign(){var e=this;return(0,p.A)(function*(){const o=yield e.api.getUser({},null,null,null);o.success?e.promoterUsersToSign=o.success.data.filter(l=>l.allowSignOnBehalf):e.toast.showErrorToast(o.error.errorMessage)})()}onClose(){this.modalCtrl.dismiss()}onSendDocumentToSign(){this.toast.showSuccessToast("El documento se ha enviado a firmar correctamente"),this.modalCtrl.dismiss()}}return(a=f).\u0275fac=function(e){return new(e||a)(t.rXU(d.W3),t.rXU(P.i),t.rXU(v.f),t.rXU(S.T))},a.\u0275cmp=t.VBU({type:a,selectors:[["app-document-open-for-sign-document"]],inputs:{document:"document"},decls:18,vars:1,consts:[[2,"position","relative"],[1,"crm-header-modal","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary",3,"click"],[1,"crm-block-inputs","crm-block-filters-inputs"],[1,"crm-section","crm-section-margin-top"],[1,"crm-title"],[4,"ngFor","ngForOf"],[1,"contract-details-button-container"],[1,"crm-button",3,"click"]],template:function(e,o){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3," Enviar documento para firma "),t.k0s(),t.j41(4,"div",3)(5,"button",4),t.bIt("click",function(){return o.onClose()}),t.EFF(6," Cerrar "),t.k0s()()(),t.j41(7,"div",5)(8,"div",6)(9,"div")(10,"div",7),t.EFF(11," Estos van a ser los usuarios de la promotora que van a firmar "),t.k0s(),t.j41(12,"ion-list"),t.DNE(13,F,2,1,"ion-item",8),t.k0s()(),t.nrm(14,"br"),t.j41(15,"div",9)(16,"button",10),t.bIt("click",function(){return o.onSendDocumentToSign()}),t.EFF(17," Enviar documento para firma "),t.k0s()()()()()),2&e&&(t.R7$(13),t.Y8G("ngForOf",o.promoterUsersToSign))},dependencies:[n.Sq,d.uz,d.nf],styles:[".contract-details-button-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;margin:50px auto 0}"]}),f})();var T=i(5970),g=i(1296),C=i(4501),m=i(345),U=i(9710),D=i(5188),O=i(1213),j=i(1880),x=i(6580);const A=(a,f,c,e,o)=>({pageStartIndex:a,pageEndIndex:f,totalCount:c,paginationPage:e,sortField:o});function B(a,f){if(1&a){const c=t.RV6();t.j41(0,"button",16),t.bIt("click",function(){t.eBV(c);const o=t.XpG(2);return t.Njj(o.onDeleteSelectedDocuments())}),t.nrm(1,"i",17),t.EFF(2," Borrar documentos seleccionados "),t.k0s()}}function L(a,f){if(1&a){const c=t.RV6();t.j41(0,"div",12)(1,"button",13),t.bIt("click",function(){t.eBV(c);const o=t.XpG();return t.Njj(o.openCreateDocumentModal())}),t.nrm(2,"i",14),t.EFF(3," A\xf1adir Documento "),t.k0s(),t.DNE(4,B,3,0,"button",15),t.k0s()}if(2&a){const c=t.XpG();t.R7$(4),t.vxM((null==c.checkedRows?null:c.checkedRows.length)>0&&"promoter"===(null==c.currentUser?null:c.currentUser.accountType)?4:-1)}}let $=(()=>{var a;class f{constructor(e,o,s,l,b,u,h,y,w,K,Y){this.popoversService=e,this.api=o,this.tableService=s,this.headerService=l,this.toastService=b,this.sanitizer=u,this.modalsService=h,this.router=y,this.activatedRoute=w,this.byvaroState=K,this.modalCtrl=Y,this.documents=[],this.checkedRows=[],this.allSystemOperationsCount=0,this.filters=null,this.sort={field:"createdAt",order:"desc"},this.pagination={page:0,itemsPerPage:50},this.agencyId=null,this.promotionId=null,this.documentsTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:"A\xf1adido en",size:"medium",type:"date"},{key:"title",label:"T\xedtulo",size:"large",type:"text"},{key:"url",label:"Documento",size:"medium",type:"file"},{key:"documentType",label:"Tipo de documento",size:"large",type:"text",fn:_=>"collaborationContract"===(null==_?void 0:_.documentType)?"Contrato de colaboraci\xf3n":""},{key:"promotions",label:"Promociones",size:"extra-large",type:"text",fn:_=>{var M;return _.allPromotionsIncluded?"Todas incluidas":null==_||null===(M=_.promotionsIncluded)||void 0===M?void 0:M.map(k=>k.projectName||(null==k?void 0:k.title)||(null==k?void 0:k.byvaroId)||"").join(", ")}},{key:"actions",label:"Acciones",size:"large"},{key:"documentSignStatus",label:"Estado firmas",size:"medium",type:"text"},{key:"fromDate",label:"Valido desde",size:"medium",type:"date"},{key:"toDate",label:"Fecha Expiraci\xf3n",size:"medium",type:"chip",fn:_=>{const M=new Date(_.toDate),k=new Date,H=M.getTime()-k.getTime(),E=Math.floor(H/864e5);return E<0?"Expirado":`Expira en ${E} d\xedas`}}],rows:[]}}ngOnInit(){this.getUserInfo()}getUserInfo(){this.byvaroState.getState().subscribe(e=>{this.currentUser=e.user})}ionViewWillEnter(){var e=this;return(0,p.A)(function*(){e.headerService.setConfig({title:"documents"}),e.agencyId=e.activatedRoute.snapshot.queryParamMap.get("agencyId"),e.promotionId=e.activatedRoute.snapshot.queryParamMap.get("promotionId"),e.getData()})()}getData(){var e=this;return(0,p.A)(function*(){var o,s;e.documentsTableConfig.columns=e.documentsTableConfig.columns.filter(u=>"promoter.name"!==u.key&&"agency.name"!==u.key),e.filters={},e.agencyId&&(e.filters.agencyId={equals:e.agencyId}),e.promotionId&&(e.filters.promotionId={equals:e.promotionId});const l="agency"===(null===(o=e.currentUser)||void 0===o?void 0:o.accountType);e.documentsTableConfig.columns.splice(5,0,{key:l?"promoter.name":"agency.name",label:"Empresa",size:"extra-large",type:"text",fn:u=>{var h,y;return l?(null===(h=u.promoter)||void 0===h?void 0:h.name)||"":(null===(y=u.agency)||void 0===y?void 0:y.name)||""}});const b=yield e.api.getDocument(e.filters,e.sort,e.pagination,null);if(e.documents=null==b||null===(s=b.success)||void 0===s?void 0:s.data,e.documents){let u=e.tableService.convertDataToTableRows(e.documents,e.documentsTableConfig);u=u.map(h=>{e.currentUser.promoterId&&(h.cells.actions={value:"none",type:"actions",actions:[{key:"asd",label:"Enviar a firmar",theme:"success"}]});const y=String(h.cells.toDate.value);if(y.includes("Expirado"))h.cells.toDate.chipTheme="red";else if(y.includes("Expira")){const w=parseInt(y.split(" ")[2],10);h.cells.toDate.chipTheme=w<30?"red":w<60?"warn":"success"}return h}),e.documentsTableConfig.rows=u}})()}openCreateDocumentModal(){var e=this;return(0,p.A)(function*(){yield e.modalsService.onShowCreateDocumentModal(e.agencyId),e.getData()})()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}onSort(e){}onRowClicked(e){return(0,p.A)(function*(){})()}onTableButtonClick(e){var o=this;return(0,p.A)(function*(){var s;console.log("Table button clicked:",e);const l=e.row.rawObject,b=yield o.modalCtrl.create({component:r,componentProps:{document:l},cssClass:"modal-upload-document"});yield b.present();const u=yield b.onDidDismiss();null!=u&&null!==(s=u.data)&&void 0!==s&&s.reload&&o.getData()})()}onRowChecked(e){var o=this;return(0,p.A)(function*(){const s=o.documentsTableConfig.rows[e],l=o.checkedRows.findIndex(u=>u.rawObject.id===s.rawObject.id);-1!==l?o.checkedRows.splice(l,1):(o.checkedRows=o.checkedRows.filter(u=>u.rowIndex!==e),o.checkedRows.push(s))})()}onDeleteSelectedDocuments(){var e=this;return(0,p.A)(function*(){try{for(const o of e.checkedRows)yield e.api.deleteDocumentById(o.rawObject.id);e.checkedRows=[],e.getData(),e.toastService.showSuccessToast("Documentos eliminados correctamente")}catch(o){console.error(o),e.toastService.showErrorToast("Error al eliminar los documentos")}})()}}return(a=f).\u0275fac=function(e){return new(e||a)(t.rXU(T.m),t.rXU(P.i),t.rXU(g.a),t.rXU(C.d),t.rXU(v.f),t.rXU(m.up),t.rXU(U.M),t.rXU(D.Ix),t.rXU(D.nX),t.rXU(O.c),t.rXU(d.W3))},a.\u0275cmp=t.VBU({type:a,selectors:[["app-documents"]],decls:12,vars:11,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar documento"],["class","crm-buttons-group",4,"ngIf"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[1,"crm-section"],[3,"actionButtonClick","rowClicked","rowCheckboxClicked","table"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"fa","fa-plus"],[1,"crm-button","crm-button-red"],[1,"crm-button","crm-button-red",3,"click"],[1,"fa-solid","fa-trash"]],template:function(e,o){1&e&&(t.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"i",6)(7,"input",7),t.k0s()(),t.DNE(8,L,5,1,"div",8),t.k0s(),t.j41(9,"app-list-pagination-selectors",9),t.bIt("goPreviousPage",function(){return o.onGoPreviousPage()})("goNextPage",function(){return o.onGoNextPage()})("sort",function(l){return o.onSort(l)}),t.k0s(),t.j41(10,"div",10)(11,"app-table",11),t.bIt("actionButtonClick",function(l){return o.onTableButtonClick(l)})("rowClicked",function(l){return o.onRowClicked(l)})("rowCheckboxClicked",function(l){return o.onRowChecked(l)}),t.k0s()()()()()),2&e&&(t.Y8G("fullscreen",!0)("scrollY",!1),t.R7$(8),t.Y8G("ngIf",(null==o.currentUser?null:o.currentUser.promoterId)&&o.agencyId),t.R7$(),t.Y8G("listPaginationConfig",t.s1E(5,A,o.updatePagination().startIndex,o.updatePagination().endIndex,o.allSystemOperationsCount,o.pagination.page+1,null!=o.sort&&o.sort.field?(null==o.sort?null:o.sort.field)+" "+(null==o.sort?null:o.sort.order):"Fecha de creaci\xf3n")),t.R7$(2),t.Y8G("table",o.documentsTableConfig))},dependencies:[n.bT,d.W9,j.O,x.k]}),f})();var G=i(9417),N=i(3274),X=i(5603),V=i(3895);const z=[{path:"",component:$}];let W=(()=>{var a;class f{}return(a=f).\u0275fac=function(e){return new(e||a)},a.\u0275mod=t.$C({type:a}),a.\u0275inj=t.G2t({imports:[n.MD,G.YN,d.bv,V.b,X.P,N.K,D.iI.forChild(z)]}),f})()}}]);