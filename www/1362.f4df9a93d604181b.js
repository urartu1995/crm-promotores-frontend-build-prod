"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1362],{1362:(X,D,c)=>{c.r(D),c.d(D,{RegistersListPageModule:()=>G});var h=c(177),I=c(9417),O=c(9465),S=c(5188),t=c(5180),M=c(3953);const L=[{path:"",component:t.c}];let k=(()=>{var m;class R{}return(m=R).\u0275fac=function(A){return new(A||m)},m.\u0275mod=M.$C({type:m}),m.\u0275inj=M.G2t({imports:[S.iI.forChild(L),S.iI]}),R})();var N=c(3895),B=c(5603),x=c(5641),$=c(3955);let G=(()=>{var m;class R{}return(m=R).\u0275fac=function(A){return new(A||m)},m.\u0275mod=M.$C({type:m}),m.\u0275inj=M.G2t({imports:[h.MD,I.YN,O.bv,k,N.b,B.P,x.D,$.h]}),R})()},5180:(X,D,c)=>{c.d(D,{c:()=>ot});var h=c(467),I=c(1413),O=c(7376),t=c(3953),M=c(5970),L=c(2081),k=c(1296),N=c(4501),B=c(8397),x=c(345),$=c(9710),G=c(1213),m=c(3955),R=c(177),j=c(1880),A=c(6580);const F=o=>({"crm-block-body-fixed":o}),z=o=>({"embedded-page-header":o}),K=o=>({"crm-button-secondary-primary":o}),V=(o,_,a,e,n)=>({pageStartIndex:o,pageEndIndex:_,totalCount:a,paginationPage:e,sortField:n}),W=o=>({"embedded-pagination-container":o});function H(o,_){if(1&o){const a=t.RV6();t.j41(0,"button",17),t.bIt("click",function(){t.eBV(a);const n=t.XpG();return t.Njj(n.openCreateRegisterModal())}),t.nrm(1,"i",18),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&o&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"register.add_record")," "))}function Y(o,_){1&o&&(t.nrm(0,"i",19),t.EFF(1),t.nI1(2,"translate")),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"register.close_filters")," "))}function J(o,_){1&o&&(t.nrm(0,"i",20),t.EFF(1),t.nI1(2,"translate")),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"register.filters_active")," "))}function Q(o,_){1&o&&(t.nrm(0,"i",20),t.EFF(1),t.nI1(2,"translate")),2&o&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"register.filter")," "))}function Z(o,_){if(1&o&&t.DNE(0,J,3,3)(1,Q,3,3),2&o){const a=t.XpG();t.vxM(a.filters?0:1)}}function q(o,_){if(1&o){const a=t.RV6();t.j41(0,"div",12)(1,"app-list-pagination-selectors",21),t.nI1(2,"translate"),t.bIt("goPreviousPage",function(){t.eBV(a);const n=t.XpG();return t.Njj(n.onGoPreviousPage())})("goNextPage",function(){t.eBV(a);const n=t.XpG();return t.Njj(n.onGoNextPage())})("sort",function(n){t.eBV(a);const s=t.XpG();return t.Njj(s.onSort(n))}),t.k0s()()}if(2&o){const a=t.XpG();t.R7$(),t.Y8G("listPaginationConfig",t.s1E(3,V,a.updatePagination().startIndex,a.updatePagination().endIndex,a.allSystemOperationsCount,a.pagination.page+1,null!=a.sort&&a.sort.field?(null==a.sort?null:a.sort.field)+" "+(null==a.sort?null:a.sort.order):t.bMT(2,1,"register.created_at")))}}function tt(o,_){if(1&o){const a=t.RV6();t.j41(0,"div",13)(1,"app-list-pagination-selectors",21),t.bIt("goPreviousPage",function(){t.eBV(a);const n=t.XpG();return t.Njj(n.onGoPreviousPage())})("goNextPage",function(){t.eBV(a);const n=t.XpG();return t.Njj(n.onGoNextPage())})("sort",function(n){t.eBV(a);const s=t.XpG();return t.Njj(s.onSort(n))}),t.k0s()()}if(2&o){const a=t.XpG();t.Y8G("ngClass",t.eq3(2,W,!a.isMainPage)),t.R7$(),t.Y8G("listPaginationConfig",t.s1E(4,V,a.updatePagination().startIndex,a.updatePagination().endIndex,a.allSystemOperationsCount,a.pagination.page+1,null!=a.sort&&a.sort.field?(null==a.sort?null:a.sort.field)+" "+(null==a.sort?null:a.sort.order):"Fecha de creaci\xf3n"))}}function et(o,_){}function nt(o,_){if(1&o){const a=t.RV6();t.qex(0),t.j41(1,"div",24),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.j41(4,"app-table",23),t.bIt("columnClick",function(n){t.eBV(a);const s=t.XpG(2);return t.Njj(s.onColumnClick(n))})("actionButtonClick",function(n){t.eBV(a);const s=t.XpG(2);return t.Njj(s.onTableButtonClick(n))})("rowClicked",function(n){t.eBV(a);const s=t.XpG(2);return t.Njj(s.onRowClicked(n))}),t.k0s(),t.bVm()}if(2&o){const a=t.XpG(2);t.R7$(2),t.SpI(" ",t.bMT(3,2,"register.pending_records")," "),t.R7$(2),t.Y8G("table",a.pendingRegistersTableConfig)}}function it(o,_){if(1&o){const a=t.RV6();t.j41(0,"div",15),t.DNE(1,nt,5,4,"ng-container"),t.j41(2,"div",22),t.EFF(3),t.nI1(4,"translate"),t.k0s(),t.j41(5,"app-table",23),t.bIt("columnClick",function(n){t.eBV(a);const s=t.XpG();return t.Njj(s.onColumnClick(n))})("actionButtonClick",function(n){t.eBV(a);const s=t.XpG();return t.Njj(s.onTableButtonClick(n))})("rowClicked",function(n){t.eBV(a);const s=t.XpG();return t.Njj(s.onRowClicked(n))}),t.k0s()()}if(2&o){const a=t.XpG();t.R7$(),t.vxM("promoter"==a.currentUser.accountType?1:-1),t.R7$(2),t.SpI(" ",t.bMT(4,3,"register.records")," "),t.R7$(2),t.Y8G("table",a.registersTableConfig)}}function st(o,_){}function at(o,_){if(1&o&&(t.j41(0,"div",16),t.DNE(1,st,0,0),t.k0s()),2&o){const a=t.XpG();t.R7$(),t.vxM("filters"===(null==a.aside?null:a.aside.type)?1:-1)}}let ot=(()=>{var o;class _{constructor(e,n,s,l,g,u,d,r,f){this.popoversService=e,this.api=n,this.tableService=s,this.headerService=l,this.toastService=g,this.sanitizer=u,this.modalsService=d,this.byvaroState=r,this.translate=f,this.isMainPage=!0,this.promotionId="",this.registers=[],this.pendingRegisters=[],this.allSystemOperationsCount=0,this.checkedOperations=0,this.searchString="",this.searchSubject=new I.B,this.aside={type:"filters",visible:!1},this.loadingList=!1,this.pipelineName="operaciones",this.showFilters=!1,this.sort={field:"createdAt",order:"desc"},this.pagination={page:0,itemsPerPage:50},this.relationsFilter={contact:{apply:!0,filter:{},onlyCount:!1},contactWithPotentialCoincidence:{apply:!0,filter:{},onlyCount:!1},agency:{apply:!0,filter:{},onlyCount:!1},createdBy:{apply:!0,filter:{},onlyCount:!1},property:{apply:!0,filter:{},onlyCount:!1},promotion:{apply:!0,filter:{},onlyCount:!1}},this.pendingRegistersTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:this.translate.instant("register.table.createdAt"),size:"medium",type:"date"},{key:"contactName",label:this.translate.instant("register.table.contact"),size:"medium"},{key:"contactPhone",label:this.translate.instant("register.table.phone"),size:"medium",fn:p=>{var i;return(null===(i=p.contactPhone)||void 0===i?void 0:i.length)>4?"****"+p.contactPhone.slice(-4):""}},{key:"contactNationality",label:this.translate.instant("register.table.nationality"),size:"medium",showFlag:!0},{key:"promotion.projectName",label:this.translate.instant("register.table.promotion"),size:"medium"},{key:"agency.name",label:this.translate.instant("register.table.agency"),size:"medium"},{key:"createdBy.name",label:this.translate.instant("register.table.user"),size:"medium"},{key:"status",label:this.translate.instant("register.table.status"),size:"medium"},{key:"actions",label:"",size:"small"},{key:"fecha_registro",label:"",size:"small"}],rows:[]},this.registersTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:this.translate.instant("register.table.createdAt"),size:"medium",type:"date"},{key:"contactName",label:this.translate.instant("register.table.contact"),size:"medium"},{key:"contactPhone",label:this.translate.instant("register.table.phone"),size:"medium"},{key:"contactNationality",label:this.translate.instant("register.table.nationality"),size:"medium"},{key:"promotion.projectName",label:this.translate.instant("register.table.promotion"),size:"medium"},{key:"agency.name",label:this.translate.instant("register.table.agency"),size:"medium"},{key:"createdBy.name",label:this.translate.instant("register.table.user"),size:"medium"},{key:"status",label:this.translate.instant("register.table.status"),size:"medium"}],rows:[]}}getCurrentUser(){var e=this;return(0,h.A)(function*(){e.byvaroState.getState().subscribe(n=>{e.currentUser=n.user})})()}ngOnInit(){var e;this.getCurrentUser(),null!==(e=this.options)&&void 0!==e&&e.fatherObj&&this.getData()}ionViewWillEnter(){this.headerService.setConfig({title:"registers"}),this.getData()}getData(){var e=this;return(0,h.A)(function*(){yield e.getRegisters(),yield e.getPendingRegisters()})()}getRegisters(){var e=this;return(0,h.A)(function*(){var n,s,l;const g=O.cloneDeep(e.filters)||{};""!=e.searchString&&(g.OR=[{contactName:{contains:e.searchString,mode:"insensitive"}},{contactEmail:{contains:e.searchString,mode:"insensitive"}},{contactPhone:{contains:e.searchString,mode:"insensitive"}}]),g.status={not:"pending"},"agency"===(null===(n=e.options)||void 0===n?void 0:n.type)&&null!==(s=e.options)&&void 0!==s&&null!==(s=s.fatherObj)&&void 0!==s&&s.id&&(g.agencyId={equals:e.options.fatherObj.id},g.promotionId={equals:e.promotionId});const u=yield e.api.getOperationRegister(g,e.sort,e.pagination,e.relationsFilter);if(null!=u&&null!==(l=u.success)&&void 0!==l&&l.data){e.registers=u.success.data;let d=e.tableService.convertDataToTableRows(e.registers,e.registersTableConfig);d=e.tableService.setRowsChipsFromRegistersList(d),e.registersTableConfig.rows=d,d=d.map((r,f)=>{r.cells.actions={value:"none",type:"actions",actions:[{key:"asd",label:e.translate.instant("register.table.history"),theme:"warning",openRow:!0}]};let p=e.getTimeAgo(new Date(r.rawObject.createdAt));r.cells.fecha_registro={value:p,type:"text",customCssClass:"get-time-ago-class"};const i=r.rawObject;var v,y,C,P;return"yes"!==i.isAPotentiallyCoincidence&&"yes"!==(null==i?void 0:i.last4NumberOfPhoneAreEqual)&&(null==i?void 0:i.percentageOfNameCoincidence)<50&&(i.isAPotentiallyCoincidence="no"),r.freeRowContentHtml=`\n<div class="operation-register-container">\n  \x3c!-- Title / Header --\x3e\n  <h5 style="margin-top: 0;">\n    ${e.translate.instant("register.title")}\n  </h5>\n\n  \x3c!-- Main message --\x3e\n  <p style="margin: 0.5rem 0;">\n  ${"yes"===i.isAPotentiallyCoincidence?e.translate.instant("register.match_found"):""}\n  ${"no"===i.isAPotentiallyCoincidence?e.translate.instant("register.no_match_found"):""}\n  ${"partial"===i.isAPotentiallyCoincidence?e.translate.instant("register.partial_match_found"):""}\n  </p>\n  `,i.contactWithPotentialCoincidenceId&&"no"!==i.isAPotentiallyCoincidence&&(r.freeRowContentHtml+=`\n      \x3c!-- ChatGPT scan info --\x3e\n      <hr style="margin: 1rem 0;" />\n      <p style="margin: 0.5rem 0;">\n        ${e.translate.instant("register.coincidence_found_with_contact")}: <a href="/contacts/${i.contactWithPotentialCoincidenceId}" target="_blank">${null===(v=i.contactWithPotentialCoincidence)||void 0===v?void 0:v.name}</a>\n        ${i.coincidenceRegistredBy?"("+e.translate.instant("register.registered_by")+" "+i.coincidenceRegistredBy+")":null!==(y=i.contactWithPotentialCoincidence)&&void 0!==y&&y.origin?"("+(null===(C=i.contactWithPotentialCoincidence)||void 0===C?void 0:C.origin)+")":""}\n        <br>\n        ${e.translate.instant("register.registration_date")}: ${e.returnCorrectDateString(null===(P=i.contactWithPotentialCoincidence)||void 0===P?void 0:P.createdAt)}\n      </p>\n      <p style="margin: 0.5rem 0;">\n        ${e.translate.instant("register.phone_digits_match")}:\n        <strong>${e.translate.instant("yes"===i.last4NumberOfPhoneAreEqual?"register.phone_match_yes":"register.phone_match_no")}:\n        ${"yes"===i.last4NumberOfPhoneAreEqual?i.coincidenceLast4NumberOfPhone:""}</strong>\n      </p>\n      <p style="margin: 0.5rem 0;">\n        ${e.translate.instant("register.name_match_percentage")}:\n        <strong>${null!=i.percentageOfNameCoincidence?i.percentageOfNameCoincidence+"%":"N/A"}</strong>\n      </p>\n      <p style="margin: 0.5rem 0;">\n        ${e.translate.instant("register.nationality_match")}:\n        <strong>${e.translate.instant(i.nationalityCoincidence?"register.phone_match_yes":"register.phone_match_no")}</strong>\n      </p>\n\n      \x3c!-- Status and Acceptance/Rejection dates --\x3e\n      <hr style="margin: 1rem 0;" />\n      <p style="margin: 0.5rem 0;">\n        <strong>${e.translate.instant("register.recommendation_title")}</strong><br/>\n        ${"yes"===i.isAPotentiallyCoincidence?e.translate.instant("register.recommendation_yes"):""}\n      ${"no"===i.isAPotentiallyCoincidence?e.translate.instant("register.recommendation_no"):""}\n      ${"partial"===i.isAPotentiallyCoincidence?e.translate.instant("register.recommendation_partial"):""}\n\n      </p>\n\n\n    `),r.freeRowContentHtml=e.sanitizer.bypassSecurityTrustHtml(r.freeRowContentHtml),r}),e.registersTableConfig.rows=d}})()}openCreateRegisterModal(){var e=this;return(0,h.A)(function*(){yield e.modalsService.onShowCreateRegisterModal(),e.getData()})()}getPendingRegisters(){var e=this;return(0,h.A)(function*(){var n,s,l;const g=O.cloneDeep(e.filters)||{};""!=e.searchString&&(g.OR=[{contactName:{contains:e.searchString,mode:"insensitive"}},{contactEmail:{contains:e.searchString,mode:"insensitive"}},{contactPhone:{contains:e.searchString,mode:"insensitive"}}]),g.status={equals:"pending"},"agency"===(null===(n=e.options)||void 0===n?void 0:n.type)&&null!==(s=e.options)&&void 0!==s&&null!==(s=s.fatherObj)&&void 0!==s&&s.id&&(g.agencyId={equals:e.options.fatherObj.id});const u=yield e.api.getOperationRegister(g,e.sort,e.pagination,e.relationsFilter);if(null!=u&&null!==(l=u.success)&&void 0!==l&&l.data){e.pendingRegisters=u.success.data;let d=e.tableService.convertDataToTableRows(e.pendingRegisters,e.pendingRegistersTableConfig);d=d.map((r,f)=>{r.cells.actions={value:"none",type:"actions",actions:[{key:"asd",label:e.translate.instant("register.table.manage"),theme:"warning",openRow:!0}]};let p=e.getTimeAgo(new Date(r.rawObject.createdAt));r.cells.fecha_registro={value:p,type:"text",customCssClass:"get-time-ago-class"};const i=r.rawObject;var v,y,C,P;return r.freeRowContentHtml=`\n<div class="operation-register-container">\n  \x3c!-- Title / Header --\x3e\n  <h5 style="margin-top: 0;">\n    ${e.translate.instant("register.title")}\n  </h5>\n\n  \x3c!-- Main message --\x3e\n  <p style="margin: 0.5rem 0;">\n  ${"yes"===i.isAPotentiallyCoincidence?e.translate.instant("register.match_found"):""}\n  ${"no"===i.isAPotentiallyCoincidence?e.translate.instant("register.no_match_found"):""}\n  ${"partial"===i.isAPotentiallyCoincidence?e.translate.instant("register.partial_match_found"):""}\n\n  </p>\n  `,"yes"!==i.isAPotentiallyCoincidence&&"yes"!==(null==i?void 0:i.last4NumberOfPhoneAreEqual)&&(null==i?void 0:i.percentageOfNameCoincidence)<50&&(i.isAPotentiallyCoincidence="no"),i.contactWithPotentialCoincidenceId&&"no"!==i.isAPotentiallyCoincidence&&(r.freeRowContentHtml+=`\n      \x3c!-- ChatGPT scan info --\x3e\n      <hr style="margin: 1rem 0;" />\n      <p style="margin: 0.5rem 0;">\n        ${e.translate.instant("register.coincidence_found_with_contact")}: <a href="/contacts/${i.contactWithPotentialCoincidenceId}" target="_blank">${null===(v=i.contactWithPotentialCoincidence)||void 0===v?void 0:v.name}</a>\n        ${i.coincidenceRegistredBy?"("+e.translate.instant("register.registered_by")+" "+i.coincidenceRegistredBy+")":null!==(y=i.contactWithPotentialCoincidence)&&void 0!==y&&y.origin?"("+(null===(C=i.contactWithPotentialCoincidence)||void 0===C?void 0:C.origin)+")":""}\n        <br>\n        ${e.translate.instant("register.registration_date")}: ${e.returnCorrectDateString(null===(P=i.contactWithPotentialCoincidence)||void 0===P?void 0:P.createdAt)}\n      </p>\n      <p style="margin: 0.5rem 0;">\n        ${e.translate.instant("register.phone_digits_match")}:\n        <strong>${e.translate.instant("yes"===i.last4NumberOfPhoneAreEqual?"register.phone_match_yes":"register.phone_match_no")}\n        ${"yes"===i.last4NumberOfPhoneAreEqual?i.coincidenceLast4NumberOfPhone:""}</strong>\n      </p>\n      <p style="margin: 0.5rem 0;">\n         ${e.translate.instant("register.name_match_percentage")}:\n        <strong>${null!=i.percentageOfNameCoincidence?i.percentageOfNameCoincidence+"%":"N/A"}</strong>\n      </p>\n      <p style="margin: 0.5rem 0;">\n        ${e.translate.instant("register.nationality_match")}:\n        <strong>${i.nationalityCoincidence?"S\xed":"No"}</strong>\n      </p>\n\n      \x3c!-- Status and Acceptance/Rejection dates --\x3e\n      <hr style="margin: 1rem 0;" />\n      <p style="margin: 0.5rem 0;">\n        <strong>${e.translate.instant("register.recommendation_title")}</strong><br/>\n      ${"yes"===i.isAPotentiallyCoincidence?e.translate.instant("register.recommendation_yes"):""}\n      ${"no"===i.isAPotentiallyCoincidence?e.translate.instant("register.recommendation_no"):""}\n      ${"partial"===i.isAPotentiallyCoincidence?e.translate.instant("register.recommendation_partial"):""}\n\n      </p>\n\n\n    `),r.freeRowContentHtml+=`\n\n  <p style="margin: 0.5rem 0;">\n        <strong>${e.translate.instant("register.note_title")}</strong><br/>\n        ${e.translate.instant("register.note")}\n      </p>\n\n      \x3c!-- Accept / Reject Buttons --\x3e\n      <div style="display:flex; align-items:center; gap: 16px; margin-top: 32px;">\n\n        <button id="register-accept-${i.id}" class="crm-button crm-button-success" style="min-width: 90px; justify-content: center;">\n          ${e.translate.instant("register.accept")}\n        </button>\n        <button id="register-reject-${i.id}" class="crm-button crm-button-red" style="min-width: 90px; justify-content: center;">\n          ${e.translate.instant("register.reject")}\n        </button>\n\n      </div>\n    </div>\n\n\n  `,r.freeRowContentHtml=e.sanitizer.bypassSecurityTrustHtml(r.freeRowContentHtml),r}),e.pendingRegistersTableConfig.rows=d}setTimeout(()=>{e.pendingRegisters.forEach(d=>{const r=document.getElementById(`register-accept-${d.id}`),f=document.getElementById(`register-reject-${d.id}`);r&&r.addEventListener("click",(0,h.A)(function*(){const p=yield e.acceptOperationRegister(d.id,d);null!=p&&p.success&&(e.getData(),e.toastService.showSuccessToast(e.translate.instant("register.accepted_success")))})),f&&f.addEventListener("click",(0,h.A)(function*(){const p=yield e.rejectOperationRegister(d.id);var i;null!=p&&p.success?(e.getData(),e.toastService.showSuccessToast(e.translate.instant("register.rejected_success"))):e.toastService.showErrorToast(e.translate.instant("register.reject_error")+" "+(null==p||null===(i=p.error)||void 0===i?void 0:i.errorMessage))}))})},1e3)})()}returnCorrectDateString(e){return e?new Date(e).toLocaleDateString():""}onTableButtonClick(e){var n=this;return(0,h.A)(function*(){if(console.log("LA DATA:",e),"accept"===e.action.key){const l=yield n.acceptOperationRegister(e.row.rawObject.id,null==e?void 0:e.row.rawObject);null!=l&&l.success&&(n.getData(),n.toastService.showSuccessToast(n.translate.instant("register.accepted_success")))}else if("reject"===e.action.key){const l=yield n.rejectOperationRegister(e.row.rawObject.id);var s;null!=l&&l.success?(n.getData(),n.toastService.showSuccessToast(n.translate.instant("register.rejected_success"))):n.toastService.showErrorToast(n.translate.instant("register.reject_error")+" "+(null==l||null===(s=l.error)||void 0===s?void 0:s.errorMessage))}})()}onRowClicked(e){return(0,h.A)(function*(){})()}acceptOperationRegister(e,n){var s=this;return(0,h.A)(function*(){var l;console.log("Accepting operation register:",n);const g=yield s.modalsService.onShowAcceptRegisterModal(n);if(console.log("Modal result:",g),null!=g&&null!==(l=g.data)&&void 0!==l&&l.confirmed){var u,d,r,f,p;if(null!=g&&null!==(u=g.data)&&void 0!==u&&null!==(u=u.data)&&void 0!==u&&u.confirmVisit&&null!=n&&null!==(d=n.visits)&&void 0!==d&&null!==(d=d[0])&&void 0!==d&&d.id){var i,v,y;const b={...null==n||null===(i=n.visits)||void 0===i?void 0:i[0],promoterResponsableUserId:null==g||null===(v=g.data)||void 0===v||null===(v=v.data)||void 0===v?void 0:v.agent,status:"accepted"},E=yield s.api.updateVisitById(null==n?void 0:n.visits[0].id,b);var C;if(null!=E&&null!==(y=E.error)&&void 0!==y&&y.errorMessage)return s.toastService.showErrorToast(s.translate.instant("register.accept_error")+" "+(null==E||null===(C=E.error)||void 0===C?void 0:C.errorMessage)),null;s.byvaroState.setRefreshVisitData(!0)}else if((null==g||null===(r=g.data)||void 0===r||null===(r=r.data)||void 0===r||!r.confirmVisit)&&null!=n&&null!==(f=n.visits)&&void 0!==f&&null!==(f=f[0])&&void 0!==f&&f.id){var P;const b=yield s.api.deleteVisitById(null==n?void 0:n.visits[0].id);var w;if(null!=b&&null!==(P=b.error)&&void 0!==P&&P.errorMessage)return s.toastService.showErrorToast(s.translate.instant("register.visit_accept_error")+" "+(null==b||null===(w=b.error)||void 0===w?void 0:w.errorMessage)),null;s.byvaroState.setRefreshVisitData(!0)}const T=yield s.api.approveOperationRegister(e);var U;return null!=T&&null!==(p=T.error)&&void 0!==p&&p.errorMessage?(s.toastService.showErrorToast(s.translate.instant("register.accept_error")+" "+(null==T||null===(U=T.error)||void 0===U?void 0:U.errorMessage)),null):T}return console.log("Modal closed without confirmation"),null})()}rejectOperationRegister(e){var n=this;return(0,h.A)(function*(){return yield n.api.rejectOperationRegister(e)})()}onSearchInputChange(e){const n=e.target.value;clearTimeout(this.debounceTime),this.debounceTime=setTimeout(()=>{this.searchString=n,this.getData()},800)}onToggleAside(){this.aside.visible=!this.aside.visible}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}onToggleAllCheckboxes(e){}onShowMenuSelectAll(e){}onSort(e){}getTimeAgo(e){const s=Math.floor(((new Date).getTime()-e.getTime())/1e3);if(s<60)return`${this.translate.instant("register.date.ago")} ${s} ${this.translate.instant(1===s?"register.date.second":"register.date.seconds")}`;const l=Math.floor(s/60);if(l<60)return`${this.translate.instant("register.date.ago")} ${l} ${this.translate.instant(1===l?"register.date.minute":"register.date.minutes")}`;const g=Math.floor(l/60);if(g<24)return`${this.translate.instant("register.date.ago")} ${g} ${this.translate.instant(1===g?"register.date.hour":"register.date.hours")}`;const u=Math.floor(g/24);if(u<30)return`${this.translate.instant("register.date.ago")} ${u} ${this.translate.instant(1===u?"register.date.day":"register.date.days")}`;const d=Math.floor(u/30);if(d<12)return`${this.translate.instant("register.date.ago")} ${d} ${this.translate.instant(1===d?"register.date.month":"register.date.months")}`;const r=Math.floor(d/12);return`${this.translate.instant("register.date.ago")} ${r} ${this.translate.instant(1===r?"register.date.year":"register.date.years")}`}onClickMoreTools(e){var n=this;return(0,h.A)(function*(){const s=yield n.popoversService.onShowMenuPopover(e,"contacts-list-more-tools");console.log("Popover result:",s)})()}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}onColumnClick(e){["createdAt","contactName","contactPhone","contactNationality","promotion.projectName","agency.name","createdBy.name","status"].includes(e.column.key)&&(this.sort={field:e.column.key,order:e.order},this.getData())}}return(o=_).\u0275fac=function(e){return new(e||o)(t.rXU(M.m),t.rXU(L.i),t.rXU(k.a),t.rXU(N.d),t.rXU(B.f),t.rXU(x.up),t.rXU($.M),t.rXU(G.c),t.rXU(m.c$))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-registers-list"]],inputs:{options:"options",isMainPage:"isMainPage",promotionId:"promotionId"},decls:21,vars:18,consts:[[1,"crm-block-body"],[3,"ngClass"],[1,"crm-header-modal",3,"ngClass"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text",3,"input","placeholder"],[1,"crm-buttons-group"],[1,"crm-button"],[1,"crm-button-secondary",3,"click","ngClass"],[1,"crm-button-secondary","crm-button-secondary-icon-solo",3,"click"],[1,"fa","fa-ellipsis"],[1,"pagination-container"],[1,"pagination-container",3,"ngClass"],[1,"crm-block-body-blue-content"],[1,"crm-section"],[1,"crm-block-content-aside"],[1,"crm-button",3,"click"],[1,"fa","fa-plus"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[1,"crm-section-title","crm-section-margin-top"],[3,"columnClick","actionButtonClick","rowClicked","table"],[1,"crm-section-title"]],template:function(e,n){1&e&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t.nrm(5,"i",5),t.j41(6,"input",6),t.nI1(7,"translate"),t.bIt("input",function(l){return n.onSearchInputChange(l)}),t.k0s()()(),t.j41(8,"div",7),t.DNE(9,H,4,3,"button",8),t.j41(10,"button",9),t.bIt("click",function(){return n.onToggleAside()}),t.DNE(11,Y,3,3)(12,Z,2,1),t.k0s(),t.j41(13,"button",10),t.bIt("click",function(l){return n.onClickMoreTools(l)}),t.nrm(14,"i",11),t.k0s()()(),t.DNE(15,q,3,9,"div",12),t.k0s(),t.DNE(16,tt,2,10,"div",13),t.j41(17,"div",14),t.DNE(18,et,0,0)(19,it,6,5,"div",15),t.k0s()(),t.DNE(20,at,2,1,"div",16)),2&e&&(t.R7$(),t.Y8G("ngClass",t.eq3(12,F,!(null!=n.options&&n.options.fatherObj))),t.R7$(),t.Y8G("ngClass",t.eq3(14,z,!n.isMainPage)),t.R7$(4),t.Y8G("placeholder",t.bMT(7,10,"register.search_record")),t.R7$(3),t.vxM(null!=n.options&&n.options.fatherObj?-1:9),t.R7$(),t.Y8G("ngClass",t.eq3(16,K,!("filters"===(null==n.aside?null:n.aside.type)&&null!=n.aside&&n.aside.visible)&&n.filters)),t.R7$(),t.vxM("filters"===(null==n.aside?null:n.aside.type)&&null!=n.aside&&n.aside.visible?11:12),t.R7$(4),t.vxM(null!=n.options&&n.options.fatherObj?-1:15),t.R7$(),t.vxM(null!=n.options&&n.options.fatherObj?16:-1),t.R7$(2),t.vxM(n.loadingList?18:19),t.R7$(2),t.vxM(null!=n.aside&&n.aside.visible?20:-1))},dependencies:[R.YU,j.O,A.k,m.D9],styles:[".pagination-container[_ngcontent-%COMP%]{background-color:#fff}.embedded-page-header[_ngcontent-%COMP%], .embedded-pagination-container[_ngcontent-%COMP%]{width:98%;margin:0 auto}"]}),_})()}}]);