"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5303],{5303:(Yt,F,c)=>{c.r(F),c.d(F,{ContactDetailsPageModule:()=>Gt});var m=c(177),h=c(9417),_=c(9465),f=c(5188),d=c(467),R=c(7376),t=c(3953),P=c(4501),b=c(9333),C=c(8397),T=c(6552),k=c(1213),v=c(3955),D=c(2606),$=c(8433),M=c(5419),E=c(2081),S=c(3303);const O=["contactForm"];function A(e,a){if(1&e){const o=t.RV6();t.j41(0,"button",7),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.onSaveContact())}),t.nrm(1,"i",8),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&e&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"CONTACT_DETAILS_INFO.SAVE_CONTACT")," "))}function U(e,a){if(1&e){const o=t.RV6();t.j41(0,"button",9),t.bIt("click",function(){t.eBV(o);const n=t.XpG();return t.Njj(n.onEditContact())}),t.nrm(1,"i",10),t.EFF(2),t.nI1(3,"translate"),t.k0s()}2&e&&(t.R7$(2),t.SpI(" ",t.bMT(3,1,"CONTACT_DETAILS_INFO.EDIT_CONTACT")," "))}let G=(()=>{var e;class a{constructor(i,n,l){this.api=i,this.toastService=n,this.contactsService=l,this.contact=null,this.saveContact=new t.bkB,this.editing=!1}setContactInfo(){this.editing=!0,setTimeout(()=>{this.editing=!1},10)}ngOnInit(){this.setContactInfo()}onEditContact(){this.editing=!0,this.contactForm.fileUploaderManager.setEditingMode(!0)}onSaveContact(){var i=this;return(0,d.A)(function*(){var n;i.contactForm.existingContact?i.toastService.showToast({text:"N\xfamero de tel\xe9fono no v\xe1lido o el contacto ya existe",theme:"red",time:3e3}):(yield i.contactsService.createOrUpdateContactFromForm(i.contactForm,null===(n=i.contact)||void 0===n?void 0:n.id))&&(i.editing=!1,i.contactForm.fileUploaderManager.setEditingMode(!1),i.saveContact.emit())})()}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(E.i),t.rXU(C.f),t.rXU(b.F))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-contact-details-info"]],viewQuery:function(i,n){if(1&i&&t.GBs(O,5),2&i){let l;t.mGM(l=t.lsd())&&(n.contactForm=l.first)}},inputs:{contact:"contact"},outputs:{saveContact:"saveContact"},decls:8,vars:3,consts:[["contactForm",""],[1,"crm-header-modal","crm-header-modal-empty","details"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary"],[1,"crm-boxes-user-create"],[2,"width","100%",3,"contact","disabled"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa","fa-check"],[1,"crm-button-secondary",3,"click"],[1,"fa","fa-edit"]],template:function(i,n){1&i&&(t.j41(0,"div",1),t.nrm(1,"div"),t.j41(2,"div",2),t.DNE(3,A,4,3,"button",3)(4,U,4,3,"button",4),t.k0s()(),t.j41(5,"div",5),t.nrm(6,"app-contact-form",6,0),t.k0s()),2&i&&(t.R7$(3),t.vxM(n.editing?3:4),t.R7$(3),t.Y8G("contact",n.contact)("disabled",!n.editing))},dependencies:[S.q,v.D9]}),a})();var X=c(5786),N=c(7380),Y=c(363),B=c(1852);const x=e=>({item:e}),J=e=>({index:e}),V=e=>({reference:e}),w=(e,a)=>({"background-color":e,color:a}),z=e=>({mode:"contact",contactId:e,itemsPerPage:5});function L(e,a){if(1&e&&(t.j41(0,"div",33),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e){const o=t.XpG().$implicit;t.R7$(),t.SpI(" ",t.i5U(2,1,"contacts.operations.property",t.eq3(4,V,null==o||null==o.mainProperty?null:o.mainProperty.reference))," ")}}function H(e,a){if(1&e&&(t.j41(0,"div",42),t.EFF(1),t.k0s()),2&e){const o=t.XpG().$implicit,i=t.XpG();t.Y8G("ngStyle",t.l_i(2,w,i.utils.hexToRgba(null==o||null==o.currentPipelineStep?null:o.currentPipelineStep.color,.1),null==o||null==o.currentPipelineStep?null:o.currentPipelineStep.color)),t.R7$(),t.SpI(" ",null==o||null==o.currentPipelineStep?null:o.currentPipelineStep.text," ")}}function Z(e,a){1&e&&(t.j41(0,"div",43),t.EFF(1," fill "),t.k0s())}function K(e,a){if(1&e){const o=t.RV6();t.j41(0,"div",27),t.bIt("click",function(){const n=t.eBV(o).$implicit,l=t.XpG();return t.Njj(l.onOpenOperation(n))}),t.j41(1,"div",28)(2,"div",29),t.nrm(3,"img",30),t.k0s(),t.j41(4,"div",31)(5,"div",32),t.EFF(6),t.nI1(7,"translate"),t.k0s(),t.DNE(8,L,3,6,"div",33),t.k0s()(),t.j41(9,"div",34)(10,"div",35)(11,"div",36)(12,"div",37),t.EFF(13),t.nI1(14,"translate"),t.k0s(),t.j41(15,"div",38)(16,"div"),t.EFF(17),t.nI1(18,"date"),t.k0s()()(),t.j41(19,"div",36)(20,"div",37),t.EFF(21),t.nI1(22,"translate"),t.k0s(),t.j41(23,"div",38)(24,"div",39)(25,"div",40),t.EFF(26),t.k0s()()()()()(),t.j41(27,"div",41),t.DNE(28,H,2,5,"div",42)(29,Z,2,0,"div",43),t.k0s()()}if(2&e){const o=a.$implicit,i=a.$index;t.R7$(3),t.Y8G("src","assets/images/building.png",t.B4B),t.R7$(3),t.SpI(" ",t.i5U(7,8,"contacts.operations.item",t.eq3(18,J,i+1))," "),t.R7$(2),t.vxM(null!=o&&o.mainProperty?8:-1),t.R7$(5),t.JRh(t.bMT(14,11,"contacts.operations.created_at")),t.R7$(4),t.SpI(" ",t.i5U(18,13,o.createdAt,"dd/MM/yyyy")," "),t.R7$(4),t.JRh(t.bMT(22,16,"contacts.operations.responsible")),t.R7$(5),t.SpI(" ",(null==o||null==o.responsible?null:o.responsible.name)||(null==o||null==o.createdBy?null:o.createdBy.name)," "),t.R7$(2),t.vxM(null!=o&&null!=o.currentPipelineStep&&o.currentPipelineStep.text?28:29)}}function Q(e,a){if(1&e&&(t.j41(0,"div"),t.nrm(1,"app-autolead-email-list-viewer",44),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.Y8G("options",t.eq3(1,z,null==o.contact?null:o.contact.id))}}function W(e,a){1&e&&t.nrm(0,"i",19)}function q(e,a){1&e&&t.nrm(0,"i",20)}function tt(e,a){if(1&e){const o=t.RV6();t.j41(0,"div",21)(1,"div",45)(2,"button",46),t.nrm(3,"i",47),t.EFF(4),t.nI1(5,"translate"),t.k0s(),t.j41(6,"button",48),t.nrm(7,"i",49),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"button",48),t.nrm(11,"i",50),t.EFF(12),t.nI1(13,"translate"),t.k0s(),t.j41(14,"button",48),t.nrm(15,"i",51),t.EFF(16),t.nI1(17,"translate"),t.k0s()(),t.j41(18,"app-activity-creation-block",52),t.bIt("onNoteCreated",function(n){t.eBV(o);const l=t.XpG();return t.Njj(l.onNoteCreated(n))}),t.k0s()()}if(2&e){const o=t.XpG();t.R7$(4),t.SpI(" ",t.bMT(5,5,"text.note")," "),t.R7$(4),t.SpI(" ",t.bMT(9,7,"text.visit")," "),t.R7$(4),t.SpI(" ",t.bMT(13,9,"text.mail")," "),t.R7$(4),t.SpI(" ",t.bMT(17,11,"text.task")," "),t.R7$(2),t.Y8G("options",o.creationBlockActivityCreationOptions)}}let nt=(()=>{var e;class a{constructor(i,n,l,s,r,p,u){this.modalService=i,this.api=n,this.router=l,this.toast=s,this.byvaroState=r,this.utils=p,this.translate=u,this.operationIdToOpenFromUrl=null,this.operationActivityData={notes:[],operationHistorics:[],operation:null},this.operations=[],this.collapsedActivityAdder=!1,this.creationBlockActivityCreationOptions={type:"note",activityType:"contact",contactId:null,operationId:null}}ngOnChanges(){this.contact&&(this.getUserInfo(),this.getOperations(),this.getUserNotes(),this.creationBlockActivityCreationOptions.contactId=this.contact.id)}onOpenOperation(i){var n=this;return(0,d.A)(function*(){yield(yield n.modalService.showOperationModal(null==i?void 0:i.id)).onDidDismiss(),n.getOperations()})()}onNoteCreated(i){console.log("note created",i),this.getUserNotes()}onAddOperation(){var i=this;return(0,d.A)(function*(){var n;const s=yield(yield i.modalService.showOperationPropertiesSearchModal()).onDidDismiss();null!=s&&null!==(n=s.data)&&void 0!==n&&n.checkedProperties&&i.createOperation(s.data.checkedProperties)})()}getUserInfo(){this.byvaroState.getState().subscribe(i=>{this.currentUser=i.user,this.userAgency=i.agency,this.userPromoter=i.promoter})}getUserNotes(){var i=this;return(0,d.A)(function*(){var n;const l=yield i.api.getNote({contactId:{equals:i.contact.id}},{field:"createdAt",order:"desc"},null,{createdBy:{apply:!0,filter:null,onlyCount:!1}});i.operationActivityData.notes=(null===(n=l.success)||void 0===n?void 0:n.data)||[]})()}getPipelines(){var i=this;return(0,d.A)(function*(){var n;return(null===(n=(yield i.api.getPipelines({},null,null,{steps:{apply:!0,filter:null,onlyCount:!1}})).success)||void 0===n?void 0:n.data)||[]})()}getOperations(){var i=this;return(0,d.A)(function*(){var n;const l=yield i.api.getOperation({contactId:{equals:i.contact.id}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1}});if(i.operations=(null===(n=l.success)||void 0===n?void 0:n.data)||[],i.operationIdToOpenFromUrl){const s=i.operations.find(r=>r.id===i.operationIdToOpenFromUrl);s&&(i.onOpenOperation(s),i.operationIdToOpenFromUrl=null)}})()}createOperation(i){var n=this;return(0,d.A)(function*(){var l,s,r,p;let u=null,g=yield n.getPipelines();g.length>0&&(u=g.find(I=>"operaciones"===I.title),u.steps=(0,R.sortBy)(u.steps,"order"));const Xt={operationType:n.currentUser.accountType,contactId:n.contact.id,promoterId:null===(l=n.userPromoter)||void 0===l?void 0:l.id,agencyId:null===(s=n.userAgency)||void 0===s?void 0:s.id,createdById:n.currentUser.id,responsibleId:n.currentUser.id,currentPipelineId:null===(r=u)||void 0===r?void 0:r.id,currentPipelineStepId:u?u.steps[0].id:null},y=yield n.api.createOperation(Xt),j=null===(p=y.success)||void 0===p?void 0:p.data,Nt=i.map(I=>I.id);yield n.api.linkPropertiesToOperation(j.id,Nt),yield n.setMainProperty(i[0].id,j.id),n.toast.showToast(y.success?{text:n.translate.instant("contacts.operations.creation_success"),theme:"success",time:2e3}:{text:n.translate.instant("contacts.operations.creation_error")+y.error.errorMessage,theme:"red",time:2e3}),n.getOperations()})()}setMainProperty(i,n){var l=this;return(0,d.A)(function*(){yield l.api.updateOperationById(n,{mainPropertyId:i})})()}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(X.M),t.rXU(E.i),t.rXU(f.Ix),t.rXU(C.f),t.rXU(k.c),t.rXU(T.T),t.rXU(v.c$))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-contact-details-operations"]],inputs:{contact:"contact",operationIdToOpenFromUrl:"operationIdToOpenFromUrl"},features:[t.OA$],decls:47,vars:21,consts:[[1,"crm-opp-contact-screen"],[1,"crm-opp-contact-screen-left"],[1,"crm-section","crm-section-padding","big-padding"],[1,"crm-header-icon","no-padding","no-line","no-background"],[1,"crm-header-icon-left"],[1,"crm-square-icon"],[1,"fa-solid","fa-bullseye"],[1,"crm-header-icon-title"],[1,"crm-header-icon-right"],[1,"crm-button",3,"click"],[1,"fas","fa-plus"],[1,"crm-section-operations"],[1,"crm-item-operation"],[1,"crm-opp-contact-screen-right"],[1,"crm-section","crm-section-padding"],[1,"crm-section"],[1,"crm-header-icon","crm-header-icon-less-padding","no-line","no-padding"],[1,"fa-solid","fa-add"],[1,"crm-button-icon-solo",3,"click"],[1,"fas","fa-chevron-up"],[1,"fas","fa-chevron-down"],[1,"crm-activity"],[1,"crm-horizontal-separator"],[1,"fa-solid","fa-clock-rotate-left"],[1,"crm-button-icon-solo"],[1,"fas","fa-filter"],[3,"data"],[1,"crm-item-operation",3,"click"],[1,"crm-item-operation-left"],[1,"crm-item-operation-left-image"],["alt","",3,"src"],[1,"crm-item-operation-left-info"],[1,"crm-item-operation-left-info-promotion"],[1,"crm-item-operation-left-info-property"],[1,"crm-item-operation-center"],[1,"crm-block-info-horizontal"],[1,"crm-info"],[1,"crm-info-title"],[1,"crm-info-content"],[1,"crm-item-reference"],[1,"crm-item-reference-text"],[1,"crm-item-operation-right"],[1,"crm-item-chip","crm-item-chip-warn",3,"ngStyle"],[1,"crm-item-chip","crm-item-chip-warn",2,"visibility","hidden"],[3,"options"],[1,"crm-activity-selector"],[1,"crm-button","crm-button-center"],[1,"fas","fa-note-sticky"],[1,"crm-button-secondary","crm-button-secondary-primary","crm-button-center"],[1,"fas","fa-calendar-alt"],[1,"fas","fa-envelope"],[1,"fas","fa-check"],[3,"onNoteCreated","options"]],template:function(i,n){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t.nrm(6,"i",6),t.k0s(),t.j41(7,"div",7),t.EFF(8),t.nI1(9,"translate"),t.k0s()(),t.j41(10,"div",8)(11,"button",9),t.bIt("click",function(){return n.onAddOperation()}),t.nrm(12,"i",10),t.EFF(13),t.nI1(14,"translate"),t.nI1(15,"translate"),t.k0s()()(),t.j41(16,"div",11),t.Z7z(17,K,30,20,"div",12,t.fX1),t.k0s(),t.DNE(19,Q,2,3,"div"),t.k0s()(),t.j41(20,"div",13)(21,"div",14)(22,"div",15)(23,"div",16)(24,"div",4)(25,"div",5),t.nrm(26,"i",17),t.k0s(),t.j41(27,"div",7),t.EFF(28),t.nI1(29,"translate"),t.k0s()(),t.j41(30,"div",8)(31,"button",18),t.bIt("click",function(){return n.collapsedActivityAdder=!n.collapsedActivityAdder}),t.DNE(32,W,1,0,"i",19)(33,q,1,0,"i",20),t.k0s()()(),t.DNE(34,tt,19,13,"div",21),t.nrm(35,"div",22),t.j41(36,"div",16)(37,"div",4)(38,"div",5),t.nrm(39,"i",23),t.k0s(),t.j41(40,"div",7),t.EFF(41),t.nI1(42,"translate"),t.k0s()(),t.j41(43,"div",8)(44,"button",24),t.nrm(45,"i",25),t.k0s()()(),t.nrm(46,"app-operation-activity-block",26),t.k0s()()()()),2&i&&(t.R7$(8),t.SpI(" ",t.bMT(9,8,"text.operations")," "),t.R7$(5),t.SpI(" ",t.i5U(15,12,"text.add_item",t.eq3(19,x,t.bMT(14,10,"text.operation")))," "),t.R7$(4),t.Dyx(n.operations),t.R7$(2),t.vxM(n.contact?19:-1),t.R7$(9),t.SpI(" ",t.bMT(29,15,"contacts.operations.add_activity")," "),t.R7$(4),t.vxM(n.collapsedActivityAdder?32:33),t.R7$(2),t.vxM(n.collapsedActivityAdder?-1:34),t.R7$(7),t.SpI(" ",t.bMT(42,17,"contacts.operations.history")," "),t.R7$(5),t.Y8G("data",n.operationActivityData))},dependencies:[m.B3,N.$,Y.T,B.n,m.vh,v.D9]}),a})();const et=e=>({"no-padding":e}),ot=(e,a,o)=>({startDate:e,destinataryEmail:a,senderEmail:o}),it=e=>({filter:e}),at=(e,a,o)=>({title:e,connectionId:a,filter:o,itemsPerPage:100}),lt=e=>({father:"contact",contactId:e});function ct(e,a){if(1&e&&(t.j41(0,"div",20)(1,"div",21)(2,"div",22),t.nrm(3,"span",23),t.k0s()()()),2&e){let o,i;const n=t.XpG().$implicit,l=t.XpG(2);t.R7$(3),t.HbH(null==(o=l.utils.getLanguageInfo(n))?null:o.flagClass),t.Y8G("title",null==(i=l.utils.getLanguageInfo(n))?null:i.name)}}function st(e,a){1&e&&t.DNE(0,ct,4,3,"div",20),2&e&&t.vxM(a.$index<4?0:-1)}function rt(e,a){if(1&e&&(t.j41(0,"div",16),t.EFF(1),t.k0s()),2&e){const o=t.XpG(2);t.R7$(),t.SpI(" +",(null==o.contact?null:o.contact.languages.length)-4," ")}}function dt(e,a){if(1&e&&(t.j41(0,"div",19),t.Z7z(1,st,1,1,null,null,t.fX1),t.k0s(),t.DNE(3,rt,2,1,"div",16)),2&e){const o=t.XpG();t.R7$(),t.Dyx(null==o.contact?null:o.contact.languages),t.R7$(2),t.vxM((null==o.contact?null:o.contact.languages.length)>4?3:-1)}}function ut(e,a){1&e&&t.nrm(0,"div",16)}function pt(e,a){1&e&&(t.j41(0,"span"),t.EFF(1,"s"),t.k0s())}function mt(e,a){if(1&e&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.JRh(null==o.contact||null==o.contact.phones?null:o.contact.phones[0])}}function vt(e,a){if(1&e&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.JRh(null==o.contact||null==o.contact.phones?null:o.contact.phones[1])}}function ft(e,a){if(1&e&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.SpI("+",(null==o.contact||null==o.contact.phones?null:o.contact.phones.length)-2,"")}}function _t(e,a){1&e&&(t.j41(0,"span"),t.EFF(1,"s"),t.k0s())}function gt(e,a){if(1&e&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.JRh(null==o.contact||null==o.contact.emails?null:o.contact.emails[0])}}function ht(e,a){if(1&e&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.JRh(null==o.contact||null==o.contact.emails?null:o.contact.emails[1])}}function Ct(e,a){if(1&e&&(t.j41(0,"div"),t.EFF(1),t.k0s()),2&e){const o=t.XpG();t.R7$(),t.SpI("+",(null==o.contact||null==o.contact.emails?null:o.contact.emails.length)-2,"")}}function yt(e,a){if(1&e&&(t.j41(0,"div",18)(1,"div",34)(2,"div",35),t.EFF(3),t.k0s()()()),2&e){const o=a.$implicit;t.R7$(3),t.SpI(" ",null==o||null==o.contact?null:o.contact.name," ")}}function It(e,a){if(1&e&&(t.j41(0,"div",18)(1,"div",34)(2,"div",35),t.EFF(3),t.k0s()()()),2&e){const o=a.$implicit;t.R7$(3),t.SpI(" ",null==o||null==o.contactRelated?null:o.contactRelated.name," ")}}function Ft(e,a){if(1&e&&(t.j41(0,"div",13)(1,"div",14),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.Z7z(4,yt,4,1,"div",18,t.fX1),t.Z7z(6,It,4,1,"div",18,t.fX1),t.k0s()),2&e){const o=t.XpG();t.R7$(2),t.JRh(t.bMT(3,1,"contacts.card.related_with")),t.R7$(2),t.Dyx(o.contact.contactsRelated),t.R7$(2),t.Dyx(o.contact.contactsRelation)}}function Rt(e,a){1&e&&(t.j41(0,"div",38),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&e&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"contacts.details.autolead_warning")," "))}function bt(e,a){if(1&e){const o=t.RV6();t.j41(0,"div",40)(1,"ion-radio-group",41),t.mxI("ngModelChange",function(n){t.eBV(o);const l=t.XpG(3);return t.DH7(l.showReceivedEmails,n)||(l.showReceivedEmails=n),t.Njj(n)}),t.j41(2,"div",42),t.nrm(3,"ion-radio",43),t.j41(4,"div",44),t.EFF(5),t.nI1(6,"translate"),t.k0s()(),t.j41(7,"div",42),t.nrm(8,"ion-radio",43),t.j41(9,"div",44),t.EFF(10),t.nI1(11,"translate"),t.k0s()()(),t.nrm(12,"br")(13,"app-imap-email-list-viewer",37),t.k0s()}if(2&e){const o=t.XpG(3);t.R7$(),t.R50("ngModel",o.showReceivedEmails),t.R7$(2),t.Y8G("value",!0),t.R7$(2),t.SpI(" ",t.bMT(6,6,"contacts.details.received")," "),t.R7$(3),t.Y8G("value",!1),t.R7$(2),t.SpI(" ",t.bMT(11,8,"contacts.details.sent")," "),t.R7$(3),t.Y8G("options",t.sMw(16,at,o.translate.instant("contacts.details.email_list"),o.userEmailAccounts[0].id,t.eq3(14,it,t.sMw(10,ot,o.toIsoStringDate4YearsAgo,o.showReceivedEmails?o.userEmailAccounts[0].email:null==o.contact||null==o.contact.emails?null:o.contact.emails[0],o.showReceivedEmails?null==o.contact||null==o.contact.emails?null:o.contact.emails[0]:o.userEmailAccounts[0].email))))}}function Tt(e,a){if(1&e){const o=t.RV6();t.DNE(0,Rt,3,3,"div",38),t.j41(1,"app-contact-details-info",39),t.bIt("saveContact",function(){t.eBV(o);const n=t.XpG(2);return t.Njj(n.ngOnInit())}),t.k0s(),t.DNE(2,bt,14,20,"div",40),t.nrm(3,"br")(4,"br")(5,"br")(6,"br")(7,"br")}if(2&e){const o=t.XpG(2);t.vxM(null!=o.contact&&o.contact.isAutoCreatedFromAutoLead?0:-1),t.R7$(),t.Y8G("contact",o.contactCopy),t.R7$(),t.vxM(o.userEmailAccounts.length>0&&null!=o.contact&&null!=o.contact.emails&&o.contact.emails[0]?2:-1)}}function kt(e,a){if(1&e&&t.nrm(0,"app-contact-details-operations",36),2&e){const o=t.XpG(2);t.Y8G("contact",o.contact)("operationIdToOpenFromUrl",o.operationIdToOpenFromUrl)}}function Dt(e,a){if(1&e&&t.nrm(0,"app-operation-documents",37),2&e){const o=t.XpG(2);t.Y8G("options",t.eq3(1,lt,o.contact.id))}}function $t(e,a){if(1&e&&t.DNE(0,Tt,8,3)(1,kt,1,2,"app-contact-details-operations",36)(2,Dt,1,3,"app-operation-documents",37),2&e){const o=t.XpG();t.vxM("info"===o.activeTab?0:-1),t.R7$(),t.vxM("operations"===o.activeTab?1:-1),t.R7$(),t.vxM("documents"===o.activeTab?2:-1)}}const Et=[{path:"",component:(()=>{var e;class a{constructor(i,n,l,s,r,p,u,g){this.headerService=i,this.activatedRoute=n,this.contactsService=l,this.toastService=s,this.router=r,this.utils=p,this.byvaroState=u,this.translate=g,this.contactParameterId=null,this.contact=null,this.contactCopy=null,this.activeTab="info",this.userEmailAccounts=[],this.showReceivedEmails=!0,this.toIsoStringDate4YearsAgo=new Date((new Date).setFullYear((new Date).getFullYear()-4)).toISOString(),this.tabs=[{id:"1",title:"info",active:!0},{id:"2",title:"operations",active:!1},{id:"3",title:"documents",active:!1}],this.operationIdToOpenFromUrl=null}ngOnInit(){this.contactParameterId=this.activatedRoute.snapshot.paramMap.get("id"),this.getData(),this.getUserInfo()}ionViewWillEnter(){this.headerService.setConfig({title:"contact_details"})}onTabClicked(i){this.activeTab=i}getUserInfo(){this.byvaroState.getState().subscribe(i=>{var n,l,s;this.currentUser=i.user,null!==(n=this.currentUser)&&void 0!==n&&n.imapEmailAccounts&&(null===(l=this.currentUser)||void 0===l?void 0:l.imapEmailAccounts.length)>0&&(this.userEmailAccounts=null===(s=this.currentUser)||void 0===s?void 0:s.imapEmailAccounts)})}getData(){var i=this;return(0,d.A)(function*(){if(i.contact=yield i.getContactById(),i.contactCopy=R.cloneDeep(i.contact),!i.contact)return i.toastService.showToast({text:i.translate.instant("contacts.details.error_not_found"),icon:"fas fa-exclamation-triangle",theme:"red",time:3e3}),void i.router.navigate(["/contacts"]);console.log(i.contact);const n=i.activatedRoute.snapshot.paramMap.get("operationId")||null;n&&(i.operationIdToOpenFromUrl=n,i.activeTab="operations")})()}getContactById(){var i=this;return(0,d.A)(function*(){return i.contactParameterId?i.contactsService.getContactById(i.contactParameterId):null})()}}return(e=a).\u0275fac=function(i){return new(i||e)(t.rXU(P.d),t.rXU(f.nX),t.rXU(b.F),t.rXU(C.f),t.rXU(f.Ix),t.rXU(T.T),t.rXU(k.c),t.rXU(v.c$))},e.\u0275cmp=t.VBU({type:e,selectors:[["app-contact-details"]],decls:101,vars:65,consts:[[1,"crm-block-body"],[1,"crm-block-body-fixed"],[1,"crm-block-details-header"],[1,"crm-block-details-header-top"],[1,"crm-block-details-header-left"],[1,"crm-block-photo-and-info"],[1,"crm-block-photo-and-info-img"],["alt","",3,"src"],[1,"crm-block-photo-and-info-info"],[1,"crm-block-photo-and-info-info-title"],[1,"crm-block-photo-and-info-info-footer"],[1,"crm-vertical-separator"],[1,"crm-block-info-horizontal"],[1,"crm-info","crm-info-size-medium"],[1,"crm-info-title"],[1,"crm-info-content-langs"],[1,"crm-info-content-langs-plus"],[1,"crm-info","crm-info-size-small"],[1,"crm-info-content"],[1,"crm-info-content-langs-langs"],[1,"crm-item-option","crm-item-option-lang"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[3,"title"],[1,"crm-item-option-label"],[4,"ngIf"],[1,"crm-info"],[1,"crm-info-content","crm-info-content-with-icon"],[1,"fas","fa-bullseye"],[1,"crm-block-details-header-right"],[1,"crm-buttons-group"],[1,"crm-block-details-bottom"],[3,"tabClicked","tabs"],[1,"crm-block-body-blue-content",3,"ngClass"],[1,"crm-item-reference"],[1,"crm-item-reference-text"],[2,"flex","1",3,"contact","operationIdToOpenFromUrl"],[3,"options"],[1,"crm-item-chip","crm-item-chip-warn"],[3,"saveContact","contact"],[2,"width","600px"],[1,"crm-input-radios",3,"ngModelChange","ngModel"],[1,"crm-input-radio"],[3,"value"],[1,"crm-input-radio-label"]],template:function(i,n){if(1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),t.nrm(7,"img",7),t.k0s(),t.j41(8,"div",8)(9,"div")(10,"div",9),t.EFF(11),t.k0s(),t.j41(12,"div",10),t.EFF(13),t.k0s()(),t.j41(14,"div")(15,"div",10),t.EFF(16),t.nI1(17,"translate"),t.nI1(18,"date"),t.k0s()()()(),t.nrm(19,"div",11),t.j41(20,"div",12)(21,"div",13)(22,"div",14),t.EFF(23),t.nI1(24,"translate"),t.k0s(),t.j41(25,"div",15),t.DNE(26,dt,4,1)(27,ut,1,0,"div",16),t.k0s()(),t.j41(28,"div",17)(29,"div",14),t.EFF(30),t.nI1(31,"translate"),t.k0s(),t.j41(32,"div",18)(33,"div",19)(34,"div",20)(35,"div",21)(36,"div",22),t.nrm(37,"span",23),t.k0s(),t.j41(38,"div",24),t.EFF(39),t.k0s()()()()()(),t.j41(40,"div",17)(41,"div",14),t.EFF(42),t.nI1(43,"translate"),t.k0s(),t.j41(44,"div",18)(45,"div"),t.EFF(46),t.k0s()()(),t.j41(47,"div",17)(48,"div",14),t.EFF(49),t.nI1(50,"translate"),t.k0s(),t.j41(51,"div",18)(52,"div"),t.EFF(53),t.k0s()()(),t.j41(54,"div",13)(55,"div",14),t.EFF(56),t.nI1(57,"translate"),t.DNE(58,pt,2,0,"span",25),t.k0s(),t.j41(59,"div",18),t.DNE(60,mt,2,1,"div",25)(61,vt,2,1,"div",25)(62,ft,2,1,"div",25),t.k0s()(),t.j41(63,"div",13)(64,"div",14),t.EFF(65),t.nI1(66,"translate"),t.DNE(67,_t,2,0,"span",25),t.k0s(),t.j41(68,"div",18),t.DNE(69,gt,2,1,"div",25)(70,ht,2,1,"div",25)(71,Ct,2,1,"div",25),t.k0s()(),t.j41(72,"div",17)(73,"div",14),t.EFF(74),t.nI1(75,"translate"),t.k0s(),t.j41(76,"div",18)(77,"div"),t.EFF(78),t.k0s()()(),t.j41(79,"div",17)(80,"div",14),t.EFF(81),t.nI1(82,"translate"),t.k0s(),t.j41(83,"div",18)(84,"div"),t.EFF(85),t.nI1(86,"date"),t.k0s()()(),t.j41(87,"div",26)(88,"div",14),t.EFF(89),t.nI1(90,"translate"),t.k0s(),t.j41(91,"div",27),t.nrm(92,"i",28),t.EFF(93),t.k0s()(),t.DNE(94,Ft,8,3,"div",13),t.k0s()(),t.j41(95,"div",29),t.nrm(96,"div",30),t.k0s()(),t.j41(97,"div",31)(98,"app-tabs",32),t.bIt("tabClicked",function(s){return n.onTabClicked(s)}),t.k0s()()()(),t.j41(99,"div",33),t.DNE(100,$t,3,3),t.k0s()()),2&i){let l,s,r;t.R7$(7),t.Y8G("src",(null==n.contact?null:n.contact.photoUrl)||"assets/images/avatar.png",t.B4B),t.R7$(4),t.SpI(" ",null==n.contact?null:n.contact.name," "),t.R7$(2),t.SpI(" #",null==n.contact?null:n.contact.byvaroId," "),t.R7$(3),t.Lme(" ",t.bMT(17,37,"contacts.details.created_at")," ",t.i5U(18,39,null==n.contact?null:n.contact.createdAt,"dd/MM/yyyy")," "),t.R7$(7),t.JRh(t.bMT(24,42,"contacts.details.languages")),t.R7$(3),t.vxM(null!=n.contact&&n.contact.languages&&(null==n.contact?null:n.contact.languages.length)>0?26:27),t.R7$(4),t.JRh(t.bMT(31,44,"contacts.details.nationality")),t.R7$(7),t.HbH(null==(l=n.utils.getCountryInfo(null==n.contact?null:n.contact.nationality))?null:l.flagClass),t.Y8G("title",null==(s=n.utils.getCountryInfo(null==n.contact?null:n.contact.nationality))?null:s.name),t.R7$(2),t.SpI(" ",null==(r=n.utils.getCountryInfo(null==n.contact?null:n.contact.nationality))?null:r.name," "),t.R7$(3),t.JRh(t.bMT(43,46,"contacts.details.alias")),t.R7$(4),t.JRh(null==n.contact?null:n.contact.alias),t.R7$(3),t.JRh(t.bMT(50,48,"contacts.details.reference")),t.R7$(4),t.JRh(null==n.contact?null:n.contact.reference),t.R7$(3),t.SpI(" ",t.bMT(57,50,"contacts.details.phone"),""),t.R7$(2),t.Y8G("ngIf",(null==n.contact||null==n.contact.emails?null:n.contact.emails.length)>1),t.R7$(2),t.Y8G("ngIf",null==n.contact||null==n.contact.phones?null:n.contact.phones[0]),t.R7$(),t.Y8G("ngIf",null==n.contact||null==n.contact.phones?null:n.contact.phones[0]),t.R7$(),t.Y8G("ngIf",(null==n.contact||null==n.contact.phones?null:n.contact.phones.length)>2),t.R7$(3),t.SpI(" ",t.bMT(66,52,"contacts.details.email"),""),t.R7$(2),t.Y8G("ngIf",(null==n.contact||null==n.contact.emails?null:n.contact.emails.length)>1),t.R7$(2),t.Y8G("ngIf",null==n.contact||null==n.contact.emails?null:n.contact.emails[0]),t.R7$(),t.Y8G("ngIf",null==n.contact||null==n.contact.emails?null:n.contact.emails[0]),t.R7$(),t.Y8G("ngIf",(null==n.contact||null==n.contact.emails?null:n.contact.emails.length)>2),t.R7$(3),t.JRh(t.bMT(75,54,"contacts.details.origin")),t.R7$(4),t.JRh(null==n.contact?null:n.contact.origin),t.R7$(3),t.JRh(t.bMT(82,56,"contacts.details.created_at")),t.R7$(4),t.JRh(t.i5U(86,58,null==n.contact?null:n.contact.createdAt,"dd/MM/yyyy")),t.R7$(4),t.JRh(t.bMT(90,61,"contacts.details.operations")),t.R7$(4),t.Lme(" ",null==n.contact||null==n.contact.operations?null:n.contact.operations.length," / ",null==n.contact||null==n.contact.operations?null:n.contact.operations.length," "),t.R7$(),t.vxM((null==n.contact||null==n.contact.contactsRelation?null:n.contact.contactsRelation.length)>0||(null==n.contact||null==n.contact.contactsRelated?null:n.contact.contactsRelated.length)>0?94:-1),t.R7$(4),t.Y8G("tabs",n.tabs),t.R7$(),t.Y8G("ngClass",t.eq3(63,et,"operations"===n.activeTab)),t.R7$(),t.vxM(null!=n.contact&&n.contact.id?100:-1)}},dependencies:[m.YU,m.bT,h.BC,h.vS,_.KO,_.f0,_.Je,D.O,$.x,M.t,G,nt,m.vh,v.D9]}),a})()}];let jt=(()=>{var e;class a{}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[f.iI.forChild(Et),f.iI]}),a})();var Pt=c(7294),Mt=c(179),St=c(3675),Ot=c(3274),At=c(5641),Ut=c(9066);let Gt=(()=>{var e;class a{}return(e=a).\u0275fac=function(i){return new(i||e)},e.\u0275mod=t.$C({type:e}),e.\u0275inj=t.G2t({imports:[m.MD,h.YN,_.bv,jt,D.O,Pt.J,v.h,Mt.Y,Ot.K,St.S,$.x,At.D,Ut.K]}),a})()}}]);