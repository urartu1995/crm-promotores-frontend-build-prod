"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2992],{2992:(b,g,i)=>{i.r(g),i.d(g,{ChangePasswordModule:()=>M});var h=i(177),l=i(9417),m=i(9465),u=i(467),e=i(3953),p=i(5188),C=i(88),v=i(2081),f=i(1213);function w(t,s){1&t&&(e.j41(0,"div"),e.EFF(1," Para cambiar la contrase\xf1a deber\xe1s primero verificar tu correo electr\xf3nico. "),e.k0s())}function _(t,s){if(1&t&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.SpI(" Hemos enviado un c\xf3digo de verificaci\xf3n a tu correo electr\xf3nico ",r.email,". Por favor, ingr\xe9salo a continuaci\xf3n. ")}}function P(t,s){if(1&t){const r=e.RV6();e.j41(0,"div",8)(1,"div",13),e.EFF(2," Ingresa tu email "),e.k0s(),e.j41(3,"div",14)(4,"input",15),e.mxI("ngModelChange",function(n){e.eBV(r);const a=e.XpG();return e.DH7(a.email,n)||(a.email=n),e.Njj(n)}),e.k0s()()()}if(2&t){const r=e.XpG();e.R7$(4),e.R50("ngModel",r.email)}}function F(t,s){if(1&t){const r=e.RV6();e.j41(0,"button",16),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.sendVerificationCode())}),e.EFF(1," Enviar c\xf3digo al email "),e.k0s()}}function y(t,s){if(1&t){const r=e.RV6();e.j41(0,"div",8)(1,"div",13),e.EFF(2," Ingresa el c\xf3digo de verificaci\xf3n "),e.k0s(),e.j41(3,"div",14)(4,"input",17),e.mxI("ngModelChange",function(n){e.eBV(r);const a=e.XpG();return e.DH7(a.code,n)||(a.code=n),e.Njj(n)}),e.k0s()()(),e.j41(5,"div",8)(6,"div",13),e.EFF(7," Ingresa la nueva contrase\xf1a "),e.k0s(),e.j41(8,"div",14)(9,"input",18),e.mxI("ngModelChange",function(n){e.eBV(r);const a=e.XpG();return e.DH7(a.newPassword,n)||(a.newPassword=n),e.Njj(n)}),e.k0s()()(),e.j41(10,"button",16),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.changePassword())}),e.EFF(11," Cambiar contrase\xf1a "),e.k0s(),e.j41(12,"button",19),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.resendCode())}),e.EFF(13," Reenviar c\xf3digo "),e.k0s()}if(2&t){const r=e.XpG();e.R7$(4),e.R50("ngModel",r.code),e.R7$(5),e.R50("ngModel",r.newPassword)}}function k(t,s){if(1&t&&(e.j41(0,"div",10),e.EFF(1),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.SpI(" ",r.errorToShow," ")}}const j=[{path:"",component:(()=>{var t;class s{constructor(o,n,a,d,c){this.router=o,this.toastController=n,this.loadingCtrl=a,this.api=d,this.state=c,this.code="",this.newPassword="",this.email="",this.codeSent=!1,this.alreadyLoggedIn=!1,this.errorToShow=""}ngOnInit(){this.getState()}getState(){var o=this;return(0,u.A)(function*(){o.state.getState().subscribe(n=>{n.user&&(o.alreadyLoggedIn=!0,o.email=n.user.email,o.sendVerificationCode())})})()}resendCode(){var o=this;return(0,u.A)(function*(){o.sendVerificationCode(),o.codeSent=!0,o.code=""})()}goBack(){this.router.navigate(["/auth/login"])}changePassword(){var o=this;return(0,u.A)(function*(){const n=yield o.loadingCtrl.create({message:"Enviando c\xf3digo de verificaci\xf3n...",spinner:"crescent",showBackdrop:!0,backdropDismiss:!1,mode:"ios"});if(yield n.present(),o.errorToShow="",!o.newPassword||o.newPassword.length<6)return yield n.dismiss(),void(yield o.toastController.create({message:"La contrase\xf1a debe tener al menos 6 caracteres",duration:2e3,color:"danger"})).present();if(!o.code||o.code.length<6)return yield n.dismiss(),void(yield o.toastController.create({message:"Por favor, ingrese el c\xf3digo de verificaci\xf3n entero",duration:2e3,color:"danger"})).present();let a=yield o.api.changePassword(o.email,o.newPassword,o.code);var d;a.success?(yield n.dismiss(),(yield o.toastController.create({message:"Contrase\xf1a cambiada con \xe9xito",duration:2e3,color:"dark"})).present(),o.router.navigate(["/auth/login"])):(yield n.dismiss(),o.errorToShow=null===(d=a.error)||void 0===d?void 0:d.errorMessage,(yield o.toastController.create({message:o.errorToShow,duration:2e3,color:"danger"})).present())})()}sendVerificationCode(){var o=this;return(0,u.A)(function*(){const n=yield o.loadingCtrl.create({message:"Enviando c\xf3digo de verificaci\xf3n...",spinner:"crescent",showBackdrop:!0,backdropDismiss:!1,mode:"ios"});if(yield n.present(),console.log("sendVerificationCode",o.email),!o.email)return yield n.dismiss(),void(yield o.toastController.create({message:"Por favor, ingrese un correo electr\xf3nico",duration:2e3,color:"danger"})).present();o.errorToShow="";let a=yield o.api.sendVerificationCodeForChangePassword(o.email);var d;a.success?(yield n.dismiss(),o.codeSent=!0):(yield n.dismiss(),o.errorToShow=null===(d=a.error)||void 0===d?void 0:d.errorMessage,(yield o.toastController.create({message:o.errorToShow,duration:2e3,color:"danger"})).present())})()}}return(t=s).\u0275fac=function(o){return new(o||t)(e.rXU(p.Ix),e.rXU(C.K_),e.rXU(C.Xi),e.rXU(v.i),e.rXU(f.c))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-change-password"]],decls:19,vars:6,consts:[[1,"crm-box","crm-section","crm-section-center-content","crm-section-margin-top",2,"margin-top","80px"],[1,"crm-header-icon","no-padding","no-line","bottom-margin"],[1,"crm-header-icon-left"],[1,"crm-square-icon"],[1,"fas","fa-key"],[1,"crm-header-icon-title"],[1,"crm-header-icon-right"],[1,"crm-section-inputs"],[1,"crm-input"],["type","button",1,"crm-button"],[1,"crm-input-error"],[2,"cursor","pointer",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-input-label"],[1,"crm-input-input"],["type","email",3,"ngModelChange","ngModel"],["type","button",1,"crm-button",3,"click"],["type","text",3,"ngModelChange","ngModel"],["type","password",3,"ngModelChange","ngModel"],["type","button",1,"crm-button","crm-button-secondary",3,"click"]],template:function(o,n){1&o&&(e.j41(0,"ion-content")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3),e.nrm(5,"i",4),e.k0s(),e.j41(6,"div",5),e.EFF(7," Cambiar contrase\xf1a "),e.k0s()(),e.nrm(8,"div",6),e.k0s(),e.j41(9,"div",7),e.DNE(10,w,2,0,"div")(11,_,2,1,"div")(12,P,5,1,"div",8)(13,F,2,0,"button",9)(14,y,14,2)(15,k,2,1,"div",10),e.j41(16,"a",11),e.bIt("click",function(){return n.goBack()}),e.nrm(17,"i",12),e.EFF(18," Volver atr\xe1s "),e.k0s()()()()),2&o&&(e.R7$(10),e.vxM(n.codeSent?-1:10),e.R7$(),e.vxM(n.codeSent?11:-1),e.R7$(),e.vxM(n.alreadyLoggedIn?-1:12),e.R7$(),e.vxM(n.codeSent?-1:13),e.R7$(),e.vxM(n.codeSent?14:-1),e.R7$(),e.vxM(n.errorToShow?15:-1))},dependencies:[l.me,l.BC,l.vS,m.W9]}),s})()}];let M=(()=>{var t;class s{}return(t=s).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[h.MD,l.YN,m.bv,l.X1,p.iI.forChild(j)]}),s})()}}]);