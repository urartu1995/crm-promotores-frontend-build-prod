"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5166],{5166:(I,m,l)=>{l.r(m),l.d(m,{OperationsListPageModule:()=>L});var u=l(177),h=l(9417),P=l(9465),O=l(5188),t=l(5990),g=l(3953);const C=[{path:"",component:t.Q}];let b=(()=>{var p;class _{}return(p=_).\u0275fac=function(f){return new(f||p)},p.\u0275mod=g.$C({type:p}),p.\u0275inj=g.G2t({imports:[O.iI.forChild(C),O.iI]}),_})();var y=l(3895),E=l(5603);let L=(()=>{var p;class _{}return(p=_).\u0275fac=function(f){return new(f||p)},p.\u0275mod=g.$C({type:p}),p.\u0275inj=g.G2t({imports:[u.MD,h.YN,P.bv,b,y.b,E.P]}),_})()},5990:(I,m,l)=>{l.d(m,{Q:()=>X});var u=l(467),h=l(1413),P=l(7376),t=l(3953),g=l(5970),C=l(4501),b=l(2081),y=l(1296),E=l(9710),L=l(5188),p=l(177),_=l(9465),v=l(1880),f=l(6580);const j=s=>({"crm-block-body-fixed":s}),T=s=>({"crm-button-secondary-primary":s}),D=s=>({active:s}),S=(s,c)=>({"background-color":s,border:c}),M=(s,c,n,e,i)=>({pageStartIndex:s,pageEndIndex:c,totalCount:n,paginationPage:e,sortField:i});function R(s,c){if(1&s){const n=t.RV6();t.j41(0,"div",19),t.bIt("click",function(){const i=t.eBV(n).$implicit,o=t.XpG();return t.Njj(o.onClickStep(i))}),t.j41(1,"div",20),t.EFF(2),t.k0s(),t.j41(3,"div",21),t.EFF(4),t.nrm(5,"div",22),t.k0s()()}if(2&s){const n=c.$implicit,e=t.XpG();t.Y8G("ngClass",t.eq3(4,D,null==n?null:n.isInOperationsTableActive)),t.R7$(2),t.SpI(" ",e.stepsCount[n.id]," "),t.R7$(2),t.SpI(" ",null==n?null:n.text," "),t.R7$(),t.Y8G("ngStyle",t.l_i(6,S,null==n?null:n.color,"1px solid "+(null==n?null:n.color)))}}function k(s,c){1&s&&(t.nrm(0,"i",23),t.EFF(1," Cerrar filtros "))}function N(s,c){1&s&&(t.nrm(0,"i",24),t.EFF(1," Filtros activados "))}function x(s,c){1&s&&(t.nrm(0,"i",24),t.EFF(1," Filtrar "))}function A(s,c){if(1&s&&t.DNE(0,N,2,0)(1,x,2,0),2&s){const n=t.XpG();t.vxM(n.filters?0:1)}}function F(s,c){if(1&s){const n=t.RV6();t.j41(0,"app-list-pagination-selectors",25),t.bIt("goPreviousPage",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.onGoPreviousPage())})("goNextPage",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.onGoNextPage())})("sort",function(i){t.eBV(n);const o=t.XpG();return t.Njj(o.onSort(i))}),t.k0s()}if(2&s){const n=t.XpG();t.Y8G("listPaginationConfig",t.s1E(1,M,n.updatePagination().startIndex,n.updatePagination().endIndex,n.allSystemOperationsCount,n.pagination.page+1,null!=n.sort&&n.sort.field?(null==n.sort?null:n.sort.field)+" "+(null==n.sort?null:n.sort.order):"Fecha de creaci\xf3n"))}}function G(s,c){if(1&s){const n=t.RV6();t.j41(0,"div",16)(1,"app-list-pagination-selectors",25),t.bIt("goPreviousPage",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.onGoPreviousPage())})("goNextPage",function(){t.eBV(n);const i=t.XpG();return t.Njj(i.onGoNextPage())})("sort",function(i){t.eBV(n);const o=t.XpG();return t.Njj(o.onSort(i))}),t.k0s()()}if(2&s){const n=t.XpG();t.R7$(),t.Y8G("listPaginationConfig",t.s1E(1,M,n.updatePagination().startIndex,n.updatePagination().endIndex,n.allSystemOperationsCount,n.pagination.page+1,null!=n.sort&&n.sort.field?(null==n.sort?null:n.sort.field)+" "+(null==n.sort?null:n.sort.order):"Fecha de creaci\xf3n"))}}function B(s,c){}function U(s,c){if(1&s){const n=t.RV6();t.j41(0,"app-table",26),t.bIt("columnClick",function(i){t.eBV(n);const o=t.XpG();return t.Njj(o.onColumnClicked(i))})("rowClicked",function(i){t.eBV(n);const o=t.XpG();return t.Njj(o.onRowClicked(i))}),t.k0s()}if(2&s){const n=t.XpG();t.Y8G("table",n.tableConfig)}}let X=(()=>{var s;class c{constructor(e,i,o,a,r,d){this.popoversService=e,this.headerService=i,this.sdk=o,this.tableService=a,this.modalService=r,this.activatedRoute=d,this.pipeline=null,this.operations=[],this.allSystemOperationsCount=0,this.checkedOperations=0,this.searchString="",this.searchSubject=new h.B,this.aside={type:"filters",visible:!1},this.pipelineName="operaciones",this.showFilters=!1,this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:25},this.tableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"currentPipelineStep.text",label:"Etapa",size:"medium"},{key:"contact.name",label:"Contacto",size:"large"},{key:"mainProperty.promotion.projectName",label:"Promoci\xf3n",size:"large"},{key:"mainProperty.reference",label:"Identificador",size:"large"},{key:"mainProperty.availabilityStatus",label:"Estado propiedad",size:"medium"},{key:"createdAt",label:"Creado",size:"medium"},{key:"responsible.name",label:"Responsable",size:"large"}],rows:[]},this.relationsFilter={mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},contact:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:{title:{equals:this.pipelineName}},onlyCount:!1}},this.loadingList=!1,this.stepsCount={}}ionViewWillEnter(){this.getData()}ngOnInit(){var e;null!==(e=this.options)&&void 0!==e&&e.fatherObj&&(this.relationsFilter.operations={apply:!0,filter:{agencyId:{equals:this.options.fatherObj.id}},onlyCount:!1},this.getData())}getData(){var e=this;return(0,u.A)(function*(){yield e.getOperationNameInUrl(),yield e.getPipelines(),yield e.getOperations(),yield e.getOperationsStepsCount()})()}getOperationNameInUrl(){var e=this;return(0,u.A)(function*(){var i;e.pipelineName=e.activatedRoute.snapshot.params.pipelineName||"operaciones",console.log("pipelineName",e.pipelineName),e.relationsFilter.currentPipeline.filter.title.equals=e.pipelineName,null!==(i=e.options)&&void 0!==i&&i.fatherObj||e.headerService.setConfig({title:"operations/"+e.pipelineName})})()}getOperationsStepsCount(){var e=this;return(0,u.A)(function*(){var i,o;if(!e.pipeline)return;let a={};var r;null!==(i=e.options)&&void 0!==i&&i.fatherObj&&(a={agencyId:null===(r=e.options)||void 0===r||null===(r=r.fatherObj)||void 0===r?void 0:r.id});const d=yield e.sdk.countOperationsPerStep(e.pipeline.id,a);e.stepsCount=null===(o=d.success)||void 0===o?void 0:o.data})()}getPipelines(){var e=this;return(0,u.A)(function*(){const i=yield e.sdk.getPipelines({title:{equals:e.pipelineName}},{field:"createdAt",order:"asc"},{itemsPerPage:200,page:0},{steps:{filter:null,apply:!0,onlyCount:!1},buttons:{filter:null,apply:!0,onlyCount:!1}});if(i.success){var o;const a=null==i||null===(o=i.success)||void 0===o?void 0:o.data[0],r=P.cloneDeep(null==a?void 0:a.steps)||[];r.sort((d,W)=>d.order-W.order),a.steps=r,e.pipeline=a}})()}getOperations(){var e=this;return(0,u.A)(function*(){const i=yield e.sdk.getOperation(e.filters,e.sort,e.pagination,e.relationsFilter);if(console.log("this.relationsFilter",JSON.parse(JSON.stringify(e.relationsFilter))),i.success){e.operations=i.success.data;let o=e.tableService.convertDataToTableRows(e.operations,e.tableConfig);o=e.tableService.setRowsChipsFromOperations(o),o=o.map(a=>{var r;return null!=a&&null!==(r=a.rawObject)&&void 0!==r&&r.viewed||(a.style={backgroundColor:"success"}),a}),e.tableConfig.rows=o}})()}setCountsOfPipelinesSteps(){var e=this;return(0,u.A)(function*(){for(let o=0;o<(null===(i=e.pipeline)||void 0===i||null===(i=i.steps)||void 0===i?void 0:i.length);o++)var i})()}onClickStep(e){if(null!=e&&e.isInOperationsTableActive){var i;const a=(null===(i=this.filters)||void 0===i?void 0:i.OR)||[],r=a.findIndex(d=>d.currentPipelineStepId.equals===e.id);a.splice(r,1),this.pipeline.steps.forEach(d=>{d.id===e.id&&(d.isInOperationsTableActive=!1)}),this.filters=0===a.length?null:{OR:a}}else{var o;const a=(null===(o=this.filters)||void 0===o?void 0:o.OR)||[];a.push({currentPipelineStepId:{equals:e.id}}),this.pipeline.steps.forEach(r=>{r.id===e.id&&(r.isInOperationsTableActive=!0)}),this.filters={OR:a}}this.getOperations()}onSearchInputChange(e){this.searchSubject.next(e.target.value)}onSearchChanged(e){this.searchString=e}onToggleAside(){this.aside.visible=!this.aside.visible}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}onToggleAllCheckboxes(e){}onShowMenuSelectAll(e){}onSort(e){}onRowClicked(e){var i=this;return(0,u.A)(function*(){const o=e.rawObject;console.log("operation",o),yield(yield i.modalService.showOperationModal(null==o?void 0:o.id)).onDidDismiss(),i.getOperations()})()}onColumnClicked(e){var i=this;return(0,u.A)(function*(){i.sort={field:e.column.key,order:e.order},i.getData()})()}onClickMoreTools(e){var i=this;return(0,u.A)(function*(){const o=yield i.popoversService.onShowMenuPopover(e,"contacts-list-more-tools");console.log("Popover result:",o)})()}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}}return(s=c).\u0275fac=function(e){return new(e||s)(t.rXU(g.m),t.rXU(C.d),t.rXU(b.i),t.rXU(y.a),t.rXU(E.M),t.rXU(L.nX))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-operations-list"]],inputs:{options:"options"},decls:23,vars:12,consts:[[3,"fullscreen","scrollY"],[1,"crm-block-content"],[1,"crm-block-body"],[3,"ngClass"],[1,"crm-section-operations-list-buttons"],[1,"crm-operations-list-pipe-button",3,"ngClass"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar operaci\xf3n",3,"input"],[1,"crm-buttons-group"],[1,"crm-button-secondary",3,"click","ngClass"],[1,"crm-button-secondary","crm-button-secondary-icon-solo",3,"click"],[1,"fa","fa-ellipsis"],[3,"listPaginationConfig"],[1,"crm-block-body-fixed","crm-block-body-fixed-padding-bigger"],[1,"crm-block-body-blue-content"],[3,"table"],[1,"crm-operations-list-pipe-button",3,"click","ngClass"],[1,"crm-operations-list-pipe-button-title"],[1,"crm-operations-list-pipe-button-subtitle"],[1,"crm-dot","success",3,"ngStyle"],[1,"fa","fa-times"],[1,"fa","fa-filter"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[3,"columnClick","rowClicked","table"]],template:function(e,i){1&e&&(t.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t.Z7z(5,R,6,9,"div",5,t.fX1),t.k0s(),t.j41(7,"div",6)(8,"div",7)(9,"div",8),t.nrm(10,"i",9),t.j41(11,"input",10),t.bIt("input",function(a){return i.onSearchInputChange(a)}),t.k0s()()(),t.j41(12,"div",11)(13,"button",12),t.bIt("click",function(){return i.onToggleAside()}),t.DNE(14,k,2,0)(15,A,2,1),t.k0s(),t.j41(16,"button",13),t.bIt("click",function(a){return i.onClickMoreTools(a)}),t.nrm(17,"i",14),t.k0s()()(),t.DNE(18,F,1,7,"app-list-pagination-selectors",15),t.k0s(),t.DNE(19,G,2,7,"div",16),t.j41(20,"div",17),t.DNE(21,B,0,0)(22,U,1,1,"app-table",18),t.k0s()()()()),2&e&&(t.Y8G("fullscreen",!0)("scrollY",!1),t.R7$(3),t.Y8G("ngClass",t.eq3(8,j,!(null!=i.options&&i.options.fatherObj))),t.R7$(2),t.Dyx(null==i.pipeline?null:i.pipeline.steps),t.R7$(8),t.Y8G("ngClass",t.eq3(10,T,!("filters"===(null==i.aside?null:i.aside.type)&&null!=i.aside&&i.aside.visible)&&i.filters)),t.R7$(),t.vxM("filters"===(null==i.aside?null:i.aside.type)&&null!=i.aside&&i.aside.visible?14:15),t.R7$(4),t.vxM(null!=i.options&&i.options.fatherObj?-1:18),t.R7$(),t.vxM(null!=i.options&&i.options.fatherObj?19:-1),t.R7$(2),t.vxM(i.loadingList?21:22))},dependencies:[p.YU,p.B3,_.W9,v.O,f.k]}),c})()}}]);