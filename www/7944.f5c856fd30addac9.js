"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7944],{7944:(R,v,p)=>{p.d(v,{v:()=>D});var m=p(467),e=p(3953),y=p(9465),h=p(2081),f=p(8397);function A(i,s){if(1&i){const o=e.RV6();e.j41(0,"app-agencies-searchbar",17),e.bIt("textUpdated",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onSearchTextUpdated(n))})("selectedAgency",function(n){e.eBV(o);const a=e.XpG();return e.Njj(a.onSelectAgency(n))}),e.k0s()}}function C(i,s){if(1&i&&e.nrm(0,"img",20),2&i){const o=e.XpG(2);e.Y8G("src",o.selectedAgency.photoUrl,e.B4B)}}function x(i,s){1&i&&e.nrm(0,"img",21)}function b(i,s){if(1&i&&(e.j41(0,"span",25),e.EFF(1),e.k0s()),2&i){const o=e.XpG(2);e.R7$(),e.E5c(" ",o.selectedAgency.city,",",o.selectedAgency.province," / ",o.selectedAgency.country,"")}}function k(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",15)(1,"div",18)(2,"div",19),e.DNE(3,C,1,1,"img",20)(4,x,1,0,"img",21),e.k0s(),e.j41(5,"div",22)(6,"div",23)(7,"span",24),e.EFF(8),e.k0s(),e.DNE(9,b,2,3,"span",25),e.k0s(),e.j41(10,"div",26),e.EFF(11),e.k0s()()(),e.j41(12,"div",27)(13,"button",28),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.onInvite())}),e.nrm(14,"i",29),e.EFF(15," Invitar "),e.k0s()()()}if(2&i){const o=e.XpG();e.R7$(3),e.vxM(o.selectedAgency.photoUrl?3:4),e.R7$(5),e.JRh(null==o.selectedAgency?null:o.selectedAgency.name),e.R7$(),e.vxM(o.selectedAgency.city&&o.selectedAgency.province&&o.selectedAgency.country?9:-1),e.R7$(2),e.SpI(" ",null==o.selectedAgency?null:o.selectedAgency.email," ")}}function I(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",32)(1,"app-card-promotion",33),e.bIt("togglePromotionCheckbox",function(){e.eBV(o);const n=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.togglePromotionCheckbox(n))}),e.k0s()()}if(2&i){const o=e.XpG().$implicit,t=e.XpG(2);e.R7$(),e.Y8G("promotion",o)("hideCheckbox",(null==o?null:o.invitedApproved)||(null==o?null:o.invitedPending)||!o.checked&&(null==t.options?null:t.options.maxPromotionsSelected)&&t.selectedPromotions.length>=(null==t.options?null:t.options.maxPromotionsSelected))}}function P(i,s){if(1&i&&e.DNE(0,I,2,2,"div",32),2&i){const o=s.$implicit;e.vxM(null!=o&&o.invitedApproved?-1:0)}}function E(i,s){if(1&i){const o=e.RV6();e.j41(0,"div",32)(1,"app-card-promotion",33),e.bIt("togglePromotionCheckbox",function(){e.eBV(o);const n=e.XpG().$implicit,a=e.XpG(2);return e.Njj(a.togglePromotionCheckbox(n))}),e.k0s()()}if(2&i){const o=e.XpG().$implicit;e.R7$(),e.Y8G("promotion",o)("hideCheckbox",(null==o?null:o.invitedApproved)||(null==o?null:o.invitedPending))}}function T(i,s){if(1&i&&e.DNE(0,E,2,2,"div",32),2&i){const o=s.$implicit;e.vxM(null!=o&&o.invitedApproved?0:-1)}}function M(i,s){if(1&i&&(e.j41(0,"div",30),e.EFF(1," \xbfA qu\xe9 promociones quieres invitar? "),e.k0s(),e.j41(2,"div",16)(3,"div",31),e.Z7z(4,P,1,1,null,null,e.fX1),e.k0s()(),e.j41(6,"div",30),e.EFF(7," Promociones ya invitadas "),e.k0s(),e.j41(8,"div",16)(9,"div",31),e.Z7z(10,T,1,1,null,null,e.fX1),e.k0s()()),2&i){const o=e.XpG();e.R7$(4),e.Dyx(o.promotions),e.R7$(6),e.Dyx(o.promotions)}}function F(i,s){1&i&&(e.j41(0,"div",16),e.nrm(1,"app-card-promotion",34)(2,"app-card-promotion",34)(3,"app-card-promotion",34),e.k0s()),2&i&&(e.R7$(),e.Y8G("isSmall",!0)("isSkeleton",!0),e.R7$(),e.Y8G("isSmall",!0)("isSkeleton",!0),e.R7$(),e.Y8G("isSmall",!0)("isSkeleton",!0))}function j(i,s){1&i&&(e.j41(0,"div",35)(1,"div",36),e.EFF(2," Encuentra r\xe1pidamente con qui\xe9n colaborar usando nuestro buscador, o invita a una nueva empresa a unirse a Byvaro introduciendo su correo electr\xf3nico. \xa1R\xe1pido y sencillo! "),e.k0s(),e.j41(3,"div",37),e.nrm(4,"img",38),e.k0s()(),e.j41(5,"div",37),e.nrm(6,"img",39),e.k0s())}let D=(()=>{var i;class s{constructor(t,n,a){this.modalCtrl=t,this.api=n,this.toastService=a,this.promotions=[],this.selectedAgency=null,this.agencyFullData=null,this.selectedPromotions=[],this.isLoading=!1,this.searchEmail="",this.filters=null,this.sort=null,this.pagination={page:0,itemsPerPage:300}}ngOnInit(){var t=this;return(0,m.A)(function*(){t.agencyCardOpen&&(t.selectedAgency=t.agencyCardOpen),yield t.getData(),yield t.getAgency()})()}getData(){var t=this;return(0,m.A)(function*(){t.isLoading=!0;const n=yield t.getPromotions();t.promotions=n,t.isLoading=!1})()}getPromotions(){var t=this;return(0,m.A)(function*(){var n;const a=yield t.api.getPromotions({promotionPaymentInfoIsCompleted:{equals:!0}},t.sort,t.pagination,{properties:{apply:!0,filter:{availabilityStatus:{equals:"available"}},onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},agencyInvitationToPromotions:{apply:!0,filter:null,onlyCount:!1}});return(null==a||null===(n=a.success)||void 0===n?void 0:n.data)||[]})()}getAgency(){var t=this;return(0,m.A)(function*(){var n,a,l;const g=(null===(n=t.agencyCardOpen)||void 0===n?void 0:n.id)||(null===(a=t.selectedAgency)||void 0===a?void 0:a.id);if(!g)return;const u=yield t.api.getAgency({id:{equals:g}},t.sort,t.pagination,{agencyInvitationToPromotions:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1}});[t.agencyFullData]=(null==u||null===(l=u.success)||void 0===l?void 0:l.data)||[],t.promotions=t.promotions.map(r=>{for(let c=0;c<t.agencyFullData.agencyInvitationToPromotions.length;c++){const d=t.agencyFullData.agencyInvitationToPromotions[c];if("pending"===d.status&&r.agencyInvitationToPromotions.find(_=>_.id===d.id)&&new Date(d.createdAt).getTime()+6048e5>(new Date).getTime())return{...r,invitedPending:!0}}for(let c=0;c<t.agencyFullData.promotions.length;c++)if(t.agencyFullData.promotions[c].id===r.id)return{...r,invitedApproved:!0};return r})})()}onSelectAgency(t){var n=this;return(0,m.A)(function*(){n.selectedAgency=t,n.selectedPromotions=[],n.promotions=yield n.getPromotions();let a=[];n.promotions.forEach(l=>{n.getCheckHasAvailableProperty(l)&&a.push(l)}),n.promotions=a,n.getAgency()})()}getCheckHasAvailableProperty(t){var n;let a=!1;return null==t||null===(n=t.properties)||void 0===n||n.forEach(l=>{"available"===l.availabilityStatus&&(a=!0)}),a}onSearchTextUpdated(t){this.searchEmail=t}togglePromotionCheckbox(t){this.selectedPromotions.find(n=>n.id===t.id)?(this.selectedPromotions=this.selectedPromotions.filter(n=>n.id!==t.id),this.promotions=this.promotions.map(n=>n.id===t.id?{...n,checked:!1}:n)):(this.selectedPromotions.push(t),this.promotions=this.promotions.map(n=>n.id===t.id?{...n,checked:!0}:n))}onInvite(){var t=this;return(0,m.A)(function*(){var n;if(!t.selectedPromotions||0===t.selectedPromotions.length)return void t.toastService.showToast({text:"No hay promociones seleccionadas",theme:"red",icon:"fas fa-exclamation-triangle",time:2e3});let a={type:"register",agencyEmail:t.searchEmail,agencyId:null,status:"pending"};if(console.log("this.selectedAgency",t.selectedAgency),null!==(n=t.selectedAgency)&&void 0!==n&&n.id)a.type="approve",a.agencyEmail=t.selectedAgency.email,a.agencyId=t.selectedAgency.id;else{var l;if(!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(t.searchEmail))return void t.toastService.showToast({text:"El email no es v\xe1lido",theme:"red",icon:"fas fa-exclamation-triangle",time:2e3});const _=yield t.api.existsUserWithEmail(t.searchEmail);if(null==_||null===(l=_.success)||void 0===l?void 0:l.data)return void t.toastService.showToast({text:"El email ya est\xe1 registrado",theme:"red",icon:"fas fa-exclamation-triangle",time:2e3})}const u=(yield t.api.createAgencyInvitationToPromotions(a)).success.data,r=t.selectedPromotions.map(d=>d.id);yield t.api.addPromotionsToAgencyInvitationToPromotions(r,u.id),t.toastService.showToast({text:"La agencia ha sido invitada",theme:"success",time:2e3}),t.onClose()})()}onClose(){this.modalCtrl.dismiss({reload:!0,selectedPromotions:this.selectedPromotions,selectedAgency:this.selectedAgency,searchEmail:this.searchEmail})}}return(i=s).\u0275fac=function(t){return new(t||i)(e.rXU(y.W3),e.rXU(h.i),e.rXU(f.f))},i.\u0275cmp=e.VBU({type:i,selectors:[["app-invite-agency-modal"]],inputs:{agencyCardOpen:"agencyCardOpen",options:"options"},decls:21,vars:3,consts:[[1,"modal-box","pb-80"],[1,"modal-body","mx-40","my-40","bg-white"],[1,"crm-header-icon","p-0","pb-24"],[1,"crm-header-icon-left"],[1,"crm-square-icon"],[1,"fas","fa-bell"],[1,"crm-header-icon-title"],[1,"crm-header-icon-right"],[1,"crm-vertical-separator"],[1,"crm-button-icon-solo",3,"click"],[1,"fas","fa-close"],[1,"modal-body-content","p-0","pt-24"],[1,"crm-section","p-0"],[1,"crm-section-light-text"],[3,"textUpdated","selectedAgency",4,"ngIf"],[1,"crm-item-associated-user",2,"background","#F9F9F9"],[1,"crm-section-block-rows"],[3,"textUpdated","selectedAgency"],[1,"crm-item-associated-user-left"],[1,"crm-item-associated-user-left-image"],["alt","",3,"src"],["src","assets/images/building.png","alt",""],[1,"crm-item-associated-user-left-info"],[1,"crm-item-associated-user-left-info-name"],[1,"text-16","text-black"],[1,"ml-5","text-16","text-secondary"],[1,"crm-item-associated-user-left-info-email"],[1,"crm-item-associated-user-right"],[1,"crm-button",3,"click"],[1,"fas","fa-plus","text-white"],[1,"crm-section-title","crm-section-margin-top","text-black","text-18"],[2,"display","flex","align-items","flex-start","flex-wrap","wrap","gap","20px"],[1,"ml-5"],["context","invite-agency",3,"togglePromotionCheckbox","promotion","hideCheckbox"],[3,"isSmall","isSkeleton"],[1,"h-[400px]","py-[100px]","px-[150px]"],[1,"text-[18px]","text-center","text-black"],[1,"text-center","mt-[40px]"],["src","assets/icon/logos-group-icon.svg","alt",""],["src","assets/icon/byvaro-logo.svg","alt",""]],template:function(t,n){1&t&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),e.nrm(5,"i",5),e.k0s(),e.j41(6,"div",6),e.EFF(7," Invitar colaboradores "),e.k0s()(),e.j41(8,"div",7),e.nrm(9,"div",8),e.j41(10,"button",9),e.bIt("click",function(){return n.onClose()}),e.nrm(11,"i",10),e.k0s()()(),e.j41(12,"div",11)(13,"div",12)(14,"div",13),e.EFF(15," Elige el colaborador con el que deseas trabajar y comp\xe1rteles tus promociones de forma directa y segura. "),e.k0s(),e.DNE(16,A,1,0,"app-agencies-searchbar",14)(17,k,16,4,"div",15)(18,M,12,0)(19,F,4,6,"div",16)(20,j,7,0),e.k0s()()()()),2&t&&(e.R7$(16),e.Y8G("ngIf",!n.agencyCardOpen),e.R7$(),e.vxM(n.selectedAgency?17:-1),e.R7$(),e.vxM(n.selectedAgency?18:n.isLoading?19:20))}}),s})()}}]);