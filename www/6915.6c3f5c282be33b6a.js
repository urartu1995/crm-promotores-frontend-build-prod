"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6915],{1129:(B,S,p)=>{p.d(S,{Z:()=>b});var v=p(3953),e=p(6069),u=p(1982);function y(t,k){if(1&t){const j=v.RV6();v.j41(0,"app-country-selector-popover",4),v.bIt("countrySelected",function(x){v.eBV(j);const V=v.XpG();return v.Njj(V.selectCountry(x))})("closePopover",function(){v.eBV(j);const x=v.XpG();return v.Njj(x.dropdownOpen=!1)}),v.k0s()}2&t&&v.Y8G("showCountryCode",!0)}let b=(()=>{var t;class k{constructor(){this.emitCountrySelected=new v.bkB,this.countries=e.X,this.selectedCountry=e.X[0],this.dropdownOpen=!1}ngOnChanges(){const g=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);g!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(g)}toggleDropdown(g){g.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(g){g.event.stopPropagation(),this.selectedCountry=g.country,this.emitCountrySelected.emit(g.country),this.dropdownOpen=!1}selectCountryByPhoneCode(g){const x=this.countries.find(V=>V.phoneCode===g);x&&(this.selectedCountry=x,this.emitCountrySelected.emit(x))}extractCountryPhoneCodeFromPhoneNumber(g){return null==g?void 0:g.split(" ")[0]}}return(t=k).\u0275fac=function(g){return new(g||t)},t.\u0275cmp=v.VBU({type:t,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[v.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(g,x){1&g&&(v.j41(0,"div",0),v.bIt("click",function(A){return x.toggleDropdown(A)}),v.j41(1,"div",1),v.nrm(2,"span")(3,"i",2),v.k0s(),v.DNE(4,y,1,1,"app-country-selector-popover",3),v.k0s()),2&g&&(v.R7$(2),v.HbH(null==x.selectedCountry?null:x.selectedCountry.flagClass),v.R7$(2),v.vxM(x.dropdownOpen?4:-1))},dependencies:[u.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),k})()},6812:(B,S,p)=>{p.d(S,{u:()=>b});var v=p(177),e=p(9417),u=p(7754),y=p(3953);let b=(()=>{var t;class k{}return(t=k).\u0275fac=function(g){return new(g||t)},t.\u0275mod=y.$C({type:t}),t.\u0275inj=y.G2t({imports:[v.MD,e.YN,u.X]}),k})()},2306:(B,S,p)=>{p.d(S,{T:()=>y});var v=p(177),e=p(9417),u=p(3953);let y=(()=>{var b;class t{}return(b=t).\u0275fac=function(j){return new(j||b)},b.\u0275mod=u.$C({type:b}),b.\u0275inj=u.G2t({imports:[v.MD,e.YN]}),t})()},7754:(B,S,p)=>{p.d(S,{X:()=>b});var v=p(177),e=p(9417),u=p(9465),y=p(3953);let b=(()=>{var t;class k{}return(t=k).\u0275fac=function(g){return new(g||t)},t.\u0275mod=y.$C({type:t}),t.\u0275inj=y.G2t({imports:[v.MD,e.YN,u.bv]}),k})()},7700:(B,S,p)=>{p.d(S,{K:()=>ye});var v=p(467),e=p(3953),u=p(9417),y=p(6906),b=p(2081),t=p(6552),k=p(9710),j=p(8397),g=p(177),x=p(7376),V=p(9465),A=p(1129),U=p(4035);const I=s=>({"crm-input-input-error":s}),w=s=>({"text-error-important":s});function z(s,_){if(1&s&&(e.j41(0,"div",4),e.nrm(1,"input",40),e.k0s()),2&s){const d=e.XpG();e.Y8G("ngClass",e.eq3(1,I,d.isControlInvalid("email")))}}function W(s,_){if(1&s){const d=e.RV6();e.j41(0,"div",5)(1,"app-contacts-searchbar",41),e.bIt("changeInput",function(o){e.eBV(d);const r=e.XpG();return e.Njj(r.onChangeEmail(o))})("contactSelected",function(o){e.eBV(d);const r=e.XpG();return e.Njj(r.onSelectContact(o))}),e.k0s()()}if(2&s){const d=e.XpG();e.Y8G("ngClass",e.eq3(2,I,d.isControlInvalid("email"))),e.R7$(),e.Y8G("searchTerm",d.emailValue)}}function K(s,_){1&s&&(e.j41(0,"div",42),e.EFF(1," Por favor, introduce un correo electr\xf3nico v\xe1lido "),e.k0s())}function L(s,_){if(1&s&&(e.j41(0,"option",45),e.EFF(1),e.k0s()),2&s){const d=_.$implicit;e.FS9("value",d.key),e.R7$(),e.JRh(d.label)}}function q(s,_){if(1&s&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," Role "),e.k0s(),e.j41(3,"div",15)(4,"select",43)(5,"option",44),e.EFF(6,"Selecciona un origen"),e.k0s(),e.Z7z(7,L,2,2,"option",45,e.fX1),e.k0s()()()),2&s){const d=e.XpG();e.R7$(5),e.Y8G("value",null),e.R7$(2),e.Dyx(d.responsibilityOptions)}}function X(s,_){1&s&&(e.j41(0,"div",42),e.EFF(1," El nombre es requerido "),e.k0s())}function J(s,_){1&s&&(e.j41(0,"div",42),e.EFF(1," La fecha de nacimiento es requerida "),e.k0s())}function H(s,_){1&s&&(e.j41(0,"div",42),e.EFF(1," Error "),e.k0s())}function Q(s,_){if(1&s&&(e.j41(0,"div",8)(1,"div",3),e.EFF(2," \xbfQue porcentaje compra el comprador? "),e.k0s(),e.j41(3,"div",4),e.nrm(4,"input",46),e.k0s(),e.DNE(5,H,2,0,"div",6),e.k0s()),2&s){const d=e.XpG();e.R7$(3),e.Y8G("ngClass",e.eq3(2,I,d.isControlInvalid("participationPercentage"))),e.R7$(2),e.Y8G("ngIf",d.isControlInvalid("participationPercentage"))}}function Z(s,_){1&s&&(e.j41(0,"div",42),e.EFF(1," La direcci\xf3n es obligatoria "),e.k0s())}function Y(s,_){1&s&&(e.j41(0,"div",42),e.EFF(1," El DNI o Pasaporte es requerido "),e.k0s())}function ee(s,_){1&s&&(e.j41(0,"div",42),e.EFF(1," El n\xfamero de tel\xe9fono es requerido "),e.k0s())}function te(s,_){1&s&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",47),e.j41(2,"div",22),e.EFF(3," Gananciales "),e.k0s()(),e.j41(4,"div",23),e.nrm(5,"ion-radio",48),e.j41(6,"div",22),e.EFF(7," Separacion de bienes "),e.k0s()())}function ne(s,_){1&s&&(e.j41(0,"div",10),e.nrm(1,"ion-radio",49),e.j41(2,"div",22),e.EFF(3," Soltero/a "),e.k0s()(),e.j41(4,"div",23),e.nrm(5,"ion-radio",50),e.j41(6,"div",22),e.EFF(7," Separado/a "),e.k0s()(),e.j41(8,"div",23),e.nrm(9,"ion-radio",51),e.j41(10,"div",22),e.EFF(11," Divorciado/a "),e.k0s()(),e.j41(12,"div",23),e.nrm(13,"ion-radio",52),e.j41(14,"div",22),e.EFF(15," Viudo/a "),e.k0s()(),e.j41(16,"div",23),e.nrm(17,"ion-radio",53),e.j41(18,"div",22),e.EFF(19," Pareja de hecho "),e.k0s()())}let oe=(()=>{var s;class _{constructor(){this.emailValue=null,this.responsibilityOptions=y.Rl;const n=new Date,o=n.getFullYear()-18,r=String(n.getMonth()+1).padStart(2,"0"),i=String(n.getDate()).padStart(2,"0");this.maxBirthDate=`${o}-${r}-${i}`}ngOnInit(){}ngAfterViewInit(){console.log(324324,this.form.value),setTimeout(()=>{var n;this.emailValue=null===(n=this.form.get("email"))||void 0===n?void 0:n.value},1e3)}isControlInvalid(n){const o=this.form.get(n);return!(!o||!o.invalid||!o.dirty&&!o.touched)}onSelectCountry(n){}onNextStep(){}onChangeEmail(n){this.form.patchValue({email:n})}isValidEmail(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}onSelectContact(n){n=x.cloneDeep(n),this.emailValue=n.emails[0],this.form.patchValue({email:n.emails[0]}),this.form.patchValue({name:n.name}),this.form.patchValue({gender:n.gender}),this.form.patchValue({civilStatus:n.civilStatus}),this.form.patchValue({identityNumber:n.dniPassport}),this.form.patchValue({birthDate:n.birthdate}),this.form.patchValue({identityType:n.typeOfIdentification}),this.form.patchValue({alreadySaved:!1}),this.form.patchValue(n.phones.length?{phoneNumber:n.phones[0]}:{phoneNumber:""}),this.form.patchValue({id:n.id})}onChangeMaritalType(n){var o;null===(o=this.form.get("civilType"))||void 0===o||o.setValue(n)}}return(s=_).\u0275fac=function(n){return new(n||s)},s.\u0275cmp=e.VBU({type:s,selectors:[["app-person-form"]],inputs:{form:"form",hasParentContact:"hasParentContact"},decls:97,vars:29,consts:[["addressInput",""],[3,"ngSubmit","formGroup"],[1,"crm-input",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],[1,"",3,"ngClass"],["class","crm-input-error",4,"ngIf"],[1,"crm-text","small","light","mb-15"],[1,"crm-input","mb-15"],["formControlName","gender",1,"d-flex","gap-16"],[1,"crm-input-radio"],["value","male"],[1,"crm-input-radio-label"],["value","female"],["type","text","placeholder","ex: Juan","formControlName","name"],[1,"crm-input-input"],["type","date","formControlName","birthDate"],[1,"crm-input",2,"margin-bottom","16px"],["type","text","formControlName","address","placeholder","Escribe la direcci\xf3n"],[1,"crm-input-label",3,"ngClass"],["formControlName","identityType",1,"gap-16"],["value","dni"],[1,"crm-input-radio-label","text-secondary"],[1,"crm-input-radio","mt-10"],["value","nif"],["value","nie"],["value","passport"],["value","identityCard"],[1,"crm-input-input","mt-10",3,"ngClass"],["type","text","placeholder","ex: 48500285A","formControlName","identityNumber"],[1,"crm-input"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected","selectedPhoneNumber"],["type","text","placeholder","N\xfamero de tel\xe9fono","formControlName","phoneNumber"],[1,"crm-text","small","light",2,"margin-bottom","8px"],["formControlName","civilType",1,"d-flex","gap-16"],[1,"crm-input-radio",3,"click"],["value","married"],["value","other"],["formControlName","civilStatus",1,"gap-16"],["type","text","placeholder","Field","formControlName","email"],[3,"changeInput","contactSelected","searchTerm"],[1,"crm-input-error"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],["type","number","formControlName","participationPercentage","placeholder","%"],["value","communityProperty"],["value","separateProperty"],["value","single"],["value","separated"],["value","divorced"],["value","widowed"],["value","civilUnion"]],template:function(n,o){if(1&n){const r=e.RV6();e.j41(0,"form",1),e.bIt("ngSubmit",function(){return e.eBV(r),e.Njj(o.onNextStep())}),e.j41(1,"div",2)(2,"div",3),e.EFF(3),e.k0s(),e.DNE(4,z,2,3,"div",4)(5,W,2,4,"div",5)(6,K,2,0,"div",6),e.k0s(),e.j41(7,"div",7),e.EFF(8," Por favor, compruebe que la direcci\xf3n de correo electr\xf3nico ingresada es correcta. "),e.k0s(),e.DNE(9,q,9,1,"div",8),e.j41(10,"div",8)(11,"ion-radio-group",9)(12,"div",10),e.nrm(13,"ion-radio",11),e.j41(14,"div",12),e.EFF(15," Don "),e.k0s()(),e.j41(16,"div",10),e.nrm(17,"ion-radio",13),e.j41(18,"div",12),e.EFF(19," Do\xf1a "),e.k0s()()()(),e.j41(20,"div",8)(21,"div",3),e.EFF(22," Nombre y apellidos "),e.k0s(),e.j41(23,"div",4),e.nrm(24,"input",14),e.k0s(),e.DNE(25,X,2,0,"div",6),e.k0s(),e.j41(26,"div",8)(27,"div",3),e.EFF(28," Fecha de nacimiento "),e.k0s(),e.j41(29,"div",15),e.nrm(30,"input",16),e.k0s(),e.DNE(31,J,2,0,"div",6),e.k0s(),e.DNE(32,Q,6,4,"div",8),e.j41(33,"div",17)(34,"div",3),e.EFF(35," Direcci\xf3n "),e.k0s(),e.j41(36,"div",4),e.nrm(37,"input",18,0),e.k0s(),e.DNE(39,Z,2,0,"div",6),e.k0s(),e.j41(40,"div",8)(41,"div",19),e.EFF(42," Identificaci\xf3n "),e.k0s(),e.j41(43,"ion-radio-group",20)(44,"div",10),e.nrm(45,"ion-radio",21),e.j41(46,"div",22),e.EFF(47," DNI "),e.k0s()(),e.j41(48,"div",23),e.nrm(49,"ion-radio",24),e.j41(50,"div",22),e.EFF(51," NIF "),e.k0s()(),e.j41(52,"div",23),e.nrm(53,"ion-radio",25),e.j41(54,"div",22),e.EFF(55," NIE "),e.k0s()(),e.j41(56,"div",23),e.nrm(57,"ion-radio",26),e.j41(58,"div",22),e.EFF(59," Pasaporte "),e.k0s()(),e.j41(60,"div",23),e.nrm(61,"ion-radio",27),e.j41(62,"div",22),e.EFF(63," Carta de identidad "),e.k0s()()(),e.j41(64,"div",28),e.nrm(65,"input",29),e.k0s(),e.DNE(66,Y,2,0,"div",6),e.k0s(),e.j41(67,"div",30)(68,"div",3),e.EFF(69," Phone number "),e.k0s(),e.j41(70,"div",31)(71,"div",4)(72,"app-flag-country-selector",32),e.bIt("emitCountrySelected",function(a){return e.eBV(r),e.Njj(o.onSelectCountry(a))}),e.k0s(),e.nrm(73,"input",33),e.k0s()(),e.DNE(74,ee,2,0,"div",6),e.j41(75,"div",34),e.EFF(76," Por favor, compruebe que el n\xfamero de tel\xe9fono m\xf3vil ingresado es correcto. Ser\xe1 utilizado para la firma electr\xf3nica."),e.nrm(77,"br")(78,"br"),e.k0s()(),e.j41(79,"div",8)(80,"div",3),e.EFF(81," Estado civil "),e.k0s(),e.j41(82,"ion-radio-group",35)(83,"div",36),e.bIt("click",function(){return e.eBV(r),e.Njj(o.onChangeMaritalType("married"))}),e.nrm(84,"ion-radio",37),e.j41(85,"div",12),e.EFF(86," Casada "),e.k0s()(),e.j41(87,"div",36),e.bIt("click",function(){return e.eBV(r),e.Njj(o.onChangeMaritalType("other"))}),e.nrm(88,"ion-radio",38),e.j41(89,"div",12),e.EFF(90," Otro "),e.k0s()()()(),e.j41(91,"div",17)(92,"div",3),e.EFF(93," Seleccionar "),e.k0s(),e.j41(94,"ion-radio-group",39),e.DNE(95,te,8,0)(96,ne,20,0),e.k0s()()()}if(2&n){let r,i,a,l;e.Y8G("formGroup",o.form),e.R7$(3),e.SpI(" Correo electr\xf3nico ",null==(r=o.form.get("alreadySaved"))?null:r.value," "),e.R7$(),e.vxM(null!=(i=o.form.get("id"))&&i.value&&null!=(i=o.form.get("alreadySaved"))&&i.value?4:5),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("email")),e.R7$(3),e.vxM(o.hasParentContact?9:-1),e.R7$(14),e.Y8G("ngClass",e.eq3(19,I,o.isControlInvalid("name"))),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("name")),e.R7$(5),e.BMQ("max",o.maxBirthDate),e.R7$(),e.Y8G("ngIf",o.isControlInvalid("birthDate")),e.R7$(),e.vxM(o.hasParentContact?-1:32),e.R7$(4),e.Y8G("ngClass",e.eq3(21,I,o.isControlInvalid("address"))),e.R7$(3),e.Y8G("ngIf",o.isControlInvalid("address")),e.R7$(2),e.Y8G("ngClass",e.eq3(23,w,o.isControlInvalid("identityType"))),e.R7$(23),e.Y8G("ngClass",e.eq3(25,I,o.isControlInvalid("identityNumber"))),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("identityNumber")),e.R7$(5),e.Y8G("ngClass",e.eq3(27,I,o.isControlInvalid("phoneNumber"))),e.R7$(),e.Y8G("selectedPhoneNumber",null==(a=o.form.get("phoneNumber"))?null:a.value),e.R7$(2),e.Y8G("ngIf",o.isControlInvalid("phoneNumber")),e.R7$(21),e.vxM("married"===(null==(l=o.form.get("civilType"))?null:l.value)?95:96)}},dependencies:[g.YU,g.bT,u.qT,u.xH,u.y7,u.me,u.Q0,u.wz,u.BC,u.cb,V.KO,V.f0,V.Je,u.j4,u.JD,A.Z,U.y]}),_})();const ie=["addressInput"],$=s=>({"background-color":s}),E=s=>({"crm-input-input-error":s});function re(s,_){if(1&s&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&s){let d;const n=e.XpG(2).$implicit;e.R7$(),e.JRh(null==(d=n.get("name"))?null:d.value)}}function ae(s,_){1&s&&e.nrm(0,"img",5),2&s&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function le(s,_){1&s&&e.nrm(0,"img",5),2&s&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function se(s,_){if(1&s){const d=e.RV6();e.j41(0,"div"),e.nrm(1,"app-person-form",18),e.j41(2,"div",19)(3,"button",20),e.bIt("click",function(){e.eBV(d);const o=e.XpG(2).index,r=e.XpG();return e.Njj(r.onSaveContact(o))}),e.EFF(4," Guardar "),e.k0s(),e.j41(5,"div",21)(6,"div",22)(7,"div",23),e.bIt("click",function(){e.eBV(d);const o=e.XpG(2).index,r=e.XpG();return e.Njj(r.removePerson(o))}),e.nrm(8,"img",24),e.j41(9,"span",25),e.EFF(10,"Eliminar"),e.k0s()()()()()()}if(2&s){const d=e.XpG(2).index,n=e.XpG();e.R7$(),e.Y8G("hasParentContact",!1)("form",n.getContactForm(d)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function ce(s,_){if(1&s){const d=e.RV6();e.j41(0,"div",13)(1,"div",14)(2,"div"),e.EFF(3),e.k0s(),e.DNE(4,re,2,1,"div",15),e.k0s(),e.j41(5,"div",16),e.bIt("click",function(){e.eBV(d);const o=e.XpG().index,r=e.XpG();return e.Njj(r.togglePersonForm(o))}),e.DNE(6,ae,1,1,"img",5)(7,le,1,1,"img",5),e.k0s()(),e.DNE(8,se,11,3,"div",17)}if(2&s){let d,n,o;const r=e.XpG(),i=r.$implicit,a=r.index;e.R7$(3),e.SpI(" Comprador ",a+1,""),e.R7$(),e.vxM(null!=(d=i.get("showForm"))&&d.value?-1:4),e.R7$(2),e.vxM(null!=(n=i.get("showForm"))&&n.value?6:7),e.R7$(2),e.Y8G("ngIf",null==(o=i.get("showForm"))?null:o.value)}}function de(s,_){if(1&s&&(e.j41(0,"option",46),e.EFF(1),e.k0s()),2&s){const d=_.$implicit;e.FS9("value",d.key),e.R7$(),e.JRh(d.label)}}function pe(s,_){if(1&s&&(e.j41(0,"div",41)(1,"div",42)(2,"div",30),e.EFF(3," Role "),e.k0s(),e.j41(4,"div",43)(5,"select",44)(6,"option",45),e.EFF(7,"Selecciona un origen"),e.k0s(),e.Z7z(8,de,2,2,"option",46,e.fX1),e.k0s()()()()),2&s){const d=e.XpG().index,n=e.XpG(3).index,o=e.XpG();e.Y8G("formGroup",o.getCompanyPersonForm(n,d)),e.R7$(6),e.Y8G("value",null),e.R7$(2),e.Dyx(o.responsibilityOptions)}}function ue(s,_){if(1&s&&(e.j41(0,"div",15),e.EFF(1),e.k0s()),2&s){let d;const n=e.XpG(2).index,o=e.XpG(3).index,r=e.XpG();e.R7$(),e.JRh(null==(d=r.getCompanyPersonForm(o,n).get("name"))?null:d.value)}}function me(s,_){if(1&s){const d=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(d);const o=e.XpG(2).index,r=e.XpG(3).index,i=e.XpG();return e.Njj(i.toggleCompanyPersonForm(r,o))}),e.k0s()}2&s&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function ve(s,_){if(1&s){const d=e.RV6();e.j41(0,"img",50),e.bIt("click",function(){e.eBV(d);const o=e.XpG(2).index,r=e.XpG(3).index,i=e.XpG();return e.Njj(i.toggleCompanyPersonForm(r,o))}),e.k0s()}2&s&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function je(s,_){if(1&s){const d=e.RV6();e.nrm(0,"app-person-form",18),e.j41(1,"div",19)(2,"button",51),e.bIt("click",function(){e.eBV(d);const o=e.XpG(2).index,r=e.XpG(3).index,i=e.XpG();return e.Njj(i.onSaveChildContact(r,o))}),e.EFF(3," Guardar "),e.k0s(),e.j41(4,"div",21)(5,"div",22)(6,"div",52),e.bIt("click",function(){e.eBV(d);const o=e.XpG(2).index,r=e.XpG(3).index,i=e.XpG();return e.Njj(i.removePersonFromCompany(r,o))}),e.nrm(7,"img",53),e.j41(8,"span",25),e.EFF(9,"Eliminar"),e.k0s()()()()()}if(2&s){const d=e.XpG(2).index,n=e.XpG(3).index,o=e.XpG();e.Y8G("hasParentContact",!0)("form",o.getCompanyPersonForm(n,d)),e.R7$(7),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function _e(s,_){if(1&s&&(e.j41(0,"div")(1,"div",47)(2,"div")(3,"div"),e.EFF(4),e.k0s(),e.DNE(5,ue,2,1,"div",15),e.k0s(),e.j41(6,"div",48),e.DNE(7,me,1,1,"img",49)(8,ve,1,1,"img",49),e.k0s()(),e.DNE(9,je,10,3),e.k0s()),2&s){let d,n,o,r;const i=e.XpG(),a=i.$implicit,l=i.index,c=e.XpG(3).index,m=e.XpG();e.R7$(4),e.JRh(m.responsibilityOptionsObj[null==(d=m.getCompanyPersonForm(c,l).get("role"))?null:d.value]),e.R7$(),e.vxM(null!=(n=a.get("showForm"))&&n.value?-1:5),e.R7$(2),e.vxM(null!=(o=a.get("showForm"))&&o.value?7:8),e.R7$(2),e.vxM(null!=(r=a.get("showForm"))&&r.value?9:-1)}}function ge(s,_){if(1&s&&(e.j41(0,"div")(1,"div",39),e.DNE(2,pe,10,2,"div",40)(3,_e,10,4,"div",17),e.k0s()()),2&s){let d,n;const o=_.index,r=e.XpG(3).index,i=e.XpG();e.R7$(2),e.Y8G("ngIf",!(null!=(d=i.getCompanyPersonForm(r,o).get("role"))&&d.value)),e.R7$(),e.Y8G("ngIf",null==(n=i.getCompanyPersonForm(r,o).get("role"))?null:n.value)}}function Ce(s,_){if(1&s){const d=e.RV6();e.j41(0,"div")(1,"form",28)(2,"div",13)(3,"div",29)(4,"div",30),e.EFF(5," Nombre de la empresa "),e.k0s(),e.j41(6,"div",31),e.nrm(7,"input",32),e.k0s()(),e.j41(8,"div",33)(9,"div",30),e.EFF(10," Direcci\xf3n "),e.k0s(),e.j41(11,"div",31),e.nrm(12,"input",34),e.k0s()()(),e.j41(13,"div",13)(14,"div",29)(15,"div",30),e.EFF(16," CIF "),e.k0s(),e.j41(17,"div",31),e.nrm(18,"input",35),e.k0s()(),e.j41(19,"div",33)(20,"div",30),e.EFF(21," \xbfQue porcentaje compra el comprador? "),e.k0s(),e.j41(22,"div",31),e.nrm(23,"input",36),e.k0s()()(),e.DNE(24,ge,4,2,"div",37),e.j41(25,"div",38)(26,"button",4),e.bIt("click",function(){e.eBV(d);const o=e.XpG(2).index,r=e.XpG();return e.Njj(r.addPersonToCompany(o))}),e.nrm(27,"img",5),e.EFF(28," A\xf1adir persona responsable "),e.k0s()()()()}if(2&s){let d;const n=e.XpG(2).index,o=e.XpG();e.R7$(),e.Y8G("formGroup",o.getContactForm(n)),e.R7$(5),e.Y8G("ngClass",e.eq3(7,E,o.isControlInvalid(o.getContactForm(n),"name"))),e.R7$(5),e.Y8G("ngClass",e.eq3(9,E,o.isControlInvalid(o.getContactForm(n),"address"))),e.R7$(6),e.Y8G("ngClass",e.eq3(11,E,o.isControlInvalid(o.getContactForm(n),"identityNumber"))),e.R7$(5),e.Y8G("ngClass",e.eq3(13,E,o.isControlInvalid(o.getContactForm(n),"participationPercentage"))),e.R7$(2),e.Y8G("ngForOf",null==(d=o.getPersons(n))?null:d.controls),e.R7$(3),e.Y8G("src","assets/icon/plus-icon.svg",e.B4B)}}function fe(s,_){if(1&s){const d=e.RV6();e.j41(0,"div",13)(1,"div",26),e.EFF(2),e.k0s(),e.j41(3,"div")(4,"img",27),e.bIt("click",function(){e.eBV(d);const o=e.XpG().index,r=e.XpG();return e.Njj(r.removeCompany(o))}),e.k0s()()(),e.DNE(5,Ce,29,15,"div",17)}if(2&s){let d;const n=e.XpG(),o=n.$implicit,r=n.index;e.R7$(2),e.SpI("Comprador ",r+1,""),e.R7$(2),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B),e.R7$(),e.Y8G("ngIf",null==(d=o.get("showForm"))?null:d.value)}}function he(s,_){if(1&s){const d=e.RV6();e.j41(0,"div",9)(1,"div",10)(2,"div",11)(3,"div",12),e.bIt("click",function(){const o=e.eBV(d).index,r=e.XpG();return e.Njj(r.onChangePersonType(o,"particular"))}),e.EFF(4," Persona f\xedsica "),e.k0s(),e.j41(5,"div",12),e.bIt("click",function(){const o=e.eBV(d).index,r=e.XpG();return e.Njj(r.onChangePersonType(o,"empresa"))}),e.EFF(6," Persona jur\xeddica "),e.k0s()()(),e.DNE(7,ce,9,4)(8,fe,6,3),e.k0s()}if(2&s){let d,n,o;const r=_.$implicit;e.R7$(3),e.Y8G("ngStyle",e.eq3(3,$,"particular"===(null==(d=r.get("type"))?null:d.value)?"#ECF2FF":"")),e.R7$(2),e.Y8G("ngStyle",e.eq3(5,$,"empresa"===(null==(n=r.get("type"))?null:n.value)?"#ECF2FF":"")),e.R7$(2),e.vxM("particular"===(null==(o=r.get("type"))?null:o.value)?7:8)}}let ye=(()=>{var s;class _{constructor(n,o,r,i,a,l){this.fb=n,this.ngZone=o,this.api=r,this.utils=i,this.modalsService=a,this.toastService=l,this.selectContactData=new e.bkB,this.screen="reserve",this.mapCenter={lat:40.416775,lng:-3.70379},this.mapZoom=6,this.markerPosition=this.mapCenter,this.mapOptions={disableDefaultUI:!1,styles:[{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]}]},this.markerOptions={draggable:!0},this.disabled=!0,this.showForms=[],this.FormGroup=u.gE,this.responsibilityOptions=y.Rl,this.responsibilityOptionsObj=y.qA;const c=this.createContactForm(!1,"particular");this.contactFormArray=this.fb.array([c])}ngOnInit(){}set contactData(n){this.contact=n,this.contact&&!this.contacts.length&&this.patchContactData(0,this.contact)}set operationData(n){this.operation=n}set reservedContacts(n){if(this.contacts=n,this.contacts.length){const o=this.extractRelatedContactIds(this.contacts);let r=0;this.contacts.forEach(i=>{o.includes(i.id)||(this.patchContactData(r,i,!1),r++)})}}extractRelatedContactIds(n){const o=[];for(const r of n.filter(i=>"empresa"===i.type))for(const i of r.contactsRelation||[])o.push(i.contactRelatedId);return o}patchContactData(n,o,r=!1){var i,a;let l=this.utils.parseBackendDateToFrontendDateInput(null==o?void 0:o.birthdate),c="";null!=o&&o.civilStatus&&(c=["communityProperty","separateProperty"].includes(o.civilStatus)?"married":"other");let m={id:o.id||null,email:(null===(i=o.emails)||void 0===i?void 0:i[0])||"",name:o.name||"",birthDate:l||"",phoneNumber:(null===(a=o.phones)||void 0===a?void 0:a[0])||"+34 ",address:o.address||"",gender:o.gender||"",type:o.type||"particular",role:"sole_administrator",identityType:o.typeOfIdentification||"",identityNumber:o.dniPassport,civilStatus:o.civilStatus,civilType:c,alreadySaved:!0,showForm:!r,formId:n},C=this.getContactForm(n);if(r){let h=this.createContactForm(r,"particular");h.patchValue(m),C.get("persons").push(h)}else{var f;null!==(f=this.operation)&&void 0!==f&&f.buyersContactsPercentages&&this.operation.buyersContactsPercentages[o.id]&&(m.participationPercentage=Number(this.operation.buyersContactsPercentages[o.id].percentage)),C?(C.patchValue(m),C.patchValue({participationPercentage:m.participationPercentage})):(C=this.createContactForm(r,m.type),C.patchValue(m))}if(this.contactFormArray.setControl(n,C),"empresa"===o.type)for(const h of o.contactsRelation||[]){const P=this.contacts.find(M=>M.id===h.contactRelatedId);P&&this.patchContactData(n,P,!0)}let F=0;this.contactFormArray.controls.forEach(h=>{var P;F+=null===(P=h.get("participationPercentage"))||void 0===P?void 0:P.value}),this.disabled=100!==F}createContactForm(n=!1,o){var r,i;const a=this.fb.group({type:[o],showForm:[!0],name:[""],email:[""],phoneNumber:["+34 "],birthDate:[""],identityNumber:[""],identityType:[""],address:[""],role:[""],id:[null],parentContact:[null],gender:[""],civilStatus:[""],civilType:[""],participationPercentage:["",[u.k0.min(1),u.k0.max(100)]],formId:[""],alreadySaved:[!1],persons:this.fb.array([])});return this.applyConditionalValidators(n,a,o),null===(r=a.get("type"))||void 0===r||r.valueChanges.subscribe(l=>{this.applyConditionalValidators(n,a,l)}),null===(i=a.get("participationPercentage"))||void 0===i||i.valueChanges.subscribe(l=>{this.onParticipationPercentageChanged(l,a)}),a}onParticipationPercentageChanged(n,o){var r;let i=null===(r=o.get("formId"))||void 0===r?void 0:r.value;const l=100-this.contactFormArray.controls.reduce((f,F)=>{var h;return F.value.formId!==i?f+parseFloat((null===(h=F.get("participationPercentage"))||void 0===h?void 0:h.value)||"0"):f},0);var m;parseFloat(n||"0")>l&&(null===(m=o.get("participationPercentage"))||void 0===m||m.setValue(l,{emitEvent:!1}));const C=this.contactFormArray.controls.reduce((f,F)=>{var h;return f+parseFloat((null===(h=F.get("participationPercentage"))||void 0===h?void 0:h.value)||"0")},0);this.disabled=100!==C}applyConditionalValidators(n=!1,o,r){var i,a,l,c,m,C,f,F,h,P,M,O,T,D,R;if(null===(i=o.get("email"))||void 0===i||i.clearValidators(),null===(a=o.get("phoneNumber"))||void 0===a||a.clearValidators(),null===(l=o.get("birthDate"))||void 0===l||l.clearValidators(),null===(c=o.get("identityNumber"))||void 0===c||c.clearValidators(),null===(m=o.get("address"))||void 0===m||m.clearValidators(),null===(C=o.get("identityType"))||void 0===C||C.clearValidators(),"particular"!==r||n){if("particular"===r&&n){var G,N,Pe,be,Fe;null===(G=o.get("email"))||void 0===G||G.setValidators([u.k0.required,u.k0.email]),null===(N=o.get("phoneNumber"))||void 0===N||N.setValidators([u.k0.required]),null===(Pe=o.get("birthDate"))||void 0===Pe||Pe.setValidators([u.k0.required]),null===(be=o.get("identityNumber"))||void 0===be||be.setValidators([u.k0.required]),null===(Fe=o.get("identityType"))||void 0===Fe||Fe.setValidators([u.k0.required])}else if("empresa"===r){var ke,xe;null===(ke=o.get("cif"))||void 0===ke||ke.setValidators([u.k0.required]),null===(xe=o.get("participationPercentage"))||void 0===xe||xe.setValidators([u.k0.required,u.k0.min(1),u.k0.max(100)])}}else null===(P=o.get("email"))||void 0===P||P.setValidators([u.k0.required,u.k0.email]),null===(M=o.get("phoneNumber"))||void 0===M||M.setValidators([u.k0.required]),null===(O=o.get("birthDate"))||void 0===O||O.setValidators([u.k0.required]),null===(T=o.get("identityNumber"))||void 0===T||T.setValidators([u.k0.required]),null===(D=o.get("identityType"))||void 0===D||D.setValidators([u.k0.required]),null===(R=o.get("participationPercentage"))||void 0===R||R.setValidators([u.k0.required,u.k0.min(1),u.k0.max(100)]);null===(f=o.get("name"))||void 0===f||f.setValidators([u.k0.required]),null===(F=o.get("identityNumber"))||void 0===F||F.setValidators([u.k0.required]),null===(h=o.get("address"))||void 0===h||h.setValidators([u.k0.required])}removeCompany(n){var o=this;return(0,v.A)(function*(){let r=o.getPersons(n),i=o.getContactForm(n),a=!1;if(r.value.forEach(m=>{m.id&&(a=!0)}),i.value.id&&(a=!0),a){let m=yield o.openConfirmationModal();var l,c;if("delete"===(null==m?void 0:m.data))i.value.id&&(yield o.api.unlinkReserveContactToOperation(null===(l=o.operation)||void 0===l?void 0:l.id,i.value.id),yield o.api.unlinkBuyerContactToOperation(null===(c=o.operation)||void 0===c?void 0:c.id,i.value.id)),r.value.forEach(function(){var C=(0,v.A)(function*(f){var F,h,P;f.id&&(yield o.api.unlinkReserveContactToOperation(null===(F=o.operation)||void 0===F?void 0:F.id,f.id),yield o.api.unlinkBuyerContactToOperation(null===(h=o.operation)||void 0===h?void 0:h.id,f.id),i.value.id&&(yield o.api.removeContactRelation(f.id,null===(P=i.value)||void 0===P?void 0:P.id)))});return function(f){return C.apply(this,arguments)}}()),o.contactFormArray.removeAt(n)}else o.contactFormArray.removeAt(n)})()}getContactForm(n){return this.contactFormArray.at(n)}getPersons(n){return this.getContactForm(n).get("persons")}getCompanyPersonForm(n,o){return this.getPersons(n).at(o)}addPersonToCompany(n){this.getPersons(n).push(this.createContactForm(!0,"particular"))}removePersonFromCompany(n,o){var r=this;return(0,v.A)(function*(){let i=r.getCompanyPersonForm(n,o),a=r.getContactForm(n);if(i.value.id&&a.value.id){let C=yield r.openConfirmationModal();var l,c,m;"delete"===(null==C?void 0:C.data)&&(r.getPersons(n).removeAt(o),yield r.api.unlinkReserveContactToOperation(null===(l=r.operation)||void 0===l?void 0:l.id,i.value.id),yield r.api.unlinkBuyerContactToOperation(null===(c=r.operation)||void 0===c?void 0:c.id,i.value.id),yield r.api.removeContactRelation(i.value.id,null===(m=a.value)||void 0===m?void 0:m.id))}else r.getPersons(n).removeAt(o)})()}toggleCompanyPersonForm(n,o){var r;const i=this.getCompanyPersonForm(n,o);i.patchValue({showForm:!(null!==(r=i.get("showForm"))&&void 0!==r&&r.value)})}toggleCompanyForm(n){var o;const r=this.getContactForm(n);r.patchValue({showForm:!(null!==(o=r.get("showForm"))&&void 0!==o&&o.value)})}addNewForm(){this.contactFormArray.push(this.createContactForm(!1,"particular"))}ngAfterViewInit(){this.addressInput&&(this.autocomplete=new google.maps.places.Autocomplete(this.addressInput.nativeElement,{types:["geocode"],componentRestrictions:{country:"es"}}),this.autocomplete.addListener("place_changed",()=>{this.ngZone.run(()=>{const o=this.autocomplete.getPlace();if(!o.geometry)return;this.mapCenter={lat:o.geometry.location.lat(),lng:o.geometry.location.lng()},this.markerPosition=this.mapCenter,this.mapZoom=17;const r=o.formatted_address||o.name||"";this.contactForm.patchValue({address:r}),this.addressInput.nativeElement.value=r})}))}isControlInvalid(n,o){const r=n.get(o);return!(!r||!r.invalid||!r.dirty&&!r.touched)}onSelectCountry(n){console.log("Selected country prefix:",n);const o=null==n?void 0:n.phoneCode,r=this.contactForm.get("phoneNumber");if(!r)return;const a=(r.value||"").split(" ");a.shift();const l=a.join(" ");r.setValue(`${o} ${l}`)}onAddressSelected(n){console.log("Address selected:",n),this.contactForm.patchValue({address:(null==n?void 0:n.formatted_address)||(null==n?void 0:n.address)||""})}getAddressFromCoordinates(n,o){(new google.maps.Geocoder).geocode({location:{lat:n,lng:o}},(i,a)=>{"OK"===a&&i&&i[0]&&this.ngZone.run(()=>{const l=i[0].formatted_address;this.contactForm.patchValue({address:l}),this.addressInput&&(this.addressInput.nativeElement.value=l),this.markerPosition={lat:n,lng:o}})})}onPrevStep(){console.log("Going to previous step...")}onNextStep(){var n=this;return(0,v.A)(function*(){n.contactFormArray.invalid?n.contactFormArray.markAllAsTouched():(n.contactFormArray.controls.forEach((o,r)=>{"particular"===o.value.type?n.onSaveContact(r,!1):"empresa"===o.value.type&&n.getPersons(r).controls.forEach((a,l)=>{n.onSaveChildContact(r,l,!1)})}),n.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3}),n.selectContactData.emit())})()}onChangePersonType(n,o){const r=this.createContactForm(!1,o),i=this.contactFormArray.at(n).value;if("empresa"===o){let a=this.createContactForm(!0,"particular");a.patchValue({id:i.id||null,name:i.name||"",email:i.email||"",address:i.address||"",birthDate:i.birthDate||"",phoneNumber:i.phoneNumber||"+34 ",gender:i.gender||"male",showForm:!0,identityNumber:i.identityNumber,identityType:i.identityType,civilStatus:i.civilStatus}),r.patchValue({name:"",identityNumber:"",showForm:!0,participationPercentage:i.participationPercentage,formId:i.formId||1}),r.get("persons").push(a)}else{let a=i;Array.isArray(i.persons)&&i.persons.length>0&&(a=i.persons[0]),r.patchValue({id:a.id||null,parentContact:i||null,name:a.name||"",participationPercentage:i.participationPercentage,email:a.email||"",address:a.address||"",birthDate:a.birthDate||"",phoneNumber:a.phoneNumber||"+34 ",gender:a.gender||"male",formId:i.formId||1,identityNumber:a.identityNumber,identityType:a.identityType,civilStatus:a.civilStatus})}this.contactFormArray.setControl(n,r)}togglePersonForm(n){var o;const r=this.getContactForm(n);r.patchValue({showForm:!(null!==(o=r.get("showForm"))&&void 0!==o&&o.value)})}openConfirmationModal(){var n=this;return(0,v.A)(function*(){return yield n.modalsService.openConfirmationModal({title:"Eliminar contactos",message:"\xbfEst\xe1s seguro de que deseas eliminar los contactos seleccionados?",icon:"fas fa-trash",iconTheme:"red",buttons:[{text:"Cancelar",theme:"btn-secondary",id:"cancel"},{text:"Eliminar",theme:"btn-red",id:"delete"}]})})()}removePerson(n){var o=this;return(0,v.A)(function*(){const r=o.getContactForm(n);if(r.value.id){let l=yield o.openConfirmationModal();var i,a;"delete"===(null==l?void 0:l.data)&&(yield o.api.unlinkReserveContactToOperation(null===(i=o.operation)||void 0===i?void 0:i.id,r.value.id),yield o.api.unlinkBuyerContactToOperation(null===(a=o.operation)||void 0===a?void 0:a.id,r.value.id),o.contactFormArray.removeAt(n))}else o.contactFormArray.removeAt(n)})()}onSaveChildContact(n,o,r=!0){var i=this;return(0,v.A)(function*(){var a,l,c,m;const C=i.getContactForm(n),f=i.getCompanyPersonForm(n,o);if(C.invalid)return void C.markAllAsTouched();let F=i.buildContactData(C.value),h=i.buildContactData(f.value),P=yield i.saveOrUpdateContact(f.value.id,h),M=yield i.saveOrUpdateContact(C.value.id,F),O=null==M||null===(a=M.success)||void 0===a||null===(a=a.data)||void 0===a?void 0:a.id,T=null==P||null===(l=P.success)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.id;var D,R,G,N;null!==(c=f.value)&&void 0!==c&&c.id&&null!==(m=f.value)&&void 0!==m&&m.alreadySaved||(yield i.api.addReserveContactToOperation(null===(D=i.operation)||void 0===D?void 0:D.id,T)),C.value.id||(yield i.api.addReserveContactToOperation(null===(R=i.operation)||void 0===R?void 0:R.id,O)),"buy"===i.screen&&(yield i.api.addBuyerContactToOperation(null===(G=i.operation)||void 0===G?void 0:G.id,O),yield i.api.addBuyerContactToOperation(null===(N=i.operation)||void 0===N?void 0:N.id,T)),yield i.api.addContactRelation(O,T,f.value.role),yield i.updateBuyersContactsPercentages(O,C.value.participationPercentage),r&&i.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3}),f.patchValue({showForm:!1})})()}onSaveContact(n,o=!0){var r=this;return(0,v.A)(function*(){const i=r.getContactForm(n);if(i.invalid)i.markAllAsTouched();else{if("particular"===i.value.type){var a,l;let M=r.buildContactData(i.value);var c,m,C,f,F;i.value.parentContact&&(yield r.api.unlinkReserveContactToOperation(null===(c=r.operation)||void 0===c?void 0:c.id,null===(m=i.value.parentContact)||void 0===m?void 0:m.id),yield r.api.unlinkBuyerContactToOperation(null===(C=r.operation)||void 0===C?void 0:C.id,null===(f=i.value.parentContact)||void 0===f?void 0:f.id),i.value.id&&(yield r.api.removeContactRelation(i.value.id,null===(F=i.value.parentContact)||void 0===F?void 0:F.id)));let O=yield r.saveOrUpdateContact(i.value.id,M),T=null==O||null===(a=O.success)||void 0===a?void 0:a.data.id;var h;yield r.api.addReserveContactToOperation(null===(l=r.operation)||void 0===l?void 0:l.id,T),"buy"===r.screen&&(yield r.api.addBuyerContactToOperation(null===(h=r.operation)||void 0===h?void 0:h.id,T)),yield r.updateBuyersContactsPercentages(T,i.value.participationPercentage),o&&r.toastService.showToast({text:"Contactos eliminados correctamente",theme:"success",time:3e3})}else if("empresa"===i.value.type){var P;let M={name:i.value.name,type:i.value.type,identityNumber:i.value.identityNumber,address:i.value.address},T=(yield r.saveOrUpdateContact(i.value.id,M)).success.data.id;yield r.api.addReserveContactToOperation(null===(P=r.operation)||void 0===P?void 0:P.id,T)}i.patchValue({showForm:!1})}})()}saveOrUpdateContact(n,o){var r=this;return(0,v.A)(function*(){return n?yield r.api.updateContactById(n,o):yield r.api.createContact(o)})()}updateBuyersContactsPercentages(n,o){var r=this;return(0,v.A)(function*(){var i;let a=r.operation.buyersContactsPercentages;a?a[n]={percentage:o,order:1}:a={[n]:{percentage:o,order:1}},yield r.api.updateOperationById(null===(i=r.operation)||void 0===i?void 0:i.id,{buyersContactsPercentages:a})})()}buildContactData(n){if("particular"===n.type){const o=n.phoneNumber,r=n.email,i=[];o&&!i.includes(o)&&i.unshift(o);const a=[];return r&&!a.includes(r)&&a.unshift(r),{name:n.name,birthdate:new Date(n.birthDate),phones:i,emails:a,address:n.address,gender:n.gender,typeOfIdentification:n.identityType,dniPassport:n.identityNumber,type:n.type,civilStatus:n.civilStatus}}return{name:n.name,address:n.address,dniPassport:n.identityNumber,type:n.type}}}return(s=_).\u0275fac=function(n){return new(n||s)(e.rXU(u.ok),e.rXU(e.SKi),e.rXU(b.i),e.rXU(t.T),e.rXU(k.M),e.rXU(j.f))},s.\u0275cmp=e.VBU({type:s,selectors:[["app-venta-select-contact-data"]],viewQuery:function(n,o){if(1&n&&e.GBs(ie,5),2&n){let r;e.mGM(r=e.lsd())&&(o.addressInput=r.first)}},inputs:{contact:"contact",operationId:"operationId",operation:"operation",screen:"screen",contactData:"contactData",operationData:"operationData",reservedContacts:"reservedContacts"},outputs:{selectContactData:"selectContactData"},decls:12,vars:3,consts:[[1,"venta-component"],[1,"venta-component-body"],["class","content mt-15",4,"ngFor","ngForOf"],[1,"w-full"],["type","button",1,"crm-button-secondary","w-full","d-flex","justify-center","align-center",3,"click"],["alt","",1,"cursor-pointer",3,"src"],[1,"mt-10",2,"display","flex","gap","16px","justify-content","space-between"],["type","button",1,"crm-button-secondary","w-50p","d-block","text-center","border-primary",3,"click"],["type","submit",1,"crm-button","w-50p","d-block","text-center",3,"click","disabled"],[1,"content","mt-15"],[1,"",2,"border","1px solid #E0E0E0","width","100%","padding","6px","border-radius","20px","margin-bottom","16px"],[1,"d-flex","text-14"],[1,"cursor-pointer","w-50p","text-center",2,"padding","6px 10px","border-radius","20px",3,"click","ngStyle"],[1,"d-flex","justify-between"],[1,"title","mb-10"],[1,"text-14","text-secondary","font-weight-400"],[1,"cursor-pointer",3,"click"],[4,"ngIf"],[3,"hasParentContact","form"],[1,"mt-10",2,"gap","16px"],["type","submit",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"w-full","d-block","text-center","text-13","mt-15","text-secondary"],[1,"d-flex","justify-center","align-center"],[1,"d-flex","align-center","cursor-pointer",3,"click"],[2,"width","14px",3,"src"],[1,"ml-5"],[1,"title"],["alt","",1,"cursor-pointer",3,"click","src"],[3,"formGroup"],[1,"crm-input","w-50p",2,"margin-bottom","8px"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","placeholder","Field","formControlName","name"],[1,"crm-input","w-50p","ml-10",2,"margin-bottom","8px"],["type","text","placeholder","Field","formControlName","address"],["type","text","placeholder","Field","formControlName","identityNumber"],["type","number","placeholder","%","formControlName","participationPercentage"],[4,"ngFor","ngForOf"],[1,"w-full","mt-20"],[1,"p-16","mt-10",2,"border","1px solid #EBEBEB","border-radius","12px"],["class","w-full  ",3,"formGroup",4,"ngIf"],[1,"w-full",3,"formGroup"],[1,"crm-input"],[1,"crm-input-input"],["formControlName","role",1,"w-full"],["disabled","","selected","",3,"value"],[3,"value"],[1,"d-flex","justify-between","mb-10"],[1,"d-flex","align-center"],["alt","",1,"cursor-pointer","ml-10",3,"src"],["alt","",1,"cursor-pointer","ml-10",3,"click","src"],["type","button",1,"crm-button","w-full","d-block","text-center",2,"height","30px","padding","0",3,"click"],[1,"cursor-pointer","d-flex","align-center",3,"click"],[1,"cursor-pointer",2,"width","14px",3,"src"]],template:function(n,o){1&n&&(e.j41(0,"div",0)(1,"div",1),e.DNE(2,he,9,7,"div",2),e.j41(3,"div",3)(4,"button",4),e.bIt("click",function(){return o.addNewForm()}),e.nrm(5,"img",5),e.EFF(6," A\xf1adir otro comprador "),e.k0s()()(),e.j41(7,"div",6)(8,"button",7),e.bIt("click",function(){return o.onPrevStep()}),e.EFF(9," Anterior "),e.k0s(),e.j41(10,"button",8),e.bIt("click",function(){return o.onNextStep()}),e.EFF(11," Siguiente "),e.k0s()()()),2&n&&(e.R7$(2),e.Y8G("ngForOf",o.contactFormArray.controls),e.R7$(3),e.Y8G("src","assets/icon/user-plus-icon.svg",e.B4B),e.R7$(5),e.Y8G("disabled",o.disabled))},dependencies:[g.YU,g.Sq,g.bT,g.B3,u.qT,u.xH,u.y7,u.me,u.Q0,u.wz,u.BC,u.cb,u.j4,u.JD,oe],styles:[".venta-component[_ngcontent-%COMP%]{max-width:500px}"]}),_})()},6915:(B,S,p)=>{p.r(S),p.d(S,{VentaOperationProcessPageModule:()=>d});var v=p(177),e=p(9417),u=p(9465),y=p(5188),b=p(467),t=p(3953),k=p(2081),j=p(8397),g=p(6906);function x(n,o){if(1&n){const r=t.RV6();t.j41(0,"button",19),t.bIt("click",function(){t.eBV(r);const a=t.XpG(2).$implicit,l=t.XpG();return t.Njj(l.onSelectPromotion(a))}),t.EFF(1," Seleccionada "),t.k0s()}}function V(n,o){if(1&n){const r=t.RV6();t.j41(0,"button",20),t.bIt("click",function(){t.eBV(r);const a=t.XpG(2).$implicit,l=t.XpG();return t.Njj(l.onSelectPromotion(a))}),t.EFF(1," Seleccionar "),t.k0s()}}function A(n,o){if(1&n&&(t.j41(0,"div",13)(1,"div",14),t.EFF(2),t.k0s(),t.j41(3,"div",15),t.EFF(4),t.k0s(),t.j41(5,"div",16),t.DNE(6,x,2,0,"button",17)(7,V,2,0,"button",18),t.k0s()()),2&n){const r=t.XpG().$implicit,i=t.XpG();t.R7$(2),t.SpI(" ",r.projectName," "),t.R7$(2),t.Lme(" ",r.availableProperties.length," / ",r.properties.length," "),t.R7$(2),t.vxM((null==i.selectedPromotion?null:i.selectedPromotion.id)===r.id?6:7)}}function U(n,o){1&n&&t.DNE(0,A,8,4,"div",13),2&n&&t.vxM(o.$implicit.availableProperties.length?0:-1)}let I=(()=>{var n;class o{constructor(i){this.api=i,this.selectPromotion=new t.bkB,this.promotions=[],this.selectedPromotion=null,this.searchTerm="",this.responsibilityOptions=g.Rl}ngOnInit(){this.getAllPromotions()}getAllPromotions(){var i=this;return(0,b.A)(function*(){try{const a={page:0,itemsPerPage:500},l=yield i.api.getPromotions({},null,a,{properties:{apply:!0,filter:null,onlyCount:!1},promotionFiles:{apply:!0,filter:null,onlyCount:!1},promoter:{apply:!0,filter:null,onlyCount:!1}});null!=l&&l.success?(i.promotions=l.success.data,i.promotions.forEach(c=>{var m;c.availableProperties=null===(m=c.properties)||void 0===m?void 0:m.filter(C=>"available"===C.availabilityStatus)}),console.log("All Promotions:",i.promotions)):console.error("Error fetching promotions:",null==l?void 0:l.error)}catch(a){console.error("Error in getAllPromotions:",a)}})()}get filteredPromotions(){return this.promotions.filter(a=>{var l;return null===(l=a.projectName)||void 0===l?void 0:l.toLowerCase().includes(this.searchTerm.toLowerCase())})}onSelectPromotion(i){this.selectPromotion.emit(i),this.selectedPromotion=i}}return(n=o).\u0275fac=function(i){return new(i||n)(t.rXU(k.i))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-promotion"]],outputs:{selectPromotion:"selectPromotion"},decls:20,vars:2,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","300px","margin-bottom","16px"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar promoci\xf3n...",3,"ngModelChange","ngModel"],[1,"promotions-table"],[1,"promotions-table-header"],[1,"promotions-table-header-title"],[1,"promotions-table-header-availability"],[1,"promotions-table-header-actions"],[1,"promotions-table-footer"],[1,"promotions-table-row"],[1,"promotions-table-row-title"],[1,"promotions-table-row-availability"],[1,"promotions-table-row-actions"],["disabled","",1,"crm-button"],[1,"crm-button"],["disabled","",1,"crm-button",3,"click"],[1,"crm-button",3,"click"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 1. Promoci\xf3n "),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.nrm(6,"i",5),t.j41(7,"input",6),t.mxI("ngModelChange",function(c){return t.DH7(a.searchTerm,c)||(a.searchTerm=c),c}),t.k0s()()(),t.j41(8,"div",7)(9,"div",8)(10,"div",9),t.EFF(11,"Promoci\xf3n"),t.k0s(),t.j41(12,"div",10),t.EFF(13,"Viviendas disponibles"),t.k0s(),t.j41(14,"div",11),t.EFF(15,"Acciones"),t.k0s()(),t.Z7z(16,U,1,1,null,null,t.fX1),t.k0s(),t.j41(18,"div",12),t.EFF(19),t.k0s()()()),2&i&&(t.R7$(7),t.R50("ngModel",a.searchTerm),t.R7$(9),t.Dyx(a.filteredPromotions),t.R7$(3),t.SpI(" Total promociones: ",a.filteredPromotions.length," "))},dependencies:[e.me,e.BC,e.vS]}),o})();var w=p(7376),z=p(1296),W=p(6552),K=p(1880);function L(n,o){if(1&n){const r=t.RV6();t.qex(0),t.j41(1,"div",4),t.EFF(2),t.k0s(),t.j41(3,"app-table",5),t.bIt("rowClicked",function(a){t.eBV(r);const l=t.XpG();return t.Njj(l.onRowClicked(a))}),t.k0s(),t.nrm(4,"div",6),t.bVm()}if(2&n){const r=o.$implicit,i=o.index;t.R7$(2),t.SpI(" ",r.name||"Bloque "+(r.index||i+1)," "),t.R7$(),t.Y8G("table",r.tableConfig)}}let q=(()=>{var n;class o{constructor(i,a,l){this.tableService=i,this.utils=a,this.toastService=l,this.selectProperty=new t.bkB,this.blocks=[],this.allColumnsKeysSelected=["externalReference","reference","m2useful","m2total","terrace","plot","bedrooms","bathrooms","pool","storage","parking","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!1,editCellsMode:!1,columns:[{key:"externalReference",label:"Ref. externa",size:"medium",editMode:{inputType:"text"}},{key:"reference",label:"Identificador",size:"medium",editMode:{inputType:"text"}},{key:"m2useful",label:"M2 \xfatiles",size:"small",extraString:" m\xb2",fn:c=>null!=c&&c.totalMeasures_squareMetersUseful?c.totalMeasures_squareMetersUseful+" m\xb2":""},{key:"m2total",label:"M2 total",size:"small",extraString:" m\xb2",fn:c=>null!=c&&c.totalMeasures_squareMetersBuilt?c.totalMeasures_squareMetersBuilt+" m\xb2":""},{key:"terrace",label:"Terraza",size:"small",fn:c=>{const f=(c.totalMeasures_squareMetersCoveredTerraces||0)+(c.totalMeasures_squareMetersUncoveredTerraces||0);return f?f+" m\xb2":""}},{key:"plot",label:"Parcela",size:"small",extraString:" m\xb2",fn:c=>null!=c&&c.totalMeasures_squareMetersPatch?c.totalMeasures_squareMetersPatch+" m\xb2":""},{key:"bedrooms",label:"Dorm.",size:"small"},{key:"bathrooms",label:"Ba\xf1os",size:"small"},{key:"pool",label:"Piscina",size:"small",fn:c=>c.f_pool_comunitaria?"Comunitaria":c.f_pool_privada?"Privada":"No"},{key:"storage",label:"Trastero",size:"small",fn:c=>c.fcustom_trastero?c.fcustom_trasteroPrice?this.utils.transformThousandSeparator(c.fcustom_trasteroPrice)+" \u20ac":c.fcustom_trasteroIncludedInPrice?"Incluido":"S\xed":"No"},{key:"parking",label:"Parking",size:"small",fn:c=>{let m=c.fcustom_parking?"S\xed":"No";return c.fcustom_parkingPrice&&(m=this.utils.transformThousandSeparator(c.fcustom_parkingPrice)+" \u20ac"),c.fcustom_parkingIncludedInPrice&&(m="Incluido"),c.fcustom_parkingComunitario&&(m+=" (Comunitario)"),m}},{key:"price",label:"Precio",size:"small",fn:c=>null!=c&&c.price?this.utils.transformThousandSeparator(c.price)+" \u20ac":""}],rows:[]}}ngOnInit(){}set selectedPromotion(i){this.promotion=i,this.getData()}getData(){var i;if(this.promotion){this.allColumnsKeysSelected=(null===(i=this.promotion)||void 0===i?void 0:i.tableColumnsKeysSelected)||this.allColumnsKeysSelected,this.blocks=this.promotion.promotionBlocks||[];for(let a=0;a<this.blocks.length;a++){const l=this.blocks[a];!l.properties||0===l.properties.length||(l.tableConfig=w.cloneDeep(this.tableConfig),l.tableConfig.rows=this.tableService.convertDataToTableRows(w.cloneDeep(l.properties),w.cloneDeep(l.tableConfig)),l.tableConfig.rows=this.addBackgroundColorsToTableRows(l.tableConfig.rows))}}}addBackgroundColorsToTableRows(i){for(let a=0;a<i.length;a++)switch(i[a].rawObject.availabilityStatus){case"available":i[a].style={backgroundColor:"success"};break;case"sold":i[a].style={backgroundColor:"red"};break;case"reserved":i[a].style={backgroundColor:"warning"};break;default:i[a].style={backgroundColor:"blocked"}}return i}onRowClicked(i){const a=i.rawObject;console.log("Row clicked, property:",a),this.selectProperty.emit(a)}}return(n=o).\u0275fac=function(i){return new(i||n)(t.rXU(z.a),t.rXU(W.T),t.rXU(j.f))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-property"]],outputs:{selectProperty:"selectProperty"},decls:5,vars:1,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[4,"ngFor","ngForOf"],[1,"block-title"],[2,"margin-bottom","16px",3,"rowClicked","table"],[2,"margin-bottom","16px"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 2. Vivienda principal "),t.k0s(),t.j41(3,"div",2),t.DNE(4,L,5,2,"ng-container",3),t.k0s()()),2&i&&(t.R7$(4),t.Y8G("ngForOf",a.blocks))},dependencies:[v.Sq,K.O],styles:[".block-title[_ngcontent-%COMP%]{margin-bottom:16px;font-size:14px;font-weight:500}"]}),o})();var X=p(4558);function J(n,o){if(1&n&&(t.j41(0,"option",21),t.EFF(1),t.k0s()),2&n){const r=o.$implicit;t.Y8G("value",r),t.R7$(),t.JRh(r)}}function H(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",22),t.bIt("click",function(){t.eBV(r);const a=t.XpG();return t.Njj(a.editingPrice=!0)}),t.EFF(1),t.nI1(2,"thousandSeparator"),t.nrm(3,"i",23),t.k0s()}if(2&n){const r=t.XpG();t.R7$(),t.SpI(" ",t.bMT(2,1,r.priceSelected.priceWithoutIva)," \u20ac ")}}function Q(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",24)(1,"input",25),t.mxI("ngModelChange",function(a){t.eBV(r);const l=t.XpG();return t.DH7(l.priceSelected.priceWithoutIva,a)||(l.priceSelected.priceWithoutIva=a),t.Njj(a)}),t.k0s(),t.j41(2,"i",26),t.bIt("click",function(){t.eBV(r);const a=t.XpG();return t.Njj(a.onPriceConfirm())}),t.k0s()()}if(2&n){const r=t.XpG();t.R7$(),t.R50("ngModel",r.priceSelected.priceWithoutIva)}}let Z=(()=>{var n;class o{constructor(){this.selectPrice=new t.bkB,this.priceSelected={priceWithoutIva:0,priceWithIva:0,finalPrice:0,iva:10},this.taxRates=["0%","10%","21%"],this.selectedTaxRate="10%",this.editingPrice=!1}set selectedProperty(i){this.property=i,this.priceSelected.priceWithoutIva=(null==i?void 0:i.price)||0,this.updateCalculations()}ngOnInit(){this.updateCalculations()}onTaxRateChange(){this.updateCalculations()}onPriceConfirm(){this.updateCalculations(),this.editingPrice=!1}updateCalculations(){const i=parseFloat(this.selectedTaxRate);this.priceSelected.iva=isNaN(i)?0:i,this.priceSelected.priceWithIva=this.priceSelected.priceWithoutIva*(this.priceSelected.iva/100),this.priceSelected.finalPrice=this.priceSelected.priceWithoutIva+this.priceSelected.priceWithIva}goNextSection(){this.selectPrice.emit(this.priceSelected),console.log("Go to the next section...")}}return(n=o).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-price"]],outputs:{selectPrice:"selectPrice"},decls:48,vars:17,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"max-width","200px","margin-bottom","24px"],[1,"crm-input-label"],[1,"crm-input-input","crm-input-input-searchbar-square"],[3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"title",2,"margin-bottom","8px"],[1,"price-table-header",2,"padding","0px 16px"],[1,"price-table-header-cell"],[1,"price-table"],[1,"price-table-row"],[1,"price-table-cell"],[1,"price-table-cell","editable-cell"],["class","editable-price-display",3,"click",4,"ngIf"],["class","editable-price-edit",4,"ngIf"],[1,"price-table-footer"],[1,"price-table-footer-cell"],[1,"crm-block-buttons-right",2,"margin-top","16px"],[1,"crm-button",3,"click"],[3,"value"],[1,"editable-price-display",3,"click"],[1,"fas","fa-pencil",2,"color","rgb(130, 130, 130)"],[1,"editable-price-edit"],["type","number",3,"ngModelChange","ngModel"],[1,"fas","fa-check",2,"color","rgb(11, 169, 11)",3,"click"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 3. Por precio "),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.EFF(6," Impuestos IVA/IT "),t.k0s(),t.j41(7,"div",5)(8,"select",6),t.mxI("ngModelChange",function(c){return t.DH7(a.selectedTaxRate,c)||(a.selectedTaxRate=c),c}),t.bIt("change",function(){return a.onTaxRateChange()}),t.DNE(9,J,2,2,"option",7),t.k0s()()(),t.j41(10,"div",8),t.EFF(11," Tabla de precios "),t.k0s(),t.j41(12,"div",9)(13,"div",10),t.EFF(14,"Vivienda"),t.k0s(),t.j41(15,"div",10),t.EFF(16,"Precio"),t.k0s(),t.j41(17,"div",10),t.EFF(18,"IVA/ITP"),t.k0s(),t.j41(19,"div",10),t.EFF(20,"PVP"),t.k0s()(),t.j41(21,"div",11)(22,"div",12)(23,"div",13),t.EFF(24," 1A "),t.k0s(),t.j41(25,"div",14),t.DNE(26,H,4,3,"div",15)(27,Q,3,1,"div",16),t.k0s(),t.j41(28,"div",13),t.EFF(29),t.k0s(),t.j41(30,"div",13),t.EFF(31),t.nI1(32,"thousandSeparator"),t.k0s()(),t.j41(33,"div",17)(34,"div",18),t.EFF(35," Total "),t.k0s(),t.j41(36,"div",18),t.EFF(37),t.nI1(38,"thousandSeparator"),t.k0s(),t.j41(39,"div",18),t.EFF(40),t.nI1(41,"thousandSeparator"),t.k0s(),t.j41(42,"div",18),t.EFF(43),t.nI1(44,"thousandSeparator"),t.k0s()()(),t.j41(45,"div",19)(46,"button",20),t.bIt("click",function(){return a.goNextSection()}),t.EFF(47," Ir a la siguiente secci\xf3n "),t.k0s()()()()),2&i&&(t.R7$(8),t.R50("ngModel",a.selectedTaxRate),t.R7$(),t.Y8G("ngForOf",a.taxRates),t.R7$(17),t.Y8G("ngIf",!a.editingPrice),t.R7$(),t.Y8G("ngIf",a.editingPrice),t.R7$(2),t.SpI(" ",a.selectedTaxRate," "),t.R7$(2),t.SpI(" ",t.bMT(32,9,a.priceSelected.finalPrice)," \u20ac "),t.R7$(6),t.SpI(" ",t.bMT(38,11,a.priceSelected.priceWithoutIva)," \u20ac "),t.R7$(3),t.SpI(" ",t.bMT(41,13,a.priceSelected.priceWithIva)," \u20ac "),t.R7$(3),t.SpI(" ",t.bMT(44,15,a.priceSelected.finalPrice)," \u20ac "))},dependencies:[v.Sq,v.bT,e.xH,e.y7,e.me,e.Q0,e.wz,e.BC,e.vS,X.w],styles:[".venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .crm-input[_ngcontent-%COMP%]{margin-bottom:16px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table-header[_ngcontent-%COMP%]   .price-table-header-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]{border-radius:12px;padding:0 16px;background:#f9f9f9}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid var(--crm-border-light-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer[_ngcontent-%COMP%]{font-weight:500;border:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%], .venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-footer-cell[_ngcontent-%COMP%]{flex:1;font-size:14px;padding:8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-cell[_ngcontent-%COMP%]{display:flex;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color)}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]{display:inline-flex;gap:8px;align-items:center}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:120px;background:#fff;outline:none;border:1px solid var(--crm-border-light-color);border-radius:8px;padding:4px 8px}.venta-component[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--crm-text-color);cursor:pointer}"]}),o})();const Y=n=>({"text-error-important":n}),ee=n=>({"text-error":n}),te=n=>({"border-error":n});let ne=(()=>{var n;class o{constructor(){this.reservationAmount=0,this.selectDocumentData=new t.bkB,this.errors=[],this.formData={contractType:"",signatureType:"",reservationAmount:this.reservationAmount}}ngOnInit(){}onContinue(){this.errors=[],this.formData.reservationAmount||this.errors.push("reservationAmount"),this.formData.contractType||this.errors.push("contractType"),this.formData.signatureType||this.errors.push("signatureType"),this.errors.length||this.selectDocumentData.emit(this.formData)}ngOnChanges(i){this.formData.reservationAmount=this.reservationAmount}}return(n=o).\u0275fac=function(i){return new(i||n)},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-select-document"]],inputs:{reservationAmount:"reservationAmount"},outputs:{selectDocumentData:"selectDocumentData"},features:[t.OA$],decls:44,vars:15,consts:[[1,"venta-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"margin-bottom","16px"],[1,"crm-text",3,"ngClass"],[3,"ngModelChange","ngModel"],[1,"crm-input-radio"],["value","byvaro"],[1,"crm-input-radio-label"],["value","propio"],[2,"border","none","border-bottom","1px solid #e5e5e5","margin","24px 0"],["value","electronica"],["value","papel"],[1,"title","mb8"],[1,"crm-text","small","light","mb16"],[1,"crm-input",2,"margin-bottom","24px","max-width","300px"],[1,"crm-input-label",3,"ngClass"],[1,"crm-input-input",3,"ngClass"],["type","number","placeholder","Por ejemplo 3000\u20ac",3,"ngModelChange","ngModel"],[1,"crm-block-buttons-right"],[1,"crm-button",3,"click"]],template:function(i,a){1&i&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2," 4. Documento de reserva "),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.EFF(6," Redacci\xf3n del contrato: "),t.k0s(),t.j41(7,"ion-radio-group",5),t.mxI("ngModelChange",function(c){return t.DH7(a.formData.contractType,c)||(a.formData.contractType=c),c}),t.j41(8,"div",6),t.nrm(9,"ion-radio",7),t.j41(10,"div",8),t.EFF(11," Contrato redactado en Byvaro "),t.k0s()(),t.j41(12,"div",6),t.nrm(13,"ion-radio",9),t.j41(14,"div",8),t.EFF(15," Contrato propio "),t.k0s()()()(),t.nrm(16,"hr",10),t.j41(17,"div",3)(18,"div",4),t.EFF(19," T\xe9rminos y condiciones de la firma: "),t.k0s(),t.j41(20,"ion-radio-group",5),t.mxI("ngModelChange",function(c){return t.DH7(a.formData.signatureType,c)||(a.formData.signatureType=c),c}),t.j41(21,"div",6),t.nrm(22,"ion-radio",11),t.j41(23,"div",8),t.EFF(24," Firma electr\xf3nica "),t.k0s()(),t.j41(25,"div",6),t.nrm(26,"ion-radio",12),t.j41(27,"div",8),t.EFF(28," Firma en papel "),t.k0s()()()(),t.nrm(29,"hr",10),t.j41(30,"div",13),t.EFF(31," Cantidad que debe pagar el cliente para reservar: "),t.k0s(),t.j41(32,"div",14),t.EFF(33," Este campo puede heredar autom\xe1ticamente el valor definido en la configuraci\xf3n de la promoci\xf3n."),t.nrm(34,"br"),t.EFF(35," Por favor, rev\xedsalo antes de continuar. "),t.k0s(),t.j41(36,"div",15)(37,"div",16),t.EFF(38," Cantidad de reserva (\u20ac) "),t.k0s(),t.j41(39,"div",17)(40,"input",18),t.mxI("ngModelChange",function(c){return t.DH7(a.formData.reservationAmount,c)||(a.formData.reservationAmount=c),c}),t.k0s()()(),t.j41(41,"div",19)(42,"button",20),t.bIt("click",function(){return a.onContinue()}),t.EFF(43," Continuar la reserva "),t.k0s()()()()),2&i&&(t.R7$(5),t.Y8G("ngClass",t.eq3(7,Y,a.errors.includes("contractType"))),t.R7$(2),t.R50("ngModel",a.formData.contractType),t.R7$(11),t.Y8G("ngClass",t.eq3(9,Y,a.errors.includes("signatureType"))),t.R7$(2),t.R50("ngModel",a.formData.signatureType),t.R7$(17),t.Y8G("ngClass",t.eq3(11,ee,a.errors.includes("reservationAmount"))),t.R7$(2),t.Y8G("ngClass",t.eq3(13,te,a.errors.includes("reservationAmount"))),t.R7$(),t.R50("ngModel",a.formData.reservationAmount))},dependencies:[v.YU,e.me,e.Q0,e.BC,e.vS,u.KO,u.f0,u.Je],styles:[".crm-text[_ngcontent-%COMP%]{font-style:normal;margin-bottom:8px}.crm-input-radio[_ngcontent-%COMP%]{margin-bottom:8px}ion-radio-group[_ngcontent-%COMP%]{display:flex;gap:16px}.mb8[_ngcontent-%COMP%]{margin-bottom:8px}.mb16[_ngcontent-%COMP%]{margin-bottom:16px}"]}),o})();var oe=p(7700);const ie=["selectPropertyComponent"],$=["selectPriceComponent"],E=n=>({"hidden-step":n}),re=(n,o)=>({"crm-steps-container-step-current":n,"crm-steps-container-step-inactive":o});function ae(n,o){1&n&&t.nrm(0,"i",24)}function le(n,o){if(1&n&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&n){const r=t.XpG().index;t.R7$(),t.JRh(r+1)}}function se(n,o){1&n&&t.nrm(0,"div",25)}function ce(n,o){if(1&n&&(t.j41(0,"div",18)(1,"div",19),t.DNE(2,ae,1,0,"i",20)(3,le,2,1,"span",21),t.k0s(),t.j41(4,"div",22),t.EFF(5),t.k0s(),t.DNE(6,se,1,0,"div",23),t.k0s()),2&n){const r=o.$implicit,i=o.index,a=t.XpG();t.Y8G("ngClass",t.l_i(5,re,i==a.activeIndex,i>a.activeIndex)),t.R7$(2),t.Y8G("ngIf",i<a.activeIndex),t.R7$(),t.Y8G("ngIf",i>=a.activeIndex),t.R7$(2),t.JRh(r),t.R7$(),t.Y8G("ngIf",i<a.steps.length-1)}}function de(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 1. Promoci\xf3n "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(r);const a=t.XpG(2);return t.Njj(a.changeStep(0))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.k0s()()}if(2&n){const r=t.XpG(2);t.R7$(7),t.SpI(" ",null==r.data||null==r.data.promotion?null:r.data.promotion.projectName," ")}}function pe(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 2. Vivienda principal "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(r);const a=t.XpG(2);return t.Njj(a.changeStep(1))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.k0s()()}if(2&n){const r=t.XpG(2);t.R7$(7),t.SpI(" ",null==r.data||null==r.data.property?null:r.data.property.reference," ")}}function ue(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 3. Por precio "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(r);const a=t.XpG(2);return t.Njj(a.changeStep(2))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.nI1(8,"thousandSeparator"),t.k0s()()}if(2&n){const r=t.XpG(2);t.R7$(7),t.SpI(" ",t.bMT(8,1,null==r.data||null==r.data.priceSelected?null:r.data.priceSelected.finalPrice)," \u20ac ")}}function me(n,o){if(1&n){const r=t.RV6();t.j41(0,"div",28)(1,"div",29)(2,"div",30),t.EFF(3," 4. Documento de reserva "),t.k0s(),t.j41(4,"div",31),t.bIt("click",function(){t.eBV(r);const a=t.XpG(2);return t.Njj(a.changeStep(3))}),t.nrm(5,"i",32),t.k0s()(),t.j41(6,"div",33),t.EFF(7),t.k0s()()}if(2&n){const r=t.XpG(2);t.R7$(7),t.SpI(" ",null==r.data||null==r.data.documentData?null:r.data.documentData.contractType," ")}}function ve(n,o){if(1&n&&(t.j41(0,"div",26),t.DNE(1,de,8,1,"div",27)(2,pe,8,1,"div",27)(3,ue,9,3,"div",27)(4,me,8,1,"div",27),t.k0s()),2&n){const r=t.XpG();t.R7$(),t.Y8G("ngIf",null==r.data?null:r.data.promotion),t.R7$(),t.Y8G("ngIf",null==r.data?null:r.data.property),t.R7$(),t.Y8G("ngIf",null==r.data||null==r.data.priceSelected?null:r.data.priceSelected.finalPrice),t.R7$(),t.Y8G("ngIf",null==r.data?null:r.data.documentData)}}const _e=[{path:"",component:(()=>{var n;class o{constructor(i,a,l,c){this.api=i,this.route=a,this.toast=l,this.router=c,this.reservationPayment=0,this.data={promotion:null,property:null,priceSelected:{priceWithoutIva:null,priceWithIva:null,finalPrice:null,iva:10},documentData:null},this.steps=["Promoci\xf3n","Vivienda principal","Por precio","Documento de reserva","Datos del cliente"],this.activeIndex=0,this.reservedContacts=[]}ngOnInit(){const i=this.route.snapshot.paramMap.get("operationId");i?this.api.getOperation({id:{equals:i}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1},operationRegisters:{apply:!0,filter:null,onlyCount:!1}}).then(a=>{a.success&&a.success.data&&a.success.data.length&&(this.operation=a.success.data[0],this.api.getOperationById(i).then(l=>{l.success&&l.success.data&&l.success.data.reserveContacts.length&&(this.reservedContacts=l.success.data.reserveContacts)}))}).catch(a=>{console.error("Error retrieving operation:",a)}):console.warn("No operationId parameter found in the URL.")}onSelectPromotion(i){var a=this;return(0,b.A)(function*(){var l;a.data.promotion=i,a.activeIndex=1;const c=yield a.api.getPromotionFullDataById(a.data.promotion.id);a.data.promotion=null==c||null===(l=c.success)||void 0===l?void 0:l.data,a.selectPropertyComponent.selectedPromotion=a.data.promotion})()}onSelectProperty(i){var a=this;return(0,b.A)(function*(){a.data.property=i,a.selectPriceComponent.selectedProperty=i,a.activeIndex=2})()}onSelectPrice(i){var a;this.data.priceSelected=i,this.reservationPayment=null===(a=this.operation)||void 0===a||null===(a=a.mainProperty)||void 0===a||null===(a=a.promotion)||void 0===a?void 0:a.reservePayment,this.activeIndex=3}onSelectDocumentData(i){this.data.documentData=i,this.activeIndex=4}onSelectContactData(){console.log("Contact data selected:",this.data.documentData),this.finishFlow()}finishFlow(){var i=this;return(0,b.A)(function*(){const a={propertyId:i.data.property.id,operationId:i.operation.id,priceSelected:i.data.priceSelected,documentData:i.data.documentData};(yield i.api.reserveProperty(a)).success?(i.toast.showSuccessToast("Reserva realizada correctamente"),i.router.navigate(["/contacts",i.operation.contactId,"operations",i.operation.id])):i.toast.showErrorToast("Error al realizar la reserva")})()}changeStep(i){this.activeIndex=i,0===i&&(this.data.property=null,this.data.priceSelected=null,this.data.documentData=null,this.selectPropertyComponent.selectedPromotion=null),1===i&&(this.data.priceSelected=null,this.data.documentData=null,this.selectPriceComponent.selectedProperty=null),console.log("DATAAAA",this.data)}}return(n=o).\u0275fac=function(i){return new(i||n)(t.rXU(k.i),t.rXU(y.nX),t.rXU(j.f),t.rXU(y.Ix))},n.\u0275cmp=t.VBU({type:n,selectors:[["app-venta-operation-process"]],viewQuery:function(i,a){if(1&i&&(t.GBs(ie,7),t.GBs($,7)),2&i){let l;t.mGM(l=t.lsd())&&(a.selectPropertyComponent=l.first),t.mGM(l=t.lsd())&&(a.selectPriceComponent=l.first)}},decls:22,vars:22,consts:[["selectPropertyComponent",""],["selectPriceComponent",""],["selectClientComponent",""],[3,"fullscreen"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-blue-content"],[1,"crm-steps-container"],["class","crm-steps-container-step",3,"ngClass",4,"ngFor","ngForOf"],[1,"venta-body"],[1,"venta-body-component"],[3,"ngClass"],[3,"selectPromotion"],[3,"selectProperty"],[3,"selectPrice"],[3,"selectDocumentData","reservationAmount"],[3,"selectContactData","contactData","reservedContacts","operationData"],["class","steps-cards-body",4,"ngIf"],[1,"crm-steps-container-step",3,"ngClass"],[1,"crm-steps-container-step-circle"],["class","fa fa-check",4,"ngIf"],[4,"ngIf"],[1,"crm-steps-container-step-label"],["class","crm-steps-container-step-separator",4,"ngIf"],[1,"fa","fa-check"],[1,"crm-steps-container-step-separator"],[1,"steps-cards-body"],["class","steps-cards-body-card",4,"ngIf"],[1,"steps-cards-body-card"],[1,"steps-cards-body-card-header"],[1,"steps-cards-body-card-header-title"],[1,"steps-cards-body-card-header-icon",3,"click"],[1,"fa-solid","fa-pencil"],[1,"steps-cards-body-card-text"]],template:function(i,a){if(1&i){const l=t.RV6();t.j41(0,"ion-content",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),t.DNE(5,ce,7,8,"div",8),t.k0s(),t.j41(6,"div",9)(7,"div",10)(8,"div",11)(9,"app-venta-select-promotion",12),t.bIt("selectPromotion",function(m){return t.eBV(l),t.Njj(a.onSelectPromotion(m))}),t.k0s()(),t.j41(10,"div",11)(11,"app-venta-select-property",13,0),t.bIt("selectProperty",function(m){return t.eBV(l),t.Njj(a.onSelectProperty(m))}),t.k0s()(),t.j41(13,"div",11)(14,"app-venta-select-price",14,1),t.bIt("selectPrice",function(m){return t.eBV(l),t.Njj(a.onSelectPrice(m))}),t.k0s()(),t.j41(16,"div",11)(17,"app-venta-select-document",15,2),t.bIt("selectDocumentData",function(m){return t.eBV(l),t.Njj(a.onSelectDocumentData(m))}),t.k0s()(),t.j41(19,"div",11)(20,"app-venta-select-contact-data",16),t.bIt("selectContactData",function(){return t.eBV(l),t.Njj(a.onSelectContactData())}),t.k0s()()(),t.DNE(21,ve,5,4,"div",17),t.k0s()()()()()}2&i&&(t.Y8G("fullscreen",!0),t.R7$(5),t.Y8G("ngForOf",a.steps),t.R7$(3),t.Y8G("ngClass",t.eq3(12,E,0!==a.activeIndex)),t.R7$(2),t.Y8G("ngClass",t.eq3(14,E,1!==a.activeIndex)),t.R7$(3),t.Y8G("ngClass",t.eq3(16,E,2!==a.activeIndex)),t.R7$(3),t.Y8G("ngClass",t.eq3(18,E,3!==a.activeIndex)),t.R7$(),t.Y8G("reservationAmount",a.reservationPayment),t.R7$(2),t.Y8G("ngClass",t.eq3(20,E,4!==a.activeIndex)),t.R7$(),t.Y8G("contactData",null==a.operation?null:a.operation.contact)("reservedContacts",a.reservedContacts)("operationData",a.operation),t.R7$(),t.Y8G("ngIf",null==a.data?null:a.data.promotion))},dependencies:[v.YU,v.Sq,v.bT,u.W9,I,q,Z,ne,oe.K,X.w],styles:[".crm-steps-container[_ngcontent-%COMP%], .crm-steps-container-step[_ngcontent-%COMP%]{display:flex;align-items:center}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#3a50e4;border:1px solid #3A50E4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#3a50e4}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#a8a8a8;border:1px solid rgb(168,168,168)}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#a8a8a8}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#a8a8a8}.crm-steps-container-step-circle[_ngcontent-%COMP%]{width:21px;min-width:21px;height:21px;min-height:21px;border-radius:50%;background:#3a50e4;color:#fff;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:12px;margin-right:8px}.crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4;font-weight:500;margin-right:16px;font-size:13px}.crm-steps-container-step-separator[_ngcontent-%COMP%]{width:20px;height:1px;background:#3a50e4;margin-right:16px}.hidden-step[_ngcontent-%COMP%]{height:0;overflow:hidden;opacity:0;position:absolute;width:0;visibility:hidden}.steps-cards-body[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:16px}.steps-cards-body-card[_ngcontent-%COMP%]{border:1px solid var(--crm-border-light-color);border-radius:6px;padding:12px}.steps-cards-body-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--crm-border-light-color);padding-bottom:16px}.steps-cards-body-card-header-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--crm-text-color)}.steps-cards-body-card-header-icon[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;color:var(--crm-text-color)}.steps-cards-body-card-text[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color);padding-top:16px}.venta-body[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:16px}.venta-body[_ngcontent-%COMP%]   .steps-cards-body[_ngcontent-%COMP%]{min-width:300px;width:300px;flex-shrink:0}.venta-body-component[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;overflow-y:auto}"]}),o})()}];let ge=(()=>{var n;class o{}return(n=o).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[y.iI.forChild(_e),y.iI]}),o})();var Ce=p(3895),fe=p(9662),he=p(6812),ye=p(969),s=p(3955),_=p(2306);let d=(()=>{var n;class o{}return(n=o).\u0275fac=function(i){return new(i||n)},n.\u0275mod=t.$C({type:n}),n.\u0275inj=t.G2t({imports:[v.MD,e.YN,u.bv,e.X1,ge,Ce.b,fe.Y,he.u,ye.rJ,s.h,_.T]}),o})()},9662:(B,S,p)=>{p.d(S,{Y:()=>u});var v=p(177),e=p(3953);let u=(()=>{var y;class b{}return(y=b).\u0275fac=function(k){return new(k||y)},y.\u0275mod=e.$C({type:y}),y.\u0275inj=e.G2t({imports:[v.MD]}),b})()}}]);