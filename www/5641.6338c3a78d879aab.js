"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5641,3666,1285],{3274:(z,w,s)=>{s.d(w,{K:()=>x});var n=s(177),e=s(3953);let x=(()=>{var T;class k{}return(T=k).\u0275fac=function(g){return new(g||T)},T.\u0275mod=e.$C({type:T}),T.\u0275inj=e.G2t({imports:[n.MD]}),k})()},7380:(z,w,s)=>{s.d(w,{$:()=>t});var n=s(467),e=s(3953),x=s(2081),T=s(8397),k=s(1213),C=s(3955),g=s(9417);const y=G=>({item:G}),f=G=>({field:G});function M(G,E){if(1&G){const c=e.RV6();e.j41(0,"div",1)(1,"div",4)(2,"textarea",5),e.nI1(3,"translate"),e.nI1(4,"translate"),e.mxI("ngModelChange",function(F){e.eBV(c);const X=e.XpG();return e.DH7(X.textNote,F)||(X.textNote=F),e.Njj(F)}),e.k0s()()()}if(2&G){const c=e.XpG();e.R7$(2),e.FS9("placeholder",e.i5U(4,4,"text.input_placeholder_fem",e.eq3(7,f,e.bMT(3,2,"text."+c.options.type)))),e.R50("ngModel",c.textNote)}}let t=(()=>{var G;class E{constructor(u,F,X,B){this.api=u,this.toast=F,this.byvaroState=X,this.translate=B,this.onNoteCreated=new e.bkB,this.textNote=""}ngOnInit(){this.getUserInfo()}getUserInfo(){this.byvaroState.getState().subscribe(u=>{this.currentUser=u.user,this.currentUserAgency=u.agency,this.currentUserPromoter=u.promoter})}onCreateNote(){var u=this;return(0,n.A)(function*(){var F,X,B;if(!u.textNote)return void u.toast.showToast({text:u.translate.instant("activity_creation_block.error_empty_note"),theme:"red",time:3e3});const J={id:void 0,createdAt:void 0,updatedAt:void 0,text:u.textNote,createdById:null===(F=u.currentUser)||void 0===F?void 0:F.id,contactId:u.options.contactId,promoterId:null===(X=u.currentUserPromoter)||void 0===X?void 0:X.id,agencyId:null===(B=u.currentUserAgency)||void 0===B?void 0:B.id,operationId:u.options.operationId},I=yield u.api.createNote(J);I.success?(u.toast.showToast({text:u.translate.instant("activity_creation_block.success_note_created"),theme:"success",time:2e3}),u.textNote="",u.onNoteCreated.emit(I.success.data)):u.toast.showToast({text:u.translate.instant("activity_creation_block.error_note_creation")+I.error.errorMessage,theme:"red",time:3e3})})()}}return(G=E).\u0275fac=function(u){return new(u||G)(e.rXU(x.i),e.rXU(T.f),e.rXU(k.c),e.rXU(C.c$))},G.\u0275cmp=e.VBU({type:G,selectors:[["app-activity-creation-block"]],inputs:{options:"options"},outputs:{onNoteCreated:"onNoteCreated"},decls:7,vars:9,consts:[[1,"crm-activity-content"],[1,"crm-input"],[1,"crm-section-buttons-right"],[1,"crm-button",3,"click"],[1,"crm-input-input","crm-input-input-textarea"],[3,"ngModelChange","ngModel","placeholder"]],template:function(u,F){1&u&&(e.j41(0,"div",0),e.DNE(1,M,5,9,"div",1),e.j41(2,"div",2)(3,"button",3),e.bIt("click",function(){return F.onCreateNote()}),e.EFF(4),e.nI1(5,"translate"),e.nI1(6,"translate"),e.k0s()()()),2&u&&(e.R7$(),e.vxM("note"===(null==F.options?null:F.options.type)?1:-1),e.R7$(3),e.SpI(" ",e.i5U(6,4,"text.add_item",e.eq3(7,y,e.bMT(5,2,"text."+(null==F.options?null:F.options.type))))," "))},dependencies:[g.me,g.BC,g.vS,C.D9]}),E})()},179:(z,w,s)=>{s.d(w,{Y:()=>C});var n=s(177),e=s(9417),x=s(9465),T=s(3955),k=s(3953);let C=(()=>{var g;class y{}return(g=y).\u0275fac=function(M){return new(M||g)},g.\u0275mod=k.$C({type:g}),g.\u0275inj=k.G2t({imports:[n.MD,e.YN,x.bv,T.h]}),y})()},6580:(z,w,s)=>{s.d(w,{k:()=>y});var n=s(3953),e=s(3955);const x=(f,M,t)=>({start:f,end:M,total:t}),T=f=>({page:f}),k=f=>({count:f});function C(f,M){if(1&f&&(n.j41(0,"div",15),n.EFF(1),n.nI1(2,"translate"),n.k0s()),2&f){const t=n.XpG(2);n.R7$(),n.SpI(" ",n.i5U(2,1,"text.items_selected",n.eq3(4,k,null==t.listPaginationConfig?null:t.listPaginationConfig.checkedItems))," ")}}function g(f,M){if(1&f&&(n.j41(0,"div",14),n.DNE(1,C,3,6,"div",15),n.k0s()),2&f){const t=n.XpG();n.R7$(),n.vxM(null!=t.listPaginationConfig&&t.listPaginationConfig.checkedItems||0===(null==t.listPaginationConfig?null:t.listPaginationConfig.checkedItems)?1:-1)}}let y=(()=>{var f;class M{constructor(){this.listPaginationConfig={},this.goPreviousPage=new n.bkB,this.goNextPage=new n.bkB,this.sort=new n.bkB}ngOnInit(){}onGoPreviousPage(G){this.goPreviousPage.emit(G)}onGoNextPage(G){this.goNextPage.emit(G)}onSort(G){this.sort.emit(G)}}return(f=M).\u0275fac=function(G){return new(G||f)},f.\u0275cmp=n.VBU({type:f,selectors:[["app-list-pagination-selectors"]],inputs:{listPaginationConfig:"listPaginationConfig"},outputs:{goPreviousPage:"goPreviousPage",goNextPage:"goNextPage",sort:"sort"},decls:24,vars:19,consts:[[1,"crm-block-pagination-selectors"],[1,"crm-button-pagination"],[1,"crm-button-pagination-text"],[1,"crm-button-pagination-buttons"],[1,"crm-button-pagination-arrow","crm-button-icon-solo",3,"click"],[1,"fas","fa-arrow-left"],[1,"crm-button-pagination-number"],[1,"fas","fa-arrow-right"],[1,"crm-dropdown",3,"click"],[1,"crm-dropdown-text"],[1,"crm-dropdown-right"],[1,"crm-dropdown-value"],[1,"crm-dropdown-arrow"],[1,"fas","fa-chevron-down"],[1,"crm-input-checkbox"],[1,"crm-input-checkbox-pre-label"]],template:function(G,E){1&G&&(n.j41(0,"div",0)(1,"div",1)(2,"div",2),n.EFF(3),n.nI1(4,"translate"),n.k0s(),n.j41(5,"div",3)(6,"button",4),n.bIt("click",function(u){return E.onGoPreviousPage(u)}),n.nrm(7,"i",5),n.k0s(),n.j41(8,"div",6),n.EFF(9),n.nI1(10,"translate"),n.k0s(),n.j41(11,"button",4),n.bIt("click",function(u){return E.onGoNextPage(u)}),n.nrm(12,"i",7),n.k0s()(),n.j41(13,"div",8),n.bIt("click",function(u){return E.onSort(u)}),n.j41(14,"div",9),n.EFF(15),n.nI1(16,"translate"),n.k0s(),n.j41(17,"div",10)(18,"div",11),n.EFF(19),n.k0s(),n.j41(20,"div",12),n.nrm(21,"i",13),n.k0s()()()(),n.j41(22,"div"),n.DNE(23,g,2,1,"div",14),n.k0s()()),2&G&&(n.R7$(3),n.SpI(" ",n.i5U(4,5,"text.pagination_range",n.sMw(13,x,null==E.listPaginationConfig?null:E.listPaginationConfig.pageStartIndex,null==E.listPaginationConfig?null:E.listPaginationConfig.pageEndIndex,null==E.listPaginationConfig?null:E.listPaginationConfig.totalCount))," "),n.R7$(6),n.SpI(" ",n.i5U(10,8,"text.page_short",n.eq3(17,T,null==E.listPaginationConfig?null:E.listPaginationConfig.paginationPage))," "),n.R7$(6),n.SpI(" ",n.bMT(16,11,"contacts.list.order_by")," "),n.R7$(4),n.SpI(" ",null==E.listPaginationConfig?null:E.listPaginationConfig.sortField," "),n.R7$(4),n.vxM(null!=E.listPaginationConfig&&E.listPaginationConfig.showSelectItems?23:-1))},dependencies:[e.D9]}),M})()},5603:(z,w,s)=>{s.d(w,{P:()=>k});var n=s(177),e=s(9417),x=s(3955),T=s(3953);let k=(()=>{var C;class g{}return(C=g).\u0275fac=function(f){return new(f||C)},C.\u0275mod=T.$C({type:C}),C.\u0275inj=T.G2t({imports:[n.MD,e.YN,x.h]}),g})()},1852:(z,w,s)=>{s.d(w,{n:()=>G});var n=s(3953),e=s(6552),x=s(177);const T=(E,c)=>({"background-color":E,color:c});function k(E,c){}function C(E,c){if(1&E&&(n.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),n.nrm(4,"i",5),n.k0s(),n.j41(5,"div",6),n.EFF(6," Nota "),n.k0s(),n.j41(7,"div",7),n.EFF(8),n.nI1(9,"date"),n.j41(10,"span",8),n.EFF(11),n.nI1(12,"date"),n.k0s()()(),n.j41(13,"div",9)(14,"button",10),n.nrm(15,"i",11),n.k0s()()(),n.j41(16,"div",12)(17,"div",13),n.EFF(18),n.k0s()(),n.j41(19,"div",14),n.DNE(20,k,0,0),n.j41(21,"div")(22,"div",15)(23,"div",16),n.nrm(24,"img",17),n.k0s(),n.j41(25,"div",18),n.EFF(26),n.k0s()()()()()),2&E){const u=n.XpG().$implicit;n.R7$(8),n.SpI(" ",n.i5U(9,6,u.createdAt,"dd/MM/yyyy")," "),n.R7$(3),n.SpI(" ",n.i5U(12,9,u.createdAt,"HH:mm")," "),n.R7$(7),n.SpI(" ",null==u.element?null:u.element.text," "),n.R7$(2),n.vxM(null!=u.element&&u.element.operationId?20:-1),n.R7$(4),n.Y8G("src",(null==u.element?null:u.element.createdBy.photoUrl)||"assets/images/avatar.png",n.B4B),n.R7$(2),n.SpI(" ",null==u.element||null==u.element.createdBy?null:u.element.createdBy.name," ")}}function g(E,c){if(1&E&&(n.j41(0,"div",13),n.EFF(1),n.k0s()),2&E){const u=n.XpG(2).$implicit;n.R7$(),n.SpI(" ",null==u.element?null:u.element.comment," ")}}function y(E,c){if(1&E&&(n.EFF(0," Pipeline cambiada de "),n.j41(1,"b"),n.EFF(2),n.k0s(),n.EFF(3," a "),n.j41(4,"b"),n.EFF(5),n.k0s(),n.EFF(6,". Del paso "),n.j41(7,"span",20),n.EFF(8),n.k0s(),n.EFF(9," \xa0 al paso \xa0 "),n.j41(10,"span",20),n.EFF(11),n.k0s()),2&E){const u=n.XpG(2).$implicit,F=n.XpG();n.R7$(2),n.JRh(null==u.element?null:u.element.oldPipeline.title),n.R7$(3),n.JRh(null==u.element?null:u.element.newPipeline.title),n.R7$(2),n.Y8G("ngStyle",n.l_i(6,T,F.utils.hexToRgba(null==u.element?null:u.element.oldStep.color,.1),null==u.element?null:u.element.oldStep.color)),n.R7$(),n.SpI(" ",null==u.element?null:u.element.oldStep.text," "),n.R7$(2),n.Y8G("ngStyle",n.l_i(9,T,F.utils.hexToRgba(null==u.element?null:u.element.newStep.color,.1),null==u.element?null:u.element.newStep.color)),n.R7$(),n.SpI(" ",null==u.element?null:u.element.newStep.text," ")}}function f(E,c){if(1&E&&(n.EFF(0," Paso de la pipeline "),n.j41(1,"b"),n.EFF(2),n.k0s(),n.EFF(3," cambiado de "),n.j41(4,"span",20),n.EFF(5),n.k0s(),n.EFF(6," \xa0 a \xa0 "),n.j41(7,"span",20),n.EFF(8),n.k0s()),2&E){const u=n.XpG(2).$implicit,F=n.XpG();n.R7$(2),n.JRh(null==u.element?null:u.element.oldPipeline.title),n.R7$(2),n.Y8G("ngStyle",n.l_i(5,T,F.utils.hexToRgba(null==u.element?null:u.element.oldStep.color,.1),null==u.element?null:u.element.oldStep.color)),n.R7$(),n.SpI(" ",null==u.element?null:u.element.oldStep.text," "),n.R7$(2),n.Y8G("ngStyle",n.l_i(8,T,F.utils.hexToRgba(null==u.element?null:u.element.newStep.color,.1),null==u.element?null:u.element.newStep.color)),n.R7$(),n.SpI(" ",null==u.element?null:u.element.newStep.text," ")}}function M(E,c){if(1&E&&(n.j41(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),n.nrm(4,"i",19),n.k0s(),n.j41(5,"div",6),n.EFF(6," Cambio de estado "),n.k0s(),n.j41(7,"div",7),n.EFF(8),n.nI1(9,"date"),n.j41(10,"span",8),n.EFF(11),n.nI1(12,"date"),n.k0s()()(),n.j41(13,"div",9)(14,"button",10),n.nrm(15,"i",11),n.k0s()()(),n.j41(16,"div",12),n.DNE(17,g,2,1,"div",13)(18,y,12,12)(19,f,9,11),n.k0s(),n.j41(20,"div",14)(21,"div")(22,"div",15)(23,"div",16),n.nrm(24,"img",17),n.k0s(),n.j41(25,"div",18),n.EFF(26),n.k0s()()()()()),2&E){const u=n.XpG().$implicit;n.R7$(8),n.SpI(" ",n.i5U(9,7,null==u.element?null:u.element.createdAt,"dd/MM/yyyy")," "),n.R7$(3),n.SpI(" ",n.i5U(12,10,null==u.element?null:u.element.createdAt,"HH:mm")," "),n.R7$(6),n.vxM(null!=u.element&&u.element.comment?17:-1),n.R7$(),n.vxM("changePipeline"===(null==u.element?null:u.element.type)?18:-1),n.R7$(),n.vxM("changePipelineStep"===(null==u.element?null:u.element.type)?19:-1),n.R7$(5),n.Y8G("src",(null==u.element?null:u.element.createdBy.photoUrl)||"assets/images/avatar.png",n.B4B),n.R7$(2),n.SpI(" ",null==u.element||null==u.element.createdBy?null:u.element.createdBy.name," ")}}function t(E,c){if(1&E&&n.DNE(0,C,27,12,"div",1)(1,M,27,13,"div",1),2&E){const u=c.$implicit;n.vxM("note"===(null==u?null:u.type)?0:-1),n.R7$(),n.vxM("operationHistoric"===(null==u?null:u.type)?1:-1)}}let G=(()=>{var E;class c{constructor(F){this.utils=F,this.items=[]}ngDoCheck(){const F=JSON.stringify(this.data);F!==this.previousData&&(this.previousData=F,this.items=this.transformDataToItemsAndOrderByCreatedAt(this.data))}transformDataToItemsAndOrderByCreatedAt(F){const X=[];return F.notes.forEach(B=>{X.push({type:"note",element:B,createdAt:B.createdAt,updatedAt:B.updatedAt})}),F.operationHistorics.forEach(B=>{X.push({type:"operationHistoric",element:B,createdAt:B.createdAt,updatedAt:B.updatedAt})}),X.sort((B,J)=>new Date(J.createdAt).getTime()-new Date(B.createdAt).getTime()),X}}return(E=c).\u0275fac=function(F){return new(F||E)(n.rXU(e.T))},E.\u0275cmp=n.VBU({type:E,selectors:[["app-operation-activity-block"]],inputs:{data:"data"},decls:3,vars:0,consts:[[1,"crm-section-operations"],[1,"crm-operation-activity"],[1,"crm-operation-activity-header"],[1,"crm-operation-activity-header-left"],[1,"crm-square-icon","crm-square-icon-small"],[1,"fa","fa-note-sticky"],[1,"crm-operation-activity-header-title"],[1,"crm-operation-activity-header-timestamp"],[1,"crm-operation-activity-header-timestamp-time"],[2,"display","flex","align-items","center","gap","8px"],[1,"crm-button-icon-solo"],[1,"fas","fa-ellipsis-vertical"],[1,"crm-operation-activity-content"],[1,"crm-text","small"],[1,"crm-operation-activity-footer"],[1,"crm-item-reference","small"],[1,"crm-item-reference-img"],["alt","",3,"src"],[1,"crm-item-reference-text"],[1,"fa","fa-exchange-alt"],[1,"crm-item-chip","crm-item-chip-warn",3,"ngStyle"]],template:function(F,X){1&F&&(n.j41(0,"div",0),n.Z7z(1,t,2,2,null,null,n.fX1),n.k0s()),2&F&&(n.R7$(),n.Dyx(X.items))},dependencies:[x.B3,x.vh]}),c})()},3675:(z,w,s)=>{s.d(w,{S:()=>k});var n=s(177),e=s(9465),x=s(9417),T=s(3953);let k=(()=>{var C;class g{}return(C=g).\u0275fac=function(f){return new(f||C)},C.\u0275mod=T.$C({type:C}),C.\u0275inj=T.G2t({imports:[n.MD,e.bv,x.YN]}),g})()},2606:(z,w,s)=>{s.d(w,{O:()=>k});var n=s(3953),e=s(3955);const x=["tabElement"];function T(C,g){if(1&C){const y=n.RV6();n.j41(0,"div",3,0),n.bIt("click",function(){const M=n.eBV(y).$index,t=n.XpG();return n.Njj(t.onClickTab(M))}),n.EFF(2),n.nI1(3,"translate"),n.k0s()}if(2&C){const y=g.$implicit;n.AVh("active",y.active),n.R7$(2),n.SpI(" ",n.bMT(3,3,"text."+(null==y?null:y.title))||(null==y?null:y.title)," ")}}let k=(()=>{var C;class g{constructor(){this.tabs=[{id:"1",title:"general_overview",active:!0},{id:"2",title:"our_team",active:!1},{id:"3",title:"agencies",active:!1}],this.tabClicked=new n.bkB}ngOnChanges(f){if(f.activeTab&&this.activeTab&&this.tabs.length>0){const M=this.tabs.findIndex(t=>t.title===this.activeTab);-1!==M&&this.onClickTab(M)}}ngAfterViewInit(){const f=this.tabs.findIndex(M=>M.active)||0;-1!==f&&this.onClickTab(f)}onClickTab(f){console.log("HEY",f),this.tabs.forEach((M,t)=>{M.active=t===f}),this.tabClicked.emit(this.tabs[f].title),this.updateActiveTab(f)}updateActiveTab(f){setTimeout(()=>{var M;const t=null===(M=this.tabElements.get(f))||void 0===M?void 0:M.nativeElement;if(t){const E=t.offsetLeft;document.documentElement.style.setProperty("--indicator-width",t.offsetWidth-12+"px"),document.documentElement.style.setProperty("--indicator-left",`${E}px`)}},0)}}return(C=g).\u0275fac=function(f){return new(f||C)},C.\u0275cmp=n.VBU({type:C,selectors:[["app-tabs"]],viewQuery:function(f,M){if(1&f&&n.GBs(x,5),2&f){let t;n.mGM(t=n.lsd())&&(M.tabElements=t)}},inputs:{tabs:"tabs",activeTab:"activeTab"},outputs:{tabClicked:"tabClicked"},standalone:!0,features:[n.OA$,n.aNF],decls:3,vars:0,consts:[["tabElement",""],[1,"crm-tabs"],[1,"crm-tabs-tab",3,"active"],[1,"crm-tabs-tab",3,"click"]],template:function(f,M){1&f&&(n.j41(0,"div",1),n.Z7z(1,T,4,5,"div",2,n.fX1),n.k0s()),2&f&&(n.R7$(),n.Dyx(M.tabs))},dependencies:[e.h,e.D9]}),g})()},1129:(z,w,s)=>{s.d(w,{Z:()=>k});var n=s(3953),e=s(6069),x=s(1982);function T(C,g){if(1&C){const y=n.RV6();n.j41(0,"app-country-selector-popover",4),n.bIt("countrySelected",function(M){n.eBV(y);const t=n.XpG();return n.Njj(t.selectCountry(M))})("closePopover",function(){n.eBV(y);const M=n.XpG();return n.Njj(M.dropdownOpen=!1)}),n.k0s()}2&C&&n.Y8G("showCountryCode",!0)}let k=(()=>{var C;class g{constructor(){this.emitCountrySelected=new n.bkB,this.countries=e.X,this.selectedCountry=e.X[0],this.dropdownOpen=!1}ngOnChanges(){const f=this.extractCountryPhoneCodeFromPhoneNumber(this.selectedPhoneNumber);f!==this.extractCountryPhoneCodeFromPhoneNumber(this.selectedCountry.phoneCode)&&this.selectCountryByPhoneCode(f)}toggleDropdown(f){f.stopPropagation(),this.dropdownOpen=!this.dropdownOpen}selectCountry(f){f.event.stopPropagation(),this.selectedCountry=f.country,this.emitCountrySelected.emit(f.country),this.dropdownOpen=!1}selectCountryByPhoneCode(f){const M=this.countries.find(t=>t.phoneCode===f);M&&(this.selectedCountry=M,this.emitCountrySelected.emit(M))}extractCountryPhoneCodeFromPhoneNumber(f){return null==f?void 0:f.split(" ")[0]}}return(C=g).\u0275fac=function(f){return new(f||C)},C.\u0275cmp=n.VBU({type:C,selectors:[["app-flag-country-selector"]],inputs:{selectedPhoneNumber:"selectedPhoneNumber"},outputs:{emitCountrySelected:"emitCountrySelected"},features:[n.OA$],decls:5,vars:3,consts:[["tabindex","0",1,"flag-country-selector-container",3,"click"],[1,"selected-country"],[1,"fas","fa-caret-down","dropdown-arrow"],[3,"showCountryCode"],[3,"countrySelected","closePopover","showCountryCode"]],template:function(f,M){1&f&&(n.j41(0,"div",0),n.bIt("click",function(G){return M.toggleDropdown(G)}),n.j41(1,"div",1),n.nrm(2,"span")(3,"i",2),n.k0s(),n.DNE(4,T,1,1,"app-country-selector-popover",3),n.k0s()),2&f&&(n.R7$(2),n.HbH(null==M.selectedCountry?null:M.selectedCountry.flagClass),n.R7$(2),n.vxM(M.dropdownOpen?4:-1))},dependencies:[x.u],styles:[".flag-country-selector-container[_ngcontent-%COMP%]{position:relative;width:50px;cursor:pointer;color:#000}.selected-country[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;height:40px;width:50px}.dropdown-arrow[_ngcontent-%COMP%]{margin-left:8px}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:200px;z-index:9999;background-color:#fff;border:1px solid #ccc;padding:8px 0;border-radius:12px;border:1px solid var(--crm-border-light-color);color:#000;max-height:150px;overflow-y:auto}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:20px;width:20px;height:20px;display:inline-block;margin-right:8px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.flag-country-selector-container[_ngcontent-%COMP%]   .option[_ngcontent-%COMP%]{color:#000}.selected-country[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:24px;width:18px;height:18px}"]}),g})()},6812:(z,w,s)=>{s.d(w,{u:()=>k});var n=s(177),e=s(9417),x=s(7754),T=s(3953);let k=(()=>{var C;class g{}return(C=g).\u0275fac=function(f){return new(f||C)},C.\u0275mod=T.$C({type:C}),C.\u0275inj=T.G2t({imports:[n.MD,e.YN,x.X]}),g})()},9066:(z,w,s)=>{s.d(w,{K:()=>T});var n=s(177),e=s(9465),x=s(3953);let T=(()=>{var k;class C{}return(k=C).\u0275fac=function(y){return new(y||k)},k.\u0275mod=x.$C({type:k}),k.\u0275inj=x.G2t({imports:[n.MD,e.bv]}),C})()},7310:(z,w,s)=>{s.d(w,{s:()=>J});var n=s(3953),e=s(8359),x=s(467),T=s(1413),k=s(152),C=s(5558),g=s(2081);let y=(()=>{var I;class ${constructor(h){this.api=h,this.searchTermSubject=new T.B,this.ignoreIncludes=!1,this.allAgencies=[],this.searchResults$=this.searchTermSubject.pipe((0,k.B)(300),(0,C.n)(D=>this.performSearch(D)))}search(h){this.searchTermSubject.next(h)}performSearch(h){var D=this;return(0,x.A)(function*(){let K=[];if((h=h.trim().toLowerCase()).includes("@")){const Y=h.split("@")[1];let at;at=["gmail.com","yahoo.com","hotmail.com","outlook.com","icloud.com","aol.com","msn.com","live.com","mail.com","protonmail.com","zoho.com","gmx.com","yandex.com","ymail.com","rocketmail.com","fastmail.com","tutanota.com","hushmail.com","inbox.com","me.com","mac.com","live.co.uk","hotmail.co.uk","yahoo.co.uk","hotmail.fr","yahoo.fr","hotmail.de","yahoo.de","hotmail.it","yahoo.it","hotmail.es","yahoo.es","hotmail.uz","yahoo.uz","hotmail.mn"].includes(Y.toLowerCase())?yield D.api.getAgency({email:{equals:h}},null,{page:0,itemsPerPage:50}):yield D.api.getAgency({email:{contains:"@"+Y}},null,{page:0,itemsPerPage:50}),K=at.success.data}else D.ignoreIncludes&&(console.log("ENTRA AQUIIIII"),K=yield D.api.getAgency({name:{contains:h,mode:"insensitive"}},null,{page:0,itemsPerPage:50}).then(Y=>Y.success.data));return K})()}}return(I=$).\u0275fac=function(h){return new(h||I)(n.KVO(g.i))},I.\u0275prov=n.jDH({token:I,factory:I.\u0275fac,providedIn:"root"}),$})();var f=s(177),M=s(9417);function t(I,$){if(1&I&&n.nrm(0,"img",11),2&I){const R=n.XpG().$implicit;n.Y8G("src",R.photoUrl,n.B4B)}}function G(I,$){1&I&&n.nrm(0,"img",12)}function E(I,$){1&I&&(n.j41(0,"div",16),n.nrm(1,"img",21),n.k0s())}function c(I,$){if(1&I&&(n.j41(0,"span",17),n.EFF(1),n.k0s()),2&I){const R=n.XpG().$implicit;n.R7$(),n.E5c(" ",R.city,",",R.province," / ",R.country,"")}}function u(I,$){if(1&I){const R=n.RV6();n.j41(0,"div",8),n.bIt("click",function(D){const K=n.eBV(R).$implicit,Y=n.XpG(2);return n.Njj(Y.selectAgency(K,D))}),n.j41(1,"div",9)(2,"div",10),n.DNE(3,t,1,1,"img",11)(4,G,1,0,"img",12),n.k0s(),n.j41(5,"div",13)(6,"div",14)(7,"div",15)(8,"span"),n.EFF(9),n.k0s(),n.DNE(10,E,2,0,"div",16)(11,c,2,3,"span",17),n.k0s()(),n.j41(12,"div",18)(13,"span",19),n.EFF(14),n.k0s()()()(),n.nrm(15,"div",20),n.k0s()}if(2&I){const R=$.$implicit;n.R7$(3),n.vxM(R.photoUrl?3:4),n.R7$(6),n.JRh(null==R?null:R.name),n.R7$(),n.vxM(null!=R&&R.verified?10:-1),n.R7$(),n.vxM(R.city&&R.province&&R.country?11:-1),n.R7$(3),n.SpI(" ",null==R?null:R.email,"")}}function F(I,$){1&I&&(n.j41(0,"div",22),n.EFF(1," No hay resultados en Byvaro "),n.k0s())}function X(I,$){if(1&I){const R=n.RV6();n.j41(0,"div",8),n.bIt("click",function(D){n.eBV(R);const K=n.XpG(2);return n.Njj(K.selectAgency(null,D))}),n.j41(1,"div",9)(2,"div",10),n.nrm(3,"img",12),n.k0s(),n.j41(4,"div",13)(5,"div",14),n.EFF(6),n.k0s(),n.j41(7,"div",18),n.EFF(8," Esta agencia no est\xe1 registrada en Byvaro, haz clic para invitarla. "),n.k0s()()(),n.nrm(9,"div",20),n.k0s()}if(2&I){const R=n.XpG(2);n.R7$(6),n.SpI(" ",R.searchTerm," ")}}function B(I,$){if(1&I&&(n.j41(0,"div",5),n.Z7z(1,u,16,5,"div",6,n.fX1),n.DNE(3,F,2,0,"div",7)(4,X,10,1,"div",6),n.k0s()),2&I){const R=n.XpG();n.R7$(),n.Dyx(R.searchResults),n.R7$(2),n.Y8G("ngIf",0===R.searchResults.length&&!R.validEmail),n.R7$(),n.vxM(0===R.searchResults.length&&R.validEmail?4:-1)}}let J=(()=>{var I;class ${constructor(h,D){this.renderer=h,this.searchbarService=D,this.selectedAgency=new n.bkB,this.textUpdated=new n.bkB,this.ignoreIncludes=!1,this.searchTerm="",this.dropdownOpen=!1,this.searchResults=[],this.validEmail=!1,this.globalClickUnlistener=null,this.searchSubscription=new e.yU}ngOnInit(){this.ignoreIncludes&&(this.searchbarService.ignoreIncludes=!0),this.searchSubscription=this.searchbarService.searchResults$.subscribe(h=>{this.searchResults=h,this.searchResults.length||this.selectedAgency.emit(null)})}onInputClick(h){h.stopPropagation(),this.dropdownOpen||this.openDropdown()}onSearchTermChange(h){this.searchTerm=h,this.searchbarService.search(h),this.checkEmail(),this.textUpdated.emit(h)}checkEmail(){this.validEmail=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.searchTerm)}selectAgency(h,D){h||(h={name:this.searchTerm,email:"Esta agencia no est\xe1 registrada en Byvaro, se enviar\xe1 una invitaci\xf3n por e-mail."}),D.stopPropagation(),this.selectedAgency.emit({name:h.name,email:h.email,id:h.id,city:h.city,province:h.province,country:h.country,photoUrl:h.photoUrl}),this.closeDropdown()}openDropdown(){this.dropdownOpen=!0,this.attachDocumentClickListener()}closeDropdown(){this.dropdownOpen=!1,this.detachDocumentClickListener()}attachDocumentClickListener(){this.globalClickUnlistener=this.renderer.listen("document","click",h=>{h.target.closest(".agents-searchbar-container")||this.closeDropdown()})}detachDocumentClickListener(){this.globalClickUnlistener&&(this.globalClickUnlistener(),this.globalClickUnlistener=null)}ngOnDestroy(){this.detachDocumentClickListener(),this.searchSubscription.unsubscribe()}}return(I=$).\u0275fac=function(h){return new(h||I)(n.rXU(n.sFG),n.rXU(y))},I.\u0275cmp=n.VBU({type:I,selectors:[["app-agencies-searchbar"]],inputs:{ignoreIncludes:"ignoreIncludes"},outputs:{selectedAgency:"selectedAgency",textUpdated:"textUpdated"},decls:5,vars:2,consts:[[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar","crm-input-input-searchbar-square","agents-searchbar-container","secondary-border-1",3,"click"],[1,"fas","fa-search"],["type","text","placeholder","Email de la agencia",3,"ngModelChange","ngModel"],["class","dropdown-options",4,"ngIf"],[1,"dropdown-options"],[1,"crm-item-searchbar-agent-result"],["class","no-results",4,"ngIf"],[1,"crm-item-searchbar-agent-result",3,"click"],[1,"crm-item-searchbar-agent-result-left"],[1,"crm-item-searchbar-agent-result-left-image"],["alt","",3,"src"],["src","assets/images/building.png","alt",""],[1,"crm-item-searchbar-agent-result-left-info"],[1,"crm-item-searchbar-agent-result-left-info-name"],[1,"d-flex","align-center"],[1,"mx-10"],[1,"text-16","text-secondary"],[1,"crm-item-searchbar-agent-result-left-info-email"],[1,"text-secondary"],[1,"crm-item-searchbar-agent-result-right"],["src","assets/icon/blue-star-icon.svg","alt",""],[1,"no-results"]],template:function(h,D){1&h&&(n.j41(0,"div",0)(1,"div",1),n.bIt("click",function(Y){return D.onInputClick(Y)}),n.nrm(2,"i",2),n.j41(3,"input",3),n.mxI("ngModelChange",function(Y){return n.DH7(D.searchTerm,Y)||(D.searchTerm=Y),Y}),n.bIt("ngModelChange",function(Y){return D.onSearchTermChange(Y)}),n.k0s(),n.DNE(4,B,5,2,"div",4),n.k0s()()),2&h&&(n.R7$(3),n.R50("ngModel",D.searchTerm),n.R7$(),n.Y8G("ngIf",D.dropdownOpen))},dependencies:[f.bT,M.me,M.BC,M.vS],styles:[".agents-searchbar-container[_ngcontent-%COMP%]{position:relative;cursor:pointer}.dropdown-options[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;z-index:9999;background-color:#fff;padding:8px 0;border-radius:0 0 8px 8px;border:1px solid var(--crm-border-light-color);max-height:225px;overflow-y:auto;font-size:14px}.option[_ngcontent-%COMP%]{padding:8px;display:flex;align-items:center;cursor:pointer;font-size:14px}.option[_ngcontent-%COMP%]:hover{background-color:#f0f0f0}.no-results[_ngcontent-%COMP%]{padding:8px;color:#888}"]}),$})()},4646:(z,w,s)=>{s.d(w,{X:()=>T});var n=s(177),e=s(9417),x=s(3953);let T=(()=>{var k;class C{}return(k=C).\u0275fac=function(y){return new(y||k)},k.\u0275mod=x.$C({type:k}),k.\u0275inj=x.G2t({imports:[n.MD,e.YN]}),C})()},68:(z,w,s)=>{s.d(w,{k:()=>T});var n=s(177),e=s(9417),x=s(3953);let T=(()=>{var k;class C{}return(k=C).\u0275fac=function(y){return new(y||k)},k.\u0275mod=x.$C({type:k}),k.\u0275inj=x.G2t({imports:[n.MD,e.YN]}),C})()},2306:(z,w,s)=>{s.d(w,{T:()=>T});var n=s(177),e=s(9417),x=s(3953);let T=(()=>{var k;class C{}return(k=C).\u0275fac=function(y){return new(y||k)},k.\u0275mod=x.$C({type:k}),k.\u0275inj=x.G2t({imports:[n.MD,e.YN]}),C})()},5641:(z,w,s)=>{s.d(w,{D:()=>pe});var n=s(177),e=s(4716),x=s(9417),T=s(9465),k=s(7944),C=s(7991),g=s(4646),y=s(3955),f=s(2652),M=s(6812),t=s(3953);let G=(()=>{var r;class b{}return(r=b).\u0275fac=function(a){return new(a||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[n.MD,x.YN]}),b})();var E=s(6279);let c=(()=>{var r;class b{}return(r=b).\u0275fac=function(a){return new(a||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[n.MD,x.YN,x.X1,T.bv,y.h,M.u,G,E.F]}),b})();var u=s(2606),F=s(179),X=s(3675),B=s(2824),J=s(1968),I=s(3895),$=s(9662);let R=(()=>{var r;class b{}return(r=b).\u0275fac=function(a){return new(a||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[n.MD,x.YN,x.X1,T.bv,f.T,E.F,$.Y,y.h]}),b})();var h=s(3274),D=s(2306),K=s(68),Y=s(144),rt=s(8433),at=s(9066),mt=s(7774),et=s(467),pt=s(9420),gt=s(4760),ft=s(2081),ht=s(8397),Ct=s(6552),yt=s(5970);const Tt=r=>({"last-label-date":r});function St(r,b){1&r&&t.nrm(0,"img",9),2&r&&t.Y8G("src","assets/icon/checked-dot-icon.svg",t.B4B)}function Mt(r,b){1&r&&t.nrm(0,"img",10),2&r&&t.Y8G("src","assets/icon/secondary-dot-icon.svg",t.B4B)}function Et(r,b){if(1&r&&(t.j41(0,"div",14),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&r){const d=t.XpG().$implicit;t.R7$(),t.JRh(t.i5U(2,1,d.date,"dd/MM/yyyy HH:mm"))}}function It(r,b){if(1&r&&(t.j41(0,"div",7)(1,"div",8),t.DNE(2,St,1,1,"img",9)(3,Mt,1,1,"img",10),t.k0s(),t.j41(4,"div",11)(5,"div",12),t.EFF(6),t.k0s(),t.DNE(7,Et,3,4,"div",13),t.k0s()()),2&r){const d=b.$implicit,a=b.index,l=t.XpG(2);t.xc7("left",l.getLeftPosition(a,l.statusStepsArray.length-1),"%"),t.AVh("completed",d.completed),t.R7$(2),t.vxM(d.completed?2:3),t.R7$(2),t.Y8G("ngClass",t.eq3(8,Tt,a===l.statusStepsArray.length-1)),t.R7$(2),t.JRh(d.label),t.R7$(),t.Y8G("ngIf",d.date)}}function Ft(r,b){if(1&r&&(t.j41(0,"div",2),t.DNE(1,It,8,10,"div",3),t.j41(2,"div",4),t.nrm(3,"div",5)(4,"div",6),t.k0s()()),2&r){const d=t.XpG();t.R7$(),t.Y8G("ngForOf",d.statusStepsArray),t.R7$(3),t.xc7("width",d.getCompletedCount(),"%")}}function Pt(r,b){if(1&r&&(t.j41(0,"div",2)(1,"div",15),t.EFF(2),t.nI1(3,"date"),t.nrm(4,"i",16),t.k0s()()),2&r){const d=t.XpG();t.R7$(2),t.SpI(" Firma completada en ",t.i5U(3,1,null==d.statusStepsArray[d.statusStepsArray.length-1]?null:d.statusStepsArray[d.statusStepsArray.length-1].date,"dd/MM/yyyy HH:mm")," ")}}let Ot=(()=>{var r;class b{constructor(){this.statusSteps={sent:{label:"Sent",date:"",completed:!0},delivered:{label:"Delivered",date:"",completed:!1},unopened:{label:"Unopened",date:"",completed:!1},unsigned:{label:"Unsigned",date:"",completed:!1},signed:{label:"Signed",date:"",completed:!1}},this.statusStepsArray=[this.statusSteps.sent,this.statusSteps.delivered,this.statusSteps.unopened,this.statusSteps.unsigned,this.statusSteps.signed]}ngOnChanges(a){this.updateStatusStepsArray()}ngOnInit(){console.log("DocumentStatusTrackerComponent statusSteps",this.statusSteps),this.updateStatusStepsArray()}updateStatusStepsArray(){this.statusStepsArray=[this.statusSteps.sent,this.statusSteps.delivered,this.statusSteps.unopened,this.statusSteps.unsigned,this.statusSteps.signed]}getLeftPosition(a,l){return 0===a?0:a*(100/l)}getCompletedCount(){let a=this.statusStepsArray.filter(l=>l.completed);return this.getLeftPosition(a.length-1,this.statusStepsArray.length-1)}}return(r=b).\u0275fac=function(a){return new(a||r)},r.\u0275cmp=t.VBU({type:r,selectors:[["app-document-status-tracker"]],inputs:{statusSteps:"statusSteps"},features:[t.OA$],decls:3,vars:2,consts:[[1,"status-tracker","w-full"],["class","line-container d-flex justify-between relative w-full","style","width: 100%;",4,"ngIf"],[1,"line-container","d-flex","justify-between","relative","w-full",2,"width","100%"],["class","step absolute","style","z-index:1",3,"completed","left",4,"ngFor","ngForOf"],[1,"w-full"],[1,"w-full","secondary-border-1"],[1,"primary-border-1","absolute",2,"top","0"],[1,"step","absolute",2,"z-index","1"],[1,"relative"],["alt","",1,"absolute",2,"top","-7px",3,"src"],["alt","",1,"absolute",2,"top","-3px",3,"src"],[1,"label-date",2,"margin-top","10px",3,"ngClass"],[1,"label","text-10"],["class","date  text-12 text-secondary",4,"ngIf"],[1,"date","text-12","text-secondary"],[2,"color","green"],[1,"fa-solid","fa-check"]],template:function(a,l){1&a&&(t.j41(0,"div",0),t.DNE(1,Ft,5,3,"div",1)(2,Pt,5,4,"div",1),t.k0s()),2&a&&(t.R7$(),t.Y8G("ngIf",!(null!=l.statusStepsArray[l.statusStepsArray.length-1]&&l.statusStepsArray[l.statusStepsArray.length-1].completed)),t.R7$(),t.Y8G("ngIf",null==l.statusStepsArray[l.statusStepsArray.length-1]?null:l.statusStepsArray[l.statusStepsArray.length-1].completed))},dependencies:[n.YU,n.Sq,n.bT,n.vh],styles:[".last-label-date[_ngcontent-%COMP%]{margin-left:-35px}"]}),b})();const bt=()=>[];function Rt(r,b){if(1&r&&(t.j41(0,"div",19),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&r){const d=t.XpG(2);t.R7$(),t.SpI(" Added ",t.i5U(2,1,d.options.existingOperationDocument.createdAt,"dd/MM/yyyy HH:mm"),"")}}function Bt(r,b){if(1&r){const d=t.RV6();t.j41(0,"div")(1,"img",20),t.bIt("click",function(l){t.eBV(d);const S=t.XpG(2);return t.Njj(S.onItemMenuClick(l))}),t.k0s()()}2&r&&(t.R7$(),t.Y8G("src","assets/icon/more-vertical-icon.svg",t.B4B))}function At(r,b){if(1&r){const d=t.RV6();t.j41(0,"div",21)(1,"button",22),t.bIt("click",function(){t.eBV(d);const l=t.XpG(2);return t.Njj(l.onUploadNewDocument())}),t.EFF(2,"Subir nuevo documento"),t.k0s()()}}function jt(r,b){1&r&&(t.j41(0,"span",24),t.EFF(1,"Este documento ya est\xe1 firmado. Debes a\xf1adir a los firmantes para completar el registro."),t.k0s())}function $t(r,b){1&r&&(t.j41(0,"span",24),t.EFF(1,"Este documento est\xe1 listo para ser enviado para firma."),t.k0s())}function Ut(r,b){if(1&r){const d=t.RV6();t.j41(0,"button",27),t.bIt("click",function(){t.eBV(d);const l=t.XpG(3);return t.Njj(l.onAddSigners())}),t.nrm(1,"img",28),t.EFF(2," A\xf1adir firmantes"),t.k0s()}}function wt(r,b){if(1&r){const d=t.RV6();t.j41(0,"button",29),t.bIt("click",function(){t.eBV(d);const l=t.XpG(3);return t.Njj(l.onSendForSignature())}),t.EFF(1,"Enviar a firmar"),t.k0s()}}function Gt(r,b){if(1&r&&(t.j41(0,"div",8)(1,"div",23),t.nrm(2,"img",10),t.DNE(3,jt,2,0,"span",24)(4,$t,2,0,"span",24),t.k0s(),t.DNE(5,Ut,3,0,"button",25)(6,wt,2,0,"button",26),t.k0s()),2&r){const d=t.XpG(2);t.R7$(2),t.Y8G("src","assets/icon/warning-red-icon.svg",t.B4B),t.R7$(),t.vxM("alreadySigned"===d.options.existingOperationDocument.documentFlowType?3:4),t.R7$(2),t.vxM("alreadySigned"===d.options.existingOperationDocument.documentFlowType?5:6)}}function Nt(r,b){if(1&r&&(t.j41(0,"div",38),t.EFF(1),t.k0s()),2&r){const d=t.XpG().$implicit,a=t.XpG(3);t.R7$(),t.JRh(null==a.options.existingOperationDocument?null:a.options.existingOperationDocument.contactsToSignData[d.id].relationType)}}function Xt(r,b){1&r&&(t.j41(0,"div",38),t.EFF(1,"Comprator"),t.k0s())}function Lt(r,b){if(1&r&&(t.j41(0,"div",41),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&r){const d=t.XpG().$implicit,a=t.XpG(3);t.R7$(),t.SpI("Firmado en ",t.i5U(2,1,null==a.options.existingOperationDocument?null:a.options.existingOperationDocument.contactsToSignData[d.id].signedDate,"dd/MM/yyyy"),"")}}function p(r,b){1&r&&t.nrm(0,"div",41)}function O(r,b){if(1&r&&(t.j41(0,"div",30)(1,"div",31)(2,"div",32),t.EFF(3),t.k0s(),t.j41(4,"div",33)(5,"div",34),t.nrm(6,"img",35),t.k0s(),t.j41(7,"div",36)(8,"div",37),t.EFF(9),t.k0s(),t.DNE(10,Nt,2,1,"div",38)(11,Xt,2,0,"div",38),t.k0s()(),t.j41(12,"div",39),t.nrm(13,"img",40),t.DNE(14,Lt,3,4,"div",41)(15,p,1,0,"div",41),t.k0s()()()),2&r){const d=b.$implicit,a=b.$index,l=t.XpG(3);t.R7$(3),t.SpI("",a+1,"."),t.R7$(3),t.Y8G("src",(null==d?null:d.photoUrl)||"assets/images/avatar.png",t.B4B),t.R7$(3),t.JRh(d.name),t.R7$(),t.vxM(null!=l.options&&null!=l.options.existingOperationDocument&&l.options.existingOperationDocument.contactsToSignData&&null!=l.options&&null!=l.options.existingOperationDocument&&l.options.existingOperationDocument.contactsToSignData[d.id]?10:11),t.R7$(4),t.vxM(null!=l.options&&null!=l.options.existingOperationDocument&&l.options.existingOperationDocument.contactsToSignData&&null!=l.options&&null!=l.options.existingOperationDocument&&l.options.existingOperationDocument.contactsToSignData[d.id]?14:15)}}function m(r,b){if(1&r&&t.Z7z(0,O,16,5,"div",30,t.fX1),2&r){const d=t.XpG(2);t.Dyx(null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.contactsToSign)}}function i(r,b){if(1&r&&(t.j41(0,"div",30)(1,"div",31)(2,"div",32),t.EFF(3),t.k0s(),t.j41(4,"div",33)(5,"div",34),t.nrm(6,"img",35),t.k0s(),t.j41(7,"div",36)(8,"div",37),t.EFF(9),t.k0s(),t.j41(10,"div",38),t.EFF(11),t.k0s()()(),t.j41(12,"div",39),t.nrm(13,"img",40),t.j41(14,"div",41),t.EFF(15),t.nI1(16,"date"),t.k0s()()()()),2&r){const d=t.XpG(),a=d.$implicit,l=d.$index,S=t.XpG(3);t.R7$(3),t.SpI("",l+1,"."),t.R7$(3),t.Y8G("src",(null==a?null:a.photoUrl)||"assets/images/avatar.png",t.B4B),t.R7$(3),t.JRh(a.name),t.R7$(2),t.JRh(null==S.options.existingOperationDocument?null:S.options.existingOperationDocument.contactsToSignData[a.id].relationType),t.R7$(4),t.SpI("Firmado en ",t.i5U(16,5,null==S.options.existingOperationDocument?null:S.options.existingOperationDocument.contactsToSignData[a.id].signedDate,"dd/MM/yyyy")," ")}}function o(r,b){if(1&r&&t.DNE(0,i,17,8,"div",30),2&r){const d=b.$implicit,a=t.XpG(3);t.vxM(null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData&&null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData[d.id]?0:-1)}}function _(r,b){if(1&r&&t.Z7z(0,o,1,1,null,null,t.fX1),2&r){const d=t.XpG(2);t.Dyx(null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.contactsToSign)}}function v(r,b){if(1&r){const d=t.RV6();t.j41(0,"div",50)(1,"button",51),t.bIt("click",function(){t.eBV(d);const l=t.XpG(2).$implicit,S=t.XpG(4);return t.Njj(S.onResendClick({contact:l}))}),t.nrm(2,"img",10),t.EFF(3," Resend"),t.k0s()()}2&r&&(t.R7$(2),t.Y8G("src","assets/icon/refresh-icon.svg",t.B4B))}function P(r,b){if(1&r&&(t.j41(0,"div",45)(1,"div",46),t.EFF(2),t.k0s(),t.j41(3,"div",47),t.nrm(4,"app-document-status-tracker",48),t.k0s(),t.DNE(5,v,4,1,"div",49),t.k0s()),2&r){let d;const a=t.XpG(),l=a.$implicit,S=a.$index,A=t.XpG(4);t.R7$(2),t.Lme("",S+1,". ",l.name,""),t.R7$(2),t.Y8G("statusSteps",A.getDocumentStatusStepsForAssignedSigner(l)),t.R7$(),t.Y8G("ngIf",!(null!=(d=A.getDocumentStatusStepsForAssignedSigner(l))&&null!=d.signed&&d.signed.completed))}}function W(r,b){if(1&r&&t.DNE(0,P,6,4,"div",45),2&r){const d=b.$implicit,a=t.XpG(4);t.vxM(null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData&&null!=a.options&&null!=a.options.existingOperationDocument&&a.options.existingOperationDocument.contactsToSignData[d.id]?-1:0)}}function V(r,b){1&r&&(t.j41(0,"div",44),t.EFF(1,"No hay contactos asignados para firmar este documento."),t.k0s())}function st(r,b){if(1&r){const d=t.RV6();t.j41(0,"div",45)(1,"div",46),t.EFF(2),t.k0s(),t.j41(3,"div",47),t.nrm(4,"app-document-status-tracker",48),t.k0s(),t.j41(5,"div",50)(6,"button",51),t.bIt("click",function(){const l=t.eBV(d).$implicit,S=t.XpG(4);return t.Njj(S.onResendClick({user:l}))}),t.nrm(7,"img",10),t.EFF(8," Resend"),t.k0s()()()}if(2&r){const d=b.$implicit,a=b.$index,l=t.XpG(4);t.R7$(2),t.Lme("",a+1,". ",d.name,""),t.R7$(2),t.Y8G("statusSteps",l.getDocumentStatusStepsForAssignedSigner(d)),t.R7$(3),t.Y8G("src","assets/icon/refresh-icon.svg",t.B4B)}}function nt(r,b){1&r&&(t.j41(0,"div",44),t.EFF(1,"No hay usuarios asignados para firmar este documento."),t.k0s())}function Z(r,b){if(1&r&&(t.j41(0,"div"),t.nrm(1,"br"),t.j41(2,"div",42),t.EFF(3),t.k0s(),t.nrm(4,"br"),t.j41(5,"div",43),t.EFF(6," Contactos firmantes: "),t.k0s(),t.Z7z(7,W,1,1,null,null,t.fX1),t.DNE(9,V,2,0,"div",44),t.nrm(10,"br"),t.j41(11,"div",43),t.EFF(12," Usuarios firmantes: "),t.k0s(),t.Z7z(13,st,9,4,"div",45,t.fX1),t.DNE(15,nt,2,0,"div",44),t.nrm(16,"br"),t.k0s()),2&r){const d=t.XpG(3);t.R7$(3),t.SpI(" Estado firma del documento: ",d.options.existingOperationDocument.documentSignStatus," "),t.R7$(4),t.Dyx((null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.contactsToSign)||t.lJ4(3,bt)),t.R7$(2),t.vxM(0===(null==d.options.existingOperationDocument.contactsToSign?null:d.options.existingOperationDocument.contactsToSign.length)?9:-1),t.R7$(4),t.Dyx(d.options.existingOperationDocument.usersToSign||t.lJ4(4,bt)),t.R7$(2),t.vxM(0===(null==d.options.existingOperationDocument.contactsToSign?null:d.options.existingOperationDocument.contactsToSign.length)?15:-1)}}function tt(r,b){if(1&r&&t.DNE(0,Z,17,5,"div",15),2&r){const d=t.XpG(2);t.Y8G("ngIf",d.options.existingOperationDocument&&d.options.existingOperationDocument.documentSignStatus)}}function U(r,b){if(1&r&&(t.j41(0,"div",1)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t.EFF(5),t.k0s(),t.nrm(6,"div",5),t.k0s(),t.j41(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9),t.nrm(11,"img",10),t.j41(12,"div",11)(13,"div",12),t.EFF(14),t.k0s(),t.j41(15,"div",13),t.EFF(16),t.k0s(),t.DNE(17,Rt,3,4,"div",14),t.k0s()(),t.DNE(18,Bt,2,1,"div",15),t.k0s(),t.nrm(19,"div",16),t.DNE(20,At,3,0,"div",17)(21,Gt,7,3,"div",18)(22,m,2,0)(23,_,2,0),t.k0s()()(),t.DNE(24,tt,1,1,"div"),t.k0s()()),2&r){const d=t.XpG();t.R7$(5),t.JRh((null==d.options?null:d.options.visibleIndex)||1),t.R7$(6),t.Y8G("src","assets/icon/icon-1.svg",t.B4B),t.R7$(3),t.SpI("",d.options.title," "),t.R7$(2),t.JRh(d.options.subtitle||d.options.documentType),t.R7$(),t.Y8G("ngIf",d.options.existingOperationDocument),t.R7$(),t.Y8G("ngIf",d.options.existingOperationDocument),t.R7$(2),t.Y8G("ngIf",!d.options.existingOperationDocument),t.R7$(),t.Y8G("ngIf",d.options.existingOperationDocument&&"notNecessary"!==d.options.existingOperationDocument.documentFlowType&&!d.options.existingOperationDocument.documentSignStatus),t.R7$(),t.vxM("alreadySigned"===(null==d.options||null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.documentFlowType)&&d.options.existingOperationDocument&&d.options.existingOperationDocument.documentSignStatus?22:"partiallySigned"===(null==d.options||null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.documentFlowType)?23:-1),t.R7$(2),t.vxM("alreadySigned"!==(null==d.options||null==d.options.existingOperationDocument?null:d.options.existingOperationDocument.documentFlowType)?24:-1)}}let L=(()=>{var r;class b{constructor(a,l,S,A,j){this.modalCtrl=a,this.api=l,this.toast=S,this.utils=A,this.popoversService=j,this.triggerAfterDocumentCreation=new t.bkB}ngOnInit(){console.log("SignDocumentFlowComponent options",this.options)}onSendForSignature(a){var l=this;return(0,et.A)(function*(){var S;const A=yield l.modalCtrl.create({component:gt.i,componentProps:{operationId:l.options.operationId,operationDocument:l.options.existingOperationDocument,operation:l.options.operation,promotion:l.options.promotion,options:{resend:(null==a?void 0:a.resend)||!1,contactsToSign:l.options.contactsToSign||[]}},cssClass:"modal-upload-document backdrop-opacity-0-52"});yield A.present();const j=yield A.onDidDismiss();if(null!=j&&null!==(S=j.data)&&void 0!==S&&S.reload){const N=yield l.api.getOperationDocumentById(l.options.existingOperationDocument.id);if(!N.success)return void l.toast.showErrorToast(N.error.errorMessage);l.options.existingOperationDocument=N.success.data,l.options.existingOperationDocument.documentSignStatus="pending"}})()}onAddSigners(a){var l=this;return(0,et.A)(function*(){var S;const A=yield l.modalCtrl.create({component:gt.i,componentProps:{operationId:l.options.operationId,operation:l.options.operation,promotion:l.options.promotion,operationDocument:l.options.existingOperationDocument,options:{resend:(null==a?void 0:a.resend)||!1,contactsToSign:l.options.contactsToSign||[]}},cssClass:"modal-upload-document backdrop-opacity-0-52"});yield A.present(),yield A.present();const j=yield A.onDidDismiss();if(null!=j&&null!==(S=j.data)&&void 0!==S&&S.reload){const N=yield l.api.getOperationDocumentById(l.options.existingOperationDocument.id);if(!N.success)return void l.toast.showErrorToast(N.error.errorMessage);l.options.existingOperationDocument=N.success.data,l.options.existingOperationDocument.documentSignStatus="pending"}})()}onGoToSeeDocument(){var a;window.open(null===(a=this.options.existingOperationDocument)||void 0===a?void 0:a.url,"_blank")}getDocumentStatusStepsForAssignedSigner(a){var l,S,A;let j={sent:{label:"Sent",date:"",completed:!0},delivered:{label:"Delivered",date:"",completed:!1},unopened:{label:"Unopened",date:"",completed:!1},unsigned:{label:"Unsigned",date:"",completed:!1},signed:{label:"Signed",date:"",completed:!1}};const N=null!==(l=null===(S=this.options.existingOperationDocument)||void 0===S?void 0:S.docusignUpdates)&&void 0!==l?l:[];if(console.log("UPDATES",N),!N||0===N.length)return j;const ut=null===(A=N[N.length-1].recipients)||void 0===A||null===(A=A.signers)||void 0===A?void 0:A.find(ot=>String(ot.recipientId)===String(a.id)||String(ot.clientUserId)===String(a.id));return ut&&(console.log("SIGNER",ut),j.sent.date=ut.sentDateTime||"",j.delivered.date=ut.deliveredDateTime||"",j.delivered.date&&(j.delivered.completed=!0),j.signed.date=ut.signedDateTime||"",j.signed.date&&(j.signed.completed=!0)),j}onResendClick(a){var l=this;return(0,et.A)(function*(){const S=a.contact,A=a.user,j=yield l.api.resendOperationDocumentSignForContact(l.options.operationId,l.options.existingOperationDocument.id,(null==S?void 0:S.id)||(null==A?void 0:A.id));j.success?l.toast.showSuccessToast("Documento reenviado correctamente"):l.toast.showErrorToast(j.error.errorMessage);const N=yield l.api.getOperationDocumentById(l.options.existingOperationDocument.id);N.success?l.options.existingOperationDocument=N.success.data:l.toast.showErrorToast(N.error.errorMessage)})()}onUploadNewDocument(){var a=this;return(0,et.A)(function*(){var l;const S=yield a.modalCtrl.create({component:pt.a,componentProps:{operationId:a.options.operationId,uploadedDocument:a.options.existingOperationDocument||null,options:{documentType:a.options.documentType,visibleStep:a.options.visibleStep||null,allowNotFirmNecessary:a.options.allowNotFirmNecessary||!1,reference:a.options.reference||null,isStandalone:a.options.isStandalone||!1}},cssClass:"modal-upload-document backdrop-opacity-0-52"});yield S.present();const A=yield S.onDidDismiss();null!=A&&null!==(l=A.data)&&void 0!==l&&l.reload&&A.data.operationDocument&&(a.options.existingOperationDocument=A.data.operationDocument,a.options.title=A.data.operationDocument.title,a.triggerAfterDocumentCreation.emit())})()}onItemMenuClick(a){var l=this;return(0,et.A)(function*(){var S;if(a.stopPropagation(),a.preventDefault(),!l.options.existingOperationDocument)return;if(l.options.existingOperationDocument.documentSignStatus){var A;let ot;if(ot="signed"===l.options.existingOperationDocument.documentSignStatus?yield l.popoversService.onShowMenuPopover(a,"operation-document-sign-completed-actions"):yield l.popoversService.onShowMenuPopover(a,"operation-document-sign-actions"),null!==(A=ot)&&void 0!==A&&A.data){const lt=ot.data;if("upload-new-document"===lt&&(yield l.onUploadNewDocument()),"resend-document"===lt&&(yield l.onSendForSignature({resend:!0})),"view-document"===lt&&(yield l.onGoToSeeDocument()),"cancel-document"===lt){if("alreadySigned"===l.options.existingOperationDocument.documentFlowType){let it=l.options.existingOperationDocument;it.contactsToSign=[],it.contactsToSignData={},it.documentSignStatus=null,yield l.api.updateOperationDocument(it.operationId,it.id,it)}else yield l.api.cancelOperationDocumentSign(l.options.operationId,l.options.existingOperationDocument.id);l.toast.showSuccessToast("Firma del documento cancelada correctamente")}if("download-certificate"===lt){var j,N;const it=l.options.existingOperationDocument.docusignUpdates||[],H=it[it.length-1],kt=null==H||null===(j=H.envelopeDocuments)||void 0===j||null===(j=j[(null==H?void 0:H.envelopeDocuments.length)-1])||void 0===j?void 0:j.PDFBytes;if(null==H||null===(N=H.envelopeDocuments)||void 0===N||(N=N[0]),console.log("certificateBase64",kt),kt){const _t=l.base64PdfToBlob(kt);console.log("BLOB",_t);const vt=URL.createObjectURL(_t);console.log("URL",vt),window.open(vt,"_blank")}}if("download-signed-document"===lt){var q,Q;const it=l.options.existingOperationDocument.docusignUpdates||[],H=it[it.length-1];console.log("LAST UPDATE",H),null==H||null===(q=H.envelopeDocuments)||void 0===q||(q=q[(null==H?void 0:H.envelopeDocuments.length)-1]);const Dt=null==H||null===(Q=H.envelopeDocuments)||void 0===Q||null===(Q=Q[0])||void 0===Q?void 0:Q.PDFBytes;if(console.log("contractSignedBase64",Dt),Dt){const _t=l.base64PdfToBlob(Dt);console.log("BLOB",_t);const vt=URL.createObjectURL(_t);console.log("URL",vt),window.open(vt,"_blank")}}}}else{const ot=yield l.popoversService.onShowMenuPopover(a,"operation-document-upload-actions");if(null!=ot&&ot.data){const lt=ot.data;"upload-new-document"===lt&&(yield l.onUploadNewDocument()),"view-document"===lt&&l.onGoToSeeDocument(),"send-to-sign"===lt&&(yield l.onSendForSignature()),"delete-document"===lt&&(yield l.api.deleteOperationDocument(l.options.operationId,l.options.existingOperationDocument.id)),l.triggerAfterDocumentCreation.emit()}}const ut=yield l.api.getOperationDocumentById(l.options.existingOperationDocument.id);l.options.existingOperationDocument=null===(S=ut.success)||void 0===S?void 0:S.data})()}base64PdfToBlob(a){const l=atob(a),S=new Array(l.length);for(let j=0;j<l.length;j++)S[j]=l.charCodeAt(j);const A=new Uint8Array(S);return new Blob([A],{type:"application/pdf"})}}return(r=b).\u0275fac=function(a){return new(a||r)(t.rXU(T.W3),t.rXU(ft.i),t.rXU(ht.f),t.rXU(Ct.T),t.rXU(yt.m))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-sign-document-flow"]],inputs:{options:"options"},outputs:{triggerAfterDocumentCreation:"triggerAfterDocumentCreation"},decls:1,vars:1,consts:[["class","",4,"ngIf"],[1,""],[1,"d-flex"],[1,"pl-8","pr-15"],[1,"text-14","bg-white","d-flex","align-center","justify-center","border-radius-full",2,"width","30px","height","30px"],[1,"secondary-border-1","ml-15",2,"height","100%","width","1px","border-left-width","0"],[1,"w-full","bg-white","border-radius-16",2,"box-shadow","0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1)"],[1,"p-24"],[1,"d-flex","justify-between","align-center"],[1,"text-14","d-flex","align-center"],["alt","",3,"src"],[1,"ml-15"],[1,"text-16","text-black"],[1,"text-14","text-secondary"],["class","text-12 text-secondary",4,"ngIf"],[4,"ngIf"],[1,"secondary-border-1","my-24","border-bottom-unset"],["class","d-flex justify-center pt-16",4,"ngIf"],["class","d-flex justify-between align-center",4,"ngIf"],[1,"text-12","text-secondary"],["alt","",2,"cursor","pointer",3,"click","src"],[1,"d-flex","justify-center","pt-16"],[1,"crm-button","crm-button-outline-primary","ml-10",3,"click"],[1,"text-error","text-14","d-flex","align-center"],[1,"pl-10"],[1,"crm-button","crm-button-secondary","text-secondary","text-[14px]"],[1,"crm-button"],[1,"crm-button","crm-button-secondary","text-secondary","text-[14px]",3,"click"],["src","assets/icon/plus-icon.svg","alt",""],[1,"crm-button",3,"click"],[1,"rounded-[16px]","mt-[10px]","p-[16px]","w-full","secondary-border-1","flex","justify-between","items-center"],[1,"flex","justify-start","w-full","items-center"],[1,"text-[14px]"],[1,"flex","items-center","w-[350px]"],[1,"w-[50px]","rounded-[100%]","ml-[15px]"],["alt","",1,"w-[38px]","h-[38px]","rounded-[100%]",3,"src"],[1,"ml-[10px]"],[1,"text-[13px]","text-black"],[1,"text-[10px]","text-secondary"],[1,"flex","text-[#00C751]","text-[12px]","w-full","items-center","ml-[20px]"],["src","assets/icon/checked-green-icon.svg","alt",""],[1,"ml-10"],[1,"crm-title","text-14","text-black","mt-24"],[1,"crm-text"],[1,"text-14","text-secondary","mt-16"],[1,"d-flex","mt-16","justify-between","pt-24","pb-16","px-16","secondary-border-1","border-radius-16"],[1,"text-14","-mt-10"],[2,"width","70%","height","40px"],[3,"statusSteps"],["class","-mt-10 ml-10",4,"ngIf"],[1,"-mt-10","ml-10"],[1,"text-14","text-secondary","bg-white","secondary-border-1","px-12","py-8","border-radius-8",3,"click"]],template:function(a,l){1&a&&t.DNE(0,U,25,10,"div",0),2&a&&t.Y8G("ngIf",l.options)},dependencies:[n.bT,Ot,n.vh]}),b})();var dt=s(1129);const Vt=["fileUploaderManagerComponent"],ct=r=>({"crm-input-input-error":r}),xt=r=>({field:r}),Wt=r=>({item:r});function zt(r,b){1&r&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"errors.required")," "))}function Ht(r,b){1&r&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"errors.required")," "))}function Jt(r,b){1&r&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"errors.required")," "))}function Zt(r,b){1&r&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"errors.required")," "))}function Qt(r,b){if(1&r){const d=t.RV6();t.j41(0,"div",15)(1,"div",27)(2,"div",28),t.nrm(3,"span"),t.k0s(),t.j41(4,"div",29),t.EFF(5),t.k0s()(),t.j41(6,"div",30),t.bIt("click",function(){const l=t.eBV(d).$implicit,S=t.XpG();return t.Njj(S.onRemoveLanguage(l))}),t.nrm(7,"i",31),t.k0s()()}if(2&r){let d,a;const l=b.$implicit,S=t.XpG();t.R7$(3),t.HbH(null==(d=S.getLanguageInfo(l))?null:d.flagClass),t.R7$(2),t.SpI(" ",null==(a=S.getLanguageInfo(l))?null:a.name," ")}}function qt(r,b){if(1&r&&(t.j41(0,"option",34),t.EFF(1),t.k0s()),2&r){const d=b.$implicit;t.Y8G("value",d.id),t.R7$(),t.JRh(d.name)}}function te(r,b){if(1&r&&(t.j41(0,"div",32)(1,"select",33),t.Z7z(2,qt,2,2,"option",34,t.fX1),t.k0s()()),2&r){const d=t.XpG();t.R7$(2),t.Dyx(d.roles)}}function ee(r,b){1&r&&(t.j41(0,"div",26),t.EFF(1),t.nI1(2,"translate"),t.k0s()),2&r&&(t.R7$(),t.SpI(" ",t.bMT(2,1,"errors.required")," "))}function ne(r,b){if(1&r){const d=t.RV6();t.j41(0,"button",35),t.bIt("click",function(){t.eBV(d);const l=t.XpG();return t.Njj(l.changeUserInactiveState(!1))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"text.activate_user")))}function oe(r,b){if(1&r){const d=t.RV6();t.j41(0,"button",36),t.bIt("click",function(){t.eBV(d);const l=t.XpG();return t.Njj(l.changeUserInactiveState(!0))}),t.EFF(1),t.nI1(2,"translate"),t.k0s()}2&r&&(t.R7$(),t.JRh(t.bMT(2,1,"text.deactivate_user")))}let ie=(()=>{var r;class b{constructor(a,l,S,A,j,N){this.fb=a,this.utils=l,this.popoverService=S,this.api=A,this.toast=j,this.translate=N,this.user={},this.onChange=new t.bkB,this.userCopy=null,this.files=[],this.photoEdited=!1,this.roles=[]}ngOnInit(){var a=this;return(0,et.A)(function*(){a.userCopy=JSON.parse(JSON.stringify(a.user)),a.initForm(),a.user?(a.populateForm(a.userCopy),a.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]},a.fileUploaderManager.createProfileFilePic(a.user)):a.fileUploaderManager.config={multiple:!1,size:"medium",showRemove:!0,showName:!1,rounded:!0,allowUpload:!0,accept:"image/*",files:[]};const l=yield a.api.getAccessRole();l.success?a.roles=l.success.data:a.toast.showErrorToast(a.translate.instant("text.error_loading_roles")+" "+l.error.errorMessage)})()}getLanguageInfo(a){return this.utils.getLanguageInfo(a)}onAddLanguage(a){var l=this;return(0,et.A)(function*(){var S,A;const j={languageSelector:!0,showCountryCode:!1,selectedCodes:null===(S=l.user)||void 0===S?void 0:S.languages},N=yield l.popoverService.onShowCountrySelectorPopover(a,j);var q,Q;null!=N&&null!==(A=N.data)&&void 0!==A&&A.country&&(l.user=l.user||{},l.user.languages=(null===(q=l.user)||void 0===q?void 0:q.languages)||[],l.user.languages.push(null===(Q=N.data)||void 0===Q||null===(Q=Q.country)||void 0===Q?void 0:Q.code))})()}changeUserInactiveState(a){var l=this;return(0,et.A)(function*(){const S=yield l.api.updateUserById(l.user.id,{...l.user,inactive:a});S.success?(l.user.inactive=a,l.toast.showSuccessToast(l.translate.instant("text.user_status_updated"))):l.toast.showErrorToast(l.translate.instant("text.error_updating_user_status")+" "+S.error.errorMessage)})()}onRemoveLanguage(a){this.user.languages=this.user.languages.filter(l=>l!==a)}initForm(){this.userForm=this.fb.group({email:["",x.k0.required],name:["",x.k0.required],jobTitle:[""],phone:["+34 "],visibleForCollaborators:[],accessRoleId:["",x.k0.required],allowSignOnBehalf:[]})}populateForm(a){var l,S,A,j,N,q,Q;this.userForm.patchValue({email:null!==(l=null==a?void 0:a.email)&&void 0!==l?l:"",name:null!==(S=null==a?void 0:a.name)&&void 0!==S?S:"",jobTitle:null!==(A=null==a?void 0:a.jobTitle)&&void 0!==A?A:"",phone:null!==(j=null==a?void 0:a.phone)&&void 0!==j?j:"",visibleForCollaborators:null!==(N=null==a?void 0:a.visibleForCollaborators)&&void 0!==N&&N,accessRoleId:null!==(q=null==a?void 0:a.accessRoleId)&&void 0!==q?q:"",allowSignOnBehalf:null!==(Q=null==a?void 0:a.allowSignOnBehalf)&&void 0!==Q&&Q}),this.userForm.get("email").disable()}onSelectCountry(a){this.userForm.get("phone").setValue((null==a?void 0:a.phoneCode)+" ")}isControlInvalid(a){const l=this.userForm.get(a);return!(!l||!l.invalid||!l.dirty&&!l.touched)}}return(r=b).\u0275fac=function(a){return new(a||r)(t.rXU(x.ok),t.rXU(Ct.T),t.rXU(yt.m),t.rXU(ft.i),t.rXU(ht.f),t.rXU(y.c$))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-user-form"]],viewQuery:function(a,l){if(1&a&&t.GBs(Vt,7),2&a){let S;t.mGM(S=t.lsd())&&(l.fileUploaderManager=S.first)}},inputs:{user:"user"},outputs:{onChange:"onChange"},decls:89,vars:93,consts:[["fileUploaderManagerComponent",""],[1,"crm-section",3,"formGroup"],[1,"crm-section-small-title"],[1,"crm-input"],[1,"crm-input-label"],[1,"crm-input-input",3,"ngClass"],["type","text","formControlName","email",3,"placeholder"],["class","crm-input-error",4,"ngIf"],["type","text","formControlName","name",3,"placeholder"],["type","text","formControlName","jobTitle",3,"placeholder"],[1,"crm-input-input-and-icon"],[3,"emitCountrySelected"],["type","text","formControlName","phone",3,"placeholder"],[1,"crm-input","crm-input-medium"],[1,"crm-section-items"],[1,"crm-item-option","crm-item-option-lang","edit"],["type","button",1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fas","fa-add"],["class","crm-input-input",4,"ngIf"],[1,"crm-input-checkboxes"],["appToggleCheckbox","",1,"crm-input-checkbox"],["formControlName","visibleForCollaborators"],[1,"crm-input-checkbox-label"],["formControlName","allowSignOnBehalf"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button-secondary","crm-button-secondary-red"],[1,"crm-input-error"],[1,"crm-item-option-left"],[1,"crm-item-option-flag"],[1,"crm-item-option-label"],[1,"crm-item-option-remove",3,"click"],[1,"fas","fa-trash"],[1,"crm-input-input"],["placeholder","Seleccione","formControlName","accessRoleId"],[3,"value"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"crm-button-secondary","crm-button-secondary-red",3,"click"]],template:function(a,l){if(1&a){const S=t.RV6();t.j41(0,"form",1)(1,"div",2),t.EFF(2),t.nI1(3,"translate"),t.k0s(),t.nrm(4,"app-file-uploader-manager",null,0),t.j41(6,"div",3)(7,"div",4),t.EFF(8),t.nI1(9,"translate"),t.k0s(),t.j41(10,"div",5),t.nrm(11,"input",6),t.nI1(12,"translate"),t.nI1(13,"translate"),t.k0s(),t.DNE(14,zt,3,3,"div",7),t.k0s(),t.j41(15,"div",3)(16,"div",4),t.EFF(17),t.nI1(18,"translate"),t.k0s(),t.j41(19,"div",5),t.nrm(20,"input",8),t.nI1(21,"translate"),t.nI1(22,"translate"),t.k0s(),t.DNE(23,Ht,3,3,"div",7),t.k0s(),t.j41(24,"div",3)(25,"div",4),t.EFF(26),t.nI1(27,"translate"),t.k0s(),t.j41(28,"div",5),t.nrm(29,"input",9),t.nI1(30,"translate"),t.nI1(31,"translate"),t.k0s(),t.DNE(32,Jt,3,3,"div",7),t.k0s(),t.j41(33,"div",3)(34,"div",4),t.EFF(35),t.nI1(36,"translate"),t.k0s(),t.j41(37,"div",10)(38,"div",5)(39,"app-flag-country-selector",11),t.bIt("emitCountrySelected",function(j){return t.eBV(S),t.Njj(l.onSelectCountry(j))}),t.k0s(),t.nrm(40,"input",12),t.nI1(41,"translate"),t.nI1(42,"translate"),t.k0s()(),t.DNE(43,Zt,3,3,"div",7),t.k0s(),t.j41(44,"div",13)(45,"div",4),t.EFF(46),t.nI1(47,"translate"),t.k0s(),t.j41(48,"div",14),t.Z7z(49,Qt,8,3,"div",15,t.fX1),t.j41(51,"button",16),t.bIt("click",function(j){return t.eBV(S),t.Njj(l.onAddLanguage(j))}),t.nrm(52,"i",17),t.EFF(53),t.nI1(54,"translate"),t.nI1(55,"translate"),t.k0s(),t.nrm(56,"br"),t.j41(57,"div",3)(58,"div",4),t.EFF(59),t.nI1(60,"translate"),t.k0s(),t.DNE(61,te,4,0,"div",18),t.k0s(),t.DNE(62,ee,3,3,"div",7),t.nrm(63,"br"),t.j41(64,"div",3)(65,"div",4),t.EFF(66),t.nI1(67,"translate"),t.k0s(),t.j41(68,"div",19)(69,"div",20),t.nrm(70,"ion-checkbox",21),t.j41(71,"div",22),t.EFF(72),t.nI1(73,"translate"),t.k0s()()()(),t.nrm(74,"br"),t.j41(75,"div",3)(76,"div",4),t.EFF(77),t.nI1(78,"translate"),t.k0s(),t.j41(79,"div",19)(80,"div",20),t.nrm(81,"ion-checkbox",23),t.j41(82,"div",22),t.EFF(83),t.nI1(84,"translate"),t.k0s()()()()(),t.nrm(85,"br")(86,"br"),t.DNE(87,ne,3,3,"button",24)(88,oe,3,3,"button",25),t.k0s()()}2&a&&(t.Y8G("formGroup",l.userForm),t.R7$(2),t.SpI(" ",t.bMT(3,28,"text.profile_pic")," "),t.R7$(6),t.SpI(" ",t.bMT(9,30,"text.email")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(75,ct,l.isControlInvalid("email"))),t.R7$(),t.Y8G("placeholder",t.i5U(13,34,"text.input_placeholder",t.eq3(77,xt,t.bMT(12,32,"text.email")))),t.R7$(3),t.Y8G("ngIf",l.isControlInvalid("email")),t.R7$(3),t.SpI(" ",t.bMT(18,37,"text.name")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(79,ct,l.isControlInvalid("name"))),t.R7$(),t.Y8G("placeholder",t.i5U(22,41,"text.input_placeholder",t.eq3(81,xt,t.bMT(21,39,"text.name")))),t.R7$(3),t.Y8G("ngIf",l.isControlInvalid("name")),t.R7$(3),t.SpI(" ",t.bMT(27,44,"text.job_title")," "),t.R7$(2),t.Y8G("ngClass",t.eq3(83,ct,l.isControlInvalid("jobTitle"))),t.R7$(),t.Y8G("placeholder",t.i5U(31,48,"text.input_placeholder",t.eq3(85,xt,t.bMT(30,46,"text.job_title")))),t.R7$(3),t.Y8G("ngIf",l.isControlInvalid("jobTitle")),t.R7$(3),t.SpI(" ",t.bMT(36,51,"text.phone")," "),t.R7$(3),t.Y8G("ngClass",t.eq3(87,ct,l.isControlInvalid("phone"))),t.R7$(2),t.Y8G("placeholder",t.i5U(42,55,"text.input_placeholder",t.eq3(89,xt,t.bMT(41,53,"text.phone")))),t.R7$(3),t.Y8G("ngIf",l.isControlInvalid("phone")),t.R7$(3),t.SpI(" ",t.bMT(47,58,"text.languages")," "),t.R7$(3),t.Dyx(null==l.user?null:l.user.languages),t.R7$(4),t.SpI(" ",t.i5U(55,62,"text.add_item",t.eq3(91,Wt,t.bMT(54,60,"text.language")))," "),t.R7$(6),t.JRh(t.bMT(60,65,"text.select_role")),t.R7$(2),t.Y8G("ngIf",l.roles),t.R7$(),t.Y8G("ngIf",l.isControlInvalid("visibleForCollaborators")),t.R7$(4),t.JRh(t.bMT(67,67,"text.show_user_to_collaborators")),t.R7$(6),t.JRh(t.bMT(73,69,"text.show")),t.R7$(5),t.JRh(t.bMT(78,71,"text.allow_sign_on_behalf")),t.R7$(6),t.JRh(t.bMT(84,73,"text.allow")),t.R7$(4),t.vxM(!0===(null==l.user?null:l.user.inactive)?87:88))},dependencies:[n.YU,n.bT,x.qT,x.xH,x.y7,x.me,x.wz,x.BC,x.cb,x.j4,x.JD,T.eY,T.hB,dt.Z,E.F,y.D9]}),b})();var se=s(8129),Kt=s(904),le=s(7310),ae=s(1852),re=s(7380),ce=s(4954),Yt=s(4821),de=s(4426),ue=s(4558);let pe=(()=>{var r;class b{}return(r=b).\u0275fac=function(a){return new(a||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[n.MD,x.YN,x.X1,T.bv,C.S,g.X,y.h,f.T,c,u.O,X.S,F.Y,I.b,R,h.K,K.k,M.u,E.F,rt.x,at.K,mt.G,$.Y,D.T]}),b})();t.wjB(e.K,[n.bT,ie,se.K],[y.D9]),t.wjB(k.v,[n.bT,Kt.X,le.s],[y.D9]),t.wjB(B.O,[n.YU,n.bT,n.B3,x.xH,x.y7,x.wz,x.BC,x.vS,T.eY,T.hB,u.O,ae.n,re.$,ce.R,Yt.e,L],[y.D9]),t.wjB(J.r,[Kt.X,Yt.e,de.O],[y.D9,ue.w]),t.wjB(Y.f,[rt.x],[])},8433:(z,w,s)=>{s.d(w,{x:()=>J});var n=s(467),e=s(177),x=s(9417),T=s(9465),k=s(3895),C=s(5603),g=s(3953),y=s(5970),f=s(2081),M=s(1296),t=s(4501),G=s(8397),E=s(345),c=s(9710),u=s(5188),F=s(6580),X=s(1880);const B=(I,$,R,h,D)=>({pageStartIndex:I,pageEndIndex:$,totalCount:R,paginationPage:h,sortField:D});let J=(()=>{var I;class ${constructor(h,D,K,Y,rt,at,mt,et,pt){this.popoversService=h,this.api=D,this.tableService=K,this.headerService=Y,this.toastService=rt,this.sanitizer=at,this.modalsService=mt,this.router=et,this.activatedRoute=pt,this.documents=[],this.allSystemOperationsCount=0,this.filters=null,this.sort={field:"createdAt",order:"desc"},this.pagination={page:0,itemsPerPage:50},this.agencyId=null,this.promotionId=null,this.documentsTableConfig={uniqueId:"table-1",showSelectors:!0,columns:[{key:"createdAt",label:"A\xf1adido en",size:"medium",type:"date"},{key:"title",label:"T\xedtulo",size:"large",type:"text"},{key:"fileName",label:"Nombre del archivo",size:"large",type:"text"},{key:"documentType",label:"Tipo de documento",size:"medium",type:"text"}],rows:[]}}ngOnInit(){this.getData()}ionViewWillEnter(){var h=this;return(0,n.A)(function*(){h.getData()})()}getData(){var h=this;return(0,n.A)(function*(){var D;let K;if(K="operation"===h.options.father?yield h.api.getOperationDocuments(h.options.operationId):yield h.api.getContactOperationDocuments({contactId:h.options.contactId}),h.documents=null===(D=K)||void 0===D||null===(D=D.success)||void 0===D?void 0:D.data,h.documents){let Y=h.tableService.convertDataToTableRows(h.documents,h.documentsTableConfig);h.documentsTableConfig.rows=Y}})()}openCreateDocumentModal(){var h=this;return(0,n.A)(function*(){yield h.modalsService.onShowCreateOperationDocumentModal(h.options.operationId),h.getData()})()}onGoNextPage(){(this.pagination.page+1)*this.pagination.itemsPerPage<this.allSystemOperationsCount&&(this.pagination.page++,this.getData())}onGoPreviousPage(){this.pagination.page>0&&(this.pagination.page--,this.getData())}updatePagination(){return{startIndex:this.pagination.page*this.pagination.itemsPerPage+1,endIndex:Math.min((this.pagination.page+1)*this.pagination.itemsPerPage,this.allSystemOperationsCount)}}onSort(h){}onRowClicked(h){return(0,n.A)(function*(){})()}onTableButtonClick(h){return(0,n.A)(function*(){})()}}return(I=$).\u0275fac=function(h){return new(h||I)(g.rXU(y.m),g.rXU(f.i),g.rXU(M.a),g.rXU(t.d),g.rXU(G.f),g.rXU(E.up),g.rXU(c.M),g.rXU(u.Ix),g.rXU(u.nX))},I.\u0275cmp=g.VBU({type:I,selectors:[["app-operation-documents"]],inputs:{options:"options"},standalone:!0,features:[g.aNF],decls:15,vars:8,consts:[[1,"crm-block-content"],[1,"crm-block-body",2,"padding","20px"],[1,"crm-header-modal"],[1,"crm-input"],[1,"crm-input-input","crm-input-input-searchbar"],[1,"fas","fa-search"],["type","text","placeholder","Buscar documento"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[1,"fa","fa-plus"],[3,"goPreviousPage","goNextPage","sort","listPaginationConfig"],[1,"crm-section"],[3,"actionButtonClick","rowClicked","table"]],template:function(h,D){1&h&&(g.j41(0,"div")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4),g.nrm(6,"i",5)(7,"input",6),g.k0s()(),g.j41(8,"div",7)(9,"button",8),g.bIt("click",function(){return D.openCreateDocumentModal()}),g.nrm(10,"i",9),g.EFF(11," A\xf1adir Documento "),g.k0s()()(),g.j41(12,"app-list-pagination-selectors",10),g.bIt("goPreviousPage",function(){return D.onGoPreviousPage()})("goNextPage",function(){return D.onGoNextPage()})("sort",function(Y){return D.onSort(Y)}),g.k0s(),g.j41(13,"div",11)(14,"app-table",12),g.bIt("actionButtonClick",function(Y){return D.onTableButtonClick(Y)})("rowClicked",function(Y){return D.onRowClicked(Y)}),g.k0s()()()()()),2&h&&(g.R7$(12),g.Y8G("listPaginationConfig",g.s1E(2,B,D.updatePagination().startIndex,D.updatePagination().endIndex,D.allSystemOperationsCount,D.pagination.page+1,null!=D.sort&&D.sort.field?(null==D.sort?null:D.sort.field)+" "+(null==D.sort?null:D.sort.order):"Fecha de creaci\xf3n")),g.R7$(2),g.Y8G("table",D.documentsTableConfig))},dependencies:[e.MD,T.bv,x.YN,x.X1,C.P,F.k,k.b,X.O]}),$})()},7754:(z,w,s)=>{s.d(w,{X:()=>C});var n=s(177),e=s(9417),x=s(9465),T=s(3955),k=s(3953);let C=(()=>{var g;class y{}return(g=y).\u0275fac=function(M){return new(M||g)},g.\u0275mod=k.$C({type:g}),g.\u0275inj=k.G2t({imports:[n.MD,e.YN,x.bv,T.h]}),y})()},7774:(z,w,s)=>{s.d(w,{G:()=>g});var n=s(177),e=s(9417),x=s(3895),T=s(9465),k=s(3955),C=s(3953);let g=(()=>{var y;class f{}return(y=f).\u0275fac=function(t){return new(t||y)},y.\u0275mod=C.$C({type:y}),y.\u0275inj=C.G2t({imports:[n.MD,e.YN,x.b,T.bv,k.h,n.MD,e.YN]}),f})()},4426:(z,w,s)=>{s.d(w,{O:()=>Lt});var n=s(467),e=s(3953),x=s(5824),T=s(7376),k=s(9465),C=s(600),g=s(177),y=s(9417),f=s(1748),M=s(4476);function t(p,O){if(1&p&&(e.j41(0,"div",12),e.nrm(1,"app-general-toast",13),e.k0s()),2&p){const m=e.XpG();e.R7$(),e.Y8G("options",m.toastConfig)}}function G(p,O){if(1&p){const m=e.RV6();e.j41(0,"ion-checkbox",15),e.bIt("ngModelChange",function(){e.eBV(m);const o=e.XpG().$implicit,_=e.XpG();return e.Njj(_.onCheckboxChange(o))}),e.mxI("ngModelChange",function(o){e.eBV(m);const _=e.XpG().$implicit;return e.DH7(_.selected,o)||(_.selected=o),e.Njj(o)}),e.k0s(),e.j41(1,"div",16),e.EFF(2),e.k0s()}if(2&p){const m=e.XpG().$implicit,i=e.XpG();e.Y8G("id",m.label)("disabled",!m.selected&&i.selectionLimitReached),e.R50("ngModel",m.selected),e.R7$(),e.Y8G("id",m.label),e.R7$(),e.JRh(m.label)}}function E(p,O){if(1&p&&(e.j41(0,"div",14),e.DNE(1,G,3,5),e.k0s()),2&p){const m=O.$implicit;e.R7$(),e.vxM(m.hidden?-1:1)}}let c=(()=>{var p;class O{constructor(i,o){this.modalCtrl=i,this.navParams=o,this.promotion=null,this.warning=!1,this.MAX_SELECTION=50,this.allColumns=[],this.selectedKeys=[],this.toastConfig={text:"Has alcanzado el l\xedmite de columnas seleccionadas. No puedes a\xf1adir m\xe1s.\n",theme:"orange",fullWidth:!0,showCloseButton:!1,smaller:!0},this.localColumns=[]}ngOnInit(){this.promotion=this.navParams.get("promotion")||null,this.allColumns=this.navParams.get("columns")||[],this.selectedKeys=this.navParams.get("selectedColumnKeys")||[],this.localColumns=this.allColumns.map(i=>({key:i.key,label:i.label,hidden:i.hideSelectColumnsList,selected:this.selectedKeys.includes(i.key)})),this.checkSelectionCount()}checkSelectionCount(){const i=this.localColumns.filter(o=>o.selected).length;this.warning=i>11}onCheckboxChange(i){i.selected&&this.selectedCount>this.MAX_SELECTION&&(i.selected=!1)}get selectedCount(){return this.localColumns.filter(i=>i.selected).length}get selectionLimitReached(){return this.selectedCount>=this.MAX_SELECTION}onCancel(){this.modalCtrl.dismiss(null,"cancel")}onSave(){const i=this.localColumns.filter(o=>o.selected).map(o=>o.key);console.log(i,"updatedSelectedKeys"),this.modalCtrl.dismiss(i,"save")}}return(p=O).\u0275fac=function(i){return new(i||p)(e.rXU(k.W3),e.rXU(C.y8))},p.\u0275cmp=e.VBU({type:p,selectors:[["app-select-table-columns-modal"]],decls:15,vars:2,consts:[[1,"crm-header-modal","crm-header-modal-empty"],[1,"crm-section-smaller-title"],[1,"crm-buttons-group"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-times"],[1,"crm-button","crm-button-success",3,"click"],[1,"fa-solid","fa-check"],["class","crm-warning-message p-15","style","",4,"ngIf"],[1,"modal-body"],[1,"modal-body-content"],[1,"crm-section-inputs"],["class","crm-input-checkbox","appToggleCheckbox","","style","margin-bottom: 12px;",4,"ngFor","ngForOf"],[1,"crm-warning-message","p-15"],[3,"options"],["appToggleCheckbox","",1,"crm-input-checkbox",2,"margin-bottom","12px"],[3,"ngModelChange","id","disabled","ngModel"],[1,"crm-input-checkbox-label",3,"id"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"div",1),e.EFF(2," Seleccionar columnas "),e.k0s(),e.j41(3,"div",2)(4,"button",3),e.bIt("click",function(){return o.onCancel()}),e.nrm(5,"i",4),e.EFF(6," Cerrar "),e.k0s(),e.j41(7,"button",5),e.bIt("click",function(){return o.onSave()}),e.nrm(8,"i",6),e.EFF(9," Guardar "),e.k0s()()(),e.DNE(10,t,2,1,"div",7),e.j41(11,"div",8)(12,"div",9)(13,"div",10),e.DNE(14,E,2,1,"div",11),e.k0s()()()),2&i&&(e.R7$(10),e.Y8G("ngIf",o.selectionLimitReached),e.R7$(4),e.Y8G("ngForOf",o.localColumns))},dependencies:[g.Sq,g.bT,y.BC,y.vS,k.eY,k.hB,f.z,M.l],styles:[".modal-body[_ngcontent-%COMP%]{overflow-y:auto}"]}),O})();function u(p,O){if(1&p&&e.nrm(0,"img",0),2&p){const m=e.XpG();e.Y8G("src",m.icon,e.B4B)}}let F=(()=>{var p;class O{constructor(){this.className=""}ngOnInit(){}}return(p=O).\u0275fac=function(i){return new(i||p)},p.\u0275cmp=e.VBU({type:p,selectors:[["app-badge"]],inputs:{text:"text",icon:"icon",className:"className"},standalone:!0,features:[e.aNF],decls:3,vars:5,consts:[["alt","",1,"badge__icon",3,"src"]],template:function(i,o){1&i&&(e.j41(0,"div"),e.DNE(1,u,1,1,"img",0),e.EFF(2),e.k0s()),2&i&&(e.ZvI("badge ",o.className,""),e.R7$(),e.vxM(o.icon?1:-1),e.R7$(),e.SpI(" ",o.text,"\n"))}}),O})();function X(p,O){if(1&p&&(e.j41(0,"div",0),e.EFF(1),e.k0s()),2&p){const m=e.XpG();e.R7$(),e.JRh(m.price)}}function B(p,O){if(1&p&&e.nrm(0,"app-badge",1),2&p){const m=e.XpG();e.Mz_("className","badge--",null==m.statusMap[m.status]?null:m.statusMap[m.status].key,""),e.FS9("text",null==m.statusMap[m.status]?null:m.statusMap[m.status].text),e.FS9("icon",null==m.statusMap[m.status]?null:m.statusMap[m.status].icon)}}function J(p,O){if(1&p&&e.EFF(0),2&p){const m=e.XpG();e.SpI(" ",m.status," ")}}let I=(()=>{var p;class O{constructor(i,o){this.price=i,this.status=o,this.statusMap={blocked:{key:"blocked",text:"Blocked",icon:"assets/icon/lock-icon.svg"},reserved:{key:"reserved",text:"Reserved",icon:"assets/icon/loading-icon-warn.svg"},sold:{key:"sold",text:"Sold",icon:""},retired:{key:"retired",text:"Retired",icon:"assets/icon/toggle-icon-left.svg"}}}ngOnInit(){}}return(p=O).\u0275fac=function(i){return new(i||p)(e.rXU("price"),e.rXU("status"))},p.\u0275cmp=e.VBU({type:p,selectors:[["app-price-status-cell"]],standalone:!0,features:[e.aNF],decls:3,vars:1,consts:[[1,"col-medium","text-left"],[3,"className","text","icon"]],template:function(i,o){1&i&&e.DNE(0,X,2,1,"div",0)(1,B,1,4,"app-badge",1)(2,J,1,1),2&i&&e.vxM("available"===o.status?0:null!=o.statusMap[o.status]&&o.statusMap[o.status].key?1:2)},dependencies:[F]}),O})(),$=(()=>{var p;class O{constructor(i){this.status=i}ngOnInit(){this.status="available"===this.status?"success":this.status}}return(p=O).\u0275fac=function(i){return new(i||p)(e.rXU("status"))},p.\u0275cmp=e.VBU({type:p,selectors:[["app-table-cell-actions"]],decls:3,vars:4,consts:[[1,"d-flex","justify-end","col-small","align-center"],[2,"padding","10px 5px"],["alt","",3,"src"]],template:function(i,o){1&i&&(e.j41(0,"div",0)(1,"div",1),e.nrm(2,"img",2),e.k0s()()),2&i&&(e.R7$(),e.ZvI("table-row-background-",o.status," rowMenu-icon-wrapper"),e.R7$(),e.Y8G("src","assets/icon/more-vertical-icon.svg",e.B4B))}}),O})(),R=(()=>{var p;class O{constructor(i){this.onClick=i}ngOnInit(){}}return(p=O).\u0275fac=function(i){return new(i||p)(e.rXU("onClick"))},p.\u0275cmp=e.VBU({type:p,selectors:[["app-table-header-cell-actions"]],decls:3,vars:1,consts:[[1,"d-flex","justify-end","col-small","align-center","pr-13",3,"click"],[1,"rowMenu-icon-wrapper",2,"padding","10px 5px","background","white"],["alt","",1,"cursor-pointer",3,"src"]],template:function(i,o){1&i&&(e.j41(0,"div",0),e.bIt("click",function(){return null==o.onClick?null:o.onClick()}),e.j41(1,"div",1),e.nrm(2,"img",2),e.k0s()()),2&i&&(e.R7$(2),e.Y8G("src","assets/icon/switch-horizontal-icon.svg",e.B4B))}}),O})();var h=s(1296),D=s(2081),K=s(1213),Y=s(8397),rt=s(9710),at=s(6552),mt=s(8031),et=s(5188),pt=s(3955),gt=s(1880);const ft=["tableComponent"],ht=(p,O)=>({"border-bottom-unset":p,"border-radius-16":O});function Ct(p,O){if(1&p){const m=e.RV6();e.j41(0,"div",4)(1,"app-general-toast",10),e.bIt("clickActionBtn",function(){e.eBV(m);const o=e.XpG(2);return e.Njj(o.onClickToastAction())}),e.k0s()()}if(2&p){const m=e.XpG(2);e.R7$(),e.Y8G("options",m.toastConfig)}}function yt(p,O){if(1&p&&e.DNE(0,Ct,2,1,"div",9),2&p){const m=e.XpG();e.Y8G("ngIf",!(null!=m.promotion&&m.promotion.promotionPaymentInfoIsCompleted))}}function Tt(p,O){if(1&p){const m=e.RV6();e.qex(0),e.j41(1,"div",16)(2,"div",17)(3,"input",18),e.nI1(4,"translate"),e.mxI("ngModelChange",function(o){e.eBV(m);const _=e.XpG(2);return e.DH7(_.editedBlockName,o)||(_.editedBlockName=o),e.Njj(o)}),e.k0s()(),e.j41(5,"div",19)(6,"div",20)(7,"i",21),e.bIt("click",function(){e.eBV(m);const o=e.XpG(),_=o.$implicit,v=o.$index,P=e.XpG();return e.Njj(P.onSaveBlockTitle(_,v))}),e.k0s(),e.j41(8,"i",22),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2);return e.Njj(o.onCancelBlockTitle())}),e.k0s()()()(),e.bVm()}if(2&p){const m=e.XpG(2);e.R7$(3),e.R50("ngModel",m.editedBlockName),e.Y8G("placeholder",e.bMT(4,2,"text.input_placeholder_block_name"))}}function St(p,O){if(1&p){const m=e.RV6();e.j41(0,"img",24),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2),_=o.$implicit,v=o.$index,P=e.XpG();return e.Njj(P.onEditBlockTitle(_,v))}),e.k0s()}2&p&&e.Y8G("src","assets/icon/edit-icon.svg",e.B4B)}function Mt(p,O){if(1&p&&(e.EFF(0),e.nI1(1,"translate"),e.DNE(2,St,1,1,"img",23)),2&p){const m=e.XpG().$implicit,i=e.XpG();e.SpI(" ",m.name||e.bMT(1,2,"text.block")+m.index," "),e.R7$(2),e.vxM("page"===i.context?2:-1)}}function Et(p,O){if(1&p){const m=e.RV6();e.qex(0),e.j41(1,"button",31),e.bIt("click",function(){e.eBV(m);const o=e.XpG(4).$index,_=e.XpG();return e.Njj(_.onSaveTable(o))}),e.nrm(2,"i",32),e.EFF(3),e.nI1(4,"translate"),e.k0s(),e.bVm()}2&p&&(e.R7$(3),e.SpI(" ",e.bMT(4,1,"text.save")," "))}function It(p,O){if(1&p){const m=e.RV6();e.j41(0,"button",31),e.bIt("click",function(){e.eBV(m);const o=e.XpG(5).$index,_=e.XpG();return e.Njj(_.onEditTable(o))}),e.nrm(1,"i",34),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&p&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"text.mass_edit")," "))}function Ft(p,O){if(1&p&&e.DNE(0,It,4,3,"button",33),2&p){const m=e.XpG(5);e.Y8G("ngIf","promoter"===(null==m.currentUser?null:m.currentUser.accountType))}}function Pt(p,O){if(1&p&&e.DNE(0,Et,5,3,"ng-container",13)(1,Ft,1,1,"ng-template",null,1,e.C5r),2&p){const m=e.sdS(2),i=e.XpG(3).$index,o=e.XpG();e.Y8G("ngIf",o.editingTableBlockIndex===i)("ngIfElse",m)}}function Ot(p,O){if(1&p){const m=e.RV6();e.j41(0,"button",31),e.bIt("click",function(o){e.eBV(m);const _=e.XpG(4);return e.Njj(_.onDuplicateProperty(o))}),e.nrm(1,"i",35),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&p&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"text.duplicate_property")," "))}function bt(p,O){if(1&p){const m=e.RV6();e.j41(0,"button",36),e.bIt("click",function(){e.eBV(m);const o=e.XpG(3).$implicit,_=e.XpG();return e.Njj(_.onAddProperty(o))}),e.nrm(1,"i",37),e.EFF(2),e.nI1(3,"translate"),e.k0s()}if(2&p){const m=e.XpG(4);e.Y8G("disabled",!(null!=m.promotion&&m.promotion.promotionPaymentInfoIsCompleted)),e.R7$(2),e.SpI(" ",e.bMT(3,2,"text.add_property")," ")}}function Rt(p,O){if(1&p){const m=e.RV6();e.DNE(0,Pt,3,2)(1,Ot,4,3,"button",28)(2,bt,4,4,"button",29),e.j41(3,"div",26)(4,"img",30),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2).$implicit,_=e.XpG();return e.Njj(_.onDeleteBlock(o))}),e.k0s()()}if(2&p){const m=e.XpG(2),i=m.$implicit,o=m.$index,_=e.XpG();e.vxM(null!=i&&null!=i.tableConfig&&null!=i.tableConfig.rows&&i.tableConfig.rows.length?0:-1),e.R7$(),e.vxM(_.showDuplicateButtonBlockIndex.includes(o)&&-1===_.editingTableBlockIndex?1:-1),e.R7$(),e.vxM(_.editingTableBlockIndex!==o?2:-1),e.R7$(2),e.Y8G("src","assets/icon/trash-icon.svg",e.B4B)}}function Bt(p,O){if(1&p){const m=e.RV6();e.j41(0,"img",39),e.bIt("click",function(){e.eBV(m);const o=e.XpG(3).$index,_=e.XpG();return e.Njj(_.onToggleBlock(o))}),e.k0s()}2&p&&e.Y8G("src","assets/icon/chevron-up-icon.svg",e.B4B)}function At(p,O){if(1&p){const m=e.RV6();e.j41(0,"img",39),e.bIt("click",function(){e.eBV(m);const o=e.XpG(3).$index,_=e.XpG();return e.Njj(_.onToggleBlock(o))}),e.k0s()}2&p&&e.Y8G("src","assets/icon/chevron-down-icon.svg",e.B4B)}function jt(p,O){if(1&p&&(e.j41(0,"div",27),e.DNE(1,Bt,1,1,"img",38)(2,At,1,1,"img",38),e.k0s()),2&p){const m=e.XpG(2).$implicit;e.R7$(),e.vxM(m.isOpen?1:2)}}function $t(p,O){if(1&p&&(e.j41(0,"div",25),e.DNE(1,Rt,5,4,"div",26)(2,jt,3,1,"div",27),e.k0s()),2&p){const m=e.XpG().$implicit,i=e.XpG();e.R7$(),e.vxM("page"===i.context?1:-1),e.R7$(),e.vxM(null!=m&&null!=m.tableConfig&&null!=m.tableConfig.rows&&m.tableConfig.rows.length?2:-1)}}function Ut(p,O){if(1&p){const m=e.RV6();e.j41(0,"app-table",40,2),e.bIt("columnClick",function(o){e.eBV(m);const _=e.XpG().$implicit,v=e.XpG();return e.Njj(v.onColumnClicked(o,_))})("rowClicked",function(o){e.eBV(m);const _=e.XpG(2);return e.Njj(_.onRowClicked(o))})("clickGlobalCheckbox",function(o){e.eBV(m);const _=e.XpG(2);return e.Njj(_.onClickGlobalCheckbox(o))})("rowCheckboxClicked",function(o){e.eBV(m);const _=e.XpG().$index,v=e.XpG();return e.Njj(v.onRowChecked(o,_))}),e.k0s()}if(2&p){const m=e.XpG().$implicit;e.Y8G("table",null==m?null:m.tableConfig)}}function wt(p,O){if(1&p&&(e.j41(0,"div",6)(1,"div",11)(2,"div",12),e.DNE(3,Tt,9,4,"ng-container",13)(4,Mt,3,4,"ng-template",null,0,e.C5r),e.k0s(),e.DNE(6,$t,3,2,"div",14),e.k0s(),e.DNE(7,Ut,2,1,"app-table",15),e.k0s()),2&p){const m=O.$implicit,i=O.$index,o=e.sdS(5),_=e.XpG();e.R7$(),e.Y8G("ngClass",e.l_i(5,ht,m.isOpen,!m.isOpen)),e.R7$(2),e.Y8G("ngIf",_.editingBlockTitleIndex===i)("ngIfElse",o),e.R7$(3),e.Y8G("ngIf","promoter"===(null==_.currentUser?null:_.currentUser.accountType)),e.R7$(),e.vxM(m.isOpen?7:-1)}}function Gt(p,O){1&p&&(e.j41(0,"div",7)(1,"div",41),e.EFF(2),e.nI1(3,"translate"),e.k0s()()),2&p&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"text.no_blocks_yet")," "))}function Nt(p,O){if(1&p){const m=e.RV6();e.j41(0,"button",43),e.bIt("click",function(){e.eBV(m);const o=e.XpG(2);return e.Njj(o.onAddBlock())}),e.nrm(1,"i",37),e.EFF(2),e.nI1(3,"translate"),e.k0s()}2&p&&(e.R7$(2),e.SpI(" ",e.bMT(3,1,"text.add_block")," "))}function Xt(p,O){if(1&p&&(e.j41(0,"div",8),e.DNE(1,Nt,4,3,"button",42),e.k0s()),2&p){const m=e.XpG();e.R7$(),e.Y8G("ngIf","promoter"===(null==m.currentUser?null:m.currentUser.accountType))}}let Lt=(()=>{var p;class O{constructor(i,o,_,v,P,W,V,st,nt,Z,tt){this.modalCtrl=i,this.tableService=o,this.api=_,this.state=v,this.toastService=P,this.modalsService=W,this.utils=V,this.promotionService=st,this.router=nt,this.location=Z,this.translate=tt,this.context="page",this.reloadPromotion=new e.bkB,this.changeTab=new e.bkB,this.sortBlock=new e.bkB,this.rowCheckboxClicked=new e.bkB,this.clickGlobalCheckbox=new e.bkB,this.hashMap=[],this.loadingBlocks=!1,this.blocks=[],this.toastConfig={text:this.translate.instant("text.fill_required_fields"),theme:"orange",fullWidth:!0,showCloseButton:!1,showActionButton:!0,smaller:!0},this.allColumnsKeysSelected=["externalReference","reference","promotionType","floor","bedrooms","bathrooms","totalMeasures_squareMetersBuilt","totalMeasures_squareMetersUseful","totalMeasures_squareMetersCoveredTerraces","totalMeasures_squareMetersUncoveredTerraces","f_pool_comunitaria","planos","price"],this.tableConfig={uniqueId:"table-1",showSelectors:!0,editCellsMode:!1,columns:[{key:"reference",label:"Id",size:"small",customCssClass:"sticky-second-column bg-white",editMode:{inputType:"text"}},{key:"byvaroId",label:"Ref",size:"medium",editMode:{inputType:"text"}},{key:"promotionType",label:this.translate.instant("table.column.subtype"),size:"medium",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"villa",value:this.translate.instant("property.subtypes.villa"),selected:!1},{key:"chalet",value:this.translate.instant("property.subtypes.chalet"),selected:!1},{key:"country_house",value:this.translate.instant("property.subtypes.country_house"),selected:!1},{key:"semi_detached",value:this.translate.instant("property.subtypes.semi_detached"),selected:!1},{key:"twin_house",value:this.translate.instant("property.subtypes.twin_house"),selected:!1},{key:"bungalow",value:"Bungalow",selected:!1},{key:"flat",value:this.translate.instant("property.subtypes.flat"),selected:!1},{key:"studio",value:this.translate.instant("property.subtypes.studio"),selected:!1},{key:"basement",value:this.translate.instant("property.subtypes.basement"),selected:!1},{key:"loft",value:"Loft",selected:!1},{key:"mezzanine",value:this.translate.instant("property.subtypes.mezzanine"),selected:!1},{key:"duplex",value:"D\xfaplex",selected:!1},{key:"triplex",value:"Triplex",selected:!1},{key:"penthouse",value:this.translate.instant("property.subtypes.penthouse"),selected:!1},{key:"penthouse_duplex",value:this.translate.instant("property.subtypes.penthouse_duplex"),selected:!1},{key:"commercial_space",value:this.translate.instant("property.subtypes.commercial_space"),selected:!1}]}},{key:"floor",label:this.translate.instant("table.column.floor"),size:"small",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersBuilt",label:this.translate.instant("table.column.m2_built"),size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUseful",label:this.translate.instant("table.column.m2_useful"),size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"m2constr",label:this.translate.instant("table.column.m2_excluding_terraces"),size:"small",extraString:" m\xb2",editMode:{inputType:"number"},fn:U=>{let ct=(U.totalMeasures_squareMetersBuilt||0)-((U.totalMeasures_squareMetersCoveredTerraces||0)+(U.totalMeasures_squareMetersUncoveredTerraces||0));return ct<0&&(ct=0),ct}},{key:"totalMeasures_squareMetersTerraces",label:this.translate.instant("table.column.m2_terraces"),size:"small",showOnlyViewMode:!0,extraString:" m\xb2",fn:U=>U.totalMeasures_squareMetersCoveredTerraces+U.totalMeasures_squareMetersUncoveredTerraces},{key:"totalMeasures_squareMetersPatch",label:this.translate.instant("table.column.parcel"),size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersCoveredTerraces",label:this.translate.instant("table.column.terrace_covered"),size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"totalMeasures_squareMetersUncoveredTerraces",label:this.translate.instant("table.column.terrace_uncovered"),size:"small",extraString:" m\xb2",editMode:{inputType:"number"}},{key:"bedrooms",label:this.translate.instant("table.column.bedrooms"),size:"small",editMode:{inputType:"number"}},{key:"bathrooms",label:this.translate.instant("table.column.bathrooms"),size:"small",editMode:{inputType:"number"}},{key:"f_pool_comunitaria",label:this.translate.instant("table.column.pool"),size:"medium",fn:U=>U.f_pool_comunitaria?"comunitaria":U.f_pool_privada?"privada":"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"comunitaria",value:this.translate.instant("table.pool.comunitaria"),selected:!1},{key:"privada",value:this.translate.instant("table.pool.privada"),selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_trastero",label:this.translate.instant("table.column.storage"),size:"medium",fn:U=>U.fcustom_trastero?U.fcustom_trasteroPrice?this.utils.transformThousandSeparator(U.fcustom_trasteroPrice)+" \u20ac":this.translate.instant(U.fcustom_trasteroIncludedInPrice?"property.included":"property.yes"):"No",editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:this.translate.instant("property.yes"),selected:!1},{key:"Incluido",value:this.translate.instant("property.included"),selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"fcustom_parking",label:"Parking",size:"medium",fn:U=>{let L="";return L=U.fcustom_parking?this.translate.instant("property.yes"):"No",U.fcustom_parkingPrice&&(L=this.utils.transformThousandSeparator(U.fcustom_parkingPrice)+" \u20ac"),U.fcustom_parkingIncludedInPrice&&(L=this.translate.instant("property.included")),null!=U&&U.fcustom_parkingComunitario&&(L+=" ("+this.translate.instant("property.communal")+")"),L},editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"S\xed",value:this.translate.instant("property.yes"),selected:!1},{key:"Incluido",value:this.translate.instant("property.included"),selected:!1},{key:"No",value:"No",selected:!1}]}},{key:"solarium",label:"Solarium",size:"small",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"yes",value:this.translate.instant("property.yes"),selected:!1},{key:"no",value:"No",selected:!1}]},fn:U=>U.fcustom_solarium?this.translate.instant("property.yes"):"No"},{key:"availabilityStatus",label:this.translate.instant("table.column.availability_status"),size:"medium",translate:!0,showOnlyEditMode:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"available",value:this.translate.instant("property.availability_status.available"),selected:!1},{key:"sold",value:this.translate.instant("property.availability_status.sold"),selected:!1},{key:"reserved",value:this.translate.instant("property.availability_status.reserved"),selected:!1},{key:"blocked",value:this.translate.instant("property.availability_status.blocked"),selected:!1},{key:"retired",value:this.translate.instant("property.availability_status.retired"),selected:!1}]}},{key:"deliveryDate",label:this.translate.instant("table.column.delivery_date"),size:"medium",editMode:{inputType:"date"},fn:U=>null!=U&&U.deliveryDate?new Date(null==U?void 0:U.deliveryDate).toLocaleDateString("es-ES"):null},{key:"status",label:this.translate.instant("table.column.construction_status"),size:"medium",type:"text",translate:!0,editMode:{inputType:"select",selectOptions:[{key:"",value:"",selected:!1},{key:"proyecto-sin-licencia",value:this.translate.instant("property.construction_status.proyecto-sin-licencia"),selected:!1},{key:"proyecto-con-licencia",value:this.translate.instant("property.construction_status.proyecto-con-licencia"),selected:!1},{key:"fase-excavacion",value:this.translate.instant("property.construction_status.fase-excavacion"),selected:!1},{key:"cimentacion-completada",value:this.translate.instant("property.construction_status.cimentacion-completada"),selected:!1},{key:"estructura-construccion",value:this.translate.instant("property.construction_status.estructura-construccion"),selected:!1},{key:"cerramiento-completado",value:this.translate.instant("property.construction_status.cerramiento-completado"),selected:!1},{key:"instalaciones-proceso",value:this.translate.instant("property.construction_status.instalaciones-proceso"),selected:!1},{key:"acabados-interiores",value:this.translate.instant("property.construction_status.acabados-interiores"),selected:!1},{key:"obra-finalizada",value:this.translate.instant("property.construction_status.obra-finalizada"),selected:!1}]}},{key:"catalog",label:this.translate.instant("table.column.catalog"),size:"small",showOnlyViewMode:!0,type:"file",fn:U=>{var L;return null==U||null===(L=U.propertyFiles)||void 0===L||null===(L=L.find(dt=>"catalog"===dt.category))||void 0===L?void 0:L.url}},{key:"planos",label:this.translate.instant("table.column.floorplan"),size:"small",showOnlyViewMode:!0,type:"file",fn:U=>{var L;return null==U||null===(L=U.propertyFiles)||void 0===L||null===(L=L.find(dt=>"plan"===dt.category))||void 0===L?void 0:L.url}},{key:"price",label:this.translate.instant("table.column.price"),size:"medium",fn:U=>{let L=null==U?void 0:U.price;return L&&(L=this.utils.transformThousandSeparator(L)),L+" \u20ac"},editMode:{inputType:"number",parseAsAPrice:!0}},{key:"rowMenu",label:"rowMenu",size:"small",hideSelectColumnsList:!0,customCssClass:"sticky-last-column",type:"component"}],rows:[]},this.checkedRows=[],this.editingTableBlockIndex=-1,this.showDuplicateButtonBlockIndex=[],this.editingBlockTitleIndex=-1,this.editedBlockName=""}ngOnInit(){this.getState()}ngOnChanges(){this.getState(),this.getData()}ionViewWillEnter(){this.reloadPromotion.emit()}getState(){this.state.getState().subscribe(i=>{this.currentUser=i.user})}getData(){var i=this;return(0,n.A)(function*(){var o,_;i.showDuplicateButtonBlockIndex=[],i.checkedRows=[],i.allColumnsKeysSelected=(null===(o=i.promotion)||void 0===o?void 0:o.tableColumnsKeysSelected)||i.allColumnsKeysSelected,i.blocks=(null===(_=i.promotion)||void 0===_?void 0:_.promotionBlocks)||[];for(let v=0;v<i.blocks.length;v++)i.blocks[v].isOpen=!0,i.blocks[v].properties&&0!==i.blocks[v].properties.length&&(i.blocks[v].tableConfig=T.cloneDeep(i.tableConfig),i.allColumnsKeysSelected.includes("rowMenu")||i.allColumnsKeysSelected.push("rowMenu"),i.blocks[v].tableConfig.columns=i.blocks[v].tableConfig.columns.map(P=>(P.show=!!i.allColumnsKeysSelected.includes(P.key),P)),i.blocks[v].tableConfig.rows=i.tableService.convertDataToTableRows(T.cloneDeep(i.blocks[v].properties),T.cloneDeep(i.blocks[v].tableConfig)),"modal"===i.context&&i.blocks[v].tableConfig.rows.forEach(P=>{let W=i.promotion.propertiesTable.rows.find(V=>V.rowId===P.rowId);W&&(P.checked=W.checked)}),i.blocks[v].tableConfig.rows=i.addBackgroundColorsToTableRows(i.blocks[v].tableConfig.rows),i.blocks[v].tableConfig.rows=i.customizeRowsWithComponents(i.blocks[v].tableConfig.rows),"agency"==i.currentUser.accountType&&(i.blocks[v].tableConfig.rows=i.blocks[v].tableConfig.rows.filter(P=>"available"==P.rawObject.availabilityStatus)),"page"===i.context&&i.blocks[v].tableConfig.columns.forEach((P,W)=>{if("rowMenu"===P.key){let V={...P};V.component=R,V.componentInputs={onClick:()=>{i.onEditColumns()}},i.blocks[v].tableConfig.columns[W]=V}}));"modal"===i.context&&(i.blocks=i.blocks.filter(v=>v.properties.length))})()}customizeRowsWithComponents(i){return i.map(o=>{var _;return o.cells.rowMenu.type="component",o.cells.rowMenu.component=$,o.cells.rowMenu.componentInputs={status:o.cells.availabilityStatus.value},o.cells.price.type="component",o.cells.price.component=I,o.cells.price.componentInputs={status:o.cells.availabilityStatus.value,price:o.cells.price.value},o.cells.reference.customCssClass=`bg-${null==o||null===(_=o.style)||void 0===_?void 0:_.backgroundColor}`,"available"===o.cells.availabilityStatus.value&&(o.checkboxCssClass="border-black"),o})}addBackgroundColorsToTableRows(i){for(let o=0;o<i.length;o++)switch(i[o].rawObject.availabilityStatus){case"available":i[o].style={backgroundColor:"success"};break;case"sold":i[o].style={backgroundColor:"sold"};break;case"reserved":i[o].style={backgroundColor:"reserved"};break;case"blocked":default:i[o].style={backgroundColor:"blocked"};break;case"retired":i[o].style={backgroundColor:"retired"}}return i}onAddProperty(i){var o=this;return(0,n.A)(function*(){const _=yield o.modalCtrl.create({component:x.E,componentProps:{block:i,promotion:o.promotion},cssClass:"modal-create-property"});yield _.present();const{data:v}=yield _.onWillDismiss();v&&(o.reloadPromotion.emit(),o.toastService.showSuccessToast("Propiedad a\xf1adida correctamente"))})()}onAddBlock(){var i=this;return(0,n.A)(function*(){let o={index:i.blocks.length+1,promotionId:i.promotion.id};o=(yield i.api.addBlock(o)).success.data,i.blocks.push(o)})()}onToggleBlock(i){this.blocks[i].isOpen=!this.blocks[i].isOpen}onDeleteBlock(i){var o=this;return(0,n.A)(function*(){if(i.properties.length>0)return void o.toastService.showErrorToast(o.translate.instant("text.cannot_delete_with_properties"));const _=yield o.modalsService.openConfirmationModal({title:o.translate.instant("text.deleteTitle"),message:o.translate.instant("text.deleteConfirm"),icon:"fas fa-trash",iconTheme:"red",buttons:[{text:o.translate.instant("text.cancel"),theme:"btn-secondary",id:"cancel"},{text:o.translate.instant("text.delete"),theme:"btn-red",id:"delete"}]});"delete"===(null==_?void 0:_.data)&&(yield o.api.deleteBlock(i.id),o.blocks=o.blocks.filter(P=>P.id!==i.id))})()}onClickGlobalCheckbox(i){"modal"===this.context&&this.clickGlobalCheckbox.emit(i)}onRowClicked(i){var o=this;return(0,n.A)(function*(){const _=yield o.modalCtrl.create({component:x.E,componentProps:{property:i.rawObject,promotion:o.promotion},cssClass:"modal-create-property"});yield _.present();const{data:v}=yield _.onWillDismiss();v?(console.log("HOLA2"),o.reloadPromotion.emit()):(console.log("HOLA"),o.reloadPromotion.emit())})()}onColumnClicked(i,o){var _=this;return(0,n.A)(function*(){const v={field:"",order:i.order},P=(W,V)=>(st,nt)=>{const Z=st[W],tt=nt[W];return null==Z?"asc"===V?-1:1:null==tt?"asc"===V?1:-1:"string"==typeof Z&&"string"==typeof tt?"asc"===V?Z.localeCompare(tt):tt.localeCompare(Z):"asc"===V?Z-tt:tt-Z};switch(i.column.key){case"reference":default:v.field="reference",o.properties.sort(P(v.field,v.order));break;case"promotionType":v.field="promotionType",o.properties.sort(P(v.field,v.order));break;case"floor":v.field="floor",o.properties.sort(P(v.field,v.order));break;case"totalMeasures_squareMetersBuilt":v.field="totalMeasures_squareMetersBuilt",o.properties.sort(P(v.field,v.order));break;case"totalMeasures_squareMetersUseful":v.field="totalMeasures_squareMetersUseful",o.properties.sort(P(v.field,v.order));break;case"totalMeasures_squareMetersPatch":v.field="totalMeasures_squareMetersPatch",o.properties.sort(P(v.field,v.order));break;case"bedrooms":v.field="bedrooms",o.properties.sort(P(v.field,v.order));break;case"bathrooms":v.field="bathrooms",o.properties.sort(P(v.field,v.order))}_.getData()})()}updateEditedRowsFromTable(i){var o=this;return(0,n.A)(function*(){const v=JSON.parse(JSON.stringify(i.table.rows)).filter(P=>P.hasBeenEdited);for(const P of v){const W=o.buildPropertyValuesToUpdate(P);null==W||delete W.catalog,null==W||delete W.planos,yield o.api.updatePropertyById(P.rawObject.id,W)}v.length>0&&(o.toastService.showSuccessToast(o.translate.instant("text.updated_successfully")),o.reloadPromotion.emit())})()}buildPropertyValuesToUpdate(i){const o={};return Object.entries(i.cells).forEach(([_,v])=>{var P;if(!v.hasBeenEdited)return;const W=this.tableConfig.columns.find(V=>V.key===_);"f_pool_comunitaria"===_?(console.log("f_pool_comunitaria",v.value),o.f_pool_comunitaria="comunitaria"===v.value,o.f_pool_privada="privada"===v.value,"No"===v.value&&(o.f_pool_comunitaria=!1,o.f_pool_privada=!1)):"fcustom_trastero"===_?"S\xed"===v.value?(o.fcustom_trastero=!0,o.fcustom_trasteroIncludedInPrice=!1):"Incluido"===v.value?(o.fcustom_trastero=!0,o.fcustom_trasteroIncludedInPrice=!0):(o.fcustom_trastero=!1,o.fcustom_trasteroIncludedInPrice=!1):"fcustom_parking"===_?"S\xed"===v.value?(o.fcustom_parking=!0,o.fcustom_parkingIncludedInPrice=!1,o.fcustom_parkingComunitario=!1):"Incluido"===v.value?(o.fcustom_parking=!0,o.fcustom_parkingIncludedInPrice=!0,o.fcustom_parkingComunitario=!1):(o.fcustom_parking=!1,o.fcustom_parkingIncludedInPrice=!1,o.fcustom_parkingComunitario=!1):o[_]=_.startsWith("fcustom_")?"S\xed"===v.value:"price"===_?parseFloat(v.value):v.value,"date"===(null==W||null===(P=W.editMode)||void 0===P?void 0:P.inputType)&&(o[_]=new Date(v.value).toISOString())}),o}onEditTable(i){var o=this;return(0,n.A)(function*(){const _=o.tableComponents.toArray();if(-1!==o.editingTableBlockIndex&&o.editingTableBlockIndex!==i){const P=_[o.editingTableBlockIndex];null!=P&&P.editCellsMode&&(console.log("HACE UN TOGGLE"),P.resetAndCloseTableEditCellsMode())}const v=_[i];v?(v.enableTableEditCellsMode(),o.editingTableBlockIndex=v.editCellsMode?i:-1):console.warn("Table not found for block index:",i)})()}onSaveTable(i){var o=this;return(0,n.A)(function*(){const v=o.tableComponents.toArray()[i];v?v.editCellsMode&&(yield o.updateEditedRowsFromTable(v),v.resetAndCloseTableEditCellsMode(),o.editingTableBlockIndex=-1):console.warn("Table not found for block index:",i)})()}onEditColumns(){var i=this;return(0,n.A)(function*(){const o=yield i.modalCtrl.create({component:c,componentProps:{promotion:i.promotion,columns:i.tableConfig.columns,selectedColumnKeys:i.allColumnsKeysSelected},cssClass:"modal-edit-table-columns"});yield o.present();const{data:_,role:v}=yield o.onWillDismiss();if("save"===v&&_){const P=_;i.allColumnsKeysSelected=P,i.blocks.forEach(V=>{var st;null!=V&&null!==(st=V.tableConfig)&&void 0!==st&&st.columns&&V.tableConfig.columns.forEach(nt=>{nt.show=P.includes(nt.key)})}),yield i.api.updatePromotionById(i.promotion.id,{tableColumnsKeysSelected:i.allColumnsKeysSelected})}})()}onRowChecked(i,o){var _=this;return(0,n.A)(function*(){const v=_.blocks[o].tableConfig.rows[i],P=_.checkedRows.findIndex(V=>V.rawObject.id===v.rawObject.id);-1!==P?_.checkedRows.splice(P,1):(_.checkedRows=_.checkedRows.filter(V=>_.blocks.findIndex(nt=>{var Z;return null===(Z=nt.properties)||void 0===Z?void 0:Z.some(tt=>tt.id===V.rawObject.id)})!==o),_.checkedRows.push(v));const W=_.checkedRows.filter(V=>_.blocks.findIndex(nt=>{var Z;return null===(Z=nt.properties)||void 0===Z?void 0:Z.some(tt=>tt.id===V.rawObject.id)})===o).length;Array.isArray(_.showDuplicateButtonBlockIndex)||(_.showDuplicateButtonBlockIndex=[]),1===W?_.showDuplicateButtonBlockIndex.includes(o)||_.showDuplicateButtonBlockIndex.push(o):_.showDuplicateButtonBlockIndex=_.showDuplicateButtonBlockIndex.filter(V=>V!==o),_.rowCheckboxClicked.emit({rowIndex:i,blockIndex:o})})()}onDuplicateProperty(i){var o=this;return(0,n.A)(function*(){const v=o.checkedRows[0].rawObject;(yield o.promotionService.onDuplicateProperty(i,v))&&o.reloadPromotion.emit()})()}onEditBlockTitle(i,o){this.editingBlockTitleIndex=o,this.editedBlockName=i.name||this.translate.instant("text.block_default_name",{index:i.index})}onSaveBlockTitle(i,o){var _=this;return(0,n.A)(function*(){i.name=_.editedBlockName;const v=yield _.api.editBlock(i);v&&v.success?_.toastService.showSuccessToast(_.translate.instant("text.update_success")):_.toastService.showErrorToast(_.translate.instant("text.update_error")),_.editingBlockTitleIndex=-1})()}onCancelBlockTitle(){this.editingBlockTitleIndex=-1}onClickToastAction(){this.router.navigate([`/promotions/${this.promotion.id}/info`]),this.changeTab.emit("info")}}return(p=O).\u0275fac=function(i){return new(i||p)(e.rXU(k.W3),e.rXU(h.a),e.rXU(D.i),e.rXU(K.c),e.rXU(Y.f),e.rXU(rt.M),e.rXU(at.T),e.rXU(mt.J),e.rXU(et.Ix),e.rXU(g.aZ),e.rXU(pt.c$))},p.\u0275cmp=e.VBU({type:p,selectors:[["app-promotion-details-availability"]],viewQuery:function(i,o){if(1&i&&e.GBs(ft,5),2&i){let _;e.mGM(_=e.lsd())&&(o.tableComponents=_)}},inputs:{promotion:"promotion",context:"context"},outputs:{reloadPromotion:"reloadPromotion",changeTab:"changeTab",sortBlock:"sortBlock",rowCheckboxClicked:"rowCheckboxClicked",clickGlobalCheckbox:"clickGlobalCheckbox"},features:[e.OA$],decls:7,vars:3,consts:[["viewMode",""],["notEditingBlock",""],["tableComponent",""],[1,"crm-section"],[1,"crm-section",2,"margin-bottom","16px","width","100%"],[1,"",2,"border-radius","16px","padding","24px","background","white"],[2,"margin-bottom","40px"],[1,"crm-header-modal","crm-header-modal-empty"],[1,"d-flex","justify-center"],["style","margin-bottom: 16px; width: 100%;","class","crm-section",4,"ngIf"],[3,"clickActionBtn","options"],[1,"crm-header-modal","crm-header-modal-empty",2,"padding","24px 16px","border","1px solid #E0E0E0","border-top-right-radius","16px","border-top-left-radius","16px",3,"ngClass"],[1,"crm-section-title"],[4,"ngIf","ngIfElse"],["class","crm-buttons-group",4,"ngIf"],[3,"table"],[1,"crm-input-input-and-icon"],[1,"crm-input-input"],["type","text",3,"ngModelChange","ngModel","placeholder"],[1,"crm-input-input-and-icon-right"],[1,"title-edit-icons"],[1,"fa-solid","fa-check",3,"click"],[1,"fa-solid","fa-times",3,"click"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"src"],["alt","",1,"cursor-pointer",2,"margin-left","8px",3,"click","src"],[1,"crm-buttons-group"],[1,"crm-trash-btn"],[1,"cursor-pointer"],[1,"crm-button-secondary","crm-button-secondary-primary"],[1,"crm-button",3,"disabled"],["alt","",3,"click","src"],[1,"crm-button-secondary","crm-button-secondary-primary",3,"click"],[1,"fa-solid","fa-save"],["class","crm-button-secondary crm-button-secondary-primary",3,"click",4,"ngIf"],[1,"fa-solid","fa-pencil"],[1,"fa-solid","fa-copy"],[1,"crm-button",3,"click","disabled"],[1,"fa-solid","fa-plus"],["alt","",1,"mb-4",3,"src"],["alt","",1,"mb-4",3,"click","src"],[3,"columnClick","rowClicked","clickGlobalCheckbox","rowCheckboxClicked","table"],[1,"crm-text"],["class","crm-button crm-button-outline-primary",3,"click",4,"ngIf"],[1,"crm-button","crm-button-outline-primary",3,"click"]],template:function(i,o){1&i&&(e.j41(0,"div",3),e.DNE(1,yt,1,1,"div",4),e.j41(2,"div",5),e.Z7z(3,wt,8,8,"div",6,e.fX1),e.DNE(5,Gt,4,3,"div",7)(6,Xt,2,1,"div",8),e.k0s()()),2&i&&(e.R7$(),e.vxM("page"===o.context?1:-1),e.R7$(2),e.Dyx(o.blocks),e.R7$(2),e.vxM(0===o.blocks.length?5:-1),e.R7$(),e.vxM("page"===o.context?6:-1))},dependencies:[g.YU,g.bT,y.me,y.BC,y.vS,gt.O,M.l,pt.D9],styles:[".title-edit-icons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{cursor:pointer;color:var(--crm-red-color)}.title-edit-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:first-child{color:var(--crm-success-color)}"]}),O})()},8031:(z,w,s)=>{s.d(w,{J:()=>M});var n=s(467),e=s(7376),T=s(3953),k=s(5970),C=s(8397),g=s(2081),y=s(6552),f=s(3955);let M=(()=>{var t;class G{constructor(c,u,F,X,B){this.popoversService=c,this.toastService=u,this.api=F,this.utils=X,this.translate=B}transformPromotionFormStepOne(c){return{projectName:null==c?void 0:c.projectName,constructionType:null==c?void 0:c.constructionType,constructionSubType:null==c?void 0:c.constructionSubType,constructionStatus:null==c?void 0:c.constructionStatus,constructionYear:null==c?void 0:c.constructionYear,constructionStart:null==c?void 0:c.constructionStart,commercializationStart:null==c?void 0:c.commercializationStart,keyDeliveryDate:null==c?void 0:c.keyDeliveryDate,country:null==c?void 0:c.country,province:null==c?void 0:c.province,city:null==c?void 0:c.city,neighborhood:null==c?void 0:c.neighborhood,address:null==c?void 0:c.address,postalCode:null==c?void 0:c.postalCode,number:null==c?void 0:c.number,showAddressPublicly:null==c?void 0:c.showAddressPublicly,showGeoreferencePublicly:null==c?void 0:c.showGeoreferencePublicly,energyEfficiencyCertificate:null==c?void 0:c.energyEfficiencyCertificate,co2EmissionsCertificate:null==c?void 0:c.co2EmissionsCertificate,energyEfficiencyValue:null==c?void 0:c.energyEfficiencyValue,co2EmissionsValue:null==c?void 0:c.co2EmissionsValue}}transformPromotionFormStepThree(c){return{title_es:null==c?void 0:c.title_es,title_en:null==c?void 0:c.title_en,title_de:null==c?void 0:c.title_de,title_fr:null==c?void 0:c.title_fr,title_ru:null==c?void 0:c.title_ru,description_es:null==c?void 0:c.description_es,description_en:null==c?void 0:c.description_en,description_de:null==c?void 0:c.description_de,description_fr:null==c?void 0:c.description_fr,description_ru:null==c?void 0:c.description_ru,promotionFiles:null==c?void 0:c.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(c){const u=e.cloneDeep(c);for(const F in u)F.startsWith("f_")||F.startsWith("fcustom_")||delete u[F];return u}onDuplicateProperty(c,u){var F=this;return(0,n.A)(function*(){let X=null;const B=yield F.popoversService.onShowDuplicatePropertyPopover(c);var J,I,$,R,h;if(console.log("POPOVER RESULT",B),B&&(null!=B&&null!==(J=B.data)&&void 0!==J&&J.count&&(null==B||null===(I=B.data)||void 0===I?void 0:I.count)>0&&(null==B||null===($=B.data)||void 0===$?void 0:$.count)<=25?X=null==B||null===(h=B.data)||void 0===h?void 0:h.count:(null==B||null===(R=B.data)||void 0===R?void 0:R.count)>25&&(yield F.toastService.showErrorToast(F.translate.instant("text.duplicate_quantity_error")))),!X)return!1;for(let D=0;D<X;D++)console.log("DUPLICATING PROPERTY",D),yield F.duplicateProperty(u,D);return yield F.toastService.showSuccessToast(F.translate.instant("text.duplicate_success")),!0})()}duplicateProperty(c,u){var F=this;return(0,n.A)(function*(){var X,B,J,I;let $=e.cloneDeep(c);$=F.utils.parseProperties($),$.promotionBlockId=c.promotionBlockId,$.promotionId=c.promotionId;const R=F.translate.instant("text.copy_suffix");$.reference=null!==(X=$)&&void 0!==X&&X.reference?`${null===(B=$)||void 0===B?void 0:B.reference} - ${R} ${u+1}`:null,$.availabilityStatus=null;const h=e.cloneDeep((null===(J=$)||void 0===J?void 0:J.propertyFiles)||[]);delete $.id,delete $.propertyFiles,delete $.measurements_floors,delete $.byvaroId,delete $.updatedAt,delete $.createdAt;const D=yield F.api.createProperty($);null==D||null===(I=D.success)||void 0===I||(I=I.data),console.log("LA PROPERTYYYYYYY",$),console.log("PROPERTY FILES",h)})()}}return(t=G).\u0275fac=function(c){return new(c||t)(T.KVO(k.m),T.KVO(C.f),T.KVO(g.i),T.KVO(y.T),T.KVO(f.c$))},t.\u0275prov=T.jDH({token:t,factory:t.\u0275fac,providedIn:"root"}),G})()}}]);