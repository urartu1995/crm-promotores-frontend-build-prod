"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2399],{2306:(x,S,o)=>{o.d(S,{T:()=>v});var c=o(177),P=o(9417),m=o(3953);let v=(()=>{var f;class r{}return(f=r).\u0275fac=function(R){return new(R||f)},f.\u0275mod=m.$C({type:f}),f.\u0275inj=m.G2t({imports:[c.MD,P.YN]}),r})()},8129:(x,S,o)=>{o.d(S,{K:()=>P});var c=o(3953);let P=(()=>{var m;class v{constructor(r,g){this.el=r,this.renderer=g,this.isLoading=!1}ngOnChanges(r){"isLoading"in r&&this.updateButtonState()}updateButtonState(){const r=this.el.nativeElement;if(this.isLoading){r.getAttribute("data-original-content")||this.renderer.setAttribute(r,"data-original-content",r.innerHTML),this.renderer.setProperty(r,"disabled",!0),this.renderer.setStyle(r,"opacity","0.6"),this.renderer.setStyle(r,"pointer-events","none"),this.renderer.setStyle(r,"cursor","not-allowed");const g=this.renderer.createElement("ion-spinner"),R=this.renderer.createText(" Cargando...");this.renderer.setProperty(r,"innerHTML",""),this.renderer.appendChild(r,g),this.renderer.appendChild(r,R)}else{this.renderer.setProperty(r,"disabled",!1),this.renderer.removeStyle(r,"opacity"),this.renderer.removeStyle(r,"pointer-events"),this.renderer.removeStyle(r,"cursor");const g=r.getAttribute("data-original-content");g&&(this.renderer.setProperty(r,"innerHTML",g),this.renderer.removeAttribute(r,"data-original-content"))}}}return(m=v).\u0275fac=function(r){return new(r||m)(c.rXU(c.aKT),c.rXU(c.sFG))},m.\u0275dir=c.FsC({type:m,selectors:[["","appLoadingButton",""]],inputs:{isLoading:[0,"appLoadingButton","isLoading"]},standalone:!0,features:[c.OA$]}),v})()},1748:(x,S,o)=>{o.d(S,{z:()=>P});var c=o(3953);let P=(()=>{var m;class v{constructor(r,g){this.el=r,this.renderer=g}ngOnInit(){this.checkbox=this.el.nativeElement.querySelector("ion-checkbox"),this.renderer.listen(this.el.nativeElement,"click",r=>{r.target!==this.checkbox&&this.checkbox&&this.checkbox.click()})}}return(m=v).\u0275fac=function(r){return new(r||m)(c.rXU(c.aKT),c.rXU(c.sFG))},m.\u0275dir=c.FsC({type:m,selectors:[["","appToggleCheckbox",""]],standalone:!0}),v})()},6676:(x,S,o)=>{o.r(S),o.d(S,{PromotionCreatePageModule:()=>D});var c=o(177),P=o(9417),m=o(9465),v=o(5188),f=o(467),r=o(293),g=o(7221),R=o(8857),C=o(7376),e=o(3953),O=o(2081),G=o(4501),K=o(8031),t=o(6552),_=o(8397),p=o(8129),h=o(3955);const l=a=>({"crm-block-steps-step-disabled":a}),b=a=>({"crm-section-invisible":a}),d=[{path:"",component:(()=>{var a;class B{constructor(i,n,u,k,T,F){this.api=i,this.headerService=n,this.promotionTransformersService=u,this.utils=k,this.router=T,this.toastService=F,this.currentStep=0,this.loadingButton=!1,this.promotionStep1RequiredFields=[],this.promotionStep3RequiredFields=[]}ngOnInit(){}ionViewWillEnter(){this.headerService.setConfig({title:"promotion_create"})}getData(){}setFormValues(){const i=this.promotionTransformersService.transformPromotionFormStepOne(this.promotion);this.stepOneForm.promotionStepOne=i,this.stepTwoForm.promotionStepTwo=this.promotion,this.promotionTransformersService.transformPromotionFormStepThree(this.promotion)}step1Validation(i){this.promotionStep1RequiredFields=[],i.projectName||this.promotionStep1RequiredFields.push("projectName"),i.constructionType||this.promotionStep1RequiredFields.push("constructionType"),i.constructionSubType||this.promotionStep1RequiredFields.push("constructionSubType"),i.address||this.promotionStep1RequiredFields.push("address"),i.co2EmissionsCertificate||this.promotionStep1RequiredFields.push("co2EmissionsCertificate"),i.energyEfficiencyCertificate||this.promotionStep1RequiredFields.push("energyEfficiencyCertificate")}step3Validation(i){var n;this.promotionStep3RequiredFields=[],i.title_es||this.promotionStep3RequiredFields.push("title_es"),i.description_es||this.promotionStep3RequiredFields.push("description_es"),(C.cloneDeep(null===(n=this.stepThreeForm)||void 0===n||null===(n=n.fileUploaderManager)||void 0===n||null===(n=n.config)||void 0===n?void 0:n.files)||[]).length||this.promotionStep3RequiredFields.push("images")}nextStep(){var i=this;return(0,f.A)(function*(){if(0!==i.currentStep||(i.promotion={...i.promotion,...i.stepOneForm.promotionStepOne},i.step1Validation(i.promotion),!i.promotionStep1RequiredFields.length)){if(1===i.currentStep){const n=i.promotionTransformersService.deleteAllPromotionPropertiesExceptFeatures(i.stepTwoForm.promotionStepTwo);i.promotion={...i.promotion,...n},i.stepThreeForm.disabled=!1,i.stepThreeForm.syncFiles()}2===i.currentStep&&(i.promotion={...i.promotion,title_es:i.stepThreeForm.promotionStepThree.title_es,title_en:i.stepThreeForm.promotionStepThree.title_en,title_de:i.stepThreeForm.promotionStepThree.title_de,title_fr:i.stepThreeForm.promotionStepThree.title_fr,title_ru:i.stepThreeForm.promotionStepThree.title_ru,description_es:i.stepThreeForm.promotionStepThree.description_es,description_en:i.stepThreeForm.promotionStepThree.description_en,description_de:i.stepThreeForm.promotionStepThree.description_de,description_fr:i.stepThreeForm.promotionStepThree.description_fr,description_ru:i.stepThreeForm.promotionStepThree.description_ru,promotionFiles:i.stepThreeForm.promotionStepThree.promotionFiles},i.step3Validation(i.promotion),i.promotionStep3RequiredFields.length)||(i.currentStep>=2&&(console.log("promotion",i.promotion),i.loadingButton=!0,yield i.createPromotion(),i.loadingButton=!1),i.currentStep<2&&i.currentStep++)}})()}prevStep(){this.currentStep--}createPromotion(){var i=this;return(0,f.A)(function*(){console.log("create promotion"),C.cloneDeep(i.promotion.promotionFiles),delete i.promotion.promotionBlocks,delete i.promotion.propertiesCount,delete i.promotion.checked,delete i.promotion.promotionFiles,i.promotion=i.utils.parseProperties(i.promotion),i.promotion.promotionPaymentInfoIsCompleted=!1;const u=yield i.api.createPromotion(i.promotion),k=u.success.data.id;if(!u.success)return console.error(u.error),void i.toastService.showToast({text:u.error.errorMessage,theme:"red",time:2e3});{var T,F,I,M;let X=[...C.cloneDeep(null===(T=i.stepThreeForm)||void 0===T||null===(T=T.fileUploaderManager)||void 0===T||null===(T=T.config)||void 0===T?void 0:T.files)||[],...C.cloneDeep(null===(F=i.stepThreeForm)||void 0===F||null===(F=F.planosFileUploadManagerComponent)||void 0===F||null===(F=F.config)||void 0===F?void 0:F.files)||[],...C.cloneDeep(null===(I=i.stepThreeForm)||void 0===I||null===(I=I.catalogsFileUploadManagerComponent)||void 0===I||null===(I=I.config)||void 0===I?void 0:I.files)||[],...C.cloneDeep(null===(M=i.stepThreeForm)||void 0===M||null===(M=M.videosFileUploadManagerComponent)||void 0===M||null===(M=M.config)||void 0===M?void 0:M.files)||[]];for(let s of X){if(null!=s&&s.new){var U;const y={promotionId:k,name:"",category:s.category,label:s.label,orderIndex:null==s?void 0:s.orderIndex},V=yield i.api.uploadFile(s.fileBlob),w=null==V||null===(U=V.success)||void 0===U||null===(U=U.data)||void 0===U?void 0:U.fileName;y.name=w,yield i.api.addPromotionFile(y)}if(null!=s&&s.deleted&&(yield i.api.removePromotionFileById(null==s?void 0:s.id)),null!=s&&s.moved&&(null==s||!s.deleted)&&(null==s||!s.new)){let y=C.cloneDeep(s);delete y.moved,delete y.fileBase64,delete y.fileBlob,delete y.new,delete y.deleted,delete y.size,delete y.type,yield i.api.editPromotionFile(y)}}}window.location.href="/promotions"})()}}return(a=B).\u0275fac=function(i){return new(i||a)(e.rXU(O.i),e.rXU(G.d),e.rXU(K.J),e.rXU(t.T),e.rXU(v.Ix),e.rXU(_.f))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-promotion-create"]],viewQuery:function(i,n){if(1&i&&(e.GBs(r.N,5),e.GBs(g.T,5),e.GBs(R.f,5)),2&i){let u;e.mGM(u=e.lsd())&&(n.stepOneForm=u.first),e.mGM(u=e.lsd())&&(n.stepTwoForm=u.first),e.mGM(u=e.lsd())&&(n.stepThreeForm=u.first)}},decls:78,vars:51,consts:[["stepOneForm",""],["stepTwoForm",""],["stepThreeForm",""],[1,"crm-block-body"],[1,"crm-block-steps"],[1,"crm-block-steps-step"],[1,"crm-block-steps-step-left"],[1,"crm-block-steps-step-number"],[1,"crm-block-steps-step-right"],[1,"crm-block-steps-step-title","text-12"],[1,"crm-block-steps-step-subtitle","text-secondary","text-14"],[1,"crm-block-steps-step",3,"ngClass"],[1,"crm-block-body-white-content"],[1,"crm-section","crm-section-center-content",3,"ngClass"],[1,"crm-header-modal","crm-header-modal-padding","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[3,"requiredFields"],[1,"crm-button-secondary",3,"click"],[1,"crm-button",3,"click","appLoadingButton"]],template:function(i,n){if(1&i){const u=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),e.EFF(5," 1 "),e.k0s()(),e.j41(6,"div",8)(7,"div",9),e.EFF(8),e.nI1(9,"translate"),e.k0s(),e.j41(10,"div",10),e.EFF(11),e.nI1(12,"translate"),e.k0s()()(),e.j41(13,"div",11)(14,"div",6)(15,"div",7),e.EFF(16," 2 "),e.k0s()(),e.j41(17,"div",8)(18,"div",9),e.EFF(19),e.nI1(20,"translate"),e.k0s(),e.j41(21,"div",10),e.EFF(22),e.nI1(23,"translate"),e.k0s()()(),e.j41(24,"div",11)(25,"div",6)(26,"div",7),e.EFF(27," 3 "),e.k0s()(),e.j41(28,"div",8)(29,"div",9),e.EFF(30),e.nI1(31,"translate"),e.k0s(),e.j41(32,"div",10),e.EFF(33),e.nI1(34,"translate"),e.k0s()()()(),e.j41(35,"div",12)(36,"div",13)(37,"div",14),e.nrm(38,"div",15),e.j41(39,"div",16)(40,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(41),e.nI1(42,"translate"),e.k0s()()(),e.nrm(43,"app-step-one-promotion-form",18,0)(45,"br")(46,"br")(47,"br"),e.k0s(),e.j41(48,"div",13)(49,"div",14),e.nrm(50,"div",15),e.j41(51,"div",16)(52,"button",19),e.bIt("click",function(){return e.eBV(u),e.Njj(n.prevStep())}),e.EFF(53),e.nI1(54,"translate"),e.k0s(),e.j41(55,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(56),e.nI1(57,"translate"),e.k0s()()(),e.nrm(58,"app-step-two-promotion-form",null,1)(60,"br")(61,"br")(62,"br"),e.k0s(),e.j41(63,"div",13)(64,"div",14),e.nrm(65,"div",15),e.j41(66,"div",16)(67,"button",19),e.bIt("click",function(){return e.eBV(u),e.Njj(n.prevStep())}),e.EFF(68),e.nI1(69,"translate"),e.k0s(),e.j41(70,"button",20),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(71),e.nI1(72,"translate"),e.k0s()()(),e.nrm(73,"app-step-three-promotion-form",18,2)(75,"br")(76,"br")(77,"br"),e.k0s()()()}2&i&&(e.R7$(8),e.SpI(" ",e.bMT(9,19,"text.promotion_step1_title")," "),e.R7$(3),e.SpI(" ",e.bMT(12,21,"text.promotion_step1_subtitle")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(41,l,n.currentStep<1)),e.R7$(6),e.SpI(" ",e.bMT(20,23,"features.caracteristicas")," "),e.R7$(3),e.SpI(" ",e.bMT(23,25,"text.promotion_step2_subtitle")," "),e.R7$(2),e.Y8G("ngClass",e.eq3(43,l,n.currentStep<2)),e.R7$(6),e.SpI(" ",e.bMT(31,27,"text.promotion_step3_title")," "),e.R7$(3),e.SpI(" ",e.bMT(34,29,"text.promotion_step3_subtitle")," "),e.R7$(3),e.Y8G("ngClass",e.eq3(45,b,0!==n.currentStep)),e.R7$(5),e.SpI(" ",e.bMT(42,31,"text.next")," "),e.R7$(2),e.Y8G("requiredFields",n.promotionStep1RequiredFields),e.R7$(5),e.Y8G("ngClass",e.eq3(47,b,1!==n.currentStep)),e.R7$(5),e.SpI(" ",e.bMT(54,33,"text.back")," "),e.R7$(3),e.SpI(" ",e.bMT(57,35,"text.next")," "),e.R7$(7),e.Y8G("ngClass",e.eq3(49,b,2!==n.currentStep)),e.R7$(5),e.SpI(" ",e.bMT(69,37,"text.back")," "),e.R7$(2),e.Y8G("appLoadingButton",n.loadingButton),e.R7$(),e.SpI(" ",e.bMT(72,39,"text.next")," "),e.R7$(2),e.Y8G("requiredFields",n.promotionStep3RequiredFields))},dependencies:[c.YU,r.N,g.T,R.f,p.K,h.D9]}),B})()}];let L=(()=>{var a;class B{}return(a=B).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[v.iI.forChild(d),v.iI]}),B})();var j=o(9083);let D=(()=>{var a;class B{}return(a=B).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[c.MD,P.YN,m.bv,L,j.E,h.h]}),B})()},8031:(x,S,o)=>{o.d(S,{J:()=>e});var c=o(467),P=o(7376),v=o(3953),f=o(5970),r=o(8397),g=o(2081),R=o(6552),C=o(3955);let e=(()=>{var O;class G{constructor(t,_,p,h,l){this.popoversService=t,this.toastService=_,this.api=p,this.utils=h,this.translate=l}transformPromotionFormStepOne(t){return{projectName:null==t?void 0:t.projectName,constructionType:null==t?void 0:t.constructionType,constructionSubType:null==t?void 0:t.constructionSubType,constructionStatus:null==t?void 0:t.constructionStatus,constructionYear:null==t?void 0:t.constructionYear,constructionStart:null==t?void 0:t.constructionStart,commercializationStart:null==t?void 0:t.commercializationStart,keyDeliveryDate:null==t?void 0:t.keyDeliveryDate,country:null==t?void 0:t.country,province:null==t?void 0:t.province,city:null==t?void 0:t.city,neighborhood:null==t?void 0:t.neighborhood,address:null==t?void 0:t.address,postalCode:null==t?void 0:t.postalCode,number:null==t?void 0:t.number,showAddressPublicly:null==t?void 0:t.showAddressPublicly,showGeoreferencePublicly:null==t?void 0:t.showGeoreferencePublicly,energyEfficiencyCertificate:null==t?void 0:t.energyEfficiencyCertificate,co2EmissionsCertificate:null==t?void 0:t.co2EmissionsCertificate,energyEfficiencyValue:null==t?void 0:t.energyEfficiencyValue,co2EmissionsValue:null==t?void 0:t.co2EmissionsValue}}transformPromotionFormStepThree(t){return{title_es:null==t?void 0:t.title_es,title_en:null==t?void 0:t.title_en,title_de:null==t?void 0:t.title_de,title_fr:null==t?void 0:t.title_fr,title_ru:null==t?void 0:t.title_ru,description_es:null==t?void 0:t.description_es,description_en:null==t?void 0:t.description_en,description_de:null==t?void 0:t.description_de,description_fr:null==t?void 0:t.description_fr,description_ru:null==t?void 0:t.description_ru,promotionFiles:null==t?void 0:t.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(t){const _=P.cloneDeep(t);for(const p in _)p.startsWith("f_")||p.startsWith("fcustom_")||delete _[p];return _}onDuplicateProperty(t,_){var p=this;return(0,c.A)(function*(){let h=null;const l=yield p.popoversService.onShowDuplicatePropertyPopover(t);var b,E,d,L,j;if(console.log("POPOVER RESULT",l),l&&(null!=l&&null!==(b=l.data)&&void 0!==b&&b.count&&(null==l||null===(E=l.data)||void 0===E?void 0:E.count)>0&&(null==l||null===(d=l.data)||void 0===d?void 0:d.count)<=25?h=null==l||null===(j=l.data)||void 0===j?void 0:j.count:(null==l||null===(L=l.data)||void 0===L?void 0:L.count)>25&&(yield p.toastService.showErrorToast(p.translate.instant("text.duplicate_quantity_error")))),!h)return!1;for(let D=0;D<h;D++)console.log("DUPLICATING PROPERTY",D),yield p.duplicateProperty(_,D);return yield p.toastService.showSuccessToast(p.translate.instant("text.duplicate_success")),!0})()}duplicateProperty(t,_){var p=this;return(0,c.A)(function*(){var h,l,b,E;let d=P.cloneDeep(t);d=p.utils.parseProperties(d),d.promotionBlockId=t.promotionBlockId,d.promotionId=t.promotionId;const L=p.translate.instant("text.copy_suffix");d.reference=null!==(h=d)&&void 0!==h&&h.reference?`${null===(l=d)||void 0===l?void 0:l.reference} - ${L} ${_+1}`:null,d.availabilityStatus=null;const j=P.cloneDeep((null===(b=d)||void 0===b?void 0:b.propertyFiles)||[]);delete d.id,delete d.propertyFiles,delete d.measurements_floors,delete d.byvaroId,delete d.updatedAt,delete d.createdAt;const D=yield p.api.createProperty(d);null==D||null===(E=D.success)||void 0===E||(E=E.data),console.log("LA PROPERTYYYYYYY",d),console.log("PROPERTY FILES",j)})()}}return(O=G).\u0275fac=function(t){return new(t||O)(v.KVO(f.m),v.KVO(r.f),v.KVO(g.i),v.KVO(R.T),v.KVO(C.c$))},O.\u0275prov=v.jDH({token:O,factory:O.\u0275fac,providedIn:"root"}),G})()},1280:(x,S,o)=>{o.d(S,{B:()=>P,X:()=>c});const c={general:["general","airConditioning","heating"],urbanizacion:["urbanizacion"],cercania:["cercania"],caracteristicas:["caracteristicas"]},P={airConditioning:["AACentralizado","Split","PreInstalacion"],heating:["CentralConGasNatural","CentralConDiesel","CentralConElectricidad","CentralConSueloRadiante","SueloRadianteSoloBanos","CentralConAerotermia","IndividualBombaCalorFrio","IndividualGasPropanoButano"],general:["barbacoa","armariosEmpotrados","puertaBlindada","ascensor","panelesSolares","domotica","gymPrivado","jacuzziPrivado","saunaPrivada","alarma","persianasElectricas","dobleAcristalamiento"],urbanizacion:["Urbanizacion","Portero","UrbanizacionCerrada","Vigilancia24Horas","Gym","PistaDePadel","PistaDeTenis","RestauranteEnElRecinto","SalaDeEventos","Coworking","ZonasAjardinadas","ParqueInfantil","PiscinaInfantil","Hammam","Jacuzzi","Sauna"],cercania:["PrimeraLineaDePlaya","SegundaLineaDePlaya","CercaDeLaPlaya","PrimeraLineaDeGolf","SegundaLineaDeGolf","CercaDeGolf","CentroDeCiudad","CercaDelPuerto"],caracteristicas:["LicenciaTuristica","Balcon","JardinPrivado","Vestidor","Lavanderia","CasaDeInvitados","Chimenea","PistaDeTenisPrivado","PistaDePadelPrivado","Bodega","Despensa"]}}}]);