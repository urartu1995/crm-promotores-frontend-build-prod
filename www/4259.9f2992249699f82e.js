"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4259],{4259:(W,h,c)=>{c.r(h),c.d(h,{CompraVentaOperationProcessPageModule:()=>Z});var m=c(177),p=c(9417),l=c(9465),d=c(5188),t=c(3953),_=c(2081),P=c(7700),C=c(4558);const f=(o,r)=>r.paymentID,v=o=>({"last-payment":o}),y=(o,r)=>({"show-error-input":o,"hide-error-input":r}),M=(o,r)=>({"show-delete-payment":o,"hide-delete-payment":r});function b(o,r){if(1&o&&(t.j41(0,"div",12)(1,"p"),t.EFF(2),t.nI1(3,"thousandSeparator"),t.k0s(),t.j41(4,"div",13)(5,"p"),t.EFF(6),t.k0s()(),t.j41(7,"span"),t.EFF(8,"La reserva se restar\xe1 del primer pago."),t.k0s()()),2&o){const a=t.XpG();t.R7$(2),t.SpI(" Reserva ",t.bMT(3,2,a.reservationPayment)," \u20ac "),t.R7$(4),t.SpI("Pagado ",a.reservationDate,"")}}function x(o,r){if(1&o&&(t.j41(0,"div",10)(1,"p"),t.EFF(2),t.nI1(3,"thousandSeparator"),t.k0s()()),2&o){const a=t.XpG();t.R7$(2),t.SpI(" Precio restante ",t.bMT(3,1,a.totalPromotionPrice-a.reservationPayment)," \u20ac ")}}function O(o,r){1&o&&(t.j41(0,"p"),t.EFF(1,"\xdaltimo pago"),t.k0s())}function F(o,r){if(1&o){const a=t.RV6();t.j41(0,"input",29),t.mxI("ngModelChange",function(e){t.eBV(a);const i=t.XpG().$implicit;return t.DH7(i.paymentPercentage,e)||(i.paymentPercentage=e),t.Njj(e)}),t.bIt("ngModelChange",function(){t.eBV(a);const e=t.XpG().$index,i=t.XpG(2);return t.Njj(i.setAmount(e))})("focusin",function(){t.eBV(a);const e=t.XpG(3);return t.Njj(e.hideError())}),t.k0s()}if(2&o){const a=t.XpG(),n=a.$implicit,e=a.$index,i=t.XpG(2);t.Mz_("id","percentage_",e,""),t.Y8G("ngClass",t.l_i(4,y,i.showError,!i.showError)),t.R50("ngModel",n.paymentPercentage)}}function k(o,r){if(1&o&&t.EFF(0),2&o){const a=t.XpG().$implicit;t.SpI(" ",a.paymentPercentage," ")}}function V(o,r){if(1&o){const a=t.RV6();t.j41(0,"input",30),t.mxI("ngModelChange",function(e){t.eBV(a);const i=t.XpG().$implicit;return t.DH7(i.paymentAmount,e)||(i.paymentAmount=e),t.Njj(e)}),t.bIt("ngModelChange",function(){t.eBV(a);const e=t.XpG().$index,i=t.XpG(2);return t.Njj(i.setPercentage(e))})("focusin",function(){t.eBV(a);const e=t.XpG(3);return t.Njj(e.hideError())}),t.k0s()}if(2&o){const a=t.XpG(),n=a.$implicit,e=a.$index,i=t.XpG(2);t.Mz_("id","amount_",e,""),t.Y8G("ngClass",t.l_i(4,y,i.showError,!i.showError)),t.R50("ngModel",n.paymentAmount)}}function S(o,r){if(1&o&&t.EFF(0),2&o){const a=t.XpG().$implicit;t.SpI(" ",a.paymentAmount," ")}}function D(o,r){if(1&o){const a=t.RV6();t.j41(0,"ion-icon",31),t.bIt("click",function(){t.eBV(a);const e=t.XpG().$index,i=t.XpG(2);return t.Njj(i.finishEdit(e))}),t.k0s()}}function E(o,r){if(1&o){const a=t.RV6();t.j41(0,"div",15)(1,"div",21),t.EFF(2),t.DNE(3,O,2,0,"p"),t.k0s(),t.j41(4,"div",22),t.DNE(5,F,1,7,"input",23)(6,k,1,1),t.EFF(7," % "),t.k0s(),t.j41(8,"div",22),t.DNE(9,V,1,7,"input",24)(10,S,1,1),t.EFF(11," \u20ac "),t.k0s(),t.j41(12,"div",22)(13,"input",25),t.bIt("click",function(){t.eBV(a);const e=t.XpG(2);return t.Njj(e.removeDateError())}),t.mxI("ngModelChange",function(e){const i=t.eBV(a).$implicit;return t.DH7(i.paymentDate,e)||(i.paymentDate=e),t.Njj(e)}),t.k0s()(),t.j41(14,"button",26),t.bIt("click",function(){const e=t.eBV(a).$index,i=t.XpG(2);return t.Njj(i.deletePayment(e))}),t.nrm(15,"i",27),t.k0s(),t.DNE(16,D,1,0,"ion-icon",28),t.k0s()}if(2&o){const a=r.$implicit,n=r.$index,e=t.XpG(2);t.R7$(),t.Y8G("ngClass",t.eq3(9,v,n==e.payments.length-1)),t.R7$(),t.SpI(" ",a.paymentID," "),t.R7$(),t.vxM(n==e.payments.length-1?3:-1),t.R7$(2),t.vxM(e.isPaymentStandard?6:5),t.R7$(4),t.vxM(e.isPaymentStandard?10:9),t.R7$(4),t.Y8G("ngClass",t.l_i(11,y,e.showDateError&&""==a.paymentDate,!e.showDateError)),t.R50("ngModel",a.paymentDate),t.R7$(),t.Y8G("ngClass",t.l_i(14,M,!e.isPaymentStandard&&n>=2,e.isPaymentStandard||n<=1)),t.R7$(2),t.Y8G("ngIf",e.isPaymentStandard&&a.isEditing)}}function j(o,r){if(1&o){const a=t.RV6();t.j41(0,"button",32),t.bIt("click",function(){t.eBV(a);const e=t.XpG(2);return t.Njj(e.addMorePayments())}),t.nrm(1,"ion-icon",33),t.j41(2,"p"),t.EFF(3,"A\xf1adir m\xe1s pagos"),t.k0s()()}}function T(o,r){if(1&o&&(t.j41(0,"div",34),t.EFF(1),t.k0s()),2&o){const a=t.XpG(2);t.R7$(),t.SpI(" La suma de los pagos debe ser el precio de compra (",0!=a.reservationPayment?a.totalPromotionPrice-a.reservationPayment:a.totalPromotionPrice," \u20ac) ")}}function I(o,r){1&o&&(t.j41(0,"div",34),t.EFF(1," Las fechas de los pagos no pueden estar vac\xedas "),t.k0s())}function w(o,r){if(1&o){const a=t.RV6();t.j41(0,"div",11)(1,"div",14),t.Z7z(2,E,17,17,"div",15,f),t.DNE(4,j,4,0,"button",16),t.k0s(),t.DNE(5,T,2,1,"div",17)(6,I,2,0,"div",17),t.j41(7,"div",18)(8,"button",19),t.EFF(9," Anterior "),t.k0s(),t.j41(10,"button",20),t.bIt("click",function(){t.eBV(a);const e=t.XpG();return t.Njj(e.updateOperation())}),t.EFF(11," Siguiente "),t.k0s()()()}if(2&o){const a=t.XpG();t.R7$(2),t.Dyx(a.payments),t.R7$(2),t.vxM(a.isPaymentStandard?-1:4),t.R7$(),t.Y8G("ngIf",a.showError&&!a.showDateError),t.R7$(),t.Y8G("ngIf",!a.showError&&a.showDateError)}}let R=(()=>{var o;class r{constructor(){this.selectPaymentMethod=new t.bkB,this.selectedPaymentMethod="",this.isPaymentStandard=!1,this.payments=[],this.totalPromotionPrice=0,this.reservationPayment=0,this.validPercentage=!1,this.validAmount=!1,this.showError=!1,this.showDateError=!1,this.reservationDate=""}formatReservationDate(){let n=this.operation.reservationDate.toString().split("T")[0],e=n.split("-")[0],i=n.split("-")[1],s=n.split("-")[2];this.reservationDate=s+"."+i+"."+e}hideError(){this.showError=!1}removeDateError(){this.showDateError=!1}updateOperation(){if(this.payments.some(n=>""==n.paymentDate))this.showDateError=!0,this.showError=!1;else if(0==this.validateValues())this.showDateError=!1,this.showError=!0;else{this.showDateError=!1,this.showError=!1;let n=[];this.operation.buyProcessPaymentMethod="standard"==this.selectedPaymentMethod?"standard":"individual";for(let e=0;e<this.payments.length;e++){const i=this.payments[e];let s={percentage:i.paymentPercentage.toFixed(2),price:i.paymentAmount,date:i.paymentDate};n.push(s)}this.operation.buyProcessPayments=n,this.selectPaymentMethod.emit(this.operation)}}validateValues(){let n=0,e=!1;for(let s=0;s<this.payments.length;s++)n+=this.payments[s].paymentAmount;return e=n==(0!=this.reservationPayment?this.totalPromotionPrice-this.reservationPayment:this.totalPromotionPrice),e}calculateRemainingPayment(){let n=0;for(let e=0;e<this.payments.length;e++)n+=this.payments[e].paymentAmount;return this.totalPromotionPrice-n}calculateRemainingPercentage(){let n=0;for(let e=0;e<this.payments.length;e++)n+=this.payments[e].paymentPercentage;return 100-n}setAmount(n){clearTimeout(this.debounceTimer);let e=this.calculateRemainingPercentage();e<0&&(this.payments[n].paymentPercentage+=e),this.payments[n].paymentAmount=this.calculateAmount(this.payments[n].paymentPercentage),0==n&&0!=this.reservationPayment&&(this.debounceTimer=setTimeout(()=>{this.payments[0].paymentAmount-=this.reservationPayment,this.payments[0].paymentAmount<0&&(this.payments[0].paymentAmount=0)},1100))}setPercentage(n){clearTimeout(this.debounceTimer);let e=this.calculateRemainingPayment();e<0&&(this.payments[n].paymentAmount+=e),this.payments[n].paymentPercentage=this.calculatePercentage(this.payments[n].paymentAmount),0==n&&0!=this.reservationPayment&&(this.debounceTimer=setTimeout(()=>{this.payments[0].paymentAmount-=this.reservationPayment,this.payments[0].paymentAmount<0&&(this.payments[0].paymentAmount=0)},1100))}calculateAmount(n){return Math.round(this.totalPromotionPrice*n/100)}calculatePercentage(n){return 100*n/this.totalPromotionPrice}finishEdit(n){this.payments[n].isEditing=!1}editPayment(n){this.payments[n].isEditing=!0}deletePayment(n){this.hideError(),this.payments.splice(n,1);for(let e=2;e<this.payments.length;e++)this.payments[e].paymentID="Pago "+(e+1)}addMorePayments(){0!=this.calculateRemainingPercentage()&&this.payments.push({paymentID:"Pago "+(this.payments.length+1),paymentPercentage:null,paymentAmount:null,paymentDate:"",isEditing:!1})}setPaymentMethod(){if(this.showError=!1,this.showDateError=!1,this.payments=[],"standard"==this.selectedPaymentMethod)if(this.isPaymentStandard=!0,null==this.operation.mainProperty.promotion.certificationsCharges||null!=this.operation.mainProperty.promotion.certificationsCharges&&0==this.operation.mainProperty.promotion.certificationsCharges.length){let n=this.operation.mainProperty.promotion.buyAndSellContractPaymentQuantityPercentage,e=100-n,i={paymentID:"Pago 1",paymentPercentage:n,paymentAmount:0!=this.reservationPayment?this.calculateAmount(n)-this.reservationPayment:this.calculateAmount(n),paymentDate:"",isEditing:!1},s={paymentID:"Pago 2",paymentPercentage:e,paymentAmount:this.calculateAmount(e),paymentDate:"",isEditing:!1};this.payments.push(i),this.payments.push(s)}else{let n=this.operation.mainProperty.promotion.buyAndSellContractPaymentQuantityPercentage,e={paymentID:"Pago 1",paymentPercentage:n,paymentAmount:0!=this.reservationPayment?this.calculateAmount(n)-this.reservationPayment:this.calculateAmount(n),paymentDate:"",isEditing:!1};this.payments.push(e);let i=this.operation.mainProperty.promotion.certificationsCharges;for(let s=0;s<i.length;s++){const g=i[s];this.payments.push({paymentID:"Pago "+(s+2),paymentPercentage:g.percentage,paymentAmount:this.calculateAmount(g.percentage),paymentDate:"",isEditing:!1})}}else{this.isPaymentStandard=!1;let e={paymentID:"Pago 2",paymentPercentage:null,paymentAmount:null,paymentDate:"",isEditing:!1};this.payments.push({paymentID:"Pago 1",paymentPercentage:null,paymentAmount:null,paymentDate:"",isEditing:!1}),this.payments.push(e)}}ngOnInit(){this.reservationPayment=this.operation.reservationAmount,this.totalPromotionPrice=this.operation.mainProperty.reservationTemporalPrice,this.formatReservationDate()}}return(o=r).\u0275fac=function(n){return new(n||o)},o.\u0275cmp=t.VBU({type:o,selectors:[["app-compra-venta-select-payment-method"]],inputs:{operation:"operation"},outputs:{selectPaymentMethod:"selectPaymentMethod"},decls:22,vars:7,consts:[[1,"venta-component","payment-method-component"],[1,"title"],[1,"content"],[1,"payment-method-radio-group",3,"ngModelChange","ionChange","ngModel"],[1,"crm-input-radio","payment-method-item"],["value","standard"],[1,"crm-input-radio-label"],["value","custom"],[1,"total-payment-price"],["class","reservation-amount",4,"ngIf"],[1,"remaining-price"],[1,"payment-items-container"],[1,"reservation-amount"],[1,"paid-reservation-chip"],[1,"price-table"],[1,"price-table-row"],[1,"crm-button-secondary","add-payments-button"],["class","crm-input-error payment-error",4,"ngIf"],[1,"payment-method-button-container"],[1,"crm-button-secondary","previous-step-button"],[1,"crm-button",3,"click"],[1,"price-table-cell",3,"ngClass"],[1,"price-table-cell"],["placeholder","0","type","number","name","","min","0","max","100",1,"percentage-input",3,"ngClass","id","ngModel"],["placeholder","0","type","number","name","","min","0",1,"amount-input",3,"ngClass","id","ngModel"],["type","date",3,"click","ngModelChange","ngClass","ngModel"],[1,"crm-button-icon-solo",3,"click","ngClass"],[1,"fas","fa-trash"],["name","checkmark-outline",3,"click",4,"ngIf"],["placeholder","0","type","number","name","","min","0","max","100",1,"percentage-input",3,"ngModelChange","focusin","ngClass","id","ngModel"],["placeholder","0","type","number","name","","min","0",1,"amount-input",3,"ngModelChange","focusin","ngClass","id","ngModel"],["name","checkmark-outline",3,"click"],[1,"crm-button-secondary","add-payments-button",3,"click"],["name","add-outline"],[1,"crm-input-error","payment-error"]],template:function(n,e){1&n&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2,"Forma de pago"),t.k0s(),t.j41(3,"div",2)(4,"ion-radio-group",3),t.mxI("ngModelChange",function(s){return t.DH7(e.selectedPaymentMethod,s)||(e.selectedPaymentMethod=s),s}),t.bIt("ionChange",function(){return e.setPaymentMethod()}),t.j41(5,"div",4),t.nrm(6,"ion-radio",5),t.j41(7,"div",6),t.EFF(8,"Pago est\xe1ndar"),t.k0s()(),t.j41(9,"div",4),t.nrm(10,"ion-radio",7),t.j41(11,"div",6),t.EFF(12,"Pago personalizado"),t.k0s()()(),t.j41(13,"div",8)(14,"p"),t.EFF(15),t.nI1(16,"thousandSeparator"),t.k0s(),t.j41(17,"span"),t.EFF(18,"Impuestos incluidos"),t.k0s()(),t.DNE(19,b,9,4,"div",9)(20,x,4,3,"div",10)(21,w,12,3,"div",11),t.k0s()()),2&n&&(t.R7$(4),t.R50("ngModel",e.selectedPaymentMethod),t.R7$(11),t.SpI("Precio de compra ",t.bMT(16,5,e.operation.mainProperty.reservationTemporalPrice)," \u20ac"),t.R7$(4),t.Y8G("ngIf",0!=e.reservationPayment),t.R7$(),t.vxM(""!=e.selectedPaymentMethod?20:-1),t.R7$(),t.vxM(""!=e.selectedPaymentMethod?21:-1))},dependencies:[m.YU,m.bT,p.me,p.Q0,p.BC,p.VZ,p.zX,p.vS,l.iq,l.KO,l.f0,l.Je,C.w],styles:[".payment-method-component[_ngcontent-%COMP%]{width:100%}.title[_ngcontent-%COMP%]{margin-bottom:10px}.payment-method-radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:-moz-fit-content;width:fit-content}.reservation-amount[_ngcontent-%COMP%]{display:flex;align-items:center;margin:5px 0 15px}.reservation-amount[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:var(--crm-font-family);color:var(--crm-black-color);font-size:var(--crm-font-size);margin:0 7px 0 0}.reservation-amount[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0 0 0 7px;font-family:var(--crm-font-family);color:var(--crm-text-color);font-size:10px;font-style:italic}.paid-reservation-chip[_ngcontent-%COMP%]{display:flex;align-items:center;width:-moz-fit-content;width:fit-content;height:28px;border-radius:100px;background-color:var(--crm-success-color-lighter)}.paid-reservation-chip[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 15px!important;font-size:var(--crm-font-size-small);color:var(--crm-success-color)!important;font-weight:700;font-style:normal!important}.total-payment-price[_ngcontent-%COMP%]{display:flex;align-items:center;margin:5px 0 15px}.total-payment-price[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:var(--crm-font-family);color:var(--crm-black-color);font-weight:600;font-size:var(--crm-font-size);margin:0 7px 0 0}.total-payment-price[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0;font-family:var(--crm-font-family);color:var(--crm-text-color);font-size:10px;font-style:italic}.remaining-price[_ngcontent-%COMP%]{display:flex;align-items:center;margin:5px 0 15px}.remaining-price[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:var(--crm-font-family);color:var(--crm-black-color);font-size:var(--crm-font-size);margin:0 7px 0 0}.remaining-price[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0;font-family:var(--crm-font-family);color:var(--crm-text-color);font-size:10px;font-style:italic}.reservation-payment[_ngcontent-%COMP%]{display:flex;align-items:center;margin:5px 0 20px}.reservation-payment[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-family:var(--crm-font-family);color:var(--crm-black-color);font-weight:400;font-size:var(--crm-font-size);margin:0 7px 0 0}.reservation-payment[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{margin:0;font-family:var(--crm-font-family);color:var(--crm-text-color);font-size:10px;font-style:italic}.payment-method-item[_ngcontent-%COMP%]{margin-bottom:20px}.show-delete-payment[_ngcontent-%COMP%]{visibility:visible}.hide-delete-payment[_ngcontent-%COMP%]{visibility:hidden}.price-table[_ngcontent-%COMP%]{border-radius:12px;padding:0 16px;background:var(--crm-primary-background)}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]{display:flex;align-items:center;padding:8px 0;border-bottom:1px solid var(--crm-border-light-color)}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:16px}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.price-table[_ngcontent-%COMP%]   .last-payment[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:normal!important}.price-table[_ngcontent-%COMP%]   .last-payment[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:7px 0 0!important;font-size:10px!important}.price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1;font-size:14px;padding:8px;height:45px}.price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 0 5px;font-size:12px;font-style:italic}.price-table[_ngcontent-%COMP%]   .price-table-cell[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{background:#fff;outline:none;border:1px solid var(--crm-border-light-color);border-radius:8px;height:35px;padding-left:8px}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]:last-child{border-bottom:none}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-cell[_ngcontent-%COMP%]{display:flex;align-items:center}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]{cursor:pointer;display:inline-flex;gap:8px;align-items:center}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-display[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:var(--crm-font-size);color:var(--crm-text-color)}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]{display:inline-flex;gap:8px;align-items:center}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{max-width:120px;background:#fff;outline:none;border:1px solid var(--crm-border-light-color);border-radius:8px;padding:4px 8px}.price-table[_ngcontent-%COMP%]   .price-table-row[_ngcontent-%COMP%]   .editable-price-edit[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{color:var(--crm-text-color);cursor:pointer}.amount-input[_ngcontent-%COMP%]{max-width:90px}.hide-input[_ngcontent-%COMP%]{visibility:hidden}.date-input[_ngcontent-%COMP%]{max-width:100px}.reservation-text[_ngcontent-%COMP%]{font-style:italic!important}.add-payments-button[_ngcontent-%COMP%]{display:flex;margin:10px auto}.payment-method-button-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;margin:15px auto 0}.previous-step-button[_ngcontent-%COMP%]{margin-right:15px}.payment-items-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;width:100%;margin:15px auto}.payment-error[_ngcontent-%COMP%]{margin-top:15px}.show-error-input[_ngcontent-%COMP%]{border:1px solid var(--crm-input-error-color)!important}.hide-error-input[_ngcontent-%COMP%]{border:none!important}"]}),r})();var G=c(467),$=c(7376);let A=(()=>{var o;class r{constructor(n,e){this.api=n,this.router=e,this.previousStep=new t.bkB}navigatePreviousStep(){this.previousStep.emit(!0)}finishFlow(){var n=this;return(0,G.A)(function*(){console.log(n.operation);let e=$.cloneDeep(n.operation);delete e.contact,delete e.createdBy,delete e.responsible,delete e.mainProperty,delete e.currentPipeline,delete e.currentPipelineStep,delete e.promotions,delete e.selectedProperties,delete e.notes,delete e.operations,delete e.operationRegisters,delete e.buyersContacts,delete e.reserveContacts,yield n.api.updateOperationById(n.operation.id,e),n.router.navigate(["/contacts",n.operation.contactId,"operations",n.operation.id])})()}ngOnInit(){}}return(o=r).\u0275fac=function(n){return new(n||o)(t.rXU(_.i),t.rXU(d.Ix))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-compra-venta-select-finish-questionnaire"]],inputs:{operation:"operation"},outputs:{previousStep:"previousStep"},decls:14,vars:0,consts:[[1,"venta-component","end-of-questionnaire-component"],[1,"title"],[1,"content"],[1,"crm-block"],[1,"crm-text",2,"margin-top","16px"],[1,"crm-text",2,"margin-top","8px"],[1,"crm-buttons-group",2,"margin-top","24px"],[1,"crm-button-secondary",3,"click"],[1,"crm-button","crm-button-primary",3,"click"]],template:function(n,e){1&n&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2,"Fin del cuestionario"),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.EFF(6," Su contrato de compraventa est\xe1 listo. "),t.k0s(),t.j41(7,"div",5),t.EFF(8," Puede cambiar sus respuestas volviendo atr\xe1s o pulsar \u201ccontinuar\u201d para proceder a la firma del contrato. "),t.k0s(),t.j41(9,"div",6)(10,"button",7),t.bIt("click",function(){return e.navigatePreviousStep()}),t.EFF(11," Anterior "),t.k0s(),t.j41(12,"button",8),t.bIt("click",function(){return e.finishFlow()}),t.EFF(13," Siguiente "),t.k0s()()()()())},styles:[".title[_ngcontent-%COMP%]{margin-bottom:10px}"]}),r})(),X=(()=>{var o;class r{constructor(n,e){this.api=n,this.route=e,this.selectContractDetails=new t.bkB,this.contractType="byvaro",this.signatureType="electronica"}setContractType(){this.operation.buyProcessContractType="byvaro"==this.contractType?"byvaro":"propio"}setSignatureType(){this.operation.buyProcessSignatureType="electronica"==this.signatureType?"electronica":"papel"}setContractDetails(){this.setContractType(),this.setSignatureType(),this.selectContractDetails.emit(this.operation)}getOperationData(){const n=this.route.snapshot.paramMap.get("operationId");n?this.api.getOperation({id:{equals:n}},null,null,{contact:{apply:!0,filter:null,onlyCount:!1},createdBy:{apply:!0,filter:null,onlyCount:!1},responsible:{apply:!0,filter:null,onlyCount:!1},mainProperty:{apply:!0,filter:null,onlyCount:!1},currentPipeline:{apply:!0,filter:null,onlyCount:!1},currentPipelineStep:{apply:!0,filter:null,onlyCount:!1},promotions:{apply:!0,filter:null,onlyCount:!1},selectedProperties:{apply:!0,filter:null,onlyCount:!1},notes:{apply:!0,filter:null,onlyCount:!1},operations:{apply:!0,filter:null,onlyCount:!1},operationRegisters:{apply:!0,filter:null,onlyCount:!1}}).then(e=>{e.success&&e.success.data&&e.success.data.length&&(this.operation=e.success.data[0],console.log("Retrieved operation:",this.operation))}).catch(e=>{console.error("Error retrieving operation:",e)}):console.warn("No operationId parameter found in the URL.")}ngOnInit(){this.getOperationData()}}return(o=r).\u0275fac=function(n){return new(n||o)(t.rXU(_.i),t.rXU(d.nX))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-compra-venta-contract-details"]],outputs:{selectContractDetails:"selectContractDetails"},decls:35,vars:2,consts:[[1,"venta-component","contract-details-component"],[1,"title"],[1,"content"],[1,"crm-input",2,"margin-bottom","16px"],[1,"crm-text"],[3,"ngModelChange","ngModel"],[1,"crm-input-radio"],["value","byvaro"],[1,"crm-input-radio-label"],["value","propio"],[2,"border","none","border-bottom","1px solid #e5e5e5","margin","24px 0"],["value","electronica"],["value","papel"],[1,"contract-details-button-container"],[1,"crm-button-secondary","previous-step-button"],[1,"crm-button",3,"click"]],template:function(n,e){1&n&&(t.j41(0,"div",0)(1,"div",1),t.EFF(2,"Detalles del contrato y firma"),t.k0s(),t.j41(3,"div",2)(4,"div",3)(5,"div",4),t.EFF(6,"Redacci\xf3n del contrato:"),t.k0s(),t.j41(7,"ion-radio-group",5),t.mxI("ngModelChange",function(s){return t.DH7(e.contractType,s)||(e.contractType=s),s}),t.j41(8,"div",6),t.nrm(9,"ion-radio",7),t.j41(10,"div",8),t.EFF(11,"Contrato redactado en Byvaro"),t.k0s()(),t.j41(12,"div",6),t.nrm(13,"ion-radio",9),t.j41(14,"div",8),t.EFF(15,"Contrato propio"),t.k0s()()()(),t.nrm(16,"hr",10),t.j41(17,"div",3)(18,"div",4),t.EFF(19,"T\xe9rminos y condiciones de la firma: "),t.k0s(),t.j41(20,"ion-radio-group",5),t.mxI("ngModelChange",function(s){return t.DH7(e.signatureType,s)||(e.signatureType=s),s}),t.j41(21,"div",6),t.nrm(22,"ion-radio",11),t.j41(23,"div",8),t.EFF(24,"Firma electr\xf3nica"),t.k0s()(),t.j41(25,"div",6),t.nrm(26,"ion-radio",12),t.j41(27,"div",8),t.EFF(28,"Firma en papel"),t.k0s()()()(),t.nrm(29,"hr",10),t.j41(30,"div",13)(31,"button",14),t.EFF(32," Anterior "),t.k0s(),t.j41(33,"button",15),t.bIt("click",function(){return e.setContractDetails()}),t.EFF(34," Siguiente "),t.k0s()()()()),2&n&&(t.R7$(7),t.R50("ngModel",e.contractType),t.R7$(13),t.R50("ngModel",e.signatureType))},dependencies:[p.BC,p.vS,l.KO,l.f0,l.Je],styles:[".crm-text[_ngcontent-%COMP%]{font-style:normal;margin-bottom:8px}.title[_ngcontent-%COMP%]{margin-bottom:10px}.crm-input-radio[_ngcontent-%COMP%]{margin-bottom:8px}ion-radio-group[_ngcontent-%COMP%]{display:flex;gap:16px}.mb8[_ngcontent-%COMP%]{margin-bottom:8px}.mb16[_ngcontent-%COMP%]{margin-bottom:16px}.contract-details-button-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;width:100%;margin:15px auto 0}.previous-step-button[_ngcontent-%COMP%]{margin-right:15px}"]}),r})();const u=o=>({"hidden-step":o}),z=(o,r)=>({"crm-steps-container-step-current":o,"crm-steps-container-step-inactive":r});function B(o,r){1&o&&t.nrm(0,"i",20)}function N(o,r){if(1&o&&(t.j41(0,"span"),t.EFF(1),t.k0s()),2&o){const a=t.XpG().index;t.R7$(),t.JRh(a+1)}}function Y(o,r){1&o&&t.nrm(0,"div",21)}function U(o,r){if(1&o&&(t.j41(0,"div",14)(1,"div",15),t.DNE(2,B,1,0,"i",16)(3,N,2,1,"span",17),t.k0s(),t.j41(4,"div",18),t.EFF(5),t.k0s(),t.DNE(6,Y,1,0,"div",19),t.k0s()),2&o){const a=r.$implicit,n=r.index,e=t.XpG();t.Y8G("ngClass",t.l_i(5,z,n==e.activeIndex,n>e.activeIndex)),t.R7$(2),t.Y8G("ngIf",n<e.activeIndex),t.R7$(),t.Y8G("ngIf",n>=e.activeIndex),t.R7$(2),t.JRh(a),t.R7$(),t.Y8G("ngIf",n<e.steps.length-1)}}function Q(o,r){if(1&o){const a=t.RV6();t.j41(0,"app-compra-venta-select-payment-method",22),t.bIt("selectPaymentMethod",function(e){t.eBV(a);const i=t.XpG();return t.Njj(i.onSelectPaymentMethod(e))}),t.k0s()}if(2&o){const a=t.XpG();t.Y8G("operation",a.updatedOperation)}}function H(o,r){if(1&o){const a=t.RV6();t.j41(0,"app-compra-venta-select-finish-questionnaire",23),t.bIt("previousStep",function(e){t.eBV(a);const i=t.XpG();return t.Njj(i.onFinishFormPreviousStep(e))}),t.k0s()}if(2&o){const a=t.XpG();t.Y8G("operation",a.updatedOperation)}}const L=[{path:"",component:(()=>{var o;class r{constructor(n){this.api=n,this.steps=["Detalles del contrato","Tipo de comprador","Forma de pago","Fin del cuestionario"],this.data={buyProcessContractType:null,buyProcessPaymentMethod:null,buyProcessPayments:null,buyProcessSignatureType:null},this.activeIndex=0,this.reservedContacts=[]}onSelectContractDetails(n){this.activeIndex=1,this.api.getOperationById(n.id).then(e=>{e.success&&e.success.data&&e.success.data.reserveContacts.length&&(this.reservedContacts=e.success.data.reserveContacts,this.updatedOperation=n)}),this.data.buyProcessContractType=n.buyProcessContractType,this.data.buyProcessSignatureType=n.buyProcessSignatureType}onSelectPaymentMethod(n){this.activeIndex=3,this.updatedOperation=n,this.data.buyProcessPaymentMethod=n.buyProcessPaymentMethod,this.data.buyProcessPayments=n.buyProcessPayments}onFinishFormPreviousStep(n){n&&(this.activeIndex=2,this.data.buyProcessPaymentMethod=null,this.data.buyProcessPayments=null)}changeStep(n){this.activeIndex=n,0==n?(this.data.buyProcessContractType=null,this.data.buyProcessPaymentMethod=null,this.data.buyProcessPayments=null,this.data.buyProcessSignatureType=null):2==n&&(this.data.buyProcessPaymentMethod=null,this.data.buyProcessPayments=null)}onSelectContactData(){this.onFinishFormPreviousStep(!0)}ngOnInit(){}}return(o=r).\u0275fac=function(n){return new(n||o)(t.rXU(_.i))},o.\u0275cmp=t.VBU({type:o,selectors:[["app-compra-venta-operation-process"]],decls:17,vars:20,consts:[[3,"fullscreen"],[1,"crm-block-content"],[1,"crm-block-body"],[1,"crm-block-body-blue-content"],[1,"crm-steps-container"],["class","crm-steps-container-step",3,"ngClass",4,"ngFor","ngForOf"],[1,"venta-body"],[1,"venta-body-component"],[3,"ngClass"],[3,"selectContractDetails"],[3,"selectContactData","operationData","reservedContacts","screen","contactData"],[3,"operation","selectPaymentMethod",4,"ngIf"],[3,"operation","previousStep",4,"ngIf"],[1,"contract-space"],[1,"crm-steps-container-step",3,"ngClass"],[1,"crm-steps-container-step-circle"],["class","fa fa-check",4,"ngIf"],[4,"ngIf"],[1,"crm-steps-container-step-label"],["class","crm-steps-container-step-separator",4,"ngIf"],[1,"fa","fa-check"],[1,"crm-steps-container-step-separator"],[3,"selectPaymentMethod","operation"],[3,"previousStep","operation"]],template:function(n,e){1&n&&(t.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4),t.DNE(5,U,7,8,"div",5),t.k0s(),t.j41(6,"div",6)(7,"div",7)(8,"div",8)(9,"app-compra-venta-contract-details",9),t.bIt("selectContractDetails",function(s){return e.onSelectContractDetails(s)}),t.k0s()(),t.j41(10,"div",8)(11,"app-venta-select-contact-data",10),t.bIt("selectContactData",function(){return e.onSelectContactData()}),t.k0s()(),t.j41(12,"div",8),t.DNE(13,Q,1,1,"app-compra-venta-select-payment-method",11),t.k0s(),t.j41(14,"div",8),t.DNE(15,H,1,1,"app-compra-venta-select-finish-questionnaire",12),t.k0s()(),t.nrm(16,"div",13),t.k0s()()()()()),2&n&&(t.Y8G("fullscreen",!0),t.R7$(5),t.Y8G("ngForOf",e.steps),t.R7$(3),t.Y8G("ngClass",t.eq3(12,u,0!==e.activeIndex)),t.R7$(2),t.Y8G("ngClass",t.eq3(14,u,1!==e.activeIndex)),t.R7$(),t.Y8G("operationData",e.updatedOperation)("reservedContacts",e.reservedContacts)("screen","buy")("contactData",null==e.updatedOperation?null:e.updatedOperation.contact),t.R7$(),t.Y8G("ngClass",t.eq3(16,u,2!==e.activeIndex)),t.R7$(),t.Y8G("ngIf",null!=e.updatedOperation),t.R7$(),t.Y8G("ngClass",t.eq3(18,u,3!==e.activeIndex)),t.R7$(),t.Y8G("ngIf",null!=e.updatedOperation))},dependencies:[m.YU,m.Sq,m.bT,l.W9,P.K,R,A,X],styles:[".back-button[_ngcontent-%COMP%]{display:flex;align-items:center;margin-top:15px;margin-left:15px;width:-moz-fit-content;width:fit-content;height:20px;margin-bottom:10px}.back-button[_ngcontent-%COMP%]:hover{cursor:pointer}.back-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:var(--crm-primary-color-500);margin-right:5px}.back-button[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-family:var(--crm-font-family);color:var(--crm-primary-color-500);font-size:13px}.crm-steps-container[_ngcontent-%COMP%], .crm-steps-container-step[_ngcontent-%COMP%]{display:flex;align-items:center}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#3a50e4;border:1px solid #3a50e4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4}.crm-steps-container-step-current[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#3a50e4}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-circle[_ngcontent-%COMP%]{background:#fff;color:#a8a8a8;border:1px solid rgb(168,168,168)}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-label[_ngcontent-%COMP%]{color:#a8a8a8}.crm-steps-container-step-inactive[_ngcontent-%COMP%]   .crm-steps-container-step-separator[_ngcontent-%COMP%]{background:#a8a8a8}.crm-steps-container-step-circle[_ngcontent-%COMP%]{width:21px;min-width:21px;height:21px;min-height:21px;border-radius:50%;background:#3a50e4;color:#fff;display:flex;justify-content:center;align-items:center;font-weight:700;font-size:12px;margin-right:8px}.crm-steps-container-step-label[_ngcontent-%COMP%]{color:#3a50e4;font-weight:500;margin-right:16px;font-size:13px}.crm-steps-container-step-separator[_ngcontent-%COMP%]{width:20px;height:1px;background:#3a50e4;margin-right:16px}.hidden-step[_ngcontent-%COMP%]{height:0;overflow:hidden;opacity:0;position:absolute;width:0;visibility:hidden}.steps-cards-body[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:16px;display:flex;flex-direction:column;gap:16px}.steps-cards-body-card[_ngcontent-%COMP%]{border:1px solid var(--crm-border-light-color);border-radius:6px;padding:12px}.steps-cards-body-card-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid var(--crm-border-light-color);padding-bottom:16px}.steps-cards-body-card-header-title[_ngcontent-%COMP%]{font-size:13px;font-weight:500;color:var(--crm-text-color)}.steps-cards-body-card-header-icon[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;color:var(--crm-text-color)}.steps-cards-body-card-text[_ngcontent-%COMP%]{font-size:13px;color:var(--crm-text-color);padding-top:16px}.venta-body[_ngcontent-%COMP%]{display:flex;align-items:flex-start;width:100%;gap:16px}.venta-body[_ngcontent-%COMP%]   .steps-cards-body[_ngcontent-%COMP%]{min-width:300px;width:300px;flex-shrink:0}.venta-body-component[_ngcontent-%COMP%]{flex:1 1 0;min-width:0;overflow-y:auto}.contract-space[_ngcontent-%COMP%]{width:55%;height:100vh;background-color:#fff;border-radius:16px}"]}),r})()}];let J=(()=>{var o;class r{}return(o=r).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[d.iI.forChild(L),d.iI]}),r})();var K=c(9662),q=c(6915);let Z=(()=>{var o;class r{}return(o=r).\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.$C({type:o}),o.\u0275inj=t.G2t({imports:[m.MD,p.YN,l.bv,J,K.Y,q.VentaOperationProcessPageModule]}),r})()}}]);