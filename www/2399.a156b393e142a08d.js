"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2399],{2306:(U,S,o)=>{o.d(S,{T:()=>p});var c=o(177),P=o(9417),v=o(3953);let p=(()=>{var m;class r{}return(m=r).\u0275fac=function(I){return new(I||m)},m.\u0275mod=v.$C({type:m}),m.\u0275inj=v.G2t({imports:[c.MD,P.YN]}),r})()},8129:(U,S,o)=>{o.d(S,{K:()=>P});var c=o(3953);let P=(()=>{var v;class p{constructor(r,f){this.el=r,this.renderer=f,this.isLoading=!1}ngOnChanges(r){"isLoading"in r&&this.updateButtonState()}updateButtonState(){const r=this.el.nativeElement;if(this.isLoading){r.getAttribute("data-original-content")||this.renderer.setAttribute(r,"data-original-content",r.innerHTML),this.renderer.setProperty(r,"disabled",!0),this.renderer.setStyle(r,"opacity","0.6"),this.renderer.setStyle(r,"pointer-events","none"),this.renderer.setStyle(r,"cursor","not-allowed");const f=this.renderer.createElement("ion-spinner"),I=this.renderer.createText(" Cargando...");this.renderer.setProperty(r,"innerHTML",""),this.renderer.appendChild(r,f),this.renderer.appendChild(r,I)}else{this.renderer.setProperty(r,"disabled",!1),this.renderer.removeStyle(r,"opacity"),this.renderer.removeStyle(r,"pointer-events"),this.renderer.removeStyle(r,"cursor");const f=r.getAttribute("data-original-content");f&&(this.renderer.setProperty(r,"innerHTML",f),this.renderer.removeAttribute(r,"data-original-content"))}}}return(v=p).\u0275fac=function(r){return new(r||v)(c.rXU(c.aKT),c.rXU(c.sFG))},v.\u0275dir=c.FsC({type:v,selectors:[["","appLoadingButton",""]],inputs:{isLoading:[0,"appLoadingButton","isLoading"]},standalone:!0,features:[c.OA$]}),p})()},1748:(U,S,o)=>{o.d(S,{z:()=>P});var c=o(3953);let P=(()=>{var v;class p{constructor(r,f){this.el=r,this.renderer=f}ngOnInit(){this.checkbox=this.el.nativeElement.querySelector("ion-checkbox"),this.renderer.listen(this.el.nativeElement,"click",r=>{r.target!==this.checkbox&&this.checkbox&&this.checkbox.click()})}}return(v=p).\u0275fac=function(r){return new(r||v)(c.rXU(c.aKT),c.rXU(c.sFG))},v.\u0275dir=c.FsC({type:v,selectors:[["","appToggleCheckbox",""]],standalone:!0}),p})()},6676:(U,S,o)=>{o.r(S),o.d(S,{PromotionCreatePageModule:()=>L});var c=o(177),P=o(9417),v=o(9465),p=o(5188),m=o(467),r=o(293),f=o(7221),I=o(8857),h=o(7376),e=o(3953),G=o(2081),Y=o(4501),t=o(8031),C=o(6552),g=o(8397),E=o(8129);const s=d=>({"crm-block-steps-step-disabled":d}),F=d=>({"crm-section-invisible":d}),a=[{path:"",component:(()=>{var d;class O{constructor(i,n,u,k,b,D){this.api=i,this.headerService=n,this.promotionTransformersService=u,this.utils=k,this.router=b,this.toastService=D,this.currentStep=0,this.loadingButton=!1,this.promotionStep1RequiredFields=[],this.promotionStep3RequiredFields=[]}ngOnInit(){}ionViewWillEnter(){this.headerService.setConfig({title:"promotion_create"})}getData(){}setFormValues(){const i=this.promotionTransformersService.transformPromotionFormStepOne(this.promotion);this.stepOneForm.promotionStepOne=i,this.stepTwoForm.promotionStepTwo=this.promotion,this.promotionTransformersService.transformPromotionFormStepThree(this.promotion)}step1Validation(i){this.promotionStep1RequiredFields=[],i.projectName||this.promotionStep1RequiredFields.push("projectName"),i.constructionType||this.promotionStep1RequiredFields.push("constructionType"),i.constructionSubType||this.promotionStep1RequiredFields.push("constructionSubType"),i.address||this.promotionStep1RequiredFields.push("address"),i.co2EmissionsCertificate||this.promotionStep1RequiredFields.push("co2EmissionsCertificate"),i.energyEfficiencyCertificate||this.promotionStep1RequiredFields.push("energyEfficiencyCertificate")}step3Validation(i){var n;this.promotionStep3RequiredFields=[],i.title_es||this.promotionStep3RequiredFields.push("title_es"),i.description_es||this.promotionStep3RequiredFields.push("description_es"),(h.cloneDeep(null===(n=this.stepThreeForm)||void 0===n||null===(n=n.fileUploaderManager)||void 0===n||null===(n=n.config)||void 0===n?void 0:n.files)||[]).length||this.promotionStep3RequiredFields.push("images")}nextStep(){var i=this;return(0,m.A)(function*(){if(0!==i.currentStep||(i.promotion={...i.promotion,...i.stepOneForm.promotionStepOne},i.step1Validation(i.promotion),!i.promotionStep1RequiredFields.length)){if(1===i.currentStep){const n=i.promotionTransformersService.deleteAllPromotionPropertiesExceptFeatures(i.stepTwoForm.promotionStepTwo);i.promotion={...i.promotion,...n},i.stepThreeForm.disabled=!1,i.stepThreeForm.syncFiles()}2===i.currentStep&&(i.promotion={...i.promotion,title_es:i.stepThreeForm.promotionStepThree.title_es,title_en:i.stepThreeForm.promotionStepThree.title_en,title_de:i.stepThreeForm.promotionStepThree.title_de,title_fr:i.stepThreeForm.promotionStepThree.title_fr,title_ru:i.stepThreeForm.promotionStepThree.title_ru,description_es:i.stepThreeForm.promotionStepThree.description_es,description_en:i.stepThreeForm.promotionStepThree.description_en,description_de:i.stepThreeForm.promotionStepThree.description_de,description_fr:i.stepThreeForm.promotionStepThree.description_fr,description_ru:i.stepThreeForm.promotionStepThree.description_ru,promotionFiles:i.stepThreeForm.promotionStepThree.promotionFiles},i.step3Validation(i.promotion),i.promotionStep3RequiredFields.length)||(i.currentStep>=2&&(console.log("promotion",i.promotion),i.loadingButton=!0,yield i.createPromotion(),i.loadingButton=!1),i.currentStep<2&&i.currentStep++)}})()}prevStep(){this.currentStep--}createPromotion(){var i=this;return(0,m.A)(function*(){console.log("create promotion"),h.cloneDeep(i.promotion.promotionFiles),delete i.promotion.promotionBlocks,delete i.promotion.propertiesCount,delete i.promotion.checked,delete i.promotion.promotionFiles,i.promotion=i.utils.parseProperties(i.promotion),i.promotion.promotionPaymentInfoIsCompleted=!1;const u=yield i.api.createPromotion(i.promotion),k=u.success.data.id;if(!u.success)return console.error(u.error),void i.toastService.showToast({text:u.error.errorMessage,theme:"red",time:2e3});{var b,D,M,B;let z=[...h.cloneDeep(null===(b=i.stepThreeForm)||void 0===b||null===(b=b.fileUploaderManager)||void 0===b||null===(b=b.config)||void 0===b?void 0:b.files)||[],...h.cloneDeep(null===(D=i.stepThreeForm)||void 0===D||null===(D=D.planosFileUploadManagerComponent)||void 0===D||null===(D=D.config)||void 0===D?void 0:D.files)||[],...h.cloneDeep(null===(M=i.stepThreeForm)||void 0===M||null===(M=M.catalogsFileUploadManagerComponent)||void 0===M||null===(M=M.config)||void 0===M?void 0:M.files)||[],...h.cloneDeep(null===(B=i.stepThreeForm)||void 0===B||null===(B=B.videosFileUploadManagerComponent)||void 0===B||null===(B=B.config)||void 0===B?void 0:B.files)||[]];for(let l of z){if(null!=l&&l.new){var A;const y={promotionId:k,name:"",category:l.category,label:l.label,orderIndex:null==l?void 0:l.orderIndex},V=yield i.api.uploadFile(l.fileBlob),X=null==V||null===(A=V.success)||void 0===A||null===(A=A.data)||void 0===A?void 0:A.fileName;y.name=X,yield i.api.addPromotionFile(y)}if(null!=l&&l.deleted&&(yield i.api.removePromotionFileById(null==l?void 0:l.id)),null!=l&&l.moved&&(null==l||!l.deleted)&&(null==l||!l.new)){let y=h.cloneDeep(l);delete y.moved,delete y.fileBase64,delete y.fileBlob,delete y.new,delete y.deleted,delete y.size,delete y.type,yield i.api.editPromotionFile(y)}}}window.location.href="/promotions"})()}}return(d=O).\u0275fac=function(i){return new(i||d)(e.rXU(G.i),e.rXU(Y.d),e.rXU(t.J),e.rXU(C.T),e.rXU(p.Ix),e.rXU(g.f))},d.\u0275cmp=e.VBU({type:d,selectors:[["app-promotion-create"]],viewQuery:function(i,n){if(1&i&&(e.GBs(r.N,5),e.GBs(f.T,5),e.GBs(I.f,5)),2&i){let u;e.mGM(u=e.lsd())&&(n.stepOneForm=u.first),e.mGM(u=e.lsd())&&(n.stepTwoForm=u.first),e.mGM(u=e.lsd())&&(n.stepThreeForm=u.first)}},decls:67,vars:18,consts:[["stepOneForm",""],["stepTwoForm",""],["stepThreeForm",""],[1,"crm-block-body"],[1,"crm-block-steps"],[1,"crm-block-steps-step"],[1,"crm-block-steps-step-left"],[1,"crm-block-steps-step-number"],[1,"crm-block-steps-step-right"],[1,"crm-block-steps-step-title","text-12"],[1,"crm-block-steps-step-subtitle","text-secondary","text-14"],[1,"crm-block-steps-step",3,"ngClass"],[1,"crm-block-body-white-content"],[1,"crm-section","crm-section-center-content",3,"ngClass"],[1,"crm-header-modal","crm-header-modal-padding","crm-header-modal-fixed-top"],[1,"crm-modal-header-title"],[1,"crm-buttons-group"],[1,"crm-button",3,"click"],[3,"requiredFields"],[1,"crm-button-secondary",3,"click"],[1,"crm-button",3,"click","appLoadingButton"]],template:function(i,n){if(1&i){const u=e.RV6();e.j41(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6)(4,"div",7),e.EFF(5," 1 "),e.k0s()(),e.j41(6,"div",8)(7,"div",9),e.EFF(8," Definir la promoci\xf3n "),e.k0s(),e.j41(9,"div",10),e.EFF(10," Establece la informaci\xf3n general de la promoci\xf3n "),e.k0s()()(),e.j41(11,"div",11)(12,"div",6)(13,"div",7),e.EFF(14," 2 "),e.k0s()(),e.j41(15,"div",8)(16,"div",9),e.EFF(17," Caracter\xedsticas "),e.k0s(),e.j41(18,"div",10),e.EFF(19," Selecciona las caracter\xedsticas de las propiedades "),e.k0s()()(),e.j41(20,"div",11)(21,"div",6)(22,"div",7),e.EFF(23," 3 "),e.k0s()(),e.j41(24,"div",8)(25,"div",9),e.EFF(26," Im\xe1genes y textos "),e.k0s(),e.j41(27,"div",10),e.EFF(28," Sube im\xe1genes y selecciona los textos "),e.k0s()()()(),e.j41(29,"div",12)(30,"div",13)(31,"div",14),e.nrm(32,"div",15),e.j41(33,"div",16)(34,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(35," Siguiente "),e.k0s()()(),e.nrm(36,"app-step-one-promotion-form",18,0)(38,"br")(39,"br")(40,"br"),e.k0s(),e.j41(41,"div",13)(42,"div",14),e.nrm(43,"div",15),e.j41(44,"div",16)(45,"button",19),e.bIt("click",function(){return e.eBV(u),e.Njj(n.prevStep())}),e.EFF(46," Atr\xe1s "),e.k0s(),e.j41(47,"button",17),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(48," Siguiente "),e.k0s()()(),e.nrm(49,"app-step-two-promotion-form",null,1)(51,"br")(52,"br")(53,"br"),e.k0s(),e.j41(54,"div",13)(55,"div",14),e.nrm(56,"div",15),e.j41(57,"div",16)(58,"button",19),e.bIt("click",function(){return e.eBV(u),e.Njj(n.prevStep())}),e.EFF(59," Atr\xe1s "),e.k0s(),e.j41(60,"button",20),e.bIt("click",function(){return e.eBV(u),e.Njj(n.nextStep())}),e.EFF(61," Siguiente "),e.k0s()()(),e.nrm(62,"app-step-three-promotion-form",18,2)(64,"br")(65,"br")(66,"br"),e.k0s()()()}2&i&&(e.R7$(11),e.Y8G("ngClass",e.eq3(8,s,n.currentStep<1)),e.R7$(9),e.Y8G("ngClass",e.eq3(10,s,n.currentStep<2)),e.R7$(10),e.Y8G("ngClass",e.eq3(12,F,0!==n.currentStep)),e.R7$(6),e.Y8G("requiredFields",n.promotionStep1RequiredFields),e.R7$(5),e.Y8G("ngClass",e.eq3(14,F,1!==n.currentStep)),e.R7$(13),e.Y8G("ngClass",e.eq3(16,F,2!==n.currentStep)),e.R7$(6),e.Y8G("appLoadingButton",n.loadingButton),e.R7$(2),e.Y8G("requiredFields",n.promotionStep3RequiredFields))},dependencies:[c.YU,r.N,f.T,I.f,E.K]}),O})()}];let R=(()=>{var d;class O{}return(d=O).\u0275fac=function(i){return new(i||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[p.iI.forChild(a),p.iI]}),O})();var T=o(9083);let L=(()=>{var d;class O{}return(d=O).\u0275fac=function(i){return new(i||d)},d.\u0275mod=e.$C({type:d}),d.\u0275inj=e.G2t({imports:[c.MD,P.YN,v.bv,R,T.E]}),O})()},8031:(U,S,o)=>{o.d(S,{J:()=>h});var c=o(467),P=o(7376),p=o(3953),m=o(5970),r=o(8397),f=o(2081),I=o(6552);let h=(()=>{var e;class G{constructor(t,C,g,E){this.popoversService=t,this.toastService=C,this.api=g,this.utils=E}transformPromotionFormStepOne(t){return{projectName:null==t?void 0:t.projectName,constructionType:null==t?void 0:t.constructionType,constructionSubType:null==t?void 0:t.constructionSubType,constructionStatus:null==t?void 0:t.constructionStatus,constructionYear:null==t?void 0:t.constructionYear,constructionStart:null==t?void 0:t.constructionStart,commercializationStart:null==t?void 0:t.commercializationStart,keyDeliveryDate:null==t?void 0:t.keyDeliveryDate,country:null==t?void 0:t.country,province:null==t?void 0:t.province,city:null==t?void 0:t.city,neighborhood:null==t?void 0:t.neighborhood,address:null==t?void 0:t.address,postalCode:null==t?void 0:t.postalCode,number:null==t?void 0:t.number,showAddressPublicly:null==t?void 0:t.showAddressPublicly,showGeoreferencePublicly:null==t?void 0:t.showGeoreferencePublicly,energyEfficiencyCertificate:null==t?void 0:t.energyEfficiencyCertificate,co2EmissionsCertificate:null==t?void 0:t.co2EmissionsCertificate,energyEfficiencyValue:null==t?void 0:t.energyEfficiencyValue,co2EmissionsValue:null==t?void 0:t.co2EmissionsValue}}transformPromotionFormStepThree(t){return{title_es:null==t?void 0:t.title_es,title_en:null==t?void 0:t.title_en,title_de:null==t?void 0:t.title_de,title_fr:null==t?void 0:t.title_fr,title_ru:null==t?void 0:t.title_ru,description_es:null==t?void 0:t.description_es,description_en:null==t?void 0:t.description_en,description_de:null==t?void 0:t.description_de,description_fr:null==t?void 0:t.description_fr,description_ru:null==t?void 0:t.description_ru,promotionFiles:null==t?void 0:t.promotionFiles}}deleteAllPromotionPropertiesExceptFeatures(t){const C=P.cloneDeep(t);for(const g in C)g.startsWith("f_")||g.startsWith("fcustom_")||delete C[g];return C}onDuplicateProperty(t,C){var g=this;return(0,c.A)(function*(){let E=null;const s=yield g.popoversService.onShowDuplicatePropertyPopover(t);var F,_,a,R,T;if(console.log("POPOVER RESULT",s),s&&(null!=s&&null!==(F=s.data)&&void 0!==F&&F.count&&(null==s||null===(_=s.data)||void 0===_?void 0:_.count)>0&&(null==s||null===(a=s.data)||void 0===a?void 0:a.count)<=25?E=null==s||null===(T=s.data)||void 0===T?void 0:T.count:(null==s||null===(R=s.data)||void 0===R?void 0:R.count)>25&&(yield g.toastService.showErrorToast("La cantidad de propiedades a duplicar debe ser mayor a 0 y menor o igual a 25"))),!E)return!1;for(let L=0;L<E;L++)console.log("DUPLICATING PROPERTY",L),yield g.duplicateProperty(C,L);return yield g.toastService.showSuccessToast("Propiedad duplicada exitosamente"),!0})()}duplicateProperty(t,C){var g=this;return(0,c.A)(function*(){var E,s,F,_;let a=P.cloneDeep(t);a=g.utils.parseProperties(a),a.promotionBlockId=t.promotionBlockId,a.promotionId=t.promotionId,a.reference=null!==(E=a)&&void 0!==E&&E.reference?`${null===(s=a)||void 0===s?void 0:s.reference} - Copia ${C+1}`:null,a.availabilityStatus=null;const R=P.cloneDeep((null===(F=a)||void 0===F?void 0:F.propertyFiles)||[]);delete a.id,delete a.propertyFiles,delete a.measurements_floors,delete a.byvaroId,delete a.updatedAt,delete a.createdAt;const T=yield g.api.createProperty(a);null==T||null===(_=T.success)||void 0===_||(_=_.data),console.log("LA PROPERTYYYYYYY",a),console.log("PROPERTY FILES",R)})()}}return(e=G).\u0275fac=function(t){return new(t||e)(p.KVO(m.m),p.KVO(r.f),p.KVO(f.i),p.KVO(I.T))},e.\u0275prov=p.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),G})()},1280:(U,S,o)=>{o.d(S,{B:()=>P,X:()=>c});const c={general:["general","airConditioning","heating"],urbanizacion:["urbanizacion"],cercania:["cercania"],caracteristicas:["caracteristicas"]},P={airConditioning:["AACentralizado","Split","PreInstalacion"],heating:["CentralConGasNatural","CentralConDiesel","CentralConElectricidad","CentralConSueloRadiante","SueloRadianteSoloBanos","CentralConAerotermia","IndividualBombaCalorFrio","IndividualGasPropanoButano"],general:["barbacoa","armariosEmpotrados","puertaBlindada","ascensor","panelesSolares","domotica","gymPrivado","jacuzziPrivado","saunaPrivada","alarma","persianasElectricas","dobleAcristalamiento"],urbanizacion:["Urbanizacion","Portero","UrbanizacionCerrada","Vigilancia24Horas","Gym","PistaDePadel","PistaDeTenis","RestauranteEnElRecinto","SalaDeEventos","Coworking","ZonasAjardinadas","ParqueInfantil","PiscinaInfantil","Hammam","Jacuzzi","Sauna"],cercania:["PrimeraLineaDePlaya","SegundaLineaDePlaya","CercaDeLaPlaya","PrimeraLineaDeGolf","SegundaLineaDeGolf","CercaDeGolf","CentroDeCiudad","CercaDelPuerto"],caracteristicas:["LicenciaTuristica","Balcon","JardinPrivado","Vestidor","Lavanderia","CasaDeInvitados","Chimenea","PistaDeTenisPrivado","PistaDePadelPrivado","Bodega","Despensa"]}}}]);